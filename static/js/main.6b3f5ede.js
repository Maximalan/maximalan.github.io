/*! For license information please see main.6b3f5ede.js.LICENSE.txt */
(()=>{"use strict";var e={7382:(e,t,a)=>{a.r(t),a.d(t,{TAG_COLLECTIONS:()=>s});var n=a(8062);const s=[{name:"Combat Enthusiasts",tags:[n.D.ARMOR,n.D.WEAPONS,n.D.ARCHERY,n.D.FIGHTING],type:"basic",unlocks:[n.D.BATTLES],theme:"collection-basic",chat:"We seem to discuss fighting a lot.",reward:"dmPoint"},{name:"Treasure Seekers",tags:[n.D.GOLD,n.D.TREASURE,n.D.GEMS],type:"basic",unlocks:[],theme:"collection-basic",chat:"All that glitters is glittery...",reward:"dmPoint"},{name:"Chit Chat",tags:[n.D.GOSSIP,n.D.SOCIALIZING],type:"basic",unlocks:[],theme:"collection-basic",chat:"You guys sure like to talk!",reward:"dmPoint"},{name:"Arcania",tags:[n.D.MAGIC,n.D.SPELLS,n.D.BOOKS],type:"basic",unlocks:[],theme:"collection-basic",chat:"This is my magic dog...it's an abracadabradoodle",reward:"dmPoint"},{name:"Fellowship",tags:[n.D.HUMANS,n.D.ELVES,n.D.DWARVES,n.D.HALFLINGS],type:"advanced",unlocks:[],theme:"collection-advanced",chat:"A Human and an Elf walk into a bar. The Dwarf and the Halfling walk under it.",reward:"dmPoint"},{name:"Beast Friends",tags:[n.D.DEER,n.D.COWS,n.D.BEARS,n.D.WOLVES],type:"advanced",unlocks:[],theme:"collection-advanced",chat:"Sometimes I feel like we talk about animals more than people.",reward:"dmPoint"},{name:"Merchant Guild",tags:[n.D.TRADING,n.D.TOWN,n.D.GOLD],type:"advanced",unlocks:[],theme:"collection-advanced",chat:"This game is a really bad lesson in economics.",reward:"dmPoint"},{name:"Typical Fantasy Monsters",tags:[n.D.GOBLINS,n.D.DRAGONS,n.D.UNDEAD],type:"advanced",unlocks:[n.D.FIGHTING],theme:"collection-advanced",chat:"Sometimes the cliche monsters are the best ones.",reward:"dmPoint"},{name:"Epic Fantasy",tags:[n.D.BORING_THINGS,n.D.FARMING,n.D.FURNITURE],type:"advanced",unlocks:[],theme:"collection-advanced",chat:"Wait...Why are we talking about this? This was supposed to be a fantasy game.",reward:"dmPoint"},{name:"Groundskeeper",tags:[n.D.TREES,n.D.FOLIAGE,n.D.GRASS],type:"advanced",unlocks:[],theme:"collection-advanced",chat:"Well-tended plants have their place in my game.",reward:"dmPoint"},{name:"Innkeeper",tags:[n.D.BEER,n.D.WINE,n.D.FIRE,n.D.FOOD],type:"advanced",unlocks:[],theme:"collection-advanced",chat:"A nice fire, a warm meal, and a good drink. Sounds nice in or out of the game.",reward:"dmPoint"},{name:"Holy Roleplay",tags:[n.D.CULTISTS,n.D.RELIGION,n.D.PRIESTS,n.D.CHURCHES,n.D.RITUALS],type:"advanced",unlocks:[],theme:"collection-advanced",chat:"We have covered a lot of religious topics in this session!",reward:"dmPoint"},{name:"Catecombs",tags:[n.D.DUNGEON,n.D.RUINS,n.D.CAVES,n.D.UNDERGROUND],type:"advanced",unlocks:[],theme:"collection-advanced",chat:"Deep in the dark places underground, we can find some pretty hard to see things.",reward:"dmPoint"},{name:"Animal Companions",tags:[n.D.DOGS,n.D.CATS,n.D.HORSES,n.D.FALCONS],type:"advanced",unlocks:[],theme:"collection-advanced",chat:"I hope you guys stopped by the petfood vendor before setting off on your journey.",reward:"dmPoint"}]},8062:(e,t,a)=>{a.d(t,{D:()=>s});var n=a(8530);const s={HUMANS:{name:"humans",preference:n.Ok.MAIN,friendly:!0,category:"RACE"},ELVES:{name:"elves",preference:n.Ok.MAIN,friendly:!0,category:"RACE"},DWARVES:{name:"dwarves",preference:n.Ok.MAIN,friendly:!0,category:"RACE"},ORCS:{name:"orcs",preference:n.Ok.MAIN,friendly:!0,category:"RACE"},HALFLINGS:{name:"halflings",preference:n.Ok.MAIN,friendly:!0,category:"RACE"},HALF_ELVES:{name:"half-elves",preference:n.Ok.MAIN,friendly:!0,category:"RACE"},HUNTERS:{name:"hunters",friendly:!0,category:"PEOPLE"},PRIESTS:{name:"priests",friendly:!0,category:"PEOPLE"},MERCHANTS:{name:"merchants",friendly:!0,category:"PEOPLE"},GOBLINS:{name:"goblins",enemy:!0,category:"MONSTERS"},GNOMES:{name:"gnomes",enemy:!0,category:"MONSTERS"},DRAGONS:{name:"dragons",enemy:!0,category:"MONSTERS"},UNDEAD:{name:"undead",preference:n.Ok.MAIN,enemy:!0,category:"MONSTERS"},BEASTS:{name:"beasts",enemy:!0,category:"MONSTERS"},CULTISTS:{name:"cultists",enemy:!0,category:"MONSTERS"},BANDITS:{name:"bandits",enemy:!0,category:"MONSTERS"},MONSTERS:{name:"monsters",enemy:!0,category:"MONSTERS"},FIGHTING:{name:"fighting",preference:n.Ok.MAIN,category:"GAME"},PUZZLES:{name:"puzzles",preference:n.Ok.MAIN,category:"GAME"},SOCIALIZING:{name:"socializing",category:"GAME"},STRATEGY:{name:"strategy",category:"GAME"},TOWN:{name:"town",preference:n.Ok.START,category:"GAME"},EXPLORATION:{name:"exploration",category:"GAME"},TREASURE_HUNTING:{name:"treasure hunting",category:"GAME"},POLITICS:{name:"politics",category:"GAME"},MAGIC:{name:"magic",preference:n.Ok.START,category:"GAME"},TOOLS:{name:"tools",category:"GAME"},RELIGION:{name:"religion",category:"GAME"},CRAFTING:{name:"crafting",category:"GAME"},TRADING:{name:"trading",category:"GAME"},FARMING:{name:"farming",category:"GAME"},BORING_THINGS:{name:"boring things",category:"GAME"},GOSSIP:{name:"gossip",category:"GAME"},HEALING:{name:"healing",category:"GAME"},CURSE:{name:"curse",category:"GAME"},ARCHERY:{name:"archery",category:"GAME"},EVIL:{name:"evil",category:"GAME"},TRAPS:{name:"traps",category:"GAME"},MYSTERY:{name:"mystery",category:"GAME"},TREASURE:{name:"treasure",category:"TREASURE"},WEAPONS:{name:"weapons",category:"TREASURE"},ARMOR:{name:"armor",category:"TREASURE"},SPELLS:{name:"spells",category:"TREASURE"},GOLD:{name:"gold",category:"TREASURE"},ARTIFACTS:{name:"artifacts",category:"TREASURE"},GEMS:{name:"gems",category:"TREASURE"},DUNGEON:{name:"dungeons",category:"LOCATION"},CITIES:{name:"cities",category:"LOCATION"},WILDERNESS:{name:"the wilderness",category:"LOCATION"},UNDERGROUND:{name:"underground",preference:n.Ok.START,category:"LOCATION"},FORESTS:{name:"forests",preference:n.Ok.START,category:"LOCATION"},DESERTS:{name:"deserts",category:"LOCATION"},SWAMPS:{name:"swamps",category:"LOCATION"},OCEANS:{name:"oceans",category:"LOCATION"},ISLANDS:{name:"islands",category:"LOCATION"},VILLAGES:{name:"villages",category:"LOCATION"},RUINS:{name:"ruins",preference:n.Ok.START,category:"LOCATION"},CASTLES:{name:"castles",preference:n.Ok.START,category:"LOCATION"},CAVE:{name:"caves",preference:n.Ok.START,category:"LOCATION"},PLAINS:{name:"plains",category:"LOCATION"},TAVERNS:{name:"taverns",category:"LOCATION"},BEACHES:{name:"beaches",category:"LOCATION"},BRIDGES:{name:"bridges",category:"LOCATION"},BUILDINGS:{name:"buildings",category:"LOCATION"},CAMP:{name:"camp",category:"LOCATION"},TOWER:{name:"tower",category:"LOCATION"},CABIN:{name:"cabin",category:"LOCATION"},CHURCHES:{name:"churches",category:"LOCATION"},SHIPS:{name:"ships",travel:!0,category:"TRAVEL"},ROADS:{name:"roads",travel:!0,category:"TRAVEL"},HORSES:{name:"horses",travel:!0,category:"TRAVEL"},FURNITURE:{name:"furniture",attributeDefault:"furniture",category:"PROPS"},TABLES:{name:"tables",attributeDefault:"furniture",category:"PROPS"},BARRELS:{name:"barrels",attributeDefault:"furniture",category:"PROPS"},BOOKS:{name:"books",attributeDefault:"furniture",category:"PROPS"},CANDLES:{name:"candles",attributeDefault:"furniture",category:"PROPS"},FOOD:{name:"food",attributeDefault:"food",category:"PROPS"},DRINKS:{name:"drinks",attributeDefault:"food",category:"PROPS"},BEER:{name:"beer",attributeDefault:"food",category:"PROPS"},WINE:{name:"wine",attributeDefault:"food",category:"PROPS"},BELL:{name:"bell",attributeDefault:"furniture",category:"PROPS"},COULDRON:{name:"couldron",attributeDefault:"furniture",category:"PROPS"},ROPE:{name:"rope",attributeDefault:"furniture",category:"PROPS"},STATUES:{name:"statues",category:"PROPS"},RUNES:{name:"runes",category:"PROPS"},FESTIVALS:{name:"festivals",category:"EVENTS"},BATTLES:{name:"battles",category:"EVENTS"},TOURNAMENTS:{name:"tournaments",category:"EVENTS"},QUESTS:{name:"quests",preference:n.Ok.START,category:"EVENTS"},MYSTERIES:{name:"mysteries",category:"EVENTS"},DISASTERS:{name:"disasters",category:"EVENTS"},CELEBRATIONS:{name:"celebrations",category:"EVENTS"},RITUALS:{name:"rituals",category:"EVENTS"},NOBILITY:{name:"nobility",category:"EVENTS"},FIRE:{name:"fire",category:"ELEMENTS"},DARKNESS:{name:"darkness",category:"ELEMENTS"},WATER:{name:"water",category:"ELEMENTS"},FOLIAGE:{name:"foliage",category:"ELEMENTS"},FOG:{name:"fog",category:"ELEMENTS"},SMOKE:{name:"smoke",category:"ELEMENTS"},TREES:{name:"trees",category:"SCENERY"},MOUNTAINS:{name:"mountains",category:"SCENERY"},RIVERS:{name:"rivers",category:"SCENERY"},LAKES:{name:"lakes",category:"SCENERY"},CAVES:{name:"caves",category:"SCENERY"},BOULDERS:{name:"boulders",category:"SCENERY"},GRASS:{name:"grass",category:"SCENERY"},CHICKENS:{name:"chickens",category:"ANIMALS"},COWS:{name:"cows",category:"ANIMALS"},DEER:{name:"deer",category:"ANIMALS"},BEARS:{name:"bears",category:"ANIMALS"},WOLVES:{name:"wolves",category:"ANIMALS"},DOGS:{name:"dogs",category:"ANIMALS"},CATS:{name:"cats",category:"ANIMALS"},FALCONS:{name:"falcons",category:"ANIMALS"},CLICKING:{name:"clicking",category:"SOUNDS"}}},8530:(e,t,a)=>{a.d(t,{$t:()=>m,Co:()=>p,Cu:()=>b,Eh:()=>o,FX:()=>y,HU:()=>N,Mf:()=>r,Ok:()=>s,P$:()=>d,TS:()=>n,UW:()=>g,ap:()=>E,c0:()=>v,d8:()=>c,lM:()=>f,lq:()=>l,p6:()=>h,wb:()=>u,wc:()=>x,zo:()=>i});class n{constructor(){this.nodes=void 0,this.edges=void 0,this.nodes=new Map,this.edges=new Map}addNode(e){this.nodes.set(e.name,e),this.edges.set(e.name,new Map)}addEdge(e,t,a){var n;null===(n=this.edges.get(e))||void 0===n||n.set(t,a)}getNode(e){return this.nodes.get(e)}}let s=function(e){return e[e.MAIN=0]="MAIN",e[e.START=1]="START",e}({}),r=function(e){return e[e.GEAR=0]="GEAR",e[e.PLOT=1]="PLOT",e[e.NONE=2]="NONE",e}({}),i=function(e){return e[e.HATE=-1]="HATE",e[e.CONFLICTED=0]="CONFLICTED",e[e.LIKE=1]="LIKE",e[e.NEUTRAL=100]="NEUTRAL",e}({}),o=function(e){return e.COMBAT="combat",e.MAGIC="magic",e.TOOLS="tools",e}({}),l=function(e){return e.RACE="race",e.GEAR="gear",e.CHARACTER_CLASS="character_class",e.ALL="all",e.NPC="npc",e}({});const c={ENCOUNTER:"encounter",LOCATION:"location",CHARACTER:"character",PLAYER:"player",MESSAGE:"message",TUTORIAL:"tutorial",TOC:"toc",GROUP:"group"},d={CAMPAIGN:"campaign",PLAYER_RECRUITMENT:"player recruitment",CHARACTER_ASSIGNMENT:"character assignment"};let u=function(e){return e.PLAYER="player",e.CHARACTER="character",e.HELPER="helper",e.SYSTEM="system",e.DM="dm",e}({}),h=function(e){return e.CAMPAIGN_START="campaign_start",e.ENCOUNTER_EVENT="encounter_event",e.LOCATION_CHANGE="location_change",e.COMBAT_START="combat_start",e.COMBAT_END="combat_end",e}({}),m=function(e){return e.LOCATION_INTRO="location_intro",e.INTRO_EVENTS="intro_events",e.INTRO_MAIN="intro_main",e.MAIN_EVENTS="main_events",e.INTRO_EXIT="intro_exit",e.EXIT_EVENTS="exit_events",e.EXIT="exit",e}({}),g=function(e){return e.LOCATION="location",e.LOCATION_EXPECTED="location-expected",e.ENCOUNTER="encounter",e.ENCOUNTER_EXPECTED="encounter-expected",e.PLAYERS="players",e.QUESTS="quests",e.RUMOR="rumor",e.PLOT="plot",e.DM="dm",e.ALL="all",e.MAGIC_ITEM_EXPECTED="magic-item-expected",e.MAGIC_ITEM="magic-item",e.FORESHADOWING="foreshadowing",e.FORESHADOWING_EXPECTED="foreshadowing-expected",e.FORESHADOWING_RANDOM="foreshadowing-random",e.BACKSTORY="backstory",e.PLOT_HOOK="plot-hook",e.EXPOSITION="exposition",e.ENEMY="enemy",e.TREASURE="treasure",e.DM_POINT="dmpoint",e.COLLECTION="collection",e.COLLECTION_COLLECTED="collection-collected",e.QUEST="quest",e.QUEST_TERMINAL="quest-terminal",e.PUZZLE="puzzle",e.PUZZLE_ANSWER="puzzle-answer",e.NONE="none",e}({}),p=function(e){return e.COMEDIC="comedic",e.HEROIC="heroic",e.SERIOUS="serious",e.DRAMATIC="dramatic",e.GRIM="grim",e.ROMANTIC="romantic",e.FANTASY="fantasy",e.HORROR="horror",e.NONE="none",e.GLOW="glow",e.length="length",e}({}),f=function(e){return e[e.CURRENT_LOCATION=0]="CURRENT_LOCATION",e[e.BRANCH_LOCATION=1]="BRANCH_LOCATION",e[e.MAGIC_ITEM=2]="MAGIC_ITEM",e[e.PLOT_HOOK=3]="PLOT_HOOK",e[e.CHARACTER_BACKSTORY=4]="CHARACTER_BACKSTORY",e[e.CHARACTER_BACKSTORY_PROGRESS=5]="CHARACTER_BACKSTORY_PROGRESS",e[e.AMBUSH=6]="AMBUSH",e}({}),v=function(e){return e[e.INDEX=0]="INDEX",e[e.DANGER=1]="DANGER",e[e.STRESS=2]="STRESS",e[e.SCORE=3]="SCORE",e}({}),y=function(e){return e[e.TREASURE=0]="TREASURE",e[e.XP=1]="XP",e[e.ITEM=2]="ITEM",e[e.PLOT_HOOK=3]="PLOT_HOOK",e[e.HEALING=4]="HEALING",e[e.BACKSTORY=5]="BACKSTORY",e[e.TOOLS=6]="TOOLS",e[e.MAGIC=7]="MAGIC",e[e.BACKSTORY_PROGRESS=8]="BACKSTORY_PROGRESS",e}({}),b=function(e){return e.ADD_TENSION="add_tension",e.ADD_ENJOYMENT="add_enjoyment",e.ADD_HAPPINESS="add_happiness",e.ADD_REWARDS="add_rewards",e.REPLENISH_MAGIC="replenish_magic",e.REPLENISH_TOOLS="replenish_tools",e.ADD_BACKSTORY="add_backstory",e.HEAL="heal",e.RESURRECT="resurrect",e.INJURE="add_injury",e.USE_TOOLS="use_tools",e.USE_MAGIC="use_magic",e.ADD_TREASURE="add_treasure",e.CAMPAIGN_POINT="CAMPAIGN_POINT",e.NONE="none",e}({}),E=function(e){return e.TEMPLE="temple",e.SHOP="shop",e.TAVERN="tavern",e.MARKETPLACE="marketplace",e.GUILD_HALL="guild_hall",e.BARRACKS="barracks",e.LIBRARY="library",e.FIRE="fire",e.CONFRONTATION="confrontation",e}({}),x=function(e){return e.SHORT="short",e.MEDIUM="medium",e.LONG="long",e}({}),N=function(e){return e.EXPLORE_CURRENT_LOCATION="explore_current_location",e.EXPLORE_UPCOMING_LOCATION="explore_upcoming_location",e.CHARACTER_BACKSTORY="character_backstory",e.AMBUSH="ambush",e.AMBUSH2="ambush2",e.EXPLORE="explore",e.CAMP="camp",e.TRAVEL="travel",e.TRADERS="traders",e.SIDE_QUEST="side_quest",e.MAGIC_CACHE="magic_cache",e}({})},7284:e=>{var t,a="object"===typeof Reflect?Reflect:null,n=a&&"function"===typeof a.apply?a.apply:function(e,t,a){return Function.prototype.apply.call(e,t,a)};t=a&&"function"===typeof a.ownKeys?a.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!==e};function r(){r.init.call(this)}e.exports=r,e.exports.once=function(e,t){return new Promise((function(a,n){function s(a){e.removeListener(t,r),n(a)}function r(){"function"===typeof e.removeListener&&e.removeListener("error",s),a([].slice.call(arguments))}p(e,t,r,{once:!0}),"error"!==t&&function(e,t,a){"function"===typeof e.on&&p(e,"error",t,a)}(e,s,{once:!0})}))},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var i=10;function o(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function c(e,t,a,n){var s,r,i,c;if(o(a),void 0===(r=e._events)?(r=e._events=Object.create(null),e._eventsCount=0):(void 0!==r.newListener&&(e.emit("newListener",t,a.listener?a.listener:a),r=e._events),i=r[t]),void 0===i)i=r[t]=a,++e._eventsCount;else if("function"===typeof i?i=r[t]=n?[a,i]:[i,a]:n?i.unshift(a):i.push(a),(s=l(e))>0&&i.length>s&&!i.warned){i.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=i.length,c=d,console&&console.warn&&console.warn(c)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,a){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:a},s=d.bind(n);return s.listener=a,n.wrapFn=s,s}function h(e,t,a){var n=e._events;if(void 0===n)return[];var s=n[t];return void 0===s?[]:"function"===typeof s?a?[s.listener||s]:[s]:a?function(e){for(var t=new Array(e.length),a=0;a<t.length;++a)t[a]=e[a].listener||e[a];return t}(s):g(s,s.length)}function m(e){var t=this._events;if(void 0!==t){var a=t[e];if("function"===typeof a)return 1;if(void 0!==a)return a.length}return 0}function g(e,t){for(var a=new Array(t),n=0;n<t;++n)a[n]=e[n];return a}function p(e,t,a,n){if("function"===typeof e.on)n.once?e.once(t,a):e.on(t,a);else{if("function"!==typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function s(r){n.once&&e.removeEventListener(t,s),a(r)}))}}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return i},set:function(e){if("number"!==typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");i=e}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return l(this)},r.prototype.emit=function(e){for(var t=[],a=1;a<arguments.length;a++)t.push(arguments[a]);var s="error"===e,r=this._events;if(void 0!==r)s=s&&void 0===r.error;else if(!s)return!1;if(s){var i;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var o=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw o.context=i,o}var l=r[e];if(void 0===l)return!1;if("function"===typeof l)n(l,this,t);else{var c=l.length,d=g(l,c);for(a=0;a<c;++a)n(d[a],this,t)}return!0},r.prototype.addListener=function(e,t){return c(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return c(this,e,t,!0)},r.prototype.once=function(e,t){return o(t),this.on(e,u(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,u(this,e,t)),this},r.prototype.removeListener=function(e,t){var a,n,s,r,i;if(o(t),void 0===(n=this._events))return this;if(void 0===(a=n[e]))return this;if(a===t||a.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,a.listener||t));else if("function"!==typeof a){for(s=-1,r=a.length-1;r>=0;r--)if(a[r]===t||a[r].listener===t){i=a[r].listener,s=r;break}if(s<0)return this;0===s?a.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(a,s),1===a.length&&(n[e]=a[0]),void 0!==n.removeListener&&this.emit("removeListener",e,i||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,a,n;if(void 0===(a=this._events))return this;if(void 0===a.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==a[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete a[e]),this;if(0===arguments.length){var s,r=Object.keys(a);for(n=0;n<r.length;++n)"removeListener"!==(s=r[n])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(t=a[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},r.prototype.listeners=function(e){return h(this,e,!0)},r.prototype.rawListeners=function(e){return h(this,e,!1)},r.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},r.prototype.listenerCount=m,r.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},2730:(e,t,a)=>{var n=a(5043),s=a(8853);function r(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,a=1;a<arguments.length;a++)t+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,o={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)i.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,m={},g={};function p(e,t,a,n,s,r,i){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=s,this.mustUseProperty=a,this.propertyName=e,this.type=t,this.sanitizeURL=r,this.removeEmptyString=i}var f={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){f[e]=new p(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];f[t]=new p(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){f[e]=new p(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){f[e]=new p(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){f[e]=new p(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){f[e]=new p(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){f[e]=new p(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){f[e]=new p(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){f[e]=new p(e,5,!1,e.toLowerCase(),null,!1,!1)}));var v=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,a,n){var s=f.hasOwnProperty(t)?f[t]:null;(null!==s?0!==s.type:n||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,a,n){if(null===t||"undefined"===typeof t||function(e,t,a,n){if(null!==a&&0===a.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==a?!a.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,a,n))return!0;if(n)return!1;if(null!==a)switch(a.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,a,s,n)&&(a=null),n||null===s?function(e){return!!u.call(g,e)||!u.call(m,e)&&(h.test(e)?g[e]=!0:(m[e]=!0,!1))}(t)&&(null===a?e.removeAttribute(t):e.setAttribute(t,""+a)):s.mustUseProperty?e[s.propertyName]=null===a?3!==s.type&&"":a:(t=s.attributeName,n=s.attributeNamespace,null===a?e.removeAttribute(t):(a=3===(s=s.type)||4===s&&!0===a?"":""+a,n?e.setAttributeNS(n,t,a):e.setAttribute(t,a))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(v,y);f[t]=new p(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(v,y);f[t]=new p(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(v,y);f[t]=new p(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){f[e]=new p(e,1,!1,e.toLowerCase(),null,!1,!1)})),f.xlinkHref=new p("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){f[e]=new p(e,1,!1,e.toLowerCase(),null,!0,!0)}));var E=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,x=Symbol.for("react.element"),N=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),A=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),M=Symbol.for("react.context"),j=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),R=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),I=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var O=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var L=Symbol.iterator;function P(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=L&&e[L]||e["@@iterator"])?e:null}var D,U=Object.assign;function _(e){if(void 0===D)try{throw Error()}catch(a){var t=a.stack.trim().match(/\n( *(at )?)/);D=t&&t[1]||""}return"\n"+D+e}var B=!1;function F(e,t){if(!e||B)return"";B=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var n=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){n=c}e.call(t.prototype)}else{try{throw Error()}catch(c){n=c}e()}}catch(c){if(c&&n&&"string"===typeof c.stack){for(var s=c.stack.split("\n"),r=n.stack.split("\n"),i=s.length-1,o=r.length-1;1<=i&&0<=o&&s[i]!==r[o];)o--;for(;1<=i&&0<=o;i--,o--)if(s[i]!==r[o]){if(1!==i||1!==o)do{if(i--,0>--o||s[i]!==r[o]){var l="\n"+s[i].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=i&&0<=o);break}}}finally{B=!1,Error.prepareStackTrace=a}return(e=e?e.displayName||e.name:"")?_(e):""}function H(e){switch(e.tag){case 5:return _(e.type);case 16:return _("Lazy");case 13:return _("Suspense");case 19:return _("SuspenseList");case 0:case 2:case 15:return e=F(e.type,!1);case 11:return e=F(e.type.render,!1);case 1:return e=F(e.type,!0);default:return""}}function G(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case T:return"Fragment";case N:return"Portal";case A:return"Profiler";case C:return"StrictMode";case w:return"Suspense";case R:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case M:return(e.displayName||"Context")+".Consumer";case S:return(e._context.displayName||"Context")+".Provider";case j:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case k:return null!==(t=e.displayName||null)?t:G(e.type)||"Memo";case I:t=e._payload,e=e._init;try{return G(e(t))}catch(a){}}return null}function W(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return G(t);case 8:return t===C?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function z(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function Q(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function V(e){e._valueTracker||(e._valueTracker=function(e){var t=Q(e)?"checked":"value",a=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof a&&"function"===typeof a.get&&"function"===typeof a.set){var s=a.get,r=a.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(e){n=""+e,r.call(this,e)}}),Object.defineProperty(e,t,{enumerable:a.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Y(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var a=t.getValue(),n="";return e&&(n=Q(e)?e.checked?"true":"false":e.value),(e=n)!==a&&(t.setValue(e),!0)}function K(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function q(e,t){var a=t.checked;return U({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=a?a:e._wrapperState.initialChecked})}function X(e,t){var a=null==t.defaultValue?"":t.defaultValue,n=null!=t.checked?t.checked:t.defaultChecked;a=z(null!=t.value?t.value:a),e._wrapperState={initialChecked:n,initialValue:a,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Z(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function J(e,t){Z(e,t);var a=z(t.value),n=t.type;if(null!=a)"number"===n?(0===a&&""===e.value||e.value!=a)&&(e.value=""+a):e.value!==""+a&&(e.value=""+a);else if("submit"===n||"reset"===n)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,a):t.hasOwnProperty("defaultValue")&&ee(e,t.type,z(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,a){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!("submit"!==n&&"reset"!==n||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,a||t===e.value||(e.value=t),e.defaultValue=t}""!==(a=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==a&&(e.name=a)}function ee(e,t,a){"number"===t&&K(e.ownerDocument)===e||(null==a?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+a&&(e.defaultValue=""+a))}var te=Array.isArray;function ae(e,t,a,n){if(e=e.options,t){t={};for(var s=0;s<a.length;s++)t["$"+a[s]]=!0;for(a=0;a<e.length;a++)s=t.hasOwnProperty("$"+e[a].value),e[a].selected!==s&&(e[a].selected=s),s&&n&&(e[a].defaultSelected=!0)}else{for(a=""+z(a),t=null,s=0;s<e.length;s++){if(e[s].value===a)return e[s].selected=!0,void(n&&(e[s].defaultSelected=!0));null!==t||e[s].disabled||(t=e[s])}null!==t&&(t.selected=!0)}}function ne(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(r(91));return U({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function se(e,t){var a=t.value;if(null==a){if(a=t.children,t=t.defaultValue,null!=a){if(null!=t)throw Error(r(92));if(te(a)){if(1<a.length)throw Error(r(93));a=a[0]}t=a}null==t&&(t=""),a=t}e._wrapperState={initialValue:z(a)}}function re(e,t){var a=z(t.value),n=z(t.defaultValue);null!=a&&((a=""+a)!==e.value&&(e.value=a),null==t.defaultValue&&e.defaultValue!==a&&(e.defaultValue=a)),null!=n&&(e.defaultValue=""+n)}function ie(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,de,ue=(de=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,a,n){MSApp.execUnsafeLocalFunction((function(){return de(e,t)}))}:de);function he(e,t){if(t){var a=e.firstChild;if(a&&a===e.lastChild&&3===a.nodeType)return void(a.nodeValue=t)}e.textContent=t}var me={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ge=["Webkit","ms","Moz","O"];function pe(e,t,a){return null==t||"boolean"===typeof t||""===t?"":a||"number"!==typeof t||0===t||me.hasOwnProperty(e)&&me[e]?(""+t).trim():t+"px"}function fe(e,t){for(var a in e=e.style,t)if(t.hasOwnProperty(a)){var n=0===a.indexOf("--"),s=pe(a,t[a],n);"float"===a&&(a="cssFloat"),n?e.setProperty(a,s):e[a]=s}}Object.keys(me).forEach((function(e){ge.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),me[t]=me[e]}))}));var ve=U({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(r(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(r(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(r(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(r(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ee=null;function xe(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ne=null,Te=null,Ce=null;function Ae(e){if(e=bs(e)){if("function"!==typeof Ne)throw Error(r(280));var t=e.stateNode;t&&(t=xs(t),Ne(e.stateNode,e.type,t))}}function Se(e){Te?Ce?Ce.push(e):Ce=[e]:Te=e}function Me(){if(Te){var e=Te,t=Ce;if(Ce=Te=null,Ae(e),t)for(e=0;e<t.length;e++)Ae(t[e])}}function je(e,t){return e(t)}function we(){}var Re=!1;function ke(e,t,a){if(Re)return e(t,a);Re=!0;try{return je(e,t,a)}finally{Re=!1,(null!==Te||null!==Ce)&&(we(),Me())}}function Ie(e,t){var a=e.stateNode;if(null===a)return null;var n=xs(a);if(null===n)return null;a=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!n;break e;default:e=!1}if(e)return null;if(a&&"function"!==typeof a)throw Error(r(231,t,typeof a));return a}var Oe=!1;if(d)try{var Le={};Object.defineProperty(Le,"passive",{get:function(){Oe=!0}}),window.addEventListener("test",Le,Le),window.removeEventListener("test",Le,Le)}catch(de){Oe=!1}function Pe(e,t,a,n,s,r,i,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(a,c)}catch(d){this.onError(d)}}var De=!1,Ue=null,_e=!1,Be=null,Fe={onError:function(e){De=!0,Ue=e}};function He(e,t,a,n,s,r,i,o,l){De=!1,Ue=null,Pe.apply(Fe,arguments)}function Ge(e){var t=e,a=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(a=t.return),e=t.return}while(e)}return 3===t.tag?a:null}function We(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function ze(e){if(Ge(e)!==e)throw Error(r(188))}function Qe(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ge(e)))throw Error(r(188));return t!==e?null:e}for(var a=e,n=t;;){var s=a.return;if(null===s)break;var i=s.alternate;if(null===i){if(null!==(n=s.return)){a=n;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===a)return ze(s),e;if(i===n)return ze(s),t;i=i.sibling}throw Error(r(188))}if(a.return!==n.return)a=s,n=i;else{for(var o=!1,l=s.child;l;){if(l===a){o=!0,a=s,n=i;break}if(l===n){o=!0,n=s,a=i;break}l=l.sibling}if(!o){for(l=i.child;l;){if(l===a){o=!0,a=i,n=s;break}if(l===n){o=!0,n=i,a=s;break}l=l.sibling}if(!o)throw Error(r(189))}}if(a.alternate!==n)throw Error(r(190))}if(3!==a.tag)throw Error(r(188));return a.stateNode.current===a?e:t}(e))?Ve(e):null}function Ve(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ve(e);if(null!==t)return t;e=e.sibling}return null}var Ye=s.unstable_scheduleCallback,Ke=s.unstable_cancelCallback,qe=s.unstable_shouldYield,Xe=s.unstable_requestPaint,Ze=s.unstable_now,Je=s.unstable_getCurrentPriorityLevel,$e=s.unstable_ImmediatePriority,et=s.unstable_UserBlockingPriority,tt=s.unstable_NormalPriority,at=s.unstable_LowPriority,nt=s.unstable_IdlePriority,st=null,rt=null;var it=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/lt|0)|0},ot=Math.log,lt=Math.LN2;var ct=64,dt=4194304;function ut(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var a=e.pendingLanes;if(0===a)return 0;var n=0,s=e.suspendedLanes,r=e.pingedLanes,i=268435455&a;if(0!==i){var o=i&~s;0!==o?n=ut(o):0!==(r&=i)&&(n=ut(r))}else 0!==(i=a&~s)?n=ut(i):0!==r&&(n=ut(r));if(0===n)return 0;if(0!==t&&t!==n&&0===(t&s)&&((s=n&-n)>=(r=t&-t)||16===s&&0!==(4194240&r)))return t;if(0!==(4&n)&&(n|=16&a),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=n;0<t;)s=1<<(a=31-it(t)),n|=e[a],t&=~s;return n}function mt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function gt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function pt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function ft(e){for(var t=[],a=0;31>a;a++)t.push(e);return t}function vt(e,t,a){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-it(t)]=a}function yt(e,t){var a=e.entangledLanes|=t;for(e=e.entanglements;a;){var n=31-it(a),s=1<<n;s&t|e[n]&t&&(e[n]|=t),a&=~s}}var bt=0;function Et(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var xt,Nt,Tt,Ct,At,St=!1,Mt=[],jt=null,wt=null,Rt=null,kt=new Map,It=new Map,Ot=[],Lt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Pt(e,t){switch(e){case"focusin":case"focusout":jt=null;break;case"dragenter":case"dragleave":wt=null;break;case"mouseover":case"mouseout":Rt=null;break;case"pointerover":case"pointerout":kt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":It.delete(t.pointerId)}}function Dt(e,t,a,n,s,r){return null===e||e.nativeEvent!==r?(e={blockedOn:t,domEventName:a,eventSystemFlags:n,nativeEvent:r,targetContainers:[s]},null!==t&&(null!==(t=bs(t))&&Nt(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,null!==s&&-1===t.indexOf(s)&&t.push(s),e)}function Ut(e){var t=ys(e.target);if(null!==t){var a=Ge(t);if(null!==a)if(13===(t=a.tag)){if(null!==(t=We(a)))return e.blockedOn=t,void At(e.priority,(function(){Tt(a)}))}else if(3===t&&a.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===a.tag?a.stateNode.containerInfo:null)}e.blockedOn=null}function _t(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var a=qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==a)return null!==(t=bs(a))&&Nt(t),e.blockedOn=a,!1;var n=new(a=e.nativeEvent).constructor(a.type,a);Ee=n,a.target.dispatchEvent(n),Ee=null,t.shift()}return!0}function Bt(e,t,a){_t(e)&&a.delete(t)}function Ft(){St=!1,null!==jt&&_t(jt)&&(jt=null),null!==wt&&_t(wt)&&(wt=null),null!==Rt&&_t(Rt)&&(Rt=null),kt.forEach(Bt),It.forEach(Bt)}function Ht(e,t){e.blockedOn===t&&(e.blockedOn=null,St||(St=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,Ft)))}function Gt(e){function t(t){return Ht(t,e)}if(0<Mt.length){Ht(Mt[0],e);for(var a=1;a<Mt.length;a++){var n=Mt[a];n.blockedOn===e&&(n.blockedOn=null)}}for(null!==jt&&Ht(jt,e),null!==wt&&Ht(wt,e),null!==Rt&&Ht(Rt,e),kt.forEach(t),It.forEach(t),a=0;a<Ot.length;a++)(n=Ot[a]).blockedOn===e&&(n.blockedOn=null);for(;0<Ot.length&&null===(a=Ot[0]).blockedOn;)Ut(a),null===a.blockedOn&&Ot.shift()}var Wt=E.ReactCurrentBatchConfig,zt=!0;function Qt(e,t,a,n){var s=bt,r=Wt.transition;Wt.transition=null;try{bt=1,Yt(e,t,a,n)}finally{bt=s,Wt.transition=r}}function Vt(e,t,a,n){var s=bt,r=Wt.transition;Wt.transition=null;try{bt=4,Yt(e,t,a,n)}finally{bt=s,Wt.transition=r}}function Yt(e,t,a,n){if(zt){var s=qt(e,t,a,n);if(null===s)zn(e,t,n,Kt,a),Pt(e,n);else if(function(e,t,a,n,s){switch(t){case"focusin":return jt=Dt(jt,e,t,a,n,s),!0;case"dragenter":return wt=Dt(wt,e,t,a,n,s),!0;case"mouseover":return Rt=Dt(Rt,e,t,a,n,s),!0;case"pointerover":var r=s.pointerId;return kt.set(r,Dt(kt.get(r)||null,e,t,a,n,s)),!0;case"gotpointercapture":return r=s.pointerId,It.set(r,Dt(It.get(r)||null,e,t,a,n,s)),!0}return!1}(s,e,t,a,n))n.stopPropagation();else if(Pt(e,n),4&t&&-1<Lt.indexOf(e)){for(;null!==s;){var r=bs(s);if(null!==r&&xt(r),null===(r=qt(e,t,a,n))&&zn(e,t,n,Kt,a),r===s)break;s=r}null!==s&&n.stopPropagation()}else zn(e,t,n,null,a)}}var Kt=null;function qt(e,t,a,n){if(Kt=null,null!==(e=ys(e=xe(n))))if(null===(t=Ge(e)))e=null;else if(13===(a=t.tag)){if(null!==(e=We(t)))return e;e=null}else if(3===a){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Kt=e,null}function Xt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case $e:return 1;case et:return 4;case tt:case at:return 16;case nt:return 536870912;default:return 16}default:return 16}}var Zt=null,Jt=null,$t=null;function ea(){if($t)return $t;var e,t,a=Jt,n=a.length,s="value"in Zt?Zt.value:Zt.textContent,r=s.length;for(e=0;e<n&&a[e]===s[e];e++);var i=n-e;for(t=1;t<=i&&a[n-t]===s[r-t];t++);return $t=s.slice(e,1<t?1-t:void 0)}function ta(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function aa(){return!0}function na(){return!1}function sa(e){function t(t,a,n,s,r){for(var i in this._reactName=t,this._targetInst=n,this.type=a,this.nativeEvent=s,this.target=r,this.currentTarget=null,e)e.hasOwnProperty(i)&&(t=e[i],this[i]=t?t(s):s[i]);return this.isDefaultPrevented=(null!=s.defaultPrevented?s.defaultPrevented:!1===s.returnValue)?aa:na,this.isPropagationStopped=na,this}return U(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=aa)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=aa)},persist:function(){},isPersistent:aa}),t}var ra,ia,oa,la={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ca=sa(la),da=U({},la,{view:0,detail:0}),ua=sa(da),ha=U({},da,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ca,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==oa&&(oa&&"mousemove"===e.type?(ra=e.screenX-oa.screenX,ia=e.screenY-oa.screenY):ia=ra=0,oa=e),ra)},movementY:function(e){return"movementY"in e?e.movementY:ia}}),ma=sa(ha),ga=sa(U({},ha,{dataTransfer:0})),pa=sa(U({},da,{relatedTarget:0})),fa=sa(U({},la,{animationName:0,elapsedTime:0,pseudoElement:0})),va=U({},la,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),ya=sa(va),ba=sa(U({},la,{data:0})),Ea={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xa={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Na={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ta(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Na[e])&&!!t[e]}function Ca(){return Ta}var Aa=U({},da,{key:function(e){if(e.key){var t=Ea[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=ta(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?xa[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ca,charCode:function(e){return"keypress"===e.type?ta(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?ta(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Sa=sa(Aa),Ma=sa(U({},ha,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),ja=sa(U({},da,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ca})),wa=sa(U({},la,{propertyName:0,elapsedTime:0,pseudoElement:0})),Ra=U({},ha,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),ka=sa(Ra),Ia=[9,13,27,32],Oa=d&&"CompositionEvent"in window,La=null;d&&"documentMode"in document&&(La=document.documentMode);var Pa=d&&"TextEvent"in window&&!La,Da=d&&(!Oa||La&&8<La&&11>=La),Ua=String.fromCharCode(32),_a=!1;function Ba(e,t){switch(e){case"keyup":return-1!==Ia.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Fa(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Ha=!1;var Ga={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wa(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Ga[e.type]:"textarea"===t}function za(e,t,a,n){Se(n),0<(t=Vn(t,"onChange")).length&&(a=new ca("onChange","change",null,a,n),e.push({event:a,listeners:t}))}var Qa=null,Va=null;function Ya(e){_n(e,0)}function Ka(e){if(Y(Es(e)))return e}function qa(e,t){if("change"===e)return t}var Xa=!1;if(d){var Za;if(d){var Ja="oninput"in document;if(!Ja){var $a=document.createElement("div");$a.setAttribute("oninput","return;"),Ja="function"===typeof $a.oninput}Za=Ja}else Za=!1;Xa=Za&&(!document.documentMode||9<document.documentMode)}function en(){Qa&&(Qa.detachEvent("onpropertychange",tn),Va=Qa=null)}function tn(e){if("value"===e.propertyName&&Ka(Va)){var t=[];za(t,Va,e,xe(e)),ke(Ya,t)}}function an(e,t,a){"focusin"===e?(en(),Va=a,(Qa=t).attachEvent("onpropertychange",tn)):"focusout"===e&&en()}function nn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Ka(Va)}function sn(e,t){if("click"===e)return Ka(t)}function rn(e,t){if("input"===e||"change"===e)return Ka(t)}var on="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ln(e,t){if(on(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var a=Object.keys(e),n=Object.keys(t);if(a.length!==n.length)return!1;for(n=0;n<a.length;n++){var s=a[n];if(!u.call(t,s)||!on(e[s],t[s]))return!1}return!0}function cn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function dn(e,t){var a,n=cn(e);for(e=0;n;){if(3===n.nodeType){if(a=e+n.textContent.length,e<=t&&a>=t)return{node:n,offset:t-e};e=a}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=cn(n)}}function un(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?un(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hn(){for(var e=window,t=K();t instanceof e.HTMLIFrameElement;){try{var a="string"===typeof t.contentWindow.location.href}catch(n){a=!1}if(!a)break;t=K((e=t.contentWindow).document)}return t}function mn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function gn(e){var t=hn(),a=e.focusedElem,n=e.selectionRange;if(t!==a&&a&&a.ownerDocument&&un(a.ownerDocument.documentElement,a)){if(null!==n&&mn(a))if(t=n.start,void 0===(e=n.end)&&(e=t),"selectionStart"in a)a.selectionStart=t,a.selectionEnd=Math.min(e,a.value.length);else if((e=(t=a.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var s=a.textContent.length,r=Math.min(n.start,s);n=void 0===n.end?r:Math.min(n.end,s),!e.extend&&r>n&&(s=n,n=r,r=s),s=dn(a,r);var i=dn(a,n);s&&i&&(1!==e.rangeCount||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==i.node||e.focusOffset!==i.offset)&&((t=t.createRange()).setStart(s.node,s.offset),e.removeAllRanges(),r>n?(e.addRange(t),e.extend(i.node,i.offset)):(t.setEnd(i.node,i.offset),e.addRange(t)))}for(t=[],e=a;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof a.focus&&a.focus(),a=0;a<t.length;a++)(e=t[a]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var pn=d&&"documentMode"in document&&11>=document.documentMode,fn=null,vn=null,yn=null,bn=!1;function En(e,t,a){var n=a.window===a?a.document:9===a.nodeType?a:a.ownerDocument;bn||null==fn||fn!==K(n)||("selectionStart"in(n=fn)&&mn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},yn&&ln(yn,n)||(yn=n,0<(n=Vn(vn,"onSelect")).length&&(t=new ca("onSelect","select",null,t,a),e.push({event:t,listeners:n}),t.target=fn)))}function xn(e,t){var a={};return a[e.toLowerCase()]=t.toLowerCase(),a["Webkit"+e]="webkit"+t,a["Moz"+e]="moz"+t,a}var Nn={animationend:xn("Animation","AnimationEnd"),animationiteration:xn("Animation","AnimationIteration"),animationstart:xn("Animation","AnimationStart"),transitionend:xn("Transition","TransitionEnd")},Tn={},Cn={};function An(e){if(Tn[e])return Tn[e];if(!Nn[e])return e;var t,a=Nn[e];for(t in a)if(a.hasOwnProperty(t)&&t in Cn)return Tn[e]=a[t];return e}d&&(Cn=document.createElement("div").style,"AnimationEvent"in window||(delete Nn.animationend.animation,delete Nn.animationiteration.animation,delete Nn.animationstart.animation),"TransitionEvent"in window||delete Nn.transitionend.transition);var Sn=An("animationend"),Mn=An("animationiteration"),jn=An("animationstart"),wn=An("transitionend"),Rn=new Map,kn="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function In(e,t){Rn.set(e,t),l(t,[e])}for(var On=0;On<kn.length;On++){var Ln=kn[On];In(Ln.toLowerCase(),"on"+(Ln[0].toUpperCase()+Ln.slice(1)))}In(Sn,"onAnimationEnd"),In(Mn,"onAnimationIteration"),In(jn,"onAnimationStart"),In("dblclick","onDoubleClick"),In("focusin","onFocus"),In("focusout","onBlur"),In(wn,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Pn="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Dn=new Set("cancel close invalid load scroll toggle".split(" ").concat(Pn));function Un(e,t,a){var n=e.type||"unknown-event";e.currentTarget=a,function(e,t,a,n,s,i,o,l,c){if(He.apply(this,arguments),De){if(!De)throw Error(r(198));var d=Ue;De=!1,Ue=null,_e||(_e=!0,Be=d)}}(n,t,void 0,e),e.currentTarget=null}function _n(e,t){t=0!==(4&t);for(var a=0;a<e.length;a++){var n=e[a],s=n.event;n=n.listeners;e:{var r=void 0;if(t)for(var i=n.length-1;0<=i;i--){var o=n[i],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==r&&s.isPropagationStopped())break e;Un(s,o,c),r=l}else for(i=0;i<n.length;i++){if(l=(o=n[i]).instance,c=o.currentTarget,o=o.listener,l!==r&&s.isPropagationStopped())break e;Un(s,o,c),r=l}}}if(_e)throw e=Be,_e=!1,Be=null,e}function Bn(e,t){var a=t[ps];void 0===a&&(a=t[ps]=new Set);var n=e+"__bubble";a.has(n)||(Wn(t,e,2,!1),a.add(n))}function Fn(e,t,a){var n=0;t&&(n|=4),Wn(a,e,n,t)}var Hn="_reactListening"+Math.random().toString(36).slice(2);function Gn(e){if(!e[Hn]){e[Hn]=!0,i.forEach((function(t){"selectionchange"!==t&&(Dn.has(t)||Fn(t,!1,e),Fn(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Hn]||(t[Hn]=!0,Fn("selectionchange",!1,t))}}function Wn(e,t,a,n){switch(Xt(t)){case 1:var s=Qt;break;case 4:s=Vt;break;default:s=Yt}a=s.bind(null,t,a,e),s=void 0,!Oe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(s=!0),n?void 0!==s?e.addEventListener(t,a,{capture:!0,passive:s}):e.addEventListener(t,a,!0):void 0!==s?e.addEventListener(t,a,{passive:s}):e.addEventListener(t,a,!1)}function zn(e,t,a,n,s){var r=n;if(0===(1&t)&&0===(2&t)&&null!==n)e:for(;;){if(null===n)return;var i=n.tag;if(3===i||4===i){var o=n.stateNode.containerInfo;if(o===s||8===o.nodeType&&o.parentNode===s)break;if(4===i)for(i=n.return;null!==i;){var l=i.tag;if((3===l||4===l)&&((l=i.stateNode.containerInfo)===s||8===l.nodeType&&l.parentNode===s))return;i=i.return}for(;null!==o;){if(null===(i=ys(o)))return;if(5===(l=i.tag)||6===l){n=r=i;continue e}o=o.parentNode}}n=n.return}ke((function(){var n=r,s=xe(a),i=[];e:{var o=Rn.get(e);if(void 0!==o){var l=ca,c=e;switch(e){case"keypress":if(0===ta(a))break e;case"keydown":case"keyup":l=Sa;break;case"focusin":c="focus",l=pa;break;case"focusout":c="blur",l=pa;break;case"beforeblur":case"afterblur":l=pa;break;case"click":if(2===a.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=ma;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=ga;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=ja;break;case Sn:case Mn:case jn:l=fa;break;case wn:l=wa;break;case"scroll":l=ua;break;case"wheel":l=ka;break;case"copy":case"cut":case"paste":l=ya;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Ma}var d=0!==(4&t),u=!d&&"scroll"===e,h=d?null!==o?o+"Capture":null:o;d=[];for(var m,g=n;null!==g;){var p=(m=g).stateNode;if(5===m.tag&&null!==p&&(m=p,null!==h&&(null!=(p=Ie(g,h))&&d.push(Qn(g,p,m)))),u)break;g=g.return}0<d.length&&(o=new l(o,c,null,a,s),i.push({event:o,listeners:d}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||a===Ee||!(c=a.relatedTarget||a.fromElement)||!ys(c)&&!c[gs])&&(l||o)&&(o=s.window===s?s:(o=s.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=n,null!==(c=(c=a.relatedTarget||a.toElement)?ys(c):null)&&(c!==(u=Ge(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=n),l!==c)){if(d=ma,p="onMouseLeave",h="onMouseEnter",g="mouse","pointerout"!==e&&"pointerover"!==e||(d=Ma,p="onPointerLeave",h="onPointerEnter",g="pointer"),u=null==l?o:Es(l),m=null==c?o:Es(c),(o=new d(p,g+"leave",l,a,s)).target=u,o.relatedTarget=m,p=null,ys(s)===n&&((d=new d(h,g+"enter",c,a,s)).target=m,d.relatedTarget=u,p=d),u=p,l&&c)e:{for(h=c,g=0,m=d=l;m;m=Yn(m))g++;for(m=0,p=h;p;p=Yn(p))m++;for(;0<g-m;)d=Yn(d),g--;for(;0<m-g;)h=Yn(h),m--;for(;g--;){if(d===h||null!==h&&d===h.alternate)break e;d=Yn(d),h=Yn(h)}d=null}else d=null;null!==l&&Kn(i,o,l,d,!1),null!==c&&null!==u&&Kn(i,u,c,d,!0)}if("select"===(l=(o=n?Es(n):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var f=qa;else if(Wa(o))if(Xa)f=rn;else{f=nn;var v=an}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(f=sn);switch(f&&(f=f(e,n))?za(i,f,a,s):(v&&v(e,o,n),"focusout"===e&&(v=o._wrapperState)&&v.controlled&&"number"===o.type&&ee(o,"number",o.value)),v=n?Es(n):window,e){case"focusin":(Wa(v)||"true"===v.contentEditable)&&(fn=v,vn=n,yn=null);break;case"focusout":yn=vn=fn=null;break;case"mousedown":bn=!0;break;case"contextmenu":case"mouseup":case"dragend":bn=!1,En(i,a,s);break;case"selectionchange":if(pn)break;case"keydown":case"keyup":En(i,a,s)}var y;if(Oa)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Ha?Ba(e,a)&&(b="onCompositionEnd"):"keydown"===e&&229===a.keyCode&&(b="onCompositionStart");b&&(Da&&"ko"!==a.locale&&(Ha||"onCompositionStart"!==b?"onCompositionEnd"===b&&Ha&&(y=ea()):(Jt="value"in(Zt=s)?Zt.value:Zt.textContent,Ha=!0)),0<(v=Vn(n,b)).length&&(b=new ba(b,e,null,a,s),i.push({event:b,listeners:v}),y?b.data=y:null!==(y=Fa(a))&&(b.data=y))),(y=Pa?function(e,t){switch(e){case"compositionend":return Fa(t);case"keypress":return 32!==t.which?null:(_a=!0,Ua);case"textInput":return(e=t.data)===Ua&&_a?null:e;default:return null}}(e,a):function(e,t){if(Ha)return"compositionend"===e||!Oa&&Ba(e,t)?(e=ea(),$t=Jt=Zt=null,Ha=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Da&&"ko"!==t.locale?null:t.data}}(e,a))&&(0<(n=Vn(n,"onBeforeInput")).length&&(s=new ba("onBeforeInput","beforeinput",null,a,s),i.push({event:s,listeners:n}),s.data=y))}_n(i,t)}))}function Qn(e,t,a){return{instance:e,listener:t,currentTarget:a}}function Vn(e,t){for(var a=t+"Capture",n=[];null!==e;){var s=e,r=s.stateNode;5===s.tag&&null!==r&&(s=r,null!=(r=Ie(e,a))&&n.unshift(Qn(e,r,s)),null!=(r=Ie(e,t))&&n.push(Qn(e,r,s))),e=e.return}return n}function Yn(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Kn(e,t,a,n,s){for(var r=t._reactName,i=[];null!==a&&a!==n;){var o=a,l=o.alternate,c=o.stateNode;if(null!==l&&l===n)break;5===o.tag&&null!==c&&(o=c,s?null!=(l=Ie(a,r))&&i.unshift(Qn(a,l,o)):s||null!=(l=Ie(a,r))&&i.push(Qn(a,l,o))),a=a.return}0!==i.length&&e.push({event:t,listeners:i})}var qn=/\r\n?/g,Xn=/\u0000|\uFFFD/g;function Zn(e){return("string"===typeof e?e:""+e).replace(qn,"\n").replace(Xn,"")}function Jn(e,t,a){if(t=Zn(t),Zn(e)!==t&&a)throw Error(r(425))}function $n(){}var es=null,ts=null;function as(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ns="function"===typeof setTimeout?setTimeout:void 0,ss="function"===typeof clearTimeout?clearTimeout:void 0,rs="function"===typeof Promise?Promise:void 0,is="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof rs?function(e){return rs.resolve(null).then(e).catch(os)}:ns;function os(e){setTimeout((function(){throw e}))}function ls(e,t){var a=t,n=0;do{var s=a.nextSibling;if(e.removeChild(a),s&&8===s.nodeType)if("/$"===(a=s.data)){if(0===n)return e.removeChild(s),void Gt(t);n--}else"$"!==a&&"$?"!==a&&"$!"!==a||n++;a=s}while(a);Gt(t)}function cs(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ds(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var a=e.data;if("$"===a||"$!"===a||"$?"===a){if(0===t)return e;t--}else"/$"===a&&t++}e=e.previousSibling}return null}var us=Math.random().toString(36).slice(2),hs="__reactFiber$"+us,ms="__reactProps$"+us,gs="__reactContainer$"+us,ps="__reactEvents$"+us,fs="__reactListeners$"+us,vs="__reactHandles$"+us;function ys(e){var t=e[hs];if(t)return t;for(var a=e.parentNode;a;){if(t=a[gs]||a[hs]){if(a=t.alternate,null!==t.child||null!==a&&null!==a.child)for(e=ds(e);null!==e;){if(a=e[hs])return a;e=ds(e)}return t}a=(e=a).parentNode}return null}function bs(e){return!(e=e[hs]||e[gs])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Es(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(r(33))}function xs(e){return e[ms]||null}var Ns=[],Ts=-1;function Cs(e){return{current:e}}function As(e){0>Ts||(e.current=Ns[Ts],Ns[Ts]=null,Ts--)}function Ss(e,t){Ts++,Ns[Ts]=e.current,e.current=t}var Ms={},js=Cs(Ms),ws=Cs(!1),Rs=Ms;function ks(e,t){var a=e.type.contextTypes;if(!a)return Ms;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var s,r={};for(s in a)r[s]=t[s];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=r),r}function Is(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Os(){As(ws),As(js)}function Ls(e,t,a){if(js.current!==Ms)throw Error(r(168));Ss(js,t),Ss(ws,a)}function Ps(e,t,a){var n=e.stateNode;if(t=t.childContextTypes,"function"!==typeof n.getChildContext)return a;for(var s in n=n.getChildContext())if(!(s in t))throw Error(r(108,W(e)||"Unknown",s));return U({},a,n)}function Ds(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ms,Rs=js.current,Ss(js,e),Ss(ws,ws.current),!0}function Us(e,t,a){var n=e.stateNode;if(!n)throw Error(r(169));a?(e=Ps(e,t,Rs),n.__reactInternalMemoizedMergedChildContext=e,As(ws),As(js),Ss(js,e)):As(ws),Ss(ws,a)}var _s=null,Bs=!1,Fs=!1;function Hs(e){null===_s?_s=[e]:_s.push(e)}function Gs(){if(!Fs&&null!==_s){Fs=!0;var e=0,t=bt;try{var a=_s;for(bt=1;e<a.length;e++){var n=a[e];do{n=n(!0)}while(null!==n)}_s=null,Bs=!1}catch(s){throw null!==_s&&(_s=_s.slice(e+1)),Ye($e,Gs),s}finally{bt=t,Fs=!1}}return null}var Ws=[],zs=0,Qs=null,Vs=0,Ys=[],Ks=0,qs=null,Xs=1,Zs="";function Js(e,t){Ws[zs++]=Vs,Ws[zs++]=Qs,Qs=e,Vs=t}function $s(e,t,a){Ys[Ks++]=Xs,Ys[Ks++]=Zs,Ys[Ks++]=qs,qs=e;var n=Xs;e=Zs;var s=32-it(n)-1;n&=~(1<<s),a+=1;var r=32-it(t)+s;if(30<r){var i=s-s%5;r=(n&(1<<i)-1).toString(32),n>>=i,s-=i,Xs=1<<32-it(t)+s|a<<s|n,Zs=r+e}else Xs=1<<r|a<<s|n,Zs=e}function er(e){null!==e.return&&(Js(e,1),$s(e,1,0))}function tr(e){for(;e===Qs;)Qs=Ws[--zs],Ws[zs]=null,Vs=Ws[--zs],Ws[zs]=null;for(;e===qs;)qs=Ys[--Ks],Ys[Ks]=null,Zs=Ys[--Ks],Ys[Ks]=null,Xs=Ys[--Ks],Ys[Ks]=null}var ar=null,nr=null,sr=!1,rr=null;function ir(e,t){var a=kc(5,null,null,0);a.elementType="DELETED",a.stateNode=t,a.return=e,null===(t=e.deletions)?(e.deletions=[a],e.flags|=16):t.push(a)}function or(e,t){switch(e.tag){case 5:var a=e.type;return null!==(t=1!==t.nodeType||a.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ar=e,nr=cs(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ar=e,nr=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(a=null!==qs?{id:Xs,overflow:Zs}:null,e.memoizedState={dehydrated:t,treeContext:a,retryLane:1073741824},(a=kc(18,null,null,0)).stateNode=t,a.return=e,e.child=a,ar=e,nr=null,!0);default:return!1}}function lr(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function cr(e){if(sr){var t=nr;if(t){var a=t;if(!or(e,t)){if(lr(e))throw Error(r(418));t=cs(a.nextSibling);var n=ar;t&&or(e,t)?ir(n,a):(e.flags=-4097&e.flags|2,sr=!1,ar=e)}}else{if(lr(e))throw Error(r(418));e.flags=-4097&e.flags|2,sr=!1,ar=e}}}function dr(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ar=e}function ur(e){if(e!==ar)return!1;if(!sr)return dr(e),sr=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!as(e.type,e.memoizedProps)),t&&(t=nr)){if(lr(e))throw hr(),Error(r(418));for(;t;)ir(e,t),t=cs(t.nextSibling)}if(dr(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(r(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var a=e.data;if("/$"===a){if(0===t){nr=cs(e.nextSibling);break e}t--}else"$"!==a&&"$!"!==a&&"$?"!==a||t++}e=e.nextSibling}nr=null}}else nr=ar?cs(e.stateNode.nextSibling):null;return!0}function hr(){for(var e=nr;e;)e=cs(e.nextSibling)}function mr(){nr=ar=null,sr=!1}function gr(e){null===rr?rr=[e]:rr.push(e)}var pr=E.ReactCurrentBatchConfig;function fr(e,t,a){if(null!==(e=a.ref)&&"function"!==typeof e&&"object"!==typeof e){if(a._owner){if(a=a._owner){if(1!==a.tag)throw Error(r(309));var n=a.stateNode}if(!n)throw Error(r(147,e));var s=n,i=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===i?t.ref:(t=function(e){var t=s.refs;null===e?delete t[i]:t[i]=e},t._stringRef=i,t)}if("string"!==typeof e)throw Error(r(284));if(!a._owner)throw Error(r(290,e))}return e}function vr(e,t){throw e=Object.prototype.toString.call(t),Error(r(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function yr(e){return(0,e._init)(e._payload)}function br(e){function t(t,a){if(e){var n=t.deletions;null===n?(t.deletions=[a],t.flags|=16):n.push(a)}}function a(a,n){if(!e)return null;for(;null!==n;)t(a,n),n=n.sibling;return null}function n(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function s(e,t){return(e=Oc(e,t)).index=0,e.sibling=null,e}function i(t,a,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<a?(t.flags|=2,a):n:(t.flags|=2,a):(t.flags|=1048576,a)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,a,n){return null===t||6!==t.tag?((t=Uc(a,e.mode,n)).return=e,t):((t=s(t,a)).return=e,t)}function c(e,t,a,n){var r=a.type;return r===T?u(e,t,a.props.children,n,a.key):null!==t&&(t.elementType===r||"object"===typeof r&&null!==r&&r.$$typeof===I&&yr(r)===t.type)?((n=s(t,a.props)).ref=fr(e,t,a),n.return=e,n):((n=Lc(a.type,a.key,a.props,null,e.mode,n)).ref=fr(e,t,a),n.return=e,n)}function d(e,t,a,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==a.containerInfo||t.stateNode.implementation!==a.implementation?((t=_c(a,e.mode,n)).return=e,t):((t=s(t,a.children||[])).return=e,t)}function u(e,t,a,n,r){return null===t||7!==t.tag?((t=Pc(a,e.mode,n,r)).return=e,t):((t=s(t,a)).return=e,t)}function h(e,t,a){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Uc(""+t,e.mode,a)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case x:return(a=Lc(t.type,t.key,t.props,null,e.mode,a)).ref=fr(e,null,t),a.return=e,a;case N:return(t=_c(t,e.mode,a)).return=e,t;case I:return h(e,(0,t._init)(t._payload),a)}if(te(t)||P(t))return(t=Pc(t,e.mode,a,null)).return=e,t;vr(e,t)}return null}function m(e,t,a,n){var s=null!==t?t.key:null;if("string"===typeof a&&""!==a||"number"===typeof a)return null!==s?null:l(e,t,""+a,n);if("object"===typeof a&&null!==a){switch(a.$$typeof){case x:return a.key===s?c(e,t,a,n):null;case N:return a.key===s?d(e,t,a,n):null;case I:return m(e,t,(s=a._init)(a._payload),n)}if(te(a)||P(a))return null!==s?null:u(e,t,a,n,null);vr(e,a)}return null}function g(e,t,a,n,s){if("string"===typeof n&&""!==n||"number"===typeof n)return l(t,e=e.get(a)||null,""+n,s);if("object"===typeof n&&null!==n){switch(n.$$typeof){case x:return c(t,e=e.get(null===n.key?a:n.key)||null,n,s);case N:return d(t,e=e.get(null===n.key?a:n.key)||null,n,s);case I:return g(e,t,a,(0,n._init)(n._payload),s)}if(te(n)||P(n))return u(t,e=e.get(a)||null,n,s,null);vr(t,n)}return null}function p(s,r,o,l){for(var c=null,d=null,u=r,p=r=0,f=null;null!==u&&p<o.length;p++){u.index>p?(f=u,u=null):f=u.sibling;var v=m(s,u,o[p],l);if(null===v){null===u&&(u=f);break}e&&u&&null===v.alternate&&t(s,u),r=i(v,r,p),null===d?c=v:d.sibling=v,d=v,u=f}if(p===o.length)return a(s,u),sr&&Js(s,p),c;if(null===u){for(;p<o.length;p++)null!==(u=h(s,o[p],l))&&(r=i(u,r,p),null===d?c=u:d.sibling=u,d=u);return sr&&Js(s,p),c}for(u=n(s,u);p<o.length;p++)null!==(f=g(u,s,p,o[p],l))&&(e&&null!==f.alternate&&u.delete(null===f.key?p:f.key),r=i(f,r,p),null===d?c=f:d.sibling=f,d=f);return e&&u.forEach((function(e){return t(s,e)})),sr&&Js(s,p),c}function f(s,o,l,c){var d=P(l);if("function"!==typeof d)throw Error(r(150));if(null==(l=d.call(l)))throw Error(r(151));for(var u=d=null,p=o,f=o=0,v=null,y=l.next();null!==p&&!y.done;f++,y=l.next()){p.index>f?(v=p,p=null):v=p.sibling;var b=m(s,p,y.value,c);if(null===b){null===p&&(p=v);break}e&&p&&null===b.alternate&&t(s,p),o=i(b,o,f),null===u?d=b:u.sibling=b,u=b,p=v}if(y.done)return a(s,p),sr&&Js(s,f),d;if(null===p){for(;!y.done;f++,y=l.next())null!==(y=h(s,y.value,c))&&(o=i(y,o,f),null===u?d=y:u.sibling=y,u=y);return sr&&Js(s,f),d}for(p=n(s,p);!y.done;f++,y=l.next())null!==(y=g(p,s,f,y.value,c))&&(e&&null!==y.alternate&&p.delete(null===y.key?f:y.key),o=i(y,o,f),null===u?d=y:u.sibling=y,u=y);return e&&p.forEach((function(e){return t(s,e)})),sr&&Js(s,f),d}return function e(n,r,i,l){if("object"===typeof i&&null!==i&&i.type===T&&null===i.key&&(i=i.props.children),"object"===typeof i&&null!==i){switch(i.$$typeof){case x:e:{for(var c=i.key,d=r;null!==d;){if(d.key===c){if((c=i.type)===T){if(7===d.tag){a(n,d.sibling),(r=s(d,i.props.children)).return=n,n=r;break e}}else if(d.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===I&&yr(c)===d.type){a(n,d.sibling),(r=s(d,i.props)).ref=fr(n,d,i),r.return=n,n=r;break e}a(n,d);break}t(n,d),d=d.sibling}i.type===T?((r=Pc(i.props.children,n.mode,l,i.key)).return=n,n=r):((l=Lc(i.type,i.key,i.props,null,n.mode,l)).ref=fr(n,r,i),l.return=n,n=l)}return o(n);case N:e:{for(d=i.key;null!==r;){if(r.key===d){if(4===r.tag&&r.stateNode.containerInfo===i.containerInfo&&r.stateNode.implementation===i.implementation){a(n,r.sibling),(r=s(r,i.children||[])).return=n,n=r;break e}a(n,r);break}t(n,r),r=r.sibling}(r=_c(i,n.mode,l)).return=n,n=r}return o(n);case I:return e(n,r,(d=i._init)(i._payload),l)}if(te(i))return p(n,r,i,l);if(P(i))return f(n,r,i,l);vr(n,i)}return"string"===typeof i&&""!==i||"number"===typeof i?(i=""+i,null!==r&&6===r.tag?(a(n,r.sibling),(r=s(r,i)).return=n,n=r):(a(n,r),(r=Uc(i,n.mode,l)).return=n,n=r),o(n)):a(n,r)}}var Er=br(!0),xr=br(!1),Nr=Cs(null),Tr=null,Cr=null,Ar=null;function Sr(){Ar=Cr=Tr=null}function Mr(e){var t=Nr.current;As(Nr),e._currentValue=t}function jr(e,t,a){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==n&&(n.childLanes|=t)):null!==n&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===a)break;e=e.return}}function wr(e,t){Tr=e,Ar=Cr=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(bo=!0),e.firstContext=null)}function Rr(e){var t=e._currentValue;if(Ar!==e)if(e={context:e,memoizedValue:t,next:null},null===Cr){if(null===Tr)throw Error(r(308));Cr=e,Tr.dependencies={lanes:0,firstContext:e}}else Cr=Cr.next=e;return t}var kr=null;function Ir(e){null===kr?kr=[e]:kr.push(e)}function Or(e,t,a,n){var s=t.interleaved;return null===s?(a.next=a,Ir(t)):(a.next=s.next,s.next=a),t.interleaved=a,Lr(e,n)}function Lr(e,t){e.lanes|=t;var a=e.alternate;for(null!==a&&(a.lanes|=t),a=e,e=e.return;null!==e;)e.childLanes|=t,null!==(a=e.alternate)&&(a.childLanes|=t),a=e,e=e.return;return 3===a.tag?a.stateNode:null}var Pr=!1;function Dr(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ur(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function _r(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Br(e,t,a){var n=e.updateQueue;if(null===n)return null;if(n=n.shared,0!==(2&jl)){var s=n.pending;return null===s?t.next=t:(t.next=s.next,s.next=t),n.pending=t,Lr(e,a)}return null===(s=n.interleaved)?(t.next=t,Ir(n)):(t.next=s.next,s.next=t),n.interleaved=t,Lr(e,a)}function Fr(e,t,a){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&a))){var n=t.lanes;a|=n&=e.pendingLanes,t.lanes=a,yt(e,a)}}function Hr(e,t){var a=e.updateQueue,n=e.alternate;if(null!==n&&a===(n=n.updateQueue)){var s=null,r=null;if(null!==(a=a.firstBaseUpdate)){do{var i={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};null===r?s=r=i:r=r.next=i,a=a.next}while(null!==a);null===r?s=r=t:r=r.next=t}else s=r=t;return a={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:r,shared:n.shared,effects:n.effects},void(e.updateQueue=a)}null===(e=a.lastBaseUpdate)?a.firstBaseUpdate=t:e.next=t,a.lastBaseUpdate=t}function Gr(e,t,a,n){var s=e.updateQueue;Pr=!1;var r=s.firstBaseUpdate,i=s.lastBaseUpdate,o=s.shared.pending;if(null!==o){s.shared.pending=null;var l=o,c=l.next;l.next=null,null===i?r=c:i.next=c,i=l;var d=e.alternate;null!==d&&((o=(d=d.updateQueue).lastBaseUpdate)!==i&&(null===o?d.firstBaseUpdate=c:o.next=c,d.lastBaseUpdate=l))}if(null!==r){var u=s.baseState;for(i=0,d=c=l=null,o=r;;){var h=o.lane,m=o.eventTime;if((n&h)===h){null!==d&&(d=d.next={eventTime:m,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var g=e,p=o;switch(h=t,m=a,p.tag){case 1:if("function"===typeof(g=p.payload)){u=g.call(m,u,h);break e}u=g;break e;case 3:g.flags=-65537&g.flags|128;case 0:if(null===(h="function"===typeof(g=p.payload)?g.call(m,u,h):g)||void 0===h)break e;u=U({},u,h);break e;case 2:Pr=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(h=s.effects)?s.effects=[o]:h.push(o))}else m={eventTime:m,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===d?(c=d=m,l=u):d=d.next=m,i|=h;if(null===(o=o.next)){if(null===(o=s.shared.pending))break;o=(h=o).next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}if(null===d&&(l=u),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=d,null!==(t=s.shared.interleaved)){s=t;do{i|=s.lane,s=s.next}while(s!==t)}else null===r&&(s.shared.lanes=0);Dl|=i,e.lanes=i,e.memoizedState=u}}function Wr(e,t,a){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var n=e[t],s=n.callback;if(null!==s){if(n.callback=null,n=a,"function"!==typeof s)throw Error(r(191,s));s.call(n)}}}var zr={},Qr=Cs(zr),Vr=Cs(zr),Yr=Cs(zr);function Kr(e){if(e===zr)throw Error(r(174));return e}function qr(e,t){switch(Ss(Yr,t),Ss(Vr,e),Ss(Qr,zr),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}As(Qr),Ss(Qr,t)}function Xr(){As(Qr),As(Vr),As(Yr)}function Zr(e){Kr(Yr.current);var t=Kr(Qr.current),a=le(t,e.type);t!==a&&(Ss(Vr,e),Ss(Qr,a))}function Jr(e){Vr.current===e&&(As(Qr),As(Vr))}var $r=Cs(0);function ei(e){for(var t=e;null!==t;){if(13===t.tag){var a=t.memoizedState;if(null!==a&&(null===(a=a.dehydrated)||"$?"===a.data||"$!"===a.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ti=[];function ai(){for(var e=0;e<ti.length;e++)ti[e]._workInProgressVersionPrimary=null;ti.length=0}var ni=E.ReactCurrentDispatcher,si=E.ReactCurrentBatchConfig,ri=0,ii=null,oi=null,li=null,ci=!1,di=!1,ui=0,hi=0;function mi(){throw Error(r(321))}function gi(e,t){if(null===t)return!1;for(var a=0;a<t.length&&a<e.length;a++)if(!on(e[a],t[a]))return!1;return!0}function pi(e,t,a,n,s,i){if(ri=i,ii=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ni.current=null===e||null===e.memoizedState?Ji:$i,e=a(n,s),di){i=0;do{if(di=!1,ui=0,25<=i)throw Error(r(301));i+=1,li=oi=null,t.updateQueue=null,ni.current=eo,e=a(n,s)}while(di)}if(ni.current=Zi,t=null!==oi&&null!==oi.next,ri=0,li=oi=ii=null,ci=!1,t)throw Error(r(300));return e}function fi(){var e=0!==ui;return ui=0,e}function vi(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===li?ii.memoizedState=li=e:li=li.next=e,li}function yi(){if(null===oi){var e=ii.alternate;e=null!==e?e.memoizedState:null}else e=oi.next;var t=null===li?ii.memoizedState:li.next;if(null!==t)li=t,oi=e;else{if(null===e)throw Error(r(310));e={memoizedState:(oi=e).memoizedState,baseState:oi.baseState,baseQueue:oi.baseQueue,queue:oi.queue,next:null},null===li?ii.memoizedState=li=e:li=li.next=e}return li}function bi(e,t){return"function"===typeof t?t(e):t}function Ei(e){var t=yi(),a=t.queue;if(null===a)throw Error(r(311));a.lastRenderedReducer=e;var n=oi,s=n.baseQueue,i=a.pending;if(null!==i){if(null!==s){var o=s.next;s.next=i.next,i.next=o}n.baseQueue=s=i,a.pending=null}if(null!==s){i=s.next,n=n.baseState;var l=o=null,c=null,d=i;do{var u=d.lane;if((ri&u)===u)null!==c&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),n=d.hasEagerState?d.eagerState:e(n,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};null===c?(l=c=h,o=n):c=c.next=h,ii.lanes|=u,Dl|=u}d=d.next}while(null!==d&&d!==i);null===c?o=n:c.next=l,on(n,t.memoizedState)||(bo=!0),t.memoizedState=n,t.baseState=o,t.baseQueue=c,a.lastRenderedState=n}if(null!==(e=a.interleaved)){s=e;do{i=s.lane,ii.lanes|=i,Dl|=i,s=s.next}while(s!==e)}else null===s&&(a.lanes=0);return[t.memoizedState,a.dispatch]}function xi(e){var t=yi(),a=t.queue;if(null===a)throw Error(r(311));a.lastRenderedReducer=e;var n=a.dispatch,s=a.pending,i=t.memoizedState;if(null!==s){a.pending=null;var o=s=s.next;do{i=e(i,o.action),o=o.next}while(o!==s);on(i,t.memoizedState)||(bo=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),a.lastRenderedState=i}return[i,n]}function Ni(){}function Ti(e,t){var a=ii,n=yi(),s=t(),i=!on(n.memoizedState,s);if(i&&(n.memoizedState=s,bo=!0),n=n.queue,Pi(Si.bind(null,a,n,e),[e]),n.getSnapshot!==t||i||null!==li&&1&li.memoizedState.tag){if(a.flags|=2048,Ri(9,Ai.bind(null,a,n,s,t),void 0,null),null===wl)throw Error(r(349));0!==(30&ri)||Ci(a,t,s)}return s}function Ci(e,t,a){e.flags|=16384,e={getSnapshot:t,value:a},null===(t=ii.updateQueue)?(t={lastEffect:null,stores:null},ii.updateQueue=t,t.stores=[e]):null===(a=t.stores)?t.stores=[e]:a.push(e)}function Ai(e,t,a,n){t.value=a,t.getSnapshot=n,Mi(t)&&ji(e)}function Si(e,t,a){return a((function(){Mi(t)&&ji(e)}))}function Mi(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!on(e,a)}catch(n){return!0}}function ji(e){var t=Lr(e,1);null!==t&&ac(t,e,1,-1)}function wi(e){var t=vi();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:bi,lastRenderedState:e},t.queue=e,e=e.dispatch=Yi.bind(null,ii,e),[t.memoizedState,e]}function Ri(e,t,a,n){return e={tag:e,create:t,destroy:a,deps:n,next:null},null===(t=ii.updateQueue)?(t={lastEffect:null,stores:null},ii.updateQueue=t,t.lastEffect=e.next=e):null===(a=t.lastEffect)?t.lastEffect=e.next=e:(n=a.next,a.next=e,e.next=n,t.lastEffect=e),e}function ki(){return yi().memoizedState}function Ii(e,t,a,n){var s=vi();ii.flags|=e,s.memoizedState=Ri(1|t,a,void 0,void 0===n?null:n)}function Oi(e,t,a,n){var s=yi();n=void 0===n?null:n;var r=void 0;if(null!==oi){var i=oi.memoizedState;if(r=i.destroy,null!==n&&gi(n,i.deps))return void(s.memoizedState=Ri(t,a,r,n))}ii.flags|=e,s.memoizedState=Ri(1|t,a,r,n)}function Li(e,t){return Ii(8390656,8,e,t)}function Pi(e,t){return Oi(2048,8,e,t)}function Di(e,t){return Oi(4,2,e,t)}function Ui(e,t){return Oi(4,4,e,t)}function _i(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Bi(e,t,a){return a=null!==a&&void 0!==a?a.concat([e]):null,Oi(4,4,_i.bind(null,t,e),a)}function Fi(){}function Hi(e,t){var a=yi();t=void 0===t?null:t;var n=a.memoizedState;return null!==n&&null!==t&&gi(t,n[1])?n[0]:(a.memoizedState=[e,t],e)}function Gi(e,t){var a=yi();t=void 0===t?null:t;var n=a.memoizedState;return null!==n&&null!==t&&gi(t,n[1])?n[0]:(e=e(),a.memoizedState=[e,t],e)}function Wi(e,t,a){return 0===(21&ri)?(e.baseState&&(e.baseState=!1,bo=!0),e.memoizedState=a):(on(a,t)||(a=pt(),ii.lanes|=a,Dl|=a,e.baseState=!0),t)}function zi(e,t){var a=bt;bt=0!==a&&4>a?a:4,e(!0);var n=si.transition;si.transition={};try{e(!1),t()}finally{bt=a,si.transition=n}}function Qi(){return yi().memoizedState}function Vi(e,t,a){var n=tc(e);if(a={lane:n,action:a,hasEagerState:!1,eagerState:null,next:null},Ki(e))qi(t,a);else if(null!==(a=Or(e,t,a,n))){ac(a,e,n,ec()),Xi(a,t,n)}}function Yi(e,t,a){var n=tc(e),s={lane:n,action:a,hasEagerState:!1,eagerState:null,next:null};if(Ki(e))qi(t,s);else{var r=e.alternate;if(0===e.lanes&&(null===r||0===r.lanes)&&null!==(r=t.lastRenderedReducer))try{var i=t.lastRenderedState,o=r(i,a);if(s.hasEagerState=!0,s.eagerState=o,on(o,i)){var l=t.interleaved;return null===l?(s.next=s,Ir(t)):(s.next=l.next,l.next=s),void(t.interleaved=s)}}catch(c){}null!==(a=Or(e,t,s,n))&&(ac(a,e,n,s=ec()),Xi(a,t,n))}}function Ki(e){var t=e.alternate;return e===ii||null!==t&&t===ii}function qi(e,t){di=ci=!0;var a=e.pending;null===a?t.next=t:(t.next=a.next,a.next=t),e.pending=t}function Xi(e,t,a){if(0!==(4194240&a)){var n=t.lanes;a|=n&=e.pendingLanes,t.lanes=a,yt(e,a)}}var Zi={readContext:Rr,useCallback:mi,useContext:mi,useEffect:mi,useImperativeHandle:mi,useInsertionEffect:mi,useLayoutEffect:mi,useMemo:mi,useReducer:mi,useRef:mi,useState:mi,useDebugValue:mi,useDeferredValue:mi,useTransition:mi,useMutableSource:mi,useSyncExternalStore:mi,useId:mi,unstable_isNewReconciler:!1},Ji={readContext:Rr,useCallback:function(e,t){return vi().memoizedState=[e,void 0===t?null:t],e},useContext:Rr,useEffect:Li,useImperativeHandle:function(e,t,a){return a=null!==a&&void 0!==a?a.concat([e]):null,Ii(4194308,4,_i.bind(null,t,e),a)},useLayoutEffect:function(e,t){return Ii(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ii(4,2,e,t)},useMemo:function(e,t){var a=vi();return t=void 0===t?null:t,e=e(),a.memoizedState=[e,t],e},useReducer:function(e,t,a){var n=vi();return t=void 0!==a?a(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=Vi.bind(null,ii,e),[n.memoizedState,e]},useRef:function(e){return e={current:e},vi().memoizedState=e},useState:wi,useDebugValue:Fi,useDeferredValue:function(e){return vi().memoizedState=e},useTransition:function(){var e=wi(!1),t=e[0];return e=zi.bind(null,e[1]),vi().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,a){var n=ii,s=vi();if(sr){if(void 0===a)throw Error(r(407));a=a()}else{if(a=t(),null===wl)throw Error(r(349));0!==(30&ri)||Ci(n,t,a)}s.memoizedState=a;var i={value:a,getSnapshot:t};return s.queue=i,Li(Si.bind(null,n,i,e),[e]),n.flags|=2048,Ri(9,Ai.bind(null,n,i,a,t),void 0,null),a},useId:function(){var e=vi(),t=wl.identifierPrefix;if(sr){var a=Zs;t=":"+t+"R"+(a=(Xs&~(1<<32-it(Xs)-1)).toString(32)+a),0<(a=ui++)&&(t+="H"+a.toString(32)),t+=":"}else t=":"+t+"r"+(a=hi++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},$i={readContext:Rr,useCallback:Hi,useContext:Rr,useEffect:Pi,useImperativeHandle:Bi,useInsertionEffect:Di,useLayoutEffect:Ui,useMemo:Gi,useReducer:Ei,useRef:ki,useState:function(){return Ei(bi)},useDebugValue:Fi,useDeferredValue:function(e){return Wi(yi(),oi.memoizedState,e)},useTransition:function(){return[Ei(bi)[0],yi().memoizedState]},useMutableSource:Ni,useSyncExternalStore:Ti,useId:Qi,unstable_isNewReconciler:!1},eo={readContext:Rr,useCallback:Hi,useContext:Rr,useEffect:Pi,useImperativeHandle:Bi,useInsertionEffect:Di,useLayoutEffect:Ui,useMemo:Gi,useReducer:xi,useRef:ki,useState:function(){return xi(bi)},useDebugValue:Fi,useDeferredValue:function(e){var t=yi();return null===oi?t.memoizedState=e:Wi(t,oi.memoizedState,e)},useTransition:function(){return[xi(bi)[0],yi().memoizedState]},useMutableSource:Ni,useSyncExternalStore:Ti,useId:Qi,unstable_isNewReconciler:!1};function to(e,t){if(e&&e.defaultProps){for(var a in t=U({},t),e=e.defaultProps)void 0===t[a]&&(t[a]=e[a]);return t}return t}function ao(e,t,a,n){a=null===(a=a(n,t=e.memoizedState))||void 0===a?t:U({},t,a),e.memoizedState=a,0===e.lanes&&(e.updateQueue.baseState=a)}var no={isMounted:function(e){return!!(e=e._reactInternals)&&Ge(e)===e},enqueueSetState:function(e,t,a){e=e._reactInternals;var n=ec(),s=tc(e),r=_r(n,s);r.payload=t,void 0!==a&&null!==a&&(r.callback=a),null!==(t=Br(e,r,s))&&(ac(t,e,s,n),Fr(t,e,s))},enqueueReplaceState:function(e,t,a){e=e._reactInternals;var n=ec(),s=tc(e),r=_r(n,s);r.tag=1,r.payload=t,void 0!==a&&null!==a&&(r.callback=a),null!==(t=Br(e,r,s))&&(ac(t,e,s,n),Fr(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var a=ec(),n=tc(e),s=_r(a,n);s.tag=2,void 0!==t&&null!==t&&(s.callback=t),null!==(t=Br(e,s,n))&&(ac(t,e,n,a),Fr(t,e,n))}};function so(e,t,a,n,s,r,i){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,r,i):!t.prototype||!t.prototype.isPureReactComponent||(!ln(a,n)||!ln(s,r))}function ro(e,t,a){var n=!1,s=Ms,r=t.contextType;return"object"===typeof r&&null!==r?r=Rr(r):(s=Is(t)?Rs:js.current,r=(n=null!==(n=t.contextTypes)&&void 0!==n)?ks(e,s):Ms),t=new t(a,r),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=no,e.stateNode=t,t._reactInternals=e,n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=r),t}function io(e,t,a,n){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(a,n),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(a,n),t.state!==e&&no.enqueueReplaceState(t,t.state,null)}function oo(e,t,a,n){var s=e.stateNode;s.props=a,s.state=e.memoizedState,s.refs={},Dr(e);var r=t.contextType;"object"===typeof r&&null!==r?s.context=Rr(r):(r=Is(t)?Rs:js.current,s.context=ks(e,r)),s.state=e.memoizedState,"function"===typeof(r=t.getDerivedStateFromProps)&&(ao(e,t,r,a),s.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof s.getSnapshotBeforeUpdate||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||(t=s.state,"function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount(),t!==s.state&&no.enqueueReplaceState(s,s.state,null),Gr(e,a,s,n),s.state=e.memoizedState),"function"===typeof s.componentDidMount&&(e.flags|=4194308)}function lo(e,t){try{var a="",n=t;do{a+=H(n),n=n.return}while(n);var s=a}catch(r){s="\nError generating stack: "+r.message+"\n"+r.stack}return{value:e,source:t,stack:s,digest:null}}function co(e,t,a){return{value:e,source:null,stack:null!=a?a:null,digest:null!=t?t:null}}function uo(e,t){try{console.error(t.value)}catch(a){setTimeout((function(){throw a}))}}var ho="function"===typeof WeakMap?WeakMap:Map;function mo(e,t,a){(a=_r(-1,a)).tag=3,a.payload={element:null};var n=t.value;return a.callback=function(){zl||(zl=!0,Ql=n),uo(0,t)},a}function go(e,t,a){(a=_r(-1,a)).tag=3;var n=e.type.getDerivedStateFromError;if("function"===typeof n){var s=t.value;a.payload=function(){return n(s)},a.callback=function(){uo(0,t)}}var r=e.stateNode;return null!==r&&"function"===typeof r.componentDidCatch&&(a.callback=function(){uo(0,t),"function"!==typeof n&&(null===Vl?Vl=new Set([this]):Vl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),a}function po(e,t,a){var n=e.pingCache;if(null===n){n=e.pingCache=new ho;var s=new Set;n.set(t,s)}else void 0===(s=n.get(t))&&(s=new Set,n.set(t,s));s.has(a)||(s.add(a),e=Ac.bind(null,e,t,a),t.then(e,e))}function fo(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vo(e,t,a,n,s){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,a.flags|=131072,a.flags&=-52805,1===a.tag&&(null===a.alternate?a.tag=17:((t=_r(-1,1)).tag=2,Br(a,t,1))),a.lanes|=1),e):(e.flags|=65536,e.lanes=s,e)}var yo=E.ReactCurrentOwner,bo=!1;function Eo(e,t,a,n){t.child=null===e?xr(t,null,a,n):Er(t,e.child,a,n)}function xo(e,t,a,n,s){a=a.render;var r=t.ref;return wr(t,s),n=pi(e,t,a,n,r,s),a=fi(),null===e||bo?(sr&&a&&er(t),t.flags|=1,Eo(e,t,n,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,zo(e,t,s))}function No(e,t,a,n,s){if(null===e){var r=a.type;return"function"!==typeof r||Ic(r)||void 0!==r.defaultProps||null!==a.compare||void 0!==a.defaultProps?((e=Lc(a.type,null,n,t,t.mode,s)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=r,To(e,t,r,n,s))}if(r=e.child,0===(e.lanes&s)){var i=r.memoizedProps;if((a=null!==(a=a.compare)?a:ln)(i,n)&&e.ref===t.ref)return zo(e,t,s)}return t.flags|=1,(e=Oc(r,n)).ref=t.ref,e.return=t,t.child=e}function To(e,t,a,n,s){if(null!==e){var r=e.memoizedProps;if(ln(r,n)&&e.ref===t.ref){if(bo=!1,t.pendingProps=n=r,0===(e.lanes&s))return t.lanes=e.lanes,zo(e,t,s);0!==(131072&e.flags)&&(bo=!0)}}return So(e,t,a,n,s)}function Co(e,t,a){var n=t.pendingProps,s=n.children,r=null!==e?e.memoizedState:null;if("hidden"===n.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ss(Ol,Il),Il|=a;else{if(0===(1073741824&a))return e=null!==r?r.baseLanes|a:a,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ss(Ol,Il),Il|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=null!==r?r.baseLanes:a,Ss(Ol,Il),Il|=n}else null!==r?(n=r.baseLanes|a,t.memoizedState=null):n=a,Ss(Ol,Il),Il|=n;return Eo(e,t,s,a),t.child}function Ao(e,t){var a=t.ref;(null===e&&null!==a||null!==e&&e.ref!==a)&&(t.flags|=512,t.flags|=2097152)}function So(e,t,a,n,s){var r=Is(a)?Rs:js.current;return r=ks(t,r),wr(t,s),a=pi(e,t,a,n,r,s),n=fi(),null===e||bo?(sr&&n&&er(t),t.flags|=1,Eo(e,t,a,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,zo(e,t,s))}function Mo(e,t,a,n,s){if(Is(a)){var r=!0;Ds(t)}else r=!1;if(wr(t,s),null===t.stateNode)Wo(e,t),ro(t,a,n),oo(t,a,n,s),n=!0;else if(null===e){var i=t.stateNode,o=t.memoizedProps;i.props=o;var l=i.context,c=a.contextType;"object"===typeof c&&null!==c?c=Rr(c):c=ks(t,c=Is(a)?Rs:js.current);var d=a.getDerivedStateFromProps,u="function"===typeof d||"function"===typeof i.getSnapshotBeforeUpdate;u||"function"!==typeof i.UNSAFE_componentWillReceiveProps&&"function"!==typeof i.componentWillReceiveProps||(o!==n||l!==c)&&io(t,i,n,c),Pr=!1;var h=t.memoizedState;i.state=h,Gr(t,n,i,s),l=t.memoizedState,o!==n||h!==l||ws.current||Pr?("function"===typeof d&&(ao(t,a,d,n),l=t.memoizedState),(o=Pr||so(t,a,o,n,h,l,c))?(u||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||("function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount()),"function"===typeof i.componentDidMount&&(t.flags|=4194308)):("function"===typeof i.componentDidMount&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=l),i.props=n,i.state=l,i.context=c,n=o):("function"===typeof i.componentDidMount&&(t.flags|=4194308),n=!1)}else{i=t.stateNode,Ur(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:to(t.type,o),i.props=c,u=t.pendingProps,h=i.context,"object"===typeof(l=a.contextType)&&null!==l?l=Rr(l):l=ks(t,l=Is(a)?Rs:js.current);var m=a.getDerivedStateFromProps;(d="function"===typeof m||"function"===typeof i.getSnapshotBeforeUpdate)||"function"!==typeof i.UNSAFE_componentWillReceiveProps&&"function"!==typeof i.componentWillReceiveProps||(o!==u||h!==l)&&io(t,i,n,l),Pr=!1,h=t.memoizedState,i.state=h,Gr(t,n,i,s);var g=t.memoizedState;o!==u||h!==g||ws.current||Pr?("function"===typeof m&&(ao(t,a,m,n),g=t.memoizedState),(c=Pr||so(t,a,c,n,h,g,l)||!1)?(d||"function"!==typeof i.UNSAFE_componentWillUpdate&&"function"!==typeof i.componentWillUpdate||("function"===typeof i.componentWillUpdate&&i.componentWillUpdate(n,g,l),"function"===typeof i.UNSAFE_componentWillUpdate&&i.UNSAFE_componentWillUpdate(n,g,l)),"function"===typeof i.componentDidUpdate&&(t.flags|=4),"function"===typeof i.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof i.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof i.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=g),i.props=n,i.state=g,i.context=l,n=c):("function"!==typeof i.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof i.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),n=!1)}return jo(e,t,a,n,r,s)}function jo(e,t,a,n,s,r){Ao(e,t);var i=0!==(128&t.flags);if(!n&&!i)return s&&Us(t,a,!1),zo(e,t,r);n=t.stateNode,yo.current=t;var o=i&&"function"!==typeof a.getDerivedStateFromError?null:n.render();return t.flags|=1,null!==e&&i?(t.child=Er(t,e.child,null,r),t.child=Er(t,null,o,r)):Eo(e,t,o,r),t.memoizedState=n.state,s&&Us(t,a,!0),t.child}function wo(e){var t=e.stateNode;t.pendingContext?Ls(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Ls(0,t.context,!1),qr(e,t.containerInfo)}function Ro(e,t,a,n,s){return mr(),gr(s),t.flags|=256,Eo(e,t,a,n),t.child}var ko,Io,Oo,Lo,Po={dehydrated:null,treeContext:null,retryLane:0};function Do(e){return{baseLanes:e,cachePool:null,transitions:null}}function Uo(e,t,a){var n,s=t.pendingProps,i=$r.current,o=!1,l=0!==(128&t.flags);if((n=l)||(n=(null===e||null!==e.memoizedState)&&0!==(2&i)),n?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(i|=1),Ss($r,1&i),null===e)return cr(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=s.children,e=s.fallback,o?(s=t.mode,o=t.child,l={mode:"hidden",children:l},0===(1&s)&&null!==o?(o.childLanes=0,o.pendingProps=l):o=Dc(l,s,0,null),e=Pc(e,s,a,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Do(a),t.memoizedState=Po,e):_o(t,l));if(null!==(i=e.memoizedState)&&null!==(n=i.dehydrated))return function(e,t,a,n,s,i,o){if(a)return 256&t.flags?(t.flags&=-257,Bo(e,t,o,n=co(Error(r(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(i=n.fallback,s=t.mode,n=Dc({mode:"visible",children:n.children},s,0,null),(i=Pc(i,s,o,null)).flags|=2,n.return=t,i.return=t,n.sibling=i,t.child=n,0!==(1&t.mode)&&Er(t,e.child,null,o),t.child.memoizedState=Do(o),t.memoizedState=Po,i);if(0===(1&t.mode))return Bo(e,t,o,null);if("$!"===s.data){if(n=s.nextSibling&&s.nextSibling.dataset)var l=n.dgst;return n=l,Bo(e,t,o,n=co(i=Error(r(419)),n,void 0))}if(l=0!==(o&e.childLanes),bo||l){if(null!==(n=wl)){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}0!==(s=0!==(s&(n.suspendedLanes|o))?0:s)&&s!==i.retryLane&&(i.retryLane=s,Lr(e,s),ac(n,e,s,-1))}return pc(),Bo(e,t,o,n=co(Error(r(421))))}return"$?"===s.data?(t.flags|=128,t.child=e.child,t=Mc.bind(null,e),s._reactRetry=t,null):(e=i.treeContext,nr=cs(s.nextSibling),ar=t,sr=!0,rr=null,null!==e&&(Ys[Ks++]=Xs,Ys[Ks++]=Zs,Ys[Ks++]=qs,Xs=e.id,Zs=e.overflow,qs=t),t=_o(t,n.children),t.flags|=4096,t)}(e,t,l,s,n,i,a);if(o){o=s.fallback,l=t.mode,n=(i=e.child).sibling;var c={mode:"hidden",children:s.children};return 0===(1&l)&&t.child!==i?((s=t.child).childLanes=0,s.pendingProps=c,t.deletions=null):(s=Oc(i,c)).subtreeFlags=14680064&i.subtreeFlags,null!==n?o=Oc(n,o):(o=Pc(o,l,a,null)).flags|=2,o.return=t,s.return=t,s.sibling=o,t.child=s,s=o,o=t.child,l=null===(l=e.child.memoizedState)?Do(a):{baseLanes:l.baseLanes|a,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~a,t.memoizedState=Po,s}return e=(o=e.child).sibling,s=Oc(o,{mode:"visible",children:s.children}),0===(1&t.mode)&&(s.lanes=a),s.return=t,s.sibling=null,null!==e&&(null===(a=t.deletions)?(t.deletions=[e],t.flags|=16):a.push(e)),t.child=s,t.memoizedState=null,s}function _o(e,t){return(t=Dc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Bo(e,t,a,n){return null!==n&&gr(n),Er(t,e.child,null,a),(e=_o(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Fo(e,t,a){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),jr(e.return,t,a)}function Ho(e,t,a,n,s){var r=e.memoizedState;null===r?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:a,tailMode:s}:(r.isBackwards=t,r.rendering=null,r.renderingStartTime=0,r.last=n,r.tail=a,r.tailMode=s)}function Go(e,t,a){var n=t.pendingProps,s=n.revealOrder,r=n.tail;if(Eo(e,t,n.children,a),0!==(2&(n=$r.current)))n=1&n|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Fo(e,a,t);else if(19===e.tag)Fo(e,a,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Ss($r,n),0===(1&t.mode))t.memoizedState=null;else switch(s){case"forwards":for(a=t.child,s=null;null!==a;)null!==(e=a.alternate)&&null===ei(e)&&(s=a),a=a.sibling;null===(a=s)?(s=t.child,t.child=null):(s=a.sibling,a.sibling=null),Ho(t,!1,s,a,r);break;case"backwards":for(a=null,s=t.child,t.child=null;null!==s;){if(null!==(e=s.alternate)&&null===ei(e)){t.child=s;break}e=s.sibling,s.sibling=a,a=s,s=e}Ho(t,!0,a,null,r);break;case"together":Ho(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Wo(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function zo(e,t,a){if(null!==e&&(t.dependencies=e.dependencies),Dl|=t.lanes,0===(a&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(r(153));if(null!==t.child){for(a=Oc(e=t.child,e.pendingProps),t.child=a,a.return=t;null!==e.sibling;)e=e.sibling,(a=a.sibling=Oc(e,e.pendingProps)).return=t;a.sibling=null}return t.child}function Qo(e,t){if(!sr)switch(e.tailMode){case"hidden":t=e.tail;for(var a=null;null!==t;)null!==t.alternate&&(a=t),t=t.sibling;null===a?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var n=null;null!==a;)null!==a.alternate&&(n=a),a=a.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Vo(e){var t=null!==e.alternate&&e.alternate.child===e.child,a=0,n=0;if(t)for(var s=e.child;null!==s;)a|=s.lanes|s.childLanes,n|=14680064&s.subtreeFlags,n|=14680064&s.flags,s.return=e,s=s.sibling;else for(s=e.child;null!==s;)a|=s.lanes|s.childLanes,n|=s.subtreeFlags,n|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=n,e.childLanes=a,t}function Yo(e,t,a){var n=t.pendingProps;switch(tr(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Vo(t),null;case 1:case 17:return Is(t.type)&&Os(),Vo(t),null;case 3:return n=t.stateNode,Xr(),As(ws),As(js),ai(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(ur(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==rr&&(ic(rr),rr=null))),Io(e,t),Vo(t),null;case 5:Jr(t);var s=Kr(Yr.current);if(a=t.type,null!==e&&null!=t.stateNode)Oo(e,t,a,n,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(null===t.stateNode)throw Error(r(166));return Vo(t),null}if(e=Kr(Qr.current),ur(t)){n=t.stateNode,a=t.type;var i=t.memoizedProps;switch(n[hs]=t,n[ms]=i,e=0!==(1&t.mode),a){case"dialog":Bn("cancel",n),Bn("close",n);break;case"iframe":case"object":case"embed":Bn("load",n);break;case"video":case"audio":for(s=0;s<Pn.length;s++)Bn(Pn[s],n);break;case"source":Bn("error",n);break;case"img":case"image":case"link":Bn("error",n),Bn("load",n);break;case"details":Bn("toggle",n);break;case"input":X(n,i),Bn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},Bn("invalid",n);break;case"textarea":se(n,i),Bn("invalid",n)}for(var l in ye(a,i),s=null,i)if(i.hasOwnProperty(l)){var c=i[l];"children"===l?"string"===typeof c?n.textContent!==c&&(!0!==i.suppressHydrationWarning&&Jn(n.textContent,c,e),s=["children",c]):"number"===typeof c&&n.textContent!==""+c&&(!0!==i.suppressHydrationWarning&&Jn(n.textContent,c,e),s=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Bn("scroll",n)}switch(a){case"input":V(n),$(n,i,!0);break;case"textarea":V(n),ie(n);break;case"select":case"option":break;default:"function"===typeof i.onClick&&(n.onclick=$n)}n=s,t.updateQueue=n,null!==n&&(t.flags|=4)}else{l=9===s.nodeType?s:s.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(a)),"http://www.w3.org/1999/xhtml"===e?"script"===a?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof n.is?e=l.createElement(a,{is:n.is}):(e=l.createElement(a),"select"===a&&(l=e,n.multiple?l.multiple=!0:n.size&&(l.size=n.size))):e=l.createElementNS(e,a),e[hs]=t,e[ms]=n,ko(e,t,!1,!1),t.stateNode=e;e:{switch(l=be(a,n),a){case"dialog":Bn("cancel",e),Bn("close",e),s=n;break;case"iframe":case"object":case"embed":Bn("load",e),s=n;break;case"video":case"audio":for(s=0;s<Pn.length;s++)Bn(Pn[s],e);s=n;break;case"source":Bn("error",e),s=n;break;case"img":case"image":case"link":Bn("error",e),Bn("load",e),s=n;break;case"details":Bn("toggle",e),s=n;break;case"input":X(e,n),s=q(e,n),Bn("invalid",e);break;case"option":default:s=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},s=U({},n,{value:void 0}),Bn("invalid",e);break;case"textarea":se(e,n),s=ne(e,n),Bn("invalid",e)}for(i in ye(a,s),c=s)if(c.hasOwnProperty(i)){var d=c[i];"style"===i?fe(e,d):"dangerouslySetInnerHTML"===i?null!=(d=d?d.__html:void 0)&&ue(e,d):"children"===i?"string"===typeof d?("textarea"!==a||""!==d)&&he(e,d):"number"===typeof d&&he(e,""+d):"suppressContentEditableWarning"!==i&&"suppressHydrationWarning"!==i&&"autoFocus"!==i&&(o.hasOwnProperty(i)?null!=d&&"onScroll"===i&&Bn("scroll",e):null!=d&&b(e,i,d,l))}switch(a){case"input":V(e),$(e,n,!1);break;case"textarea":V(e),ie(e);break;case"option":null!=n.value&&e.setAttribute("value",""+z(n.value));break;case"select":e.multiple=!!n.multiple,null!=(i=n.value)?ae(e,!!n.multiple,i,!1):null!=n.defaultValue&&ae(e,!!n.multiple,n.defaultValue,!0);break;default:"function"===typeof s.onClick&&(e.onclick=$n)}switch(a){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Vo(t),null;case 6:if(e&&null!=t.stateNode)Lo(e,t,e.memoizedProps,n);else{if("string"!==typeof n&&null===t.stateNode)throw Error(r(166));if(a=Kr(Yr.current),Kr(Qr.current),ur(t)){if(n=t.stateNode,a=t.memoizedProps,n[hs]=t,(i=n.nodeValue!==a)&&null!==(e=ar))switch(e.tag){case 3:Jn(n.nodeValue,a,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jn(n.nodeValue,a,0!==(1&e.mode))}i&&(t.flags|=4)}else(n=(9===a.nodeType?a:a.ownerDocument).createTextNode(n))[hs]=t,t.stateNode=n}return Vo(t),null;case 13:if(As($r),n=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(sr&&null!==nr&&0!==(1&t.mode)&&0===(128&t.flags))hr(),mr(),t.flags|=98560,i=!1;else if(i=ur(t),null!==n&&null!==n.dehydrated){if(null===e){if(!i)throw Error(r(318));if(!(i=null!==(i=t.memoizedState)?i.dehydrated:null))throw Error(r(317));i[hs]=t}else mr(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Vo(t),i=!1}else null!==rr&&(ic(rr),rr=null),i=!0;if(!i)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=a,t):((n=null!==n)!==(null!==e&&null!==e.memoizedState)&&n&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&$r.current)?0===Ll&&(Ll=3):pc())),null!==t.updateQueue&&(t.flags|=4),Vo(t),null);case 4:return Xr(),Io(e,t),null===e&&Gn(t.stateNode.containerInfo),Vo(t),null;case 10:return Mr(t.type._context),Vo(t),null;case 19:if(As($r),null===(i=t.memoizedState))return Vo(t),null;if(n=0!==(128&t.flags),null===(l=i.rendering))if(n)Qo(i,!1);else{if(0!==Ll||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=ei(e))){for(t.flags|=128,Qo(i,!1),null!==(n=l.updateQueue)&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=a,a=t.child;null!==a;)e=n,(i=a).flags&=14680066,null===(l=i.alternate)?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=l.childLanes,i.lanes=l.lanes,i.child=l.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=l.memoizedProps,i.memoizedState=l.memoizedState,i.updateQueue=l.updateQueue,i.type=l.type,e=l.dependencies,i.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),a=a.sibling;return Ss($r,1&$r.current|2),t.child}e=e.sibling}null!==i.tail&&Ze()>Gl&&(t.flags|=128,n=!0,Qo(i,!1),t.lanes=4194304)}else{if(!n)if(null!==(e=ei(l))){if(t.flags|=128,n=!0,null!==(a=e.updateQueue)&&(t.updateQueue=a,t.flags|=4),Qo(i,!0),null===i.tail&&"hidden"===i.tailMode&&!l.alternate&&!sr)return Vo(t),null}else 2*Ze()-i.renderingStartTime>Gl&&1073741824!==a&&(t.flags|=128,n=!0,Qo(i,!1),t.lanes=4194304);i.isBackwards?(l.sibling=t.child,t.child=l):(null!==(a=i.last)?a.sibling=l:t.child=l,i.last=l)}return null!==i.tail?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Ze(),t.sibling=null,a=$r.current,Ss($r,n?1&a|2:1&a),t):(Vo(t),null);case 22:case 23:return uc(),n=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==n&&(t.flags|=8192),n&&0!==(1&t.mode)?0!==(1073741824&Il)&&(Vo(t),6&t.subtreeFlags&&(t.flags|=8192)):Vo(t),null;case 24:case 25:return null}throw Error(r(156,t.tag))}function Ko(e,t){switch(tr(t),t.tag){case 1:return Is(t.type)&&Os(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Xr(),As(ws),As(js),ai(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Jr(t),null;case 13:if(As($r),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(r(340));mr()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return As($r),null;case 4:return Xr(),null;case 10:return Mr(t.type._context),null;case 22:case 23:return uc(),null;default:return null}}ko=function(e,t){for(var a=t.child;null!==a;){if(5===a.tag||6===a.tag)e.appendChild(a.stateNode);else if(4!==a.tag&&null!==a.child){a.child.return=a,a=a.child;continue}if(a===t)break;for(;null===a.sibling;){if(null===a.return||a.return===t)return;a=a.return}a.sibling.return=a.return,a=a.sibling}},Io=function(){},Oo=function(e,t,a,n){var s=e.memoizedProps;if(s!==n){e=t.stateNode,Kr(Qr.current);var r,i=null;switch(a){case"input":s=q(e,s),n=q(e,n),i=[];break;case"select":s=U({},s,{value:void 0}),n=U({},n,{value:void 0}),i=[];break;case"textarea":s=ne(e,s),n=ne(e,n),i=[];break;default:"function"!==typeof s.onClick&&"function"===typeof n.onClick&&(e.onclick=$n)}for(d in ye(a,n),a=null,s)if(!n.hasOwnProperty(d)&&s.hasOwnProperty(d)&&null!=s[d])if("style"===d){var l=s[d];for(r in l)l.hasOwnProperty(r)&&(a||(a={}),a[r]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(o.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in n){var c=n[d];if(l=null!=s?s[d]:void 0,n.hasOwnProperty(d)&&c!==l&&(null!=c||null!=l))if("style"===d)if(l){for(r in l)!l.hasOwnProperty(r)||c&&c.hasOwnProperty(r)||(a||(a={}),a[r]="");for(r in c)c.hasOwnProperty(r)&&l[r]!==c[r]&&(a||(a={}),a[r]=c[r])}else a||(i||(i=[]),i.push(d,a)),a=c;else"dangerouslySetInnerHTML"===d?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(i=i||[]).push(d,c)):"children"===d?"string"!==typeof c&&"number"!==typeof c||(i=i||[]).push(d,""+c):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(o.hasOwnProperty(d)?(null!=c&&"onScroll"===d&&Bn("scroll",e),i||l===c||(i=[])):(i=i||[]).push(d,c))}a&&(i=i||[]).push("style",a);var d=i;(t.updateQueue=d)&&(t.flags|=4)}},Lo=function(e,t,a,n){a!==n&&(t.flags|=4)};var qo=!1,Xo=!1,Zo="function"===typeof WeakSet?WeakSet:Set,Jo=null;function $o(e,t){var a=e.ref;if(null!==a)if("function"===typeof a)try{a(null)}catch(n){Cc(e,t,n)}else a.current=null}function el(e,t,a){try{a()}catch(n){Cc(e,t,n)}}var tl=!1;function al(e,t,a){var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var s=n=n.next;do{if((s.tag&e)===e){var r=s.destroy;s.destroy=void 0,void 0!==r&&el(t,a,r)}s=s.next}while(s!==n)}}function nl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var a=t=t.next;do{if((a.tag&e)===e){var n=a.create;a.destroy=n()}a=a.next}while(a!==t)}}function sl(e){var t=e.ref;if(null!==t){var a=e.stateNode;e.tag,e=a,"function"===typeof t?t(e):t.current=e}}function rl(e){var t=e.alternate;null!==t&&(e.alternate=null,rl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hs],delete t[ms],delete t[ps],delete t[fs],delete t[vs])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function il(e){return 5===e.tag||3===e.tag||4===e.tag}function ol(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||il(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,a){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?8===a.nodeType?a.parentNode.insertBefore(e,t):a.insertBefore(e,t):(8===a.nodeType?(t=a.parentNode).insertBefore(e,a):(t=a).appendChild(e),null!==(a=a._reactRootContainer)&&void 0!==a||null!==t.onclick||(t.onclick=$n));else if(4!==n&&null!==(e=e.child))for(ll(e,t,a),e=e.sibling;null!==e;)ll(e,t,a),e=e.sibling}function cl(e,t,a){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?a.insertBefore(e,t):a.appendChild(e);else if(4!==n&&null!==(e=e.child))for(cl(e,t,a),e=e.sibling;null!==e;)cl(e,t,a),e=e.sibling}var dl=null,ul=!1;function hl(e,t,a){for(a=a.child;null!==a;)ml(e,t,a),a=a.sibling}function ml(e,t,a){if(rt&&"function"===typeof rt.onCommitFiberUnmount)try{rt.onCommitFiberUnmount(st,a)}catch(o){}switch(a.tag){case 5:Xo||$o(a,t);case 6:var n=dl,s=ul;dl=null,hl(e,t,a),ul=s,null!==(dl=n)&&(ul?(e=dl,a=a.stateNode,8===e.nodeType?e.parentNode.removeChild(a):e.removeChild(a)):dl.removeChild(a.stateNode));break;case 18:null!==dl&&(ul?(e=dl,a=a.stateNode,8===e.nodeType?ls(e.parentNode,a):1===e.nodeType&&ls(e,a),Gt(e)):ls(dl,a.stateNode));break;case 4:n=dl,s=ul,dl=a.stateNode.containerInfo,ul=!0,hl(e,t,a),dl=n,ul=s;break;case 0:case 11:case 14:case 15:if(!Xo&&(null!==(n=a.updateQueue)&&null!==(n=n.lastEffect))){s=n=n.next;do{var r=s,i=r.destroy;r=r.tag,void 0!==i&&(0!==(2&r)||0!==(4&r))&&el(a,t,i),s=s.next}while(s!==n)}hl(e,t,a);break;case 1:if(!Xo&&($o(a,t),"function"===typeof(n=a.stateNode).componentWillUnmount))try{n.props=a.memoizedProps,n.state=a.memoizedState,n.componentWillUnmount()}catch(o){Cc(a,t,o)}hl(e,t,a);break;case 21:hl(e,t,a);break;case 22:1&a.mode?(Xo=(n=Xo)||null!==a.memoizedState,hl(e,t,a),Xo=n):hl(e,t,a);break;default:hl(e,t,a)}}function gl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var a=e.stateNode;null===a&&(a=e.stateNode=new Zo),t.forEach((function(t){var n=jc.bind(null,e,t);a.has(t)||(a.add(t),t.then(n,n))}))}}function pl(e,t){var a=t.deletions;if(null!==a)for(var n=0;n<a.length;n++){var s=a[n];try{var i=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:dl=l.stateNode,ul=!1;break e;case 3:case 4:dl=l.stateNode.containerInfo,ul=!0;break e}l=l.return}if(null===dl)throw Error(r(160));ml(i,o,s),dl=null,ul=!1;var c=s.alternate;null!==c&&(c.return=null),s.return=null}catch(d){Cc(s,t,d)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)fl(t,e),t=t.sibling}function fl(e,t){var a=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(pl(t,e),vl(e),4&n){try{al(3,e,e.return),nl(3,e)}catch(f){Cc(e,e.return,f)}try{al(5,e,e.return)}catch(f){Cc(e,e.return,f)}}break;case 1:pl(t,e),vl(e),512&n&&null!==a&&$o(a,a.return);break;case 5:if(pl(t,e),vl(e),512&n&&null!==a&&$o(a,a.return),32&e.flags){var s=e.stateNode;try{he(s,"")}catch(f){Cc(e,e.return,f)}}if(4&n&&null!=(s=e.stateNode)){var i=e.memoizedProps,o=null!==a?a.memoizedProps:i,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===i.type&&null!=i.name&&Z(s,i),be(l,o);var d=be(l,i);for(o=0;o<c.length;o+=2){var u=c[o],h=c[o+1];"style"===u?fe(s,h):"dangerouslySetInnerHTML"===u?ue(s,h):"children"===u?he(s,h):b(s,u,h,d)}switch(l){case"input":J(s,i);break;case"textarea":re(s,i);break;case"select":var m=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var g=i.value;null!=g?ae(s,!!i.multiple,g,!1):m!==!!i.multiple&&(null!=i.defaultValue?ae(s,!!i.multiple,i.defaultValue,!0):ae(s,!!i.multiple,i.multiple?[]:"",!1))}s[ms]=i}catch(f){Cc(e,e.return,f)}}break;case 6:if(pl(t,e),vl(e),4&n){if(null===e.stateNode)throw Error(r(162));s=e.stateNode,i=e.memoizedProps;try{s.nodeValue=i}catch(f){Cc(e,e.return,f)}}break;case 3:if(pl(t,e),vl(e),4&n&&null!==a&&a.memoizedState.isDehydrated)try{Gt(t.containerInfo)}catch(f){Cc(e,e.return,f)}break;case 4:default:pl(t,e),vl(e);break;case 13:pl(t,e),vl(e),8192&(s=e.child).flags&&(i=null!==s.memoizedState,s.stateNode.isHidden=i,!i||null!==s.alternate&&null!==s.alternate.memoizedState||(Hl=Ze())),4&n&&gl(e);break;case 22:if(u=null!==a&&null!==a.memoizedState,1&e.mode?(Xo=(d=Xo)||u,pl(t,e),Xo=d):pl(t,e),vl(e),8192&n){if(d=null!==e.memoizedState,(e.stateNode.isHidden=d)&&!u&&0!==(1&e.mode))for(Jo=e,u=e.child;null!==u;){for(h=Jo=u;null!==Jo;){switch(g=(m=Jo).child,m.tag){case 0:case 11:case 14:case 15:al(4,m,m.return);break;case 1:$o(m,m.return);var p=m.stateNode;if("function"===typeof p.componentWillUnmount){n=m,a=m.return;try{t=n,p.props=t.memoizedProps,p.state=t.memoizedState,p.componentWillUnmount()}catch(f){Cc(n,a,f)}}break;case 5:$o(m,m.return);break;case 22:if(null!==m.memoizedState){xl(h);continue}}null!==g?(g.return=m,Jo=g):xl(h)}u=u.sibling}e:for(u=null,h=e;;){if(5===h.tag){if(null===u){u=h;try{s=h.stateNode,d?"function"===typeof(i=s.style).setProperty?i.setProperty("display","none","important"):i.display="none":(l=h.stateNode,o=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=pe("display",o))}catch(f){Cc(e,e.return,f)}}}else if(6===h.tag){if(null===u)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(f){Cc(e,e.return,f)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:pl(t,e),vl(e),4&n&&gl(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var a=e.return;null!==a;){if(il(a)){var n=a;break e}a=a.return}throw Error(r(160))}switch(n.tag){case 5:var s=n.stateNode;32&n.flags&&(he(s,""),n.flags&=-33),cl(e,ol(e),s);break;case 3:case 4:var i=n.stateNode.containerInfo;ll(e,ol(e),i);break;default:throw Error(r(161))}}catch(o){Cc(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yl(e,t,a){Jo=e,bl(e,t,a)}function bl(e,t,a){for(var n=0!==(1&e.mode);null!==Jo;){var s=Jo,r=s.child;if(22===s.tag&&n){var i=null!==s.memoizedState||qo;if(!i){var o=s.alternate,l=null!==o&&null!==o.memoizedState||Xo;o=qo;var c=Xo;if(qo=i,(Xo=l)&&!c)for(Jo=s;null!==Jo;)l=(i=Jo).child,22===i.tag&&null!==i.memoizedState?Nl(s):null!==l?(l.return=i,Jo=l):Nl(s);for(;null!==r;)Jo=r,bl(r,t,a),r=r.sibling;Jo=s,qo=o,Xo=c}El(e)}else 0!==(8772&s.subtreeFlags)&&null!==r?(r.return=s,Jo=r):El(e)}}function El(e){for(;null!==Jo;){var t=Jo;if(0!==(8772&t.flags)){var a=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Xo||nl(5,t);break;case 1:var n=t.stateNode;if(4&t.flags&&!Xo)if(null===a)n.componentDidMount();else{var s=t.elementType===t.type?a.memoizedProps:to(t.type,a.memoizedProps);n.componentDidUpdate(s,a.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;null!==i&&Wr(t,i,n);break;case 3:var o=t.updateQueue;if(null!==o){if(a=null,null!==t.child)switch(t.child.tag){case 5:case 1:a=t.child.stateNode}Wr(t,o,a)}break;case 5:var l=t.stateNode;if(null===a&&4&t.flags){a=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&a.focus();break;case"img":c.src&&(a.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var d=t.alternate;if(null!==d){var u=d.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&Gt(h)}}}break;default:throw Error(r(163))}Xo||512&t.flags&&sl(t)}catch(m){Cc(t,t.return,m)}}if(t===e){Jo=null;break}if(null!==(a=t.sibling)){a.return=t.return,Jo=a;break}Jo=t.return}}function xl(e){for(;null!==Jo;){var t=Jo;if(t===e){Jo=null;break}var a=t.sibling;if(null!==a){a.return=t.return,Jo=a;break}Jo=t.return}}function Nl(e){for(;null!==Jo;){var t=Jo;try{switch(t.tag){case 0:case 11:case 15:var a=t.return;try{nl(4,t)}catch(l){Cc(t,a,l)}break;case 1:var n=t.stateNode;if("function"===typeof n.componentDidMount){var s=t.return;try{n.componentDidMount()}catch(l){Cc(t,s,l)}}var r=t.return;try{sl(t)}catch(l){Cc(t,r,l)}break;case 5:var i=t.return;try{sl(t)}catch(l){Cc(t,i,l)}}}catch(l){Cc(t,t.return,l)}if(t===e){Jo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Jo=o;break}Jo=t.return}}var Tl,Cl=Math.ceil,Al=E.ReactCurrentDispatcher,Sl=E.ReactCurrentOwner,Ml=E.ReactCurrentBatchConfig,jl=0,wl=null,Rl=null,kl=0,Il=0,Ol=Cs(0),Ll=0,Pl=null,Dl=0,Ul=0,_l=0,Bl=null,Fl=null,Hl=0,Gl=1/0,Wl=null,zl=!1,Ql=null,Vl=null,Yl=!1,Kl=null,ql=0,Xl=0,Zl=null,Jl=-1,$l=0;function ec(){return 0!==(6&jl)?Ze():-1!==Jl?Jl:Jl=Ze()}function tc(e){return 0===(1&e.mode)?1:0!==(2&jl)&&0!==kl?kl&-kl:null!==pr.transition?(0===$l&&($l=pt()),$l):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Xt(e.type)}function ac(e,t,a,n){if(50<Xl)throw Xl=0,Zl=null,Error(r(185));vt(e,a,n),0!==(2&jl)&&e===wl||(e===wl&&(0===(2&jl)&&(Ul|=a),4===Ll&&oc(e,kl)),nc(e,n),1===a&&0===jl&&0===(1&t.mode)&&(Gl=Ze()+500,Bs&&Gs()))}function nc(e,t){var a=e.callbackNode;!function(e,t){for(var a=e.suspendedLanes,n=e.pingedLanes,s=e.expirationTimes,r=e.pendingLanes;0<r;){var i=31-it(r),o=1<<i,l=s[i];-1===l?0!==(o&a)&&0===(o&n)||(s[i]=mt(o,t)):l<=t&&(e.expiredLanes|=o),r&=~o}}(e,t);var n=ht(e,e===wl?kl:0);if(0===n)null!==a&&Ke(a),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(null!=a&&Ke(a),1===t)0===e.tag?function(e){Bs=!0,Hs(e)}(lc.bind(null,e)):Hs(lc.bind(null,e)),is((function(){0===(6&jl)&&Gs()})),a=null;else{switch(Et(n)){case 1:a=$e;break;case 4:a=et;break;case 16:default:a=tt;break;case 536870912:a=nt}a=wc(a,sc.bind(null,e))}e.callbackPriority=t,e.callbackNode=a}}function sc(e,t){if(Jl=-1,$l=0,0!==(6&jl))throw Error(r(327));var a=e.callbackNode;if(Nc()&&e.callbackNode!==a)return null;var n=ht(e,e===wl?kl:0);if(0===n)return null;if(0!==(30&n)||0!==(n&e.expiredLanes)||t)t=fc(e,n);else{t=n;var s=jl;jl|=2;var i=gc();for(wl===e&&kl===t||(Wl=null,Gl=Ze()+500,hc(e,t));;)try{yc();break}catch(l){mc(e,l)}Sr(),Al.current=i,jl=s,null!==Rl?t=0:(wl=null,kl=0,t=Ll)}if(0!==t){if(2===t&&(0!==(s=gt(e))&&(n=s,t=rc(e,s))),1===t)throw a=Pl,hc(e,0),oc(e,n),nc(e,Ze()),a;if(6===t)oc(e,n);else{if(s=e.current.alternate,0===(30&n)&&!function(e){for(var t=e;;){if(16384&t.flags){var a=t.updateQueue;if(null!==a&&null!==(a=a.stores))for(var n=0;n<a.length;n++){var s=a[n],r=s.getSnapshot;s=s.value;try{if(!on(r(),s))return!1}catch(o){return!1}}}if(a=t.child,16384&t.subtreeFlags&&null!==a)a.return=t,t=a;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(s)&&(2===(t=fc(e,n))&&(0!==(i=gt(e))&&(n=i,t=rc(e,i))),1===t))throw a=Pl,hc(e,0),oc(e,n),nc(e,Ze()),a;switch(e.finishedWork=s,e.finishedLanes=n,t){case 0:case 1:throw Error(r(345));case 2:case 5:xc(e,Fl,Wl);break;case 3:if(oc(e,n),(130023424&n)===n&&10<(t=Hl+500-Ze())){if(0!==ht(e,0))break;if(((s=e.suspendedLanes)&n)!==n){ec(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=ns(xc.bind(null,e,Fl,Wl),t);break}xc(e,Fl,Wl);break;case 4:if(oc(e,n),(4194240&n)===n)break;for(t=e.eventTimes,s=-1;0<n;){var o=31-it(n);i=1<<o,(o=t[o])>s&&(s=o),n&=~i}if(n=s,10<(n=(120>(n=Ze()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Cl(n/1960))-n)){e.timeoutHandle=ns(xc.bind(null,e,Fl,Wl),n);break}xc(e,Fl,Wl);break;default:throw Error(r(329))}}}return nc(e,Ze()),e.callbackNode===a?sc.bind(null,e):null}function rc(e,t){var a=Bl;return e.current.memoizedState.isDehydrated&&(hc(e,t).flags|=256),2!==(e=fc(e,t))&&(t=Fl,Fl=a,null!==t&&ic(t)),e}function ic(e){null===Fl?Fl=e:Fl.push.apply(Fl,e)}function oc(e,t){for(t&=~_l,t&=~Ul,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var a=31-it(t),n=1<<a;e[a]=-1,t&=~n}}function lc(e){if(0!==(6&jl))throw Error(r(327));Nc();var t=ht(e,0);if(0===(1&t))return nc(e,Ze()),null;var a=fc(e,t);if(0!==e.tag&&2===a){var n=gt(e);0!==n&&(t=n,a=rc(e,n))}if(1===a)throw a=Pl,hc(e,0),oc(e,t),nc(e,Ze()),a;if(6===a)throw Error(r(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,xc(e,Fl,Wl),nc(e,Ze()),null}function cc(e,t){var a=jl;jl|=1;try{return e(t)}finally{0===(jl=a)&&(Gl=Ze()+500,Bs&&Gs())}}function dc(e){null!==Kl&&0===Kl.tag&&0===(6&jl)&&Nc();var t=jl;jl|=1;var a=Ml.transition,n=bt;try{if(Ml.transition=null,bt=1,e)return e()}finally{bt=n,Ml.transition=a,0===(6&(jl=t))&&Gs()}}function uc(){Il=Ol.current,As(Ol)}function hc(e,t){e.finishedWork=null,e.finishedLanes=0;var a=e.timeoutHandle;if(-1!==a&&(e.timeoutHandle=-1,ss(a)),null!==Rl)for(a=Rl.return;null!==a;){var n=a;switch(tr(n),n.tag){case 1:null!==(n=n.type.childContextTypes)&&void 0!==n&&Os();break;case 3:Xr(),As(ws),As(js),ai();break;case 5:Jr(n);break;case 4:Xr();break;case 13:case 19:As($r);break;case 10:Mr(n.type._context);break;case 22:case 23:uc()}a=a.return}if(wl=e,Rl=e=Oc(e.current,null),kl=Il=t,Ll=0,Pl=null,_l=Ul=Dl=0,Fl=Bl=null,null!==kr){for(t=0;t<kr.length;t++)if(null!==(n=(a=kr[t]).interleaved)){a.interleaved=null;var s=n.next,r=a.pending;if(null!==r){var i=r.next;r.next=s,n.next=i}a.pending=n}kr=null}return e}function mc(e,t){for(;;){var a=Rl;try{if(Sr(),ni.current=Zi,ci){for(var n=ii.memoizedState;null!==n;){var s=n.queue;null!==s&&(s.pending=null),n=n.next}ci=!1}if(ri=0,li=oi=ii=null,di=!1,ui=0,Sl.current=null,null===a||null===a.return){Ll=1,Pl=t,Rl=null;break}e:{var i=e,o=a.return,l=a,c=t;if(t=kl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var d=c,u=l,h=u.tag;if(0===(1&u.mode)&&(0===h||11===h||15===h)){var m=u.alternate;m?(u.updateQueue=m.updateQueue,u.memoizedState=m.memoizedState,u.lanes=m.lanes):(u.updateQueue=null,u.memoizedState=null)}var g=fo(o);if(null!==g){g.flags&=-257,vo(g,o,l,0,t),1&g.mode&&po(i,d,t),c=d;var p=(t=g).updateQueue;if(null===p){var f=new Set;f.add(c),t.updateQueue=f}else p.add(c);break e}if(0===(1&t)){po(i,d,t),pc();break e}c=Error(r(426))}else if(sr&&1&l.mode){var v=fo(o);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),vo(v,o,l,0,t),gr(lo(c,l));break e}}i=c=lo(c,l),4!==Ll&&(Ll=2),null===Bl?Bl=[i]:Bl.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t,Hr(i,mo(0,c,t));break e;case 1:l=c;var y=i.type,b=i.stateNode;if(0===(128&i.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Vl||!Vl.has(b)))){i.flags|=65536,t&=-t,i.lanes|=t,Hr(i,go(i,l,t));break e}}i=i.return}while(null!==i)}Ec(a)}catch(E){t=E,Rl===a&&null!==a&&(Rl=a=a.return);continue}break}}function gc(){var e=Al.current;return Al.current=Zi,null===e?Zi:e}function pc(){0!==Ll&&3!==Ll&&2!==Ll||(Ll=4),null===wl||0===(268435455&Dl)&&0===(268435455&Ul)||oc(wl,kl)}function fc(e,t){var a=jl;jl|=2;var n=gc();for(wl===e&&kl===t||(Wl=null,hc(e,t));;)try{vc();break}catch(s){mc(e,s)}if(Sr(),jl=a,Al.current=n,null!==Rl)throw Error(r(261));return wl=null,kl=0,Ll}function vc(){for(;null!==Rl;)bc(Rl)}function yc(){for(;null!==Rl&&!qe();)bc(Rl)}function bc(e){var t=Tl(e.alternate,e,Il);e.memoizedProps=e.pendingProps,null===t?Ec(e):Rl=t,Sl.current=null}function Ec(e){var t=e;do{var a=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(a=Yo(a,t,Il)))return void(Rl=a)}else{if(null!==(a=Ko(a,t)))return a.flags&=32767,void(Rl=a);if(null===e)return Ll=6,void(Rl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Rl=t);Rl=t=e}while(null!==t);0===Ll&&(Ll=5)}function xc(e,t,a){var n=bt,s=Ml.transition;try{Ml.transition=null,bt=1,function(e,t,a,n){do{Nc()}while(null!==Kl);if(0!==(6&jl))throw Error(r(327));a=e.finishedWork;var s=e.finishedLanes;if(null===a)return null;if(e.finishedWork=null,e.finishedLanes=0,a===e.current)throw Error(r(177));e.callbackNode=null,e.callbackPriority=0;var i=a.lanes|a.childLanes;if(function(e,t){var a=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<a;){var s=31-it(a),r=1<<s;t[s]=0,n[s]=-1,e[s]=-1,a&=~r}}(e,i),e===wl&&(Rl=wl=null,kl=0),0===(2064&a.subtreeFlags)&&0===(2064&a.flags)||Yl||(Yl=!0,wc(tt,(function(){return Nc(),null}))),i=0!==(15990&a.flags),0!==(15990&a.subtreeFlags)||i){i=Ml.transition,Ml.transition=null;var o=bt;bt=1;var l=jl;jl|=4,Sl.current=null,function(e,t){if(es=zt,mn(e=hn())){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{var n=(a=(a=e.ownerDocument)&&a.defaultView||window).getSelection&&a.getSelection();if(n&&0!==n.rangeCount){a=n.anchorNode;var s=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{a.nodeType,i.nodeType}catch(x){a=null;break e}var o=0,l=-1,c=-1,d=0,u=0,h=e,m=null;t:for(;;){for(var g;h!==a||0!==s&&3!==h.nodeType||(l=o+s),h!==i||0!==n&&3!==h.nodeType||(c=o+n),3===h.nodeType&&(o+=h.nodeValue.length),null!==(g=h.firstChild);)m=h,h=g;for(;;){if(h===e)break t;if(m===a&&++d===s&&(l=o),m===i&&++u===n&&(c=o),null!==(g=h.nextSibling))break;m=(h=m).parentNode}h=g}a=-1===l||-1===c?null:{start:l,end:c}}else a=null}a=a||{start:0,end:0}}else a=null;for(ts={focusedElem:e,selectionRange:a},zt=!1,Jo=t;null!==Jo;)if(e=(t=Jo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Jo=e;else for(;null!==Jo;){t=Jo;try{var p=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==p){var f=p.memoizedProps,v=p.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?f:to(t.type,f),v);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var E=t.stateNode.containerInfo;1===E.nodeType?E.textContent="":9===E.nodeType&&E.documentElement&&E.removeChild(E.documentElement);break;default:throw Error(r(163))}}catch(x){Cc(t,t.return,x)}if(null!==(e=t.sibling)){e.return=t.return,Jo=e;break}Jo=t.return}p=tl,tl=!1}(e,a),fl(a,e),gn(ts),zt=!!es,ts=es=null,e.current=a,yl(a,e,s),Xe(),jl=l,bt=o,Ml.transition=i}else e.current=a;if(Yl&&(Yl=!1,Kl=e,ql=s),i=e.pendingLanes,0===i&&(Vl=null),function(e){if(rt&&"function"===typeof rt.onCommitFiberRoot)try{rt.onCommitFiberRoot(st,e,void 0,128===(128&e.current.flags))}catch(t){}}(a.stateNode),nc(e,Ze()),null!==t)for(n=e.onRecoverableError,a=0;a<t.length;a++)s=t[a],n(s.value,{componentStack:s.stack,digest:s.digest});if(zl)throw zl=!1,e=Ql,Ql=null,e;0!==(1&ql)&&0!==e.tag&&Nc(),i=e.pendingLanes,0!==(1&i)?e===Zl?Xl++:(Xl=0,Zl=e):Xl=0,Gs()}(e,t,a,n)}finally{Ml.transition=s,bt=n}return null}function Nc(){if(null!==Kl){var e=Et(ql),t=Ml.transition,a=bt;try{if(Ml.transition=null,bt=16>e?16:e,null===Kl)var n=!1;else{if(e=Kl,Kl=null,ql=0,0!==(6&jl))throw Error(r(331));var s=jl;for(jl|=4,Jo=e.current;null!==Jo;){var i=Jo,o=i.child;if(0!==(16&Jo.flags)){var l=i.deletions;if(null!==l){for(var c=0;c<l.length;c++){var d=l[c];for(Jo=d;null!==Jo;){var u=Jo;switch(u.tag){case 0:case 11:case 15:al(8,u,i)}var h=u.child;if(null!==h)h.return=u,Jo=h;else for(;null!==Jo;){var m=(u=Jo).sibling,g=u.return;if(rl(u),u===d){Jo=null;break}if(null!==m){m.return=g,Jo=m;break}Jo=g}}}var p=i.alternate;if(null!==p){var f=p.child;if(null!==f){p.child=null;do{var v=f.sibling;f.sibling=null,f=v}while(null!==f)}}Jo=i}}if(0!==(2064&i.subtreeFlags)&&null!==o)o.return=i,Jo=o;else e:for(;null!==Jo;){if(0!==(2048&(i=Jo).flags))switch(i.tag){case 0:case 11:case 15:al(9,i,i.return)}var y=i.sibling;if(null!==y){y.return=i.return,Jo=y;break e}Jo=i.return}}var b=e.current;for(Jo=b;null!==Jo;){var E=(o=Jo).child;if(0!==(2064&o.subtreeFlags)&&null!==E)E.return=o,Jo=E;else e:for(o=b;null!==Jo;){if(0!==(2048&(l=Jo).flags))try{switch(l.tag){case 0:case 11:case 15:nl(9,l)}}catch(N){Cc(l,l.return,N)}if(l===o){Jo=null;break e}var x=l.sibling;if(null!==x){x.return=l.return,Jo=x;break e}Jo=l.return}}if(jl=s,Gs(),rt&&"function"===typeof rt.onPostCommitFiberRoot)try{rt.onPostCommitFiberRoot(st,e)}catch(N){}n=!0}return n}finally{bt=a,Ml.transition=t}}return!1}function Tc(e,t,a){e=Br(e,t=mo(0,t=lo(a,t),1),1),t=ec(),null!==e&&(vt(e,1,t),nc(e,t))}function Cc(e,t,a){if(3===e.tag)Tc(e,e,a);else for(;null!==t;){if(3===t.tag){Tc(t,e,a);break}if(1===t.tag){var n=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof n.componentDidCatch&&(null===Vl||!Vl.has(n))){t=Br(t,e=go(t,e=lo(a,e),1),1),e=ec(),null!==t&&(vt(t,1,e),nc(t,e));break}}t=t.return}}function Ac(e,t,a){var n=e.pingCache;null!==n&&n.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&a,wl===e&&(kl&a)===a&&(4===Ll||3===Ll&&(130023424&kl)===kl&&500>Ze()-Hl?hc(e,0):_l|=a),nc(e,t)}function Sc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=dt,0===(130023424&(dt<<=1))&&(dt=4194304)));var a=ec();null!==(e=Lr(e,t))&&(vt(e,t,a),nc(e,a))}function Mc(e){var t=e.memoizedState,a=0;null!==t&&(a=t.retryLane),Sc(e,a)}function jc(e,t){var a=0;switch(e.tag){case 13:var n=e.stateNode,s=e.memoizedState;null!==s&&(a=s.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(r(314))}null!==n&&n.delete(t),Sc(e,a)}function wc(e,t){return Ye(e,t)}function Rc(e,t,a,n){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function kc(e,t,a,n){return new Rc(e,t,a,n)}function Ic(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Oc(e,t){var a=e.alternate;return null===a?((a=kc(e.tag,t,e.key,e.mode)).elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=t,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=14680064&e.flags,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,t=e.dependencies,a.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a}function Lc(e,t,a,n,s,i){var o=2;if(n=e,"function"===typeof e)Ic(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case T:return Pc(a.children,s,i,t);case C:o=8,s|=8;break;case A:return(e=kc(12,a,t,2|s)).elementType=A,e.lanes=i,e;case w:return(e=kc(13,a,t,s)).elementType=w,e.lanes=i,e;case R:return(e=kc(19,a,t,s)).elementType=R,e.lanes=i,e;case O:return Dc(a,s,i,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case S:o=10;break e;case M:o=9;break e;case j:o=11;break e;case k:o=14;break e;case I:o=16,n=null;break e}throw Error(r(130,null==e?e:typeof e,""))}return(t=kc(o,a,t,s)).elementType=e,t.type=n,t.lanes=i,t}function Pc(e,t,a,n){return(e=kc(7,e,n,t)).lanes=a,e}function Dc(e,t,a,n){return(e=kc(22,e,n,t)).elementType=O,e.lanes=a,e.stateNode={isHidden:!1},e}function Uc(e,t,a){return(e=kc(6,e,null,t)).lanes=a,e}function _c(e,t,a){return(t=kc(4,null!==e.children?e.children:[],e.key,t)).lanes=a,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bc(e,t,a,n,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ft(0),this.expirationTimes=ft(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ft(0),this.identifierPrefix=n,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Fc(e,t,a,n,s,r,i,o,l){return e=new Bc(e,t,a,o,l),1===t?(t=1,!0===r&&(t|=8)):t=0,r=kc(3,null,null,t),e.current=r,r.stateNode=e,r.memoizedState={element:n,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},Dr(r),e}function Hc(e){if(!e)return Ms;e:{if(Ge(e=e._reactInternals)!==e||1!==e.tag)throw Error(r(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Is(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(r(171))}if(1===e.tag){var a=e.type;if(Is(a))return Ps(e,a,t)}return t}function Gc(e,t,a,n,s,r,i,o,l){return(e=Fc(a,n,!0,e,0,r,0,o,l)).context=Hc(null),a=e.current,(r=_r(n=ec(),s=tc(a))).callback=void 0!==t&&null!==t?t:null,Br(a,r,s),e.current.lanes=s,vt(e,s,n),nc(e,n),e}function Wc(e,t,a,n){var s=t.current,r=ec(),i=tc(s);return a=Hc(a),null===t.context?t.context=a:t.pendingContext=a,(t=_r(r,i)).payload={element:e},null!==(n=void 0===n?null:n)&&(t.callback=n),null!==(e=Br(s,t,i))&&(ac(e,s,i,r),Fr(e,s,i)),i}function zc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Qc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var a=e.retryLane;e.retryLane=0!==a&&a<t?a:t}}function Vc(e,t){Qc(e,t),(e=e.alternate)&&Qc(e,t)}Tl=function(e,t,a){if(null!==e)if(e.memoizedProps!==t.pendingProps||ws.current)bo=!0;else{if(0===(e.lanes&a)&&0===(128&t.flags))return bo=!1,function(e,t,a){switch(t.tag){case 3:wo(t),mr();break;case 5:Zr(t);break;case 1:Is(t.type)&&Ds(t);break;case 4:qr(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,s=t.memoizedProps.value;Ss(Nr,n._currentValue),n._currentValue=s;break;case 13:if(null!==(n=t.memoizedState))return null!==n.dehydrated?(Ss($r,1&$r.current),t.flags|=128,null):0!==(a&t.child.childLanes)?Uo(e,t,a):(Ss($r,1&$r.current),null!==(e=zo(e,t,a))?e.sibling:null);Ss($r,1&$r.current);break;case 19:if(n=0!==(a&t.childLanes),0!==(128&e.flags)){if(n)return Go(e,t,a);t.flags|=128}if(null!==(s=t.memoizedState)&&(s.rendering=null,s.tail=null,s.lastEffect=null),Ss($r,$r.current),n)break;return null;case 22:case 23:return t.lanes=0,Co(e,t,a)}return zo(e,t,a)}(e,t,a);bo=0!==(131072&e.flags)}else bo=!1,sr&&0!==(1048576&t.flags)&&$s(t,Vs,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;Wo(e,t),e=t.pendingProps;var s=ks(t,js.current);wr(t,a),s=pi(null,t,n,e,s,a);var i=fi();return t.flags|=1,"object"===typeof s&&null!==s&&"function"===typeof s.render&&void 0===s.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Is(n)?(i=!0,Ds(t)):i=!1,t.memoizedState=null!==s.state&&void 0!==s.state?s.state:null,Dr(t),s.updater=no,t.stateNode=s,s._reactInternals=t,oo(t,n,e,a),t=jo(null,t,n,!0,i,a)):(t.tag=0,sr&&i&&er(t),Eo(null,t,s,a),t=t.child),t;case 16:n=t.elementType;e:{switch(Wo(e,t),e=t.pendingProps,n=(s=n._init)(n._payload),t.type=n,s=t.tag=function(e){if("function"===typeof e)return Ic(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===j)return 11;if(e===k)return 14}return 2}(n),e=to(n,e),s){case 0:t=So(null,t,n,e,a);break e;case 1:t=Mo(null,t,n,e,a);break e;case 11:t=xo(null,t,n,e,a);break e;case 14:t=No(null,t,n,to(n.type,e),a);break e}throw Error(r(306,n,""))}return t;case 0:return n=t.type,s=t.pendingProps,So(e,t,n,s=t.elementType===n?s:to(n,s),a);case 1:return n=t.type,s=t.pendingProps,Mo(e,t,n,s=t.elementType===n?s:to(n,s),a);case 3:e:{if(wo(t),null===e)throw Error(r(387));n=t.pendingProps,s=(i=t.memoizedState).element,Ur(e,t),Gr(t,n,null,a);var o=t.memoizedState;if(n=o.element,i.isDehydrated){if(i={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=i,t.memoizedState=i,256&t.flags){t=Ro(e,t,n,a,s=lo(Error(r(423)),t));break e}if(n!==s){t=Ro(e,t,n,a,s=lo(Error(r(424)),t));break e}for(nr=cs(t.stateNode.containerInfo.firstChild),ar=t,sr=!0,rr=null,a=xr(t,null,n,a),t.child=a;a;)a.flags=-3&a.flags|4096,a=a.sibling}else{if(mr(),n===s){t=zo(e,t,a);break e}Eo(e,t,n,a)}t=t.child}return t;case 5:return Zr(t),null===e&&cr(t),n=t.type,s=t.pendingProps,i=null!==e?e.memoizedProps:null,o=s.children,as(n,s)?o=null:null!==i&&as(n,i)&&(t.flags|=32),Ao(e,t),Eo(e,t,o,a),t.child;case 6:return null===e&&cr(t),null;case 13:return Uo(e,t,a);case 4:return qr(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=Er(t,null,n,a):Eo(e,t,n,a),t.child;case 11:return n=t.type,s=t.pendingProps,xo(e,t,n,s=t.elementType===n?s:to(n,s),a);case 7:return Eo(e,t,t.pendingProps,a),t.child;case 8:case 12:return Eo(e,t,t.pendingProps.children,a),t.child;case 10:e:{if(n=t.type._context,s=t.pendingProps,i=t.memoizedProps,o=s.value,Ss(Nr,n._currentValue),n._currentValue=o,null!==i)if(on(i.value,o)){if(i.children===s.children&&!ws.current){t=zo(e,t,a);break e}}else for(null!==(i=t.child)&&(i.return=t);null!==i;){var l=i.dependencies;if(null!==l){o=i.child;for(var c=l.firstContext;null!==c;){if(c.context===n){if(1===i.tag){(c=_r(-1,a&-a)).tag=2;var d=i.updateQueue;if(null!==d){var u=(d=d.shared).pending;null===u?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}i.lanes|=a,null!==(c=i.alternate)&&(c.lanes|=a),jr(i.return,a,t),l.lanes|=a;break}c=c.next}}else if(10===i.tag)o=i.type===t.type?null:i.child;else if(18===i.tag){if(null===(o=i.return))throw Error(r(341));o.lanes|=a,null!==(l=o.alternate)&&(l.lanes|=a),jr(o,a,t),o=i.sibling}else o=i.child;if(null!==o)o.return=i;else for(o=i;null!==o;){if(o===t){o=null;break}if(null!==(i=o.sibling)){i.return=o.return,o=i;break}o=o.return}i=o}Eo(e,t,s.children,a),t=t.child}return t;case 9:return s=t.type,n=t.pendingProps.children,wr(t,a),n=n(s=Rr(s)),t.flags|=1,Eo(e,t,n,a),t.child;case 14:return s=to(n=t.type,t.pendingProps),No(e,t,n,s=to(n.type,s),a);case 15:return To(e,t,t.type,t.pendingProps,a);case 17:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:to(n,s),Wo(e,t),t.tag=1,Is(n)?(e=!0,Ds(t)):e=!1,wr(t,a),ro(t,n,s),oo(t,n,s,a),jo(null,t,n,!0,e,a);case 19:return Go(e,t,a);case 22:return Co(e,t,a)}throw Error(r(156,t.tag))};var Yc="function"===typeof reportError?reportError:function(e){console.error(e)};function Kc(e){this._internalRoot=e}function qc(e){this._internalRoot=e}function Xc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Zc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Jc(){}function $c(e,t,a,n,s){var r=a._reactRootContainer;if(r){var i=r;if("function"===typeof s){var o=s;s=function(){var e=zc(i);o.call(e)}}Wc(t,i,e,s)}else i=function(e,t,a,n,s){if(s){if("function"===typeof n){var r=n;n=function(){var e=zc(i);r.call(e)}}var i=Gc(t,n,e,0,null,!1,0,"",Jc);return e._reactRootContainer=i,e[gs]=i.current,Gn(8===e.nodeType?e.parentNode:e),dc(),i}for(;s=e.lastChild;)e.removeChild(s);if("function"===typeof n){var o=n;n=function(){var e=zc(l);o.call(e)}}var l=Fc(e,0,!1,null,0,!1,0,"",Jc);return e._reactRootContainer=l,e[gs]=l.current,Gn(8===e.nodeType?e.parentNode:e),dc((function(){Wc(t,l,a,n)})),l}(a,t,e,s,n);return zc(i)}qc.prototype.render=Kc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(r(409));Wc(e,t,null,null)},qc.prototype.unmount=Kc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;dc((function(){Wc(null,e,null,null)})),t[gs]=null}},qc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Ct();e={blockedOn:null,target:e,priority:t};for(var a=0;a<Ot.length&&0!==t&&t<Ot[a].priority;a++);Ot.splice(a,0,e),0===a&&Ut(e)}},xt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var a=ut(t.pendingLanes);0!==a&&(yt(t,1|a),nc(t,Ze()),0===(6&jl)&&(Gl=Ze()+500,Gs()))}break;case 13:dc((function(){var t=Lr(e,1);if(null!==t){var a=ec();ac(t,e,1,a)}})),Vc(e,1)}},Nt=function(e){if(13===e.tag){var t=Lr(e,134217728);if(null!==t)ac(t,e,134217728,ec());Vc(e,134217728)}},Tt=function(e){if(13===e.tag){var t=tc(e),a=Lr(e,t);if(null!==a)ac(a,e,t,ec());Vc(e,t)}},Ct=function(){return bt},At=function(e,t){var a=bt;try{return bt=e,t()}finally{bt=a}},Ne=function(e,t,a){switch(t){case"input":if(J(e,a),t=a.name,"radio"===a.type&&null!=t){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<a.length;t++){var n=a[t];if(n!==e&&n.form===e.form){var s=xs(n);if(!s)throw Error(r(90));Y(n),J(n,s)}}}break;case"textarea":re(e,a);break;case"select":null!=(t=a.value)&&ae(e,!!a.multiple,t,!1)}},je=cc,we=dc;var ed={usingClientEntryPoint:!1,Events:[bs,Es,xs,Se,Me,cc]},td={findFiberByHostInstance:ys,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ad={bundleType:td.bundleType,version:td.version,rendererPackageName:td.rendererPackageName,rendererConfig:td.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:E.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Qe(e))?null:e.stateNode},findFiberByHostInstance:td.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var nd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!nd.isDisabled&&nd.supportsFiber)try{st=nd.inject(ad),rt=nd}catch(de){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ed,t.createPortal=function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Xc(t))throw Error(r(200));return function(e,t,a){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:N,key:null==n?null:""+n,children:e,containerInfo:t,implementation:a}}(e,t,null,a)},t.createRoot=function(e,t){if(!Xc(e))throw Error(r(299));var a=!1,n="",s=Yc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(a=!0),void 0!==t.identifierPrefix&&(n=t.identifierPrefix),void 0!==t.onRecoverableError&&(s=t.onRecoverableError)),t=Fc(e,1,!1,null,0,a,0,n,s),e[gs]=t.current,Gn(8===e.nodeType?e.parentNode:e),new Kc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(r(188));throw e=Object.keys(e).join(","),Error(r(268,e))}return e=null===(e=Qe(t))?null:e.stateNode},t.flushSync=function(e){return dc(e)},t.hydrate=function(e,t,a){if(!Zc(t))throw Error(r(200));return $c(null,e,t,!0,a)},t.hydrateRoot=function(e,t,a){if(!Xc(e))throw Error(r(405));var n=null!=a&&a.hydratedSources||null,s=!1,i="",o=Yc;if(null!==a&&void 0!==a&&(!0===a.unstable_strictMode&&(s=!0),void 0!==a.identifierPrefix&&(i=a.identifierPrefix),void 0!==a.onRecoverableError&&(o=a.onRecoverableError)),t=Gc(t,null,e,1,null!=a?a:null,s,0,i,o),e[gs]=t.current,Gn(e),n)for(e=0;e<n.length;e++)s=(s=(a=n[e])._getVersion)(a._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[a,s]:t.mutableSourceEagerHydrationData.push(a,s);return new qc(t)},t.render=function(e,t,a){if(!Zc(t))throw Error(r(200));return $c(null,e,t,!1,a)},t.unmountComponentAtNode=function(e){if(!Zc(e))throw Error(r(40));return!!e._reactRootContainer&&(dc((function(){$c(null,null,e,!1,(function(){e._reactRootContainer=null,e[gs]=null}))})),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,a,n){if(!Zc(a))throw Error(r(200));if(null==e||void 0===e._reactInternals)throw Error(r(38));return $c(e,t,a,!1,n)},t.version="18.3.1-next-f1338f8080-20240426"},4391:(e,t,a)=>{var n=a(7950);t.createRoot=n.createRoot,t.hydrateRoot=n.hydrateRoot},7950:(e,t,a)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=a(2730)},1153:(e,t,a)=>{var n=a(5043),s=Symbol.for("react.element"),r=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,a){var n,r={},c=null,d=null;for(n in void 0!==a&&(c=""+a),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)i.call(t,n)&&!l.hasOwnProperty(n)&&(r[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===r[n]&&(r[n]=t[n]);return{$$typeof:s,type:e,key:c,ref:d,props:r,_owner:o.current}}t.Fragment=r,t.jsx=c,t.jsxs=c},4202:(e,t)=>{var a=Symbol.for("react.element"),n=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),m=Symbol.iterator;var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},p=Object.assign,f={};function v(e,t,a){this.props=e,this.context=t,this.refs=f,this.updater=a||g}function y(){}function b(e,t,a){this.props=e,this.context=t,this.refs=f,this.updater=a||g}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var E=b.prototype=new y;E.constructor=b,p(E,v.prototype),E.isPureReactComponent=!0;var x=Array.isArray,N=Object.prototype.hasOwnProperty,T={current:null},C={key:!0,ref:!0,__self:!0,__source:!0};function A(e,t,n){var s,r={},i=null,o=null;if(null!=t)for(s in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(i=""+t.key),t)N.call(t,s)&&!C.hasOwnProperty(s)&&(r[s]=t[s]);var l=arguments.length-2;if(1===l)r.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];r.children=c}if(e&&e.defaultProps)for(s in l=e.defaultProps)void 0===r[s]&&(r[s]=l[s]);return{$$typeof:a,type:e,key:i,ref:o,props:r,_owner:T.current}}function S(e){return"object"===typeof e&&null!==e&&e.$$typeof===a}var M=/\/+/g;function j(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function w(e,t,s,r,i){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case a:case n:l=!0}}if(l)return i=i(l=e),e=""===r?"."+j(l,0):r,x(i)?(s="",null!=e&&(s=e.replace(M,"$&/")+"/"),w(i,t,s,"",(function(e){return e}))):null!=i&&(S(i)&&(i=function(e,t){return{$$typeof:a,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(i,s+(!i.key||l&&l.key===i.key?"":(""+i.key).replace(M,"$&/")+"/")+e)),t.push(i)),1;if(l=0,r=""===r?".":r+":",x(e))for(var c=0;c<e.length;c++){var d=r+j(o=e[c],c);l+=w(o,t,s,d,i)}else if(d=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=m&&e[m]||e["@@iterator"])?e:null}(e),"function"===typeof d)for(e=d.call(e),c=0;!(o=e.next()).done;)l+=w(o=o.value,t,s,d=r+j(o,c++),i);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function R(e,t,a){if(null==e)return e;var n=[],s=0;return w(e,n,"","",(function(e){return t.call(a,e,s++)})),n}function k(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var I={current:null},O={transition:null},L={ReactCurrentDispatcher:I,ReactCurrentBatchConfig:O,ReactCurrentOwner:T};function P(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:R,forEach:function(e,t,a){R(e,(function(){t.apply(this,arguments)}),a)},count:function(e){var t=0;return R(e,(function(){t++})),t},toArray:function(e){return R(e,(function(e){return e}))||[]},only:function(e){if(!S(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=s,t.Profiler=i,t.PureComponent=b,t.StrictMode=r,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L,t.act=P,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=p({},e.props),r=e.key,i=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(i=t.ref,o=T.current),void 0!==t.key&&(r=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)N.call(t,c)&&!C.hasOwnProperty(c)&&(s[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)s.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];s.children=l}return{$$typeof:a,type:e.type,key:r,ref:i,props:s,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=A,t.createFactory=function(e){var t=A.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=S,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:k}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=O.transition;O.transition={};try{e()}finally{O.transition=t}},t.unstable_act=P,t.useCallback=function(e,t){return I.current.useCallback(e,t)},t.useContext=function(e){return I.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return I.current.useDeferredValue(e)},t.useEffect=function(e,t){return I.current.useEffect(e,t)},t.useId=function(){return I.current.useId()},t.useImperativeHandle=function(e,t,a){return I.current.useImperativeHandle(e,t,a)},t.useInsertionEffect=function(e,t){return I.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return I.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return I.current.useMemo(e,t)},t.useReducer=function(e,t,a){return I.current.useReducer(e,t,a)},t.useRef=function(e){return I.current.useRef(e)},t.useState=function(e){return I.current.useState(e)},t.useSyncExternalStore=function(e,t,a){return I.current.useSyncExternalStore(e,t,a)},t.useTransition=function(){return I.current.useTransition()},t.version="18.3.1"},5043:(e,t,a)=>{e.exports=a(4202)},579:(e,t,a)=>{e.exports=a(1153)},7234:(e,t)=>{function a(e,t){var a=e.length;e.push(t);e:for(;0<a;){var n=a-1>>>1,s=e[n];if(!(0<r(s,t)))break e;e[n]=t,e[a]=s,a=n}}function n(e){return 0===e.length?null:e[0]}function s(e){if(0===e.length)return null;var t=e[0],a=e.pop();if(a!==t){e[0]=a;e:for(var n=0,s=e.length,i=s>>>1;n<i;){var o=2*(n+1)-1,l=e[o],c=o+1,d=e[c];if(0>r(l,a))c<s&&0>r(d,l)?(e[n]=d,e[c]=a,n=c):(e[n]=l,e[o]=a,n=o);else{if(!(c<s&&0>r(d,a)))break e;e[n]=d,e[c]=a,n=c}}}return t}function r(e,t){var a=e.sortIndex-t.sortIndex;return 0!==a?a:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],d=[],u=1,h=null,m=3,g=!1,p=!1,f=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function E(e){for(var t=n(d);null!==t;){if(null===t.callback)s(d);else{if(!(t.startTime<=e))break;s(d),t.sortIndex=t.expirationTime,a(c,t)}t=n(d)}}function x(e){if(f=!1,E(e),!p)if(null!==n(c))p=!0,O(N);else{var t=n(d);null!==t&&L(x,t.startTime-e)}}function N(e,a){p=!1,f&&(f=!1,y(S),S=-1),g=!0;var r=m;try{for(E(a),h=n(c);null!==h&&(!(h.expirationTime>a)||e&&!w());){var i=h.callback;if("function"===typeof i){h.callback=null,m=h.priorityLevel;var o=i(h.expirationTime<=a);a=t.unstable_now(),"function"===typeof o?h.callback=o:h===n(c)&&s(c),E(a)}else s(c);h=n(c)}if(null!==h)var l=!0;else{var u=n(d);null!==u&&L(x,u.startTime-a),l=!1}return l}finally{h=null,m=r,g=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var T,C=!1,A=null,S=-1,M=5,j=-1;function w(){return!(t.unstable_now()-j<M)}function R(){if(null!==A){var e=t.unstable_now();j=e;var a=!0;try{a=A(!0,e)}finally{a?T():(C=!1,A=null)}}else C=!1}if("function"===typeof b)T=function(){b(R)};else if("undefined"!==typeof MessageChannel){var k=new MessageChannel,I=k.port2;k.port1.onmessage=R,T=function(){I.postMessage(null)}}else T=function(){v(R,0)};function O(e){A=e,C||(C=!0,T())}function L(e,a){S=v((function(){e(t.unstable_now())}),a)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){p||g||(p=!0,O(N))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return m},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(e){switch(m){case 1:case 2:case 3:var t=3;break;default:t=m}var a=m;m=t;try{return e()}finally{m=a}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var a=m;m=e;try{return t()}finally{m=a}},t.unstable_scheduleCallback=function(e,s,r){var i=t.unstable_now();switch("object"===typeof r&&null!==r?r="number"===typeof(r=r.delay)&&0<r?i+r:i:r=i,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:u++,callback:s,priorityLevel:e,startTime:r,expirationTime:o=r+o,sortIndex:-1},r>i?(e.sortIndex=r,a(d,e),null===n(c)&&e===n(d)&&(f?(y(S),S=-1):f=!0,L(x,r-i))):(e.sortIndex=o,a(c,e),p||g||(p=!0,O(N))),e},t.unstable_shouldYield=w,t.unstable_wrapCallback=function(e){var t=m;return function(){var a=m;m=t;try{return e.apply(this,arguments)}finally{m=a}}}},8853:(e,t,a)=>{e.exports=a(7234)}},t={};function a(n){var s=t[n];if(void 0!==s)return s.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,a),r.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.p="/";var n=a(5043),s=a(4391),r=a(8530);const i=a.p+"static/media/player_0.4a3651c609911ede6b72.png",o=a.p+"static/media/player_1.e45ee653acbed2e81514.png",l=a.p+"static/media/player_2.5356a740be72474dde56.png",c=a.p+"static/media/player_3.e970725dca65db94df39.png",d=a.p+"static/media/player_4.98676765df467966984d.png",u=a.p+"static/media/player_5.8e9f672d492a6cd896a0.png",h=a.p+"static/media/player_6.1afa8fa2ab715ade57d5.png",m=a.p+"static/media/player_7.23786cb18222b198a480.png",g=a.p+"static/media/player_8.2b3036cbda4d0af349b0.png",p=a.p+"static/media/player_9.fd514f539cd296b8caac.png",f=a.p+"static/media/player_10.fd514f539cd296b8caac.png",v=a.p+"static/media/human_1.9d3f8a08cea097d68269.png",y=a.p+"static/media/human_2.0e1a803f8d735c4da762.png",b=a.p+"static/media/dwarf_1.c503bf6080db0c9aca15.png",E=a.p+"static/media/dwarf_2.325f93f2c9d02a323c0d.png",x=a.p+"static/media/elf_1.3c415e4adb872f30841d.png",N=a.p+"static/media/elf_2.b487365606e6211f3988.png",T=a.p+"static/media/halfOrc_1.cf7fa4b64f0730c1b02d.png",C=a.p+"static/media/halfOrc_2.70c9be869bbf78847eed.png",A=a.p+"static/media/halfElf_1.903a6f9a31de5c5fa48f.png",S=a.p+"static/media/halfElf_2.24de139aa431732d5366.png",M=a.p+"static/media/halfling_1.64e3bf1b974cc3baae68.png",j=a.p+"static/media/halfling_2.aa9af491102918fccd9d.png",w=a.p+"static/media/combat_humans.89c356e733541dcb180a.png",R=a.p+"static/media/combat_cultists.d0ab5cb2741624fd0092.png",k=a.p+"static/media/combat_dragons.a2989854bcbd0162365d.png",I=a.p+"static/media/combat_dwarves.13c40c678e72bab59ea4.png",O=a.p+"static/media/combat_elves.d6fd31d11c3108bdb449.png",L=a.p+"static/media/combat_goblins.9301d270487837bd4748.png",P=a.p+"static/media/combat_halflings.98aa638546add30dfbe1.png",D=a.p+"static/media/combat_orcs.c7be566ba65f106f6b1e.png",U=a.p+"static/media/combat_undead.4790a552af33cacad7df.png",_=a.p+"static/media/combat_half_elves.0a2d9509713fd51f9e4f.png",B=a.p+"static/media/combat_bandits.89c356e733541dcb180a.png",F=a.p+"static/media/combat_beasts.9502aa1dc2917797980d.png",H=a.p+"static/media/combat_deer.062749db0e7b6f72ddd8.png",G=a.p+"static/media/combat_bear.2f83335d479faa0bebf0.png",W=a.p+"static/media/title.4674d0f8292f8293550e.png",z=a.p+"static/media/not-implemented.6e4dd23f00eef76570e5.png",Q=a.p+"static/media/campaign.0ae804324ee4a18dce29.png",V=a.p+"static/media/gameroom.4e3df83064899f2fae6a.png",Y=a.p+"static/media/cult_of_the_deep_1.b409ccc25b3fadce874d.png",K=a.p+"static/media/trolls_1.90f3ef3168a7f77abc26.png",q=a.p+"static/media/millstone_mystery.0d0e978724bf0aa95d99.png",X=a.p+"static/media/theoldmill.b86706aaeacca8bbc241.png",Z=a.p+"static/media/mm_l_quarry.eb852bbab8e4cc3a8ca9.png",J=a.p+"static/media/mm_l_road.d480c4606222b9aea225.png",$=a.p+"static/media/mm_l_entrance.5679770273c0862c881c.png",ee=a.p+"static/media/mm_l_tunnel2.5976fb89c60f0f68d3fd.png",te=a.p+"static/media/mm_l_bridge.1c1ce30fcaf2e4507aae.png",ae=a.p+"static/media/mm_l_beach.31082008cdfcff16b189.png",ne=a.p+"static/media/mm_l_townville.4e54b180a6ee89c987d3.png",se=a.p+"static/media/cd_l_underthewell.98e28442096e4aaac62e.png",re=a.p+"static/media/cd_l_lakeside.d5b62d5defccbb95ed8c.png",ie=a.p+"static/media/cd_l_lakesidebrewery.0c7b83c1dde61fb344f1.png",oe=a.p+"static/media/cd_l_lakesidecliffs.38f0ef7278d542cc991d.png",le=a.p+"static/media/cd_l_sagewoodtavern.4775f3613dcbcab24ca8.png",ce=a.p+"static/media/cd_l_sagewoodbrewery.64e3abb3d3e74cd872b9.png",de=a.p+"static/media/millstone.c7ca463bca0eb320cbb6.png",ue=a.p+"static/media/mm_e_road.cf271ba5815a2537fb24.png",he=a.p+"static/media/mm_e_quarry.960c581913f776a57abc.png",me=a.p+"static/media/mm_e_tunnels.15628af37650c0bc9ee1.png",ge=a.p+"static/media/mm_e_bandits.0006aeb7ebe035ec77e8.png",pe=a.p+"static/media/mm_e_beach.061cc3fe7e572a537013.png",fe=a.p+"static/media/mm_e_shipwreck.afc3a7d9ae6e260cd095.png",ve=a.p+"static/media/mm_e_fire.698dc46d87465784cb37.png",ye=a.p+"static/media/mm_e_townville.1676d8a8fc3226700c83.png",be=a.p+"static/media/cd_e_breweryexploration.661326c17535663b1c7d.png",Ee=a.p+"static/media/cd_e_breweryfight.64e3abb3d3e74cd872b9.png",xe=a.p+"static/media/cd_e_bythelake.acbab6311ed84da30246.png",Ne=a.p+"static/media/cd_e_lakesidecliffs.814e190d9e33026b9850.png",Te=a.p+"static/media/cd_e_underthewell.f9feee6b1e0f48ffc561.png",Ce=a.p+"static/media/cd_e_sagewoodtavern4.15b73aec91294164e7f6.png",Ae=a.p+"static/media/cd_e_sagewoodbrewery.0c7b83c1dde61fb344f1.png",Se=a.p+"static/media/mm_l_mountain_camp.0e6a014b058a4d52ef36.png",Me=a.p+"static/media/mm_l_elven_town.d06fa2be497a4b619bb1.png",je=a.p+"static/media/mm_e_mountain_path.29406517a21f942f7933.png",we=a.p+"static/media/mm_e_pointed.a6ea5f2cb1e4d2eafc2c.png",Re=a.p+"static/media/mm_l_witch.96f8ffed5a5f387fc3a3.png",ke=a.p+"static/media/mm_e_cabin2.8c2df121554dfb223ae1.png",Ie=a.p+"static/media/mm_e_dwarves.d018647284ec26e3fb20.png",Oe=a.p+"static/media/mm_e_fairlight.2bd3e8dc56115ac0a5f8.png",Le=a.p+"static/media/mm_l_fairlight.efa637cfd018bf65ffd1.png",Pe=a.p+"static/media/icon_treasure.8110614d84385bf6c296.png",De=a.p+"static/media/imp.7010d4c2da611a1b1ef2.png",Ue=a.p+"static/media/dm.6eddb4c9c933accb4321.png",_e=a.p+"static/media/die.77171ca96e847f33fa8c.png",Be=a.p+"static/media/imp.c1264900e624e8b84161.png",Fe=a.p+"static/media/event_roleplay.f96d28d31976009a6d50.png",He=a.p+"static/media/event_puzzle.599aeecb673368f8dc6f.png",Ge=a.p+"static/media/event_dungeon.c10a14181d46af20cb49.png",We=a.p+"static/media/event_town.da8414c457dc0f3f3e38.png",ze=a.p+"static/media/event_challenge.b4711d0b921afc3ad481.png",Qe=a.p+"static/media/event_trap.708f8a4b30441fdb40a7.png",Ve=a.p+"static/media/event_exposition.52e794b142c4be513074.png",Ye=a.p+"static/media/d20.23c491a94724e311cb9d.png",Ke=a.p+"static/media/rose.3cabbdd6d96badf13de4.png",qe=a.p+"static/media/face.621ee4a8e1d035bafa1a.png";var Xe=a(579);const Ze={player_0:i,player_1:o,player_2:l,player_3:c,player_4:d,player_5:u,player_6:h,player_7:m,player_8:g,player_9:p,player_10:f,human_1:v,human_2:y,dwarf_1:b,dwarf_2:E,elf_1:x,elf_2:N,halfOrc_1:T,halfOrc_2:C,halfElf_1:A,halfElf_2:S,halfling_1:M,halfling_2:j,main_menu:W,default_bg:z,campaign_bg:Q,gameroom_bg:V,cult_of_the_deep_1:Y,trolls_1:K,millstone_mystery_1:q,mountain_mystery:q,mm_l_oldMill:X,mm_l_quarry:Z,mm_l_road:J,mm_l_entrance:$,mm_l_tunnel:ee,mm_l_bridge:te,mm_l_beach:ae,mm_l_townville:ne,mm_e_millstone:de,mm_e_road:ue,mm_e_quarry:he,mm_e_tunnels:me,mm_e_bandits:ge,mm_e_beach:pe,mm_e_shipwreck:fe,mm_e_fire:ve,mm_e_townville:ye,cd_l_underthewell:se,cd_l_lakeside:re,cd_l_lakesidebrewery:ie,cd_l_lakesidecliffs:oe,cd_l_sagewoodtavern:le,cd_l_sagewoodbrewery:ce,cd_e_breweryexploration:be,cd_e_breweryfight:Ee,cd_e_bythelake:xe,cd_e_lakesidecliffs:Ne,cd_e_underthewell:Te,cd_e_sagewoodtavern:Ce,cd_e_sagewoodbrewery:Ae,mm_l_mountain_camp:Se,mm_l_elven_town:Me,mm_e_up_the_mountain:je,mm_e_pointed:we,mm_l_witch:Re,mm_e_cabin:ke,mm_l_tunnel23:ee,mm_e_dwarves:Ie,mm_e_fairlight:Oe,mm_l_fairlight:Le,tutorial_mascot:Be,chat_imp:De,chat_dm:Ue,chat_die:_e,number_die_4:_e,number_die_6:_e,number_die_8:_e,number_die_10:_e,number_die_12:_e,number_die_20:_e,number_die_100:_e,combat_human:w,combat_cultists:R,combat_dragons:k,combat_dwarves:I,combat_elves:O,combat_goblins:L,combat_halflings:P,combat_humans:w,combat_orcs:D,combat_undead:U,combat_half_elves:_,combat_bandits:B,combat_beasts:F,combat_deer:H,combat_bear:G,icon_treasure1:Pe,icon_dmpoint:"data:image/png;base64,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",icon_playerpoint:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAABg2lDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw1AUhU9TpSIVBwuKiGSoTnZREcdahSJUCLVCqw4mL/2DJg1Jiouj4Fpw8Gex6uDirKuDqyAI/oC4C06KLlLifUmhRYwXHu/jvHcO990HCI0K06yuOKDptplOJsRsblUMvSKIQfAalZllzElSCr71dY8A3+9iPMv/3p/Vp+YtBgRE4jgzTJt4g3hm0zY47xNHWElWic+JJ0xqkPiR64rHb5yLLgs8M2Jm0vPEEWKx2MFKB7OSqRFPE0dVTad8IeuxynmLs1apsVaf/IXhvL6yzHVaI0hiEUuQIEJBDWVUYCNGu06KhTSdJ3z8w65fIpdCrjIYORZQhQbZ9YP/we/ZWoWpSS8pnAC6XxznYwwI7QLNuuN8HztO8wQIPgNXettfbQCzn6TX21r0COjfBi6u25qyB1zuAENPhmzKrhSkJRQKwPsZfVMOGLgFete8ubXOcfoAZGhWqRvg4BAYL1L2us+7ezrn9u+d1vx+ACwscormaRQ4AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH6QMXARkDdDpniQAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAALjSURBVHja7Z09UiNBDEal3tlTkHMPas+Ag429CUcg5wok6wts+Q4U5yA3l4CtIXIVRQHln1br656n0IEt6c2nltpT3WYYhmHdmKs7eL3ZzRHfu11fOEASEt8bKAeCFhwHghYcB4QWGAeEFhgHhBYYB4QWGO8dxFeJUPOnKZAWwdd6AtV9deUAozsaRd9dLZisSVklHldxXmVvKTs2z3ZYdZMvK07PclIVRHbM3tqxXkBkxe+tnOkVROtcODC0oDgwtKBMvQ512baPr3Y35hFPwOgwInPlwNCCUihTWrF7LdJLhlEzfw4MLShFRaqUrw8l6xSqwKivlGkUuY+icFdTR+ZLEhExHRtPGeGpqpm87P97imFSKi3H/vhSFvKsP+MKMLSgULLEyldBHVpdHAoRU8k0gjr2/s02+6M9/rjfXL4o+/od4GmkJ9nNZzN7tbVJvYDNHNLxOlhGCKI3KN/5wKJOycJOBsLs0b5soRBKFgaQjmaRaSkgfv/d3b643an7OY22oM82l9Xm+f/Hz8/ZS4nKxWfbKEMo5H1QK3tmDVliewqQjKd1tgcZhSz1zJL39u/Pxa/WHR8KEWtqACLWYU6kX6vVB4iZ3ayffl7Z1av8pH692c0j7/juY9smz07DKWSkh4ZFvTcgzCPtyhUKoWRhVYBQttqUKxTSc8lCJfHqQCG9L+qoJFYdZmbl2CkXKHEwKFmjzCGoJC5Xxey0zTmgxOSIkiVmZ5+XxRvy9dRR5bwsSlfdnHDEnwiMT4/4A0oujOqL+pLLV63YOUg5GcZBBykDJQeGWeBbJ3tHOYy/Usmq+cNcV3F4TrjQRQjGwUBqSpQrjypceRRRN7kUrAKQiMWMa/POBBLVYXCx5BlAIts+rl4VDaQFnKEuJ24VWG04w1/f3TLQY4Jf9AX3ConItrA7qACTu86FdzSjgolqOJq1mKOAie78mvf8vYJpNR+lTsfqcDKGVJl9JBU42Vs4b3dv8ih1MV7NAAAAAElFTkSuQmCC",event_combat:"data:image/png;base64,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",event_roleplay:Fe,event_puzzle:He,event_dungeon:Ge,event_perception:"data:image/png;base64,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",event_town:We,event_travel:"data:image/png;base64,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",event_challenge:ze,event_trap:Qe,event_exposition:Ve,event_exploration:"data:image/png;base64,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",die_d4:"data:image/png;base64,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",die_d6:"data:image/png;base64,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",die_d20:Ye,rickyrose:Ke,theface:qe},Je=e=>{let{imageId:t}=e;if("none"===t)return null;const a=Ze[t||""];return a?(0,Xe.jsx)("img",{src:a,alt:"Icon",className:"cimage"}):(console.error(`No image found for imageId: ${t}`),null)};let $e=function(e){return e.HUMAN="human",e.ELF="elf",e.DWARF="dwarf",e.HALFLING="halfling",e.HALF_ORC="half-orc",e.HALF_ELF="HALF_ELF",e.NPC="npc",e}({}),et=function(e){return e.CLERIC="cleric",e.DRUID="druid",e.FIGHTER="fighter",e.PALADIN="paladin",e.ROGUE="rogue",e.WIZARD="wizard",e.NPC="npc",e}({});const tt=65,at=30;let nt=function(e){return e.COMBAT="combat",e.ROLEPLAY="roleplay",e.PUZZLE="puzzle",e.PERCEPTION="perception",e.TOWN="town",e.TRAVEL="travel",e.CHALLENGE="challenge",e.TRAP="trap",e.CHARACTER_BACKSTORY="character backstory",e.STORY="story",e.EXPLORATION="exploration",e.EXPOSITION="exposition",e.FINALE="finale",e.DUNGEON="dungeon",e}({}),st=function(e){return e.REFRESH="refresh",e.CHARACTER="character",e.MAX_HAPPINESS="max_happiness",e.MAX_ATTENTION="max_attention",e.STRESS_BUFFER="stress_buffer",e.PLAYER_TRAIT="player_trait",e}({});const rt=[6,6,10,10,10,20],it=[{abbreviation:"M",fullName:"Monday"},{abbreviation:"T",fullName:"Tuesday"},{abbreviation:"W",fullName:"Wednesday"},{abbreviation:"R",fullName:"Thursday"},{abbreviation:"F",fullName:"Friday"},{abbreviation:"St",fullName:"Saturday"},{abbreviation:"Sn",fullName:"Sunday"}],ot=[{name:"Yes",percentage:tt+1},{name:"Maybe",percentage:tt-1},{name:"No",percentage:at-1}],lt=e=>`rgba(${Math.min(255,Math.floor(2.55*(100-e)))}, ${Math.min(255,Math.floor(2.55*e))}, 0, 0)`,ct=e=>e<=at?"X":e>tt?"\u2714":"",dt=e=>{let{dayData:t,legend:a=!1}=e;return(0,Xe.jsxs)("div",{className:"week-display-days",children:[!a&&it.map(((e,a)=>{const n=((e,t)=>e[t])(t,a),s=lt(n);return(0,Xe.jsxs)("div",{className:"day-square",style:{backgroundColor:s},children:[(0,Xe.jsx)("div",{className:"day-abbreviation",children:e.abbreviation}),(0,Xe.jsx)("div",{className:"day-symbol",children:ct(n)}),(0,Xe.jsxs)("div",{className:"day-percentage",children:[n,"%"]})]},a)})),a&&ot.map(((e,t)=>{const a=e.percentage,n=lt(a);return(0,Xe.jsxs)("div",{className:"day-square",style:{backgroundColor:n},children:[(0,Xe.jsx)("div",{className:"day-abbreviation",children:e.name}),(0,Xe.jsx)("div",{className:"day-symbol",children:ct(a)})]},t)}))]})},ut=e=>{let{callback:t,classname:a=""}=e;return(0,Xe.jsx)("div",{className:`more-info ${a}`,onClick:t,children:(0,Xe.jsx)("div",{className:"more-info-text",children:"?"})})},ht=(0,n.createContext)(void 0),mt=(0,n.createContext)(void 0),gt=(0,n.createContext)(void 0),pt=(0,n.createContext)(void 0),ft=(0,n.createContext)(void 0),vt=(0,n.createContext)(void 0),yt=(0,n.createContext)(void 0),bt=(0,n.createContext)(void 0),Et=e=>{let{manager:t,children:a}=e;return(0,Xe.jsx)(yt.Provider,{value:t,children:a})},xt=e=>{let{manager:t,children:a}=e;return(0,Xe.jsx)(bt.Provider,{value:t,children:a})},Nt=e=>{let{manager:t,children:a}=e;return(0,Xe.jsx)(ht.Provider,{value:t,children:a})},Tt=e=>{let{manager:t,children:a}=e;return(0,Xe.jsx)(mt.Provider,{value:t,children:a})},Ct=e=>{let{manager:t,children:a}=e;return(0,Xe.jsx)(gt.Provider,{value:t,children:a})},At=e=>{let{manager:t,children:a}=e;return(0,Xe.jsx)(pt.Provider,{value:t,children:a})},St=e=>{let{manager:t,children:a}=e;return(0,Xe.jsx)(ft.Provider,{value:t,children:a})},Mt=e=>{let{manager:t,children:a}=e;return(0,Xe.jsx)(vt.Provider,{value:t,children:a})},jt=()=>{const e=(0,n.useContext)(yt);if(void 0===e)throw new Error("useCharacterManager must be used within a CharacterManagerProvider");return e},wt=()=>{const e=(0,n.useContext)(bt);if(void 0===e)throw new Error("usePlayerManager must be used within a PlayerManagerProvider");return e},Rt=()=>{const e=(0,n.useContext)(ht);if(void 0===e)throw new Error("useAppManager must be used within a AppManagerProvider");return e},kt=()=>{const e=(0,n.useContext)(gt);if(void 0===e)throw new Error("useCampaignManager must be used within a CampaignManagerProvider");return e},It=()=>{const e=(0,n.useContext)(ft);if(void 0===e)throw new Error("usePartyManager must be used within a PartyManagerProvider");return e},Ot=()=>{const e=(0,n.useContext)(vt);if(void 0===e)throw new Error("useUiManager must be used within a UiManagerProvider");return e};let Lt=function(e){return e.MAIN_MENU="main-menu",e.CAMPAIGN_SETUP="campaign-setup",e.PLAYER_RECRUITMENT="player-recruitment",e.CHARACTER_CREATION="character-creation",e.SESSION_OVERVIEW="session-setup",e.SESSION="session",e.SCORE="score",e}({});const Pt={nextState:Lt.MAIN_MENU,ui:{showCharacterBar:!1},background_image_id:"default_bg",bg_transition_mode:"none",secondary_bg_image_id:"none",secondary_image_pos:"none"},Dt={[Lt.MAIN_MENU]:{nextState:Lt.CAMPAIGN_SETUP,ui:{showCharacterBar:!1},background_image_id:"main_menu"},[Lt.CAMPAIGN_SETUP]:{nextState:Lt.PLAYER_RECRUITMENT,ui:{showCharacterBar:!1},background_image_id:"main_menu",bg_transition_mode:"slide-down",secondary_bg_image_id:"campaign_bg",secondary_image_pos:"bottom"},[Lt.PLAYER_RECRUITMENT]:{nextState:Lt.CHARACTER_CREATION,ui:{showCharacterBar:!1},background_image_id:"main_menu",bg_transition_mode:"slide-right"},[Lt.CHARACTER_CREATION]:{nextState:Lt.SESSION_OVERVIEW,ui:{showCharacterBar:!1},background_image_id:"main_menu",bg_transition_mode:"slide-left"},[Lt.SESSION_OVERVIEW]:{nextState:Lt.SESSION,ui:{showCharacterBar:!1},background_image_id:"none",bg_transition_mode:"none",secondary_bg_image_id:"none"},[Lt.SESSION]:{nextState:Lt.SCORE,ui:{showCharacterBar:!1},background_image_id:"none",secondary_bg_image_id:"none"},[Lt.SCORE]:{nextState:Lt.MAIN_MENU,ui:{showCharacterBar:!1}}},Ut={VERY_UNREADY:20,UNREADY:50,READY_START:50,READY_END:64,PERFECT_START:65,PERFECT_END:74,READY_SECOND_START:75,READY_SECOND_END:90,OVERREADY:91};let _t=function(e){return e.VERY_UNREADY="very-unready",e.UNREADY="unready",e.READY="ready",e.PERFECT="perfect",e.OVERREADY="overready",e}({});function Bt(e){return e<Ut.VERY_UNREADY?_t.VERY_UNREADY:e<Ut.UNREADY?_t.UNREADY:e<Ut.PERFECT_START?_t.READY:e<Ut.READY_SECOND_START?_t.PERFECT:e<=Ut.READY_SECOND_END?_t.READY:_t.OVERREADY}function Ft(e){switch(Bt(e)){case _t.VERY_UNREADY:case _t.UNREADY:return"\u2717";case _t.READY:return"\u2713";case _t.PERFECT:case _t.OVERREADY:return"!";default:return"?"}}const Ht={SWORD_1:{name:"Plus 1 Sword",attributes:{[r.Eh.COMBAT]:1}},MIRROR_SHIELD:{name:"Mirror Shield",attributes:{[r.Eh.COMBAT]:2,[r.Eh.TOOLS]:2}},WAND_5:{name:"Spellring",attributes:{[r.Eh.MAGIC]:2}},HELPFUL_IMP:{name:"Helpful Imp",attributes:{[r.Eh.COMBAT]:1,[r.Eh.TOOLS]:1,[r.Eh.MAGIC]:1}},STONECUTTER:{name:"Stonecutter",attributes:{[r.Eh.TOOLS]:5}},CLOAK_OF_LEVITATION:{name:"Cloak of Levitation",attributes:{[r.Eh.MAGIC]:1,[r.Eh.TOOLS]:1}},WAND_OF_MISSILES:{name:"Wand of Missiles",attributes:{[r.Eh.MAGIC]:2,[r.Eh.COMBAT]:1}},GLOVES_OF_THE_SPIDER:{name:"Gloves of the Spider",attributes:{[r.Eh.TOOLS]:3}}};function Gt(e){switch(e.race){case $e.DWARF:return{[r.Eh.COMBAT]:2,[r.Eh.MAGIC]:0,[r.Eh.TOOLS]:1};case $e.ELF:return{[r.Eh.COMBAT]:1,[r.Eh.MAGIC]:3,[r.Eh.TOOLS]:0};case $e.HUMAN:return{[r.Eh.COMBAT]:1,[r.Eh.MAGIC]:1,[r.Eh.TOOLS]:1};case $e.HALFLING:return{[r.Eh.COMBAT]:1,[r.Eh.MAGIC]:0,[r.Eh.TOOLS]:3};case $e.HALF_ORC:return{[r.Eh.COMBAT]:3,[r.Eh.MAGIC]:0,[r.Eh.TOOLS]:0};case $e.HALF_ELF:return{[r.Eh.COMBAT]:1,[r.Eh.MAGIC]:2,[r.Eh.TOOLS]:0};case $e.NPC:return{[r.Eh.COMBAT]:0,[r.Eh.MAGIC]:0,[r.Eh.TOOLS]:0}}}function Wt(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return{[r.Eh.COMBAT]:0,[r.Eh.MAGIC]:0,[r.Eh.TOOLS]:0};const a=Gt(e),n=function(e){const t={[r.Eh.COMBAT]:0,[r.Eh.MAGIC]:0,[r.Eh.TOOLS]:0};return e.gear.forEach((e=>{var a,n,s;t[r.Eh.COMBAT]+=null!==(a=e.attributes[r.Eh.COMBAT])&&void 0!==a?a:0,t[r.Eh.MAGIC]+=null!==(n=e.attributes[r.Eh.MAGIC])&&void 0!==n?n:0,t[r.Eh.TOOLS]+=null!==(s=e.attributes[r.Eh.TOOLS])&&void 0!==s?s:0})),t}(e),s=function(e){const t={[r.Eh.COMBAT]:0,[r.Eh.MAGIC]:0,[r.Eh.TOOLS]:0};for(let a=0;a<e.level;a++){let n=a+1;t[r.Eh.COMBAT]+=zt(e.character_class,n)[r.Eh.COMBAT],t[r.Eh.MAGIC]+=zt(e.character_class,n)[r.Eh.MAGIC],t[r.Eh.TOOLS]+=zt(e.character_class,n)[r.Eh.TOOLS]}return t}(e),i={[r.Eh.COMBAT]:0+a[r.Eh.COMBAT]+s[r.Eh.COMBAT]+n[r.Eh.COMBAT],[r.Eh.MAGIC]:0+a[r.Eh.MAGIC]+s[r.Eh.MAGIC]+n[r.Eh.MAGIC],[r.Eh.TOOLS]:0+a[r.Eh.TOOLS]+s[r.Eh.TOOLS]+n[r.Eh.TOOLS]};var o,l,c;t&&(e.attributeLoss&&(i[r.Eh.COMBAT]-=null!==(o=e.attributeLoss[r.Eh.COMBAT])&&void 0!==o?o:0,i[r.Eh.MAGIC]-=null!==(l=e.attributeLoss[r.Eh.MAGIC])&&void 0!==l?l:0,i[r.Eh.TOOLS]-=null!==(c=e.attributeLoss[r.Eh.TOOLS])&&void 0!==c?c:0));return i}function zt(e,t){const a=t%2,n=(t+1)%2;switch(e){case et.CLERIC:return{[r.Eh.COMBAT]:1+a,[r.Eh.MAGIC]:2,[r.Eh.TOOLS]:n};case et.DRUID:return{[r.Eh.COMBAT]:1+n,[r.Eh.MAGIC]:1+a,[r.Eh.TOOLS]:1+a};case et.FIGHTER:return{[r.Eh.COMBAT]:3,[r.Eh.MAGIC]:0,[r.Eh.TOOLS]:1};case et.PALADIN:return{[r.Eh.COMBAT]:2+n,[r.Eh.MAGIC]:1,[r.Eh.TOOLS]:a};case et.ROGUE:return{[r.Eh.COMBAT]:1,[r.Eh.MAGIC]:0,[r.Eh.TOOLS]:3+a};case et.WIZARD:return{[r.Eh.COMBAT]:n,[r.Eh.MAGIC]:3,[r.Eh.TOOLS]:1}}return{[r.Eh.COMBAT]:0,[r.Eh.MAGIC]:0,[r.Eh.TOOLS]:0}}const Qt=e=>"character"in e||"npcTag"in e,Vt=e=>{let{attributes:t,lostAttributes:a,collapsed:n=!1,showAttributeLoss:s=!1}=e;const r=jt(),i=(e,t)=>{const a=[],n=r.getUFAttributeSymbol(e);for(let s=0;s<t;s++)a.push((0,Xe.jsx)("span",{className:`attribute-icon ${e}`,children:n},`${e}-${s}`));return a};if(n){const e=Object.keys(t).flatMap((e=>i(e,t[e]||0)));return(0,Xe.jsx)("div",{className:"collapsed-attributes",children:e})}return(0,Xe.jsx)("div",{className:"attribute-display-container",children:Object.keys(t).map((e=>(0,Xe.jsxs)("div",{className:"attribute-display",children:[(0,Xe.jsxs)("div",{className:"attribute-title",children:[(0,Xe.jsx)("b",{children:r.getUFAttributeName(e)}),":"]}),a&&s?(0,Xe.jsxs)("div",{className:"attribute-container",children:[(0,Xe.jsx)("div",{className:"attributes-retained",children:i(e,t[e]||0)}),(0,Xe.jsx)("div",{className:"attributes-lost",children:i(e,a[e]||0)})]}):(0,Xe.jsx)("div",{className:"attribute-container",children:i(e,t[e]||0)})]},e)))})},Yt=e=>{let{hero:t,category:a,collapsed:n,showAttributeLoss:s,overviewDisplay:i=!1}=e;const o=jt(),l=Rt().getCombatManager();let c,d={[r.Eh.COMBAT]:0,[r.Eh.MAGIC]:0,[r.Eh.TOOLS]:0};Qt(t)&&t.npcTag&&(d=l.getNPCAttributes(t.npcTag),t.character=o.generateNPC(t.npcTag),a=r.lq.NPC),c=Qt(t)?t.character:t;const u=Gt(c),h=Wt(c,!0),m=c.attributeLoss||{[r.Eh.COMBAT]:0,[r.Eh.MAGIC]:0,[r.Eh.TOOLS]:0},g=Wt(c),p=(e,t)=>{const a=[],n=o.getUFAttributeSymbol(e);for(let s=0;s<t;s++)a.push((0,Xe.jsx)("span",{className:`attribute-icon ${e}`,children:n},`${e}-${s}`));return a},f=(e,t)=>{if(n){const t=Object.keys(e).flatMap((t=>p(t,e[t]||0)));return(0,Xe.jsx)("div",{className:"collapsed-attributes",children:t})}return Object.keys(e).map((a=>(0,Xe.jsxs)("div",{className:"attribute-display",children:[(0,Xe.jsxs)("div",{className:"attribute-title",children:[(0,Xe.jsx)("b",{children:o.getUFAttributeName(a)}),":"]}),t&&s?(0,Xe.jsxs)("div",{className:"attribute-container",children:[(0,Xe.jsx)("div",{className:"attributes-retained",children:p(a,e[a]||0)}),(0,Xe.jsx)("div",{className:"attributes-lost",children:p(a,t[a]||0)})]}):(0,Xe.jsx)("div",{className:"attribute-container",children:p(a,e[a]||0)})]},a)))},v=()=>0===c.gear.length?(0,Xe.jsx)("div",{}):c.gear.map((e=>(0,Xe.jsxs)("div",{className:"gear-attributes",children:[(0,Xe.jsx)("div",{className:"gear-title",children:(0,Xe.jsxs)("b",{children:[e.name,": "]})}),f(e.attributes)]},e.name)));return(0,Xe.jsxs)("div",{className:"attribute-display-container",children:[(()=>{switch(a){case r.lq.CHARACTER_CLASS:return Array.from({length:c.level},((e,t)=>t+1)).map((e=>{const t=zt(c.character_class,e);return(0,Xe.jsxs)("div",{className:"level-attributes",children:[(0,Xe.jsxs)("div",{className:"level-title",children:[(0,Xe.jsxs)("b",{children:["Level ",e,":"]})," "]}),f(t)]},e)}));case r.lq.GEAR:return v();case r.lq.RACE:return f(u);case r.lq.ALL:return s?f(h,m):f(g);case r.lq.NPC:return f(d);default:return null}})(),i&&v(),i&&(()=>{const e=c.backstory,t=c.backstory.filter((e=>e.completed)).length,a=4-e.length;return(0,Xe.jsxs)("div",{className:"backstory-element",children:[(0,Xe.jsxs)("div",{className:"backstory-title",children:[(0,Xe.jsx)("b",{children:"Backstory : "}),t," / 4"]}),(0,Xe.jsxs)("div",{className:"backstory-tags",children:[e.map(((e,t)=>(0,Xe.jsx)("div",{className:"tag-pill backstory-item "+(e.completed?"type-backstory":"expected"),children:e.tag.name},`backstory-${t}`))),[...Array(a)].map(((e,t)=>(0,Xe.jsx)("div",{className:"tag-pill backstory-item expected",children:"?"},`placeholder-${t}`)))]})]})})()]})},Kt=e=>{let{character:t,isSelected:a,onSelect:n,showAbilities:s,collapsed:i,isAssigned:o,isAssignedToOther:l}=e;const c=Ot(),d=jt(),u=()=>{c.showBasicNotebook(r.d8.CHARACTER,t)},h=Rt().state!==Lt.CHARACTER_CREATION;return i?(0,Xe.jsxs)("div",{className:"character-card collapsed",onClick:n,children:[(0,Xe.jsxs)("div",{className:"character-icon",children:[(0,Xe.jsx)(Je,{imageId:t.icon}),(0,Xe.jsx)("div",{className:"character-initials",children:d.getUFInitials(t)})]}),(0,Xe.jsx)("div",{className:"character-collapsed-overlay",children:h?(0,Xe.jsx)(ut,{callback:u}):(0,Xe.jsx)("div",{className:"character-collapsed-unassign",children:"X"})})]}):(0,Xe.jsxs)("div",{className:`character-card ${a?"selected":""} ${l?"assigned-to-other":""}`,onClick:n,children:[(0,Xe.jsxs)("div",{className:`character-card-container ${o?"assigned":""} `,children:[(0,Xe.jsxs)("div",{className:"character-card-header",children:[(0,Xe.jsxs)("div",{className:"character-info",children:[(0,Xe.jsx)("div",{className:"character-name",children:t.name}),(0,Xe.jsx)("div",{className:"character-details",children:(0,Xe.jsxs)("div",{className:"character-race",children:[d.getUFRace(t.race)," ",d.getUFClass(t.character_class)]})}),(0,Xe.jsx)(Yt,{hero:t,category:r.lq.ALL,collapsed:!1})]}),(0,Xe.jsxs)("div",{className:"character-icon",children:[(0,Xe.jsx)(Je,{imageId:t.icon}),(0,Xe.jsxs)("div",{className:"character-level",children:["Level ",t.level]})]})]}),s&&(0,Xe.jsx)("div",{className:"character-card-body",children:(0,Xe.jsx)("div",{className:"abilities-list",children:(0,Xe.jsx)("ul",{children:t.abilities.map(((e,t)=>(0,Xe.jsx)("li",{children:(0,Xe.jsx)("strong",{children:e})},t)))})})})]}),(0,Xe.jsx)(ut,{callback:u}),o&&(0,Xe.jsx)("div",{className:"character-assigned",children:"Assigned"})]})},qt=e=>{let{totalSegments:t,filledSegments:a,theme:s="",label:r,buttonWhenFilled:i=!1,onClickFilled:o,filledLabel:l,labelStyle:c="normal"}=e;const d=(0,n.useRef)(a),[u,h]=(0,n.useState)([]);(0,n.useEffect)((()=>{const e=d.current;if(a>e){const t=[];for(let s=e;s<a;s++)t.push(s);h(t);const n=setTimeout((()=>{h([])}),500);return d.current=a,()=>clearTimeout(n)}d.current=a}),[a]);const m=Array.from({length:t},((e,t)=>{const n=t<a,r=u.includes(t);return(0,Xe.jsx)("div",{className:`fill-bar-segment bg-theme-${s} ${n?"filled":""} ${r?"fill-glow-animation":""}`},t)})),g=a>=t,p="theme-"+s;return"over"!==c?(0,Xe.jsxs)("div",{className:"fill-bar",children:[r&&(0,Xe.jsx)("div",{className:`fill-bar-label text-theme-${s||""}`,children:r}),(0,Xe.jsx)("div",{className:`fill-bar-container ${g?"filled":""} ${p}`,children:g&&i?(0,Xe.jsx)("div",{className:`fill-bar-filled-button ${p}`,onClick:o,children:l}):m})]}):(0,Xe.jsx)("div",{className:"fill-bar",children:(0,Xe.jsxs)("div",{className:`fill-bar-container ${g?p:""}`,children:[r&&"over"===c&&(0,Xe.jsx)("div",{className:`fill-bar-label-over text-theme-${s||""}`,children:r}),g&&i?(0,Xe.jsx)("div",{className:`fill-bar-filled-button ${p}`,onClick:o,children:l}):m]})})},Xt=["#CC0000","#CC6600","#CCCC00","#66CC00","#00CC00"],Zt=["#990000","#994C00","#999900","#4C9900","#009900"],Jt=["#FFCCCC","#FFDDCC","#FFFFCC","#DDFFCC","#CCFFCC"],$t=["#660000","#663300","#666600","#336600","#006600"],ea=e=>{let{player:t,parentUpdate:a,isSelected:s,onSelect:i,showCharacters:o,showSchedule:l,showPreferences:c,overlayStyle:d,showStats:u}=e;const h=Ot(),m=Rt(),[g,p]=(0,n.useState)(!1),[f,v]=(0,n.useState)(!1),[y,b]=(0,n.useState)(!1),[E,x]=(0,n.useState)(!1),[N,T]=(0,n.useState)(t.playerStats.enjoyment),[C,A]=(0,n.useState)(!1),S=t.preferences.reduce(((e,t)=>t[1]>e[1]?t:e),t.preferences[0]),M=t.preferences.reduce(((e,t)=>t[1]<e[1]?t:e),t.preferences[0]),j=t.preferences.filter((e=>e[1]>0)),w=t.preferences.filter((e=>e[1]<0)),R="assign"===d?"Assign":"Remove",k="none"===d?"":(0,Xe.jsx)("div",{className:`overlay ${d}`,children:(0,Xe.jsx)("div",{className:"overlay-text",children:R})}),I=(jt(),wt()),O=e=>{I.toggleSinglePlayerForCharacter(t,e),p(!g),a&&a()};(0,n.useEffect)((()=>{N!==t.playerStats.enjoyment&&(A(!0),setTimeout((()=>A(!1)),500),T(t.playerStats.enjoyment))}),[t.playerStats.enjoyment]);return(0,Xe.jsxs)("div",{className:"player-card "+(s?"selected":""),onClick:i,style:{backgroundColor:Jt[t.playerStats.enjoyment]||"",borderColor:$t[t.playerStats.enjoyment]||""},children:[(0,Xe.jsx)(ut,{callback:()=>{h.showBasicNotebook(r.d8.PLAYER,t)}}),(0,Xe.jsxs)("div",{className:"player-card-header",children:[(0,Xe.jsx)("div",{className:"player-icon",children:(0,Xe.jsx)(Je,{imageId:t.icon})}),(0,Xe.jsxs)("div",{className:"player-upper-info",children:[(0,Xe.jsx)("div",{className:"player-name",children:t.name}),l&&(0,Xe.jsx)("div",{className:"player-schedule-container",children:(0,Xe.jsx)(dt,{dayData:t.schedule})})]})]}),c&&(0,Xe.jsxs)("div",{className:"player-preferences-section",children:[t.traits.length>0&&(0,Xe.jsxs)("div",{className:"preferences-column",children:[(0,Xe.jsx)("div",{className:"preferences-title",children:"Traits"}),(0,Xe.jsx)("div",{className:"preferences-traits ",onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),children:t.traits.map(((e,t)=>(0,Xe.jsx)("div",{className:"trait-item text-pill trait",children:e.name},t)))}),E&&(0,Xe.jsx)("div",{className:"tooltip traits",children:(0,Xe.jsx)("div",{className:"tooltip-content-single",children:t.traits.map(((e,t)=>(0,Xe.jsxs)("div",{className:"tooltip-trait-item",children:[(0,Xe.jsx)("b",{children:e.name}),": ",e.description]},t)))})})]}),(0,Xe.jsxs)("div",{className:"preferences-column",children:[(0,Xe.jsx)("div",{className:"preferences-title",children:"Likes"}),(0,Xe.jsx)("div",{className:"preferences-main",children:S[0].name}),(0,Xe.jsx)("div",{className:"preferences-dots",onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1),children:j.map(((e,t)=>(0,Xe.jsx)("div",{className:"preference-dot like",title:e[0].name},t)))}),f&&(0,Xe.jsx)("div",{className:"tooltip like",children:(0,Xe.jsx)("div",{className:"tooltip-content",children:t.preferences.filter((e=>e[1]>0)).map(((e,t)=>(0,Xe.jsx)("div",{className:"tooltip-pill",children:e[0].name},t)))})})]}),(0,Xe.jsxs)("div",{className:"preferences-column",children:[(0,Xe.jsx)("div",{className:"preferences-title",children:"Hates"}),(0,Xe.jsx)("div",{className:"preferences-main",children:M[0].name}),(0,Xe.jsx)("div",{className:"preferences-dots",onMouseEnter:()=>b(!0),onMouseLeave:()=>b(!1),children:w.map(((e,t)=>(0,Xe.jsx)("div",{className:"preference-dot hate",title:e[0].name},t)))}),y&&(0,Xe.jsx)("div",{className:"tooltip hate",children:(0,Xe.jsx)("div",{className:"tooltip-content",children:t.preferences.filter((e=>e[1]<0)).map(((e,t)=>(0,Xe.jsx)("div",{className:"tooltip-pill",children:e[0].name},t)))})})]})]}),u?(0,Xe.jsxs)("div",{className:"player-stats",children:[(0,Xe.jsxs)("div",{className:"stat-item enjoyment",children:[(0,Xe.jsx)("div",{className:"stat-item-emoji",children:"\ud83d\ude1e"}),Array.from({length:5}).map(((e,a)=>{const n=a<=t.playerStats.enjoyment;return(0,Xe.jsx)("span",{className:`delight-circle ${n?"filled":""} ${C?"flash":""}`,style:n?{backgroundColor:Xt[t.playerStats.enjoyment]||"",borderColor:Zt[t.playerStats.enjoyment]||"",boxShadow:`0 0 10px ${Xt[t.playerStats.enjoyment]||""}`}:{}},a)})),(0,Xe.jsx)("div",{className:"stat-item-emoji",children:"\ud83d\ude0a"})]}),(0,Xe.jsx)("div",{className:"stat-item engagement",children:(0,Xe.jsx)(qt,{totalSegments:5,filledSegments:t.playerStats.involvement,theme:"engagement",label:"ATTENTION"})})]}):null,o&&(0,Xe.jsx)("div",{className:"character-row-container",children:(0,Xe.jsx)("div",{className:"character-row-display",children:t.characters.map((e=>(0,Xe.jsx)(Kt,{character:e,isSelected:!1,onSelect:()=>{(e=>{m.state===Lt.CHARACTER_CREATION?O(e):h.showBasicNotebook(r.d8.CHARACTER,e)})(e)},showAbilities:!1,collapsed:!0},e.id)))})}),d&&k]})},ta=e=>{let{title:t,theme:a,children:n,onClick:s}=e;return(0,Xe.jsxs)("div",{className:`cbox ${a}`,onClick:()=>{s&&s()},children:[(0,Xe.jsx)("div",{className:`cbox-text ${a}`,children:t}),(0,Xe.jsx)("div",{className:"cbox-children",children:n})]})},aa=e=>{let{tag:t,disabled:a=!1,highlighted:s=!1,theme:i,onClick:o,className:l="",showTooltip:c=!0,tooltipText:d,tooltipClassName:u="",off:h,style:m,...g}=e;const[p,f]=(0,n.useState)(!1),v=(0,n.useRef)(null),y=(kt(),Ot()),b=Rt().getTagManager(),E="character"in t?t.tag:t;(0,n.useEffect)((()=>{if(p&&v.current){const e=v.current.querySelector(".tooltip");if(e){u&&e.classList.add(u);v.current.getBoundingClientRect();const t=e.getBoundingClientRect();t.right>window.innerWidth&&(e.style.left="auto",e.style.right="0",e.style.transform="translateX(0)"),t.left<0&&(e.style.left="0",e.style.right="auto",e.style.transform="translateX(0)")}}}),[p]);const x=()=>{if(d)return d;const e=b.getTooltipText({tag:E,type:"tag"});if(e)return e;switch((null===E||void 0===E?void 0:E.source)||""){case r.UW.LOCATION:case r.UW.PLOT:case r.UW.PLAYERS:case r.UW.BACKSTORY:case r.UW.FORESHADOWING:}return"HOW DID YOU GET HERE?!?! "+(null===E||void 0===E?void 0:E.tag.name)||0},N=()=>{let e="tag-pill text-pill";if(E){E.source&&(e+=` type-${E.source.toLowerCase()}`),E.theme&&E.theme!==r.Co.NONE&&(e+=` theme-${E.theme.toLowerCase()}`);const t=y.getPlayerAttitudesStyle(E.tag);t&&(e+=` ${t}`)}return a&&(e+=" disabled"),s&&(e+=" highlighted"),i&&(e+=` theme-${i}`),l&&(e+=` ${l}`),h&&(e+=" off"),e},T=()=>{!a&&o&&E&&o(E)},C=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,Xe.jsxs)("div",{ref:v,className:N(),style:e,onClick:T,onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:[(null===E||void 0===E?void 0:E.source)===r.UW.TREASURE?(0,Xe.jsx)("div",{className:"treasure-icon-container",children:(0,Xe.jsx)(Je,{imageId:"icon_treasure1"})}):(null===E||void 0===E?void 0:E.source)===r.UW.DM_POINT?(0,Xe.jsx)("div",{className:"dmpoint-icon-container",children:(0,Xe.jsx)(Je,{imageId:"number_die_20"})}):(null===E||void 0===E?void 0:E.tag.name)+(null!==E&&void 0!==E&&E.source&&E.source===r.UW.FORESHADOWING_RANDOM?"?":""),!a&&c&&p&&t&&(0,Xe.jsx)("div",{className:"tooltip",children:(0,Xe.jsx)("div",{className:"tooltip-content",children:x()})})]})};return(null===E||void 0===E?void 0:E.source)===r.UW.ENCOUNTER||(null===E||void 0===E?void 0:E.source)===r.UW.ENCOUNTER_EXPECTED?(()=>{const e=(null===E||void 0===E?void 0:E.source)===r.UW.ENCOUNTER_EXPECTED;return(0,Xe.jsxs)("div",{className:`encounter-medallion-outer tag-pill text-pill ${e?"expected":""} ${h?"off":""}`,style:m,onClick:T,onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:[C({pointerEvents:"none"},!1),!a&&c&&p&&(0,Xe.jsx)("div",{className:"tooltip medallion-tooltip",children:(0,Xe.jsx)("div",{className:"tooltip-content",children:x()})})]})})():C(m)},na=e=>{let{tag:t,source:a=r.UW.NONE,theme:n=r.Co.NONE,className:s,disabled:i,highlighted:o,onClick:l,showTooltip:c,tooltipText:d,tooltipClassName:u,off:h}=e;const m={tag:t,source:a,theme:n};return(0,Xe.jsx)(aa,{tag:m,className:s,disabled:i,highlighted:o,onClick:l?()=>l(m):void 0,showTooltip:c,tooltipText:d,tooltipClassName:u,off:h})},sa=e=>{let{encounterInfo:t}=e;kt();const a=t.encounter,n=Rt().getTagManager().encounterTagsExpected[a.name]||[];t.encounter.branches;return(0,Xe.jsxs)("div",{className:"notebook-encounter-container",children:[(0,Xe.jsx)("div",{className:"notebook-encounter-contents left",children:(0,Xe.jsx)(ta,{title:a.name,theme:"encounter-info",children:(0,Xe.jsx)("div",{className:"notebook-icon-container",children:(0,Xe.jsx)(Je,{imageId:a.icon})})})}),(0,Xe.jsxs)(ta,{title:"DETAILS",theme:"details",children:[(0,Xe.jsx)(ta,{title:"LOCATION",theme:"location",children:(0,Xe.jsx)("div",{className:"encounter-location",children:a.location.name})}),(0,Xe.jsxs)(ta,{title:"DESCRIPTION",theme:"description",children:[" ",(0,Xe.jsx)("div",{className:"notebook-text encounter-description",children:a.description})]}),(0,Xe.jsx)(ta,{title:"TOPICS AND THEMES",theme:"elements",children:(0,Xe.jsx)("div",{className:"elements-features-list-container",children:n.map(((e,t)=>(0,Xe.jsx)(na,{tag:e,showTooltip:!1,className:"notebook-text elements-features-list text-pill type-encounter"},t)))})})]})]})},ra=e=>{let{content:t,position:a="top",delay:s=200,className:r="",maxWidth:i=250,visible:o,trigger:l="hover",preservePositioning:c=!1,showHelpIcon:d=!0,children:u,translate:h=[0,0]}=e;const[m,g]=(0,n.useState)(!1),[p,f]=(0,n.useState)({x:0,y:0}),v=(0,n.useRef)(null),y=(0,n.useRef)(null),b=(0,n.useRef)(null),E=void 0!==o?"function"===typeof o?o():o:m;(0,n.useEffect)((()=>{if(E&&y.current&&v.current){const e=window.getComputedStyle(y.current);if("none"===e.display||"hidden"===e.visibility)return;const t=y.current.getBoundingClientRect(),n=v.current.getBoundingClientRect();let s=0,r=0;if(c)switch(a){case"top":s=window.scrollX+t.left+t.width/2-n.width/2,r=window.scrollY+t.top-n.height-12;break;case"bottom":s=window.scrollX+t.left+t.width/2-n.width/2,r=window.scrollY+t.bottom+12;break;case"left":s=window.scrollX+t.left-n.width-12,r=window.scrollY+t.top+t.height/2-n.height/2;break;case"right":s=window.scrollX+t.right+12,r=window.scrollY+t.top+t.height/2-n.height/2}else switch(a){case"top":s=t.left+t.width/2-n.width/2,r=t.top-n.height-8;break;case"bottom":s=t.left+t.width/2-n.width/2,r=t.bottom+8;break;case"left":s=t.left-n.width-8,r=t.top+t.height/2-n.height/2;break;case"right":s=t.right+8,r=t.top+t.height/2-n.height/2}const i=window.innerWidth,o=window.innerHeight;s<10&&(s=10),s+n.width>i-10&&(s=i-n.width-10),r<10&&(r=10),r+n.height>o-10&&(r=o-n.height-10),f({x:s,y:r})}}),[E,a,c]);const x=()=>{b.current&&clearTimeout(b.current),b.current=setTimeout((()=>g(!0)),s)},N=()=>{b.current&&clearTimeout(b.current),g(!1)};(0,n.useEffect)((()=>()=>{b.current&&clearTimeout(b.current)}),[]);const T=()=>{g(!m)};return(0,Xe.jsxs)("div",{className:`tooltip-wrapper-container ${c?"preserve-positioning":""} ${r}`,ref:y,..."hover"===l||"both"===l?{onMouseEnter:x,onMouseLeave:N,onFocus:x,onBlur:N,onClick:"both"===l?T:void 0}:"click"===l?{onClick:T}:{},children:[u,E&&(0,Xe.jsxs)("div",{className:`tooltip-wrapper tooltip-${a}`,ref:v,style:{left:p.x,top:p.y,maxWidth:"number"===typeof i?`${i}px`:i,zIndex:1e4,transform:`translate(${h[0]}px, ${h[1]}px)`},children:["          ",(0,Xe.jsx)("div",{className:"tooltip-content",children:t}),d&&(0,Xe.jsx)("div",{className:"tooltip-help-icon",children:(0,Xe.jsx)("span",{className:"tooltip-help-icon-text",children:"i"})})]})]})},ia=e=>{let{totalSegments:t,filledSegments:a,ranges:n,theme:s="",label:r,onHover:i,onLeave:o,showTooltips:l=!1}=e;const c=e=>{const t=n.find((t=>e>=t.start&&e<=t.end)),s=e<a;return t?{backgroundColor:s?t.fillColor:t.backgroundColor}:{backgroundColor:s?"#4CAF50":"#e0e0e0"}},d=e=>{if(!l)return"";const t="Level Up: Full Attention\n";return e<20?t+"Very Unready: All other players -2 happiness":e<50?t+"Unready: All other players -1 happiness":e<65||e>=75&&e<=90?t+"Ready: +1 Happiness":e>=65&&e<75?t+"Perfect: +2 Happiness":e>90?t+"Overready: +0 Happiness (-1 Happiness when OTHER Player's Characters level up)":t},u=Array.from({length:t},((e,t)=>{const s=(0,Xe.jsx)("div",{className:"fill-bar-segment ranged "+(t<a?"filled":""),style:c(t),onMouseEnter:()=>(e=>{if(i){const t=n.find((t=>e>=t.start&&e<=t.end));t&&i(t.label)}})(t),onMouseLeave:o},t);return l?(0,Xe.jsx)(ra,{content:d(t),position:"top",showHelpIcon:!1,children:s},t):s}));return(0,Xe.jsxs)("div",{className:"fill-bar ranged-fill-bar",children:[r&&(0,Xe.jsx)("div",{className:`fill-bar-label text-theme-${s||""}`,children:r}),(0,Xe.jsx)("div",{className:"fill-bar-container ranged",children:u})]})},oa=e=>{var t,a;let{characterInfo:n}=e;const s=jt(),i=wt();return(0,Xe.jsxs)("div",{className:"notebook-character",children:[(0,Xe.jsxs)("div",{className:"notebook-character-left",children:[(0,Xe.jsx)(ta,{title:n.character.name,theme:"character-info",children:(0,Xe.jsxs)("div",{className:"notebook-left-top-container",children:[(0,Xe.jsx)("div",{className:"notebook-character-icon-container",onClick:()=>{n.character.experience+=10},children:(0,Xe.jsx)(Je,{imageId:n.character.icon})}),(0,Xe.jsxs)("div",{className:"notebook-character-stats",children:[(0,Xe.jsxs)("div",{children:[(0,Xe.jsx)("b",{children:"Race:"})," ",s.getUFRace(n.character.race)]}),(0,Xe.jsxs)("div",{children:[(0,Xe.jsx)("b",{children:"Class:"})," ",s.getUFClass(n.character.character_class)]}),(0,Xe.jsx)("div",{children:(()=>{const e=i.getPlayerAssignedCharacter(n.character);return e?`Assigned to ${e.name}`:"Not assigned to any player"})()})]}),(0,Xe.jsx)(ta,{title:"STATUS",theme:`health ${n.character.injury}`,children:(0,Xe.jsx)("div",{className:`health-status ${n.character.injury}`,children:null!==(t=null===(a=n.character.injury)||void 0===a?void 0:a.toUpperCase())&&void 0!==t?t:"HEALTHY"})})]})}),(0,Xe.jsxs)(ta,{title:`LEVEL ${n.character.level}`,theme:"stats",children:[(0,Xe.jsx)("div",{className:"character-level",children:(0,Xe.jsx)(qt,{filledSegments:Math.min(n.character.experience,Ut.READY_START),totalSegments:Ut.READY_START,theme:"character-level"})}),n.character.experience>=Ut.READY_START&&(0,Xe.jsx)("div",{className:"character-level-up-readiness",children:(0,Xe.jsx)(ia,{filledSegments:n.character.experience,totalSegments:100,ranges:[{start:Ut.READY_START,end:Ut.READY_END,backgroundColor:"#c8e6c9",fillColor:"#81c784",label:"Ready"},{start:Ut.PERFECT_START,end:Ut.PERFECT_END,backgroundColor:"#a5d6a7",fillColor:"#4caf50",label:"Perfect"},{start:Ut.READY_SECOND_START,end:Ut.READY_SECOND_END,backgroundColor:"#c8e6c9",fillColor:"#81c784",label:"Ready"},{start:Ut.OVERREADY,end:100,backgroundColor:"#ffab91",fillColor:"#d84315",label:"Overready"}],theme:"level-up-readiness",label:"Level up: "+(Bt(n.character.experience)===_t.READY?"Ready":Bt(n.character.experience)===_t.PERFECT?"Perfect":"Overready"),showTooltips:!0})})]}),(0,Xe.jsxs)(ta,{title:"BACKSTORY",theme:"backstory",children:[(0,Xe.jsx)(qt,{totalSegments:Math.max(n.character.backstory.length,3),filledSegments:n.character.backstory.filter((e=>e.completed)).length,theme:"backstory",label:"Backstory Elements"}),(0,Xe.jsxs)("div",{className:"notebook-backstory-tags",children:[n.character.backstory.length>0?(0,Xe.jsx)("div",{children:"SEEKING:"}):(0,Xe.jsx)("div",{children:"No backstory yet..."}),n.character.backstory.filter((e=>!e.completed)).map(((e,t)=>(0,Xe.jsx)("div",{className:"text-pill expected",children:e.tag.name},t)))]}),(0,Xe.jsxs)("div",{className:"notebook-backstory-tags",children:[n.character.backstory.filter((e=>e.completed)).length>0&&(0,Xe.jsx)("div",{children:"COMPLETED:"}),n.character.backstory.filter((e=>e.completed)).map(((e,t)=>(0,Xe.jsx)("div",{className:"text-pill completed",children:e.tag.name},t)))]})]})]}),(0,Xe.jsxs)("div",{className:"notebook-character-right",children:[(0,Xe.jsx)(ta,{title:"ABILITIES",theme:"abilities",children:(0,Xe.jsx)(Yt,{hero:n.character,category:r.lq.ALL})}),(0,Xe.jsxs)(ta,{title:"ABILITY DETAILS",theme:"ability-details",children:[(0,Xe.jsx)(ta,{title:`${s.getUFRace(n.character.race)} Abilities`,theme:"race-abilities",children:(0,Xe.jsx)(Yt,{hero:n.character,category:r.lq.RACE,collapsed:!0})}),(0,Xe.jsx)(ta,{title:`${s.getUFClass(n.character.character_class)} Abilities`,theme:"class-abilities",children:(0,Xe.jsx)(Yt,{hero:n.character,category:r.lq.CHARACTER_CLASS,collapsed:!0})}),n.character.gear.length>0&&(0,Xe.jsx)(ta,{title:"Equipment Bonuses",theme:"gear-abilities",children:(0,Xe.jsx)(Yt,{hero:n.character,category:r.lq.GEAR,collapsed:!0})})]})]})]})},la=e=>{let{locationInfo:t}=e;const a=t.location;return(0,Xe.jsxs)("div",{className:"notebook-location-container",children:[(0,Xe.jsx)("div",{className:"notebook-location-contents left",children:(0,Xe.jsx)(ta,{title:a.name,theme:"location-info",children:(0,Xe.jsx)("div",{className:"notebook-icon-container",children:(0,Xe.jsx)(Je,{imageId:a.icon})})})}),(0,Xe.jsx)("div",{className:"notebook-location-contents right",children:(0,Xe.jsxs)(ta,{title:"DETAILS",theme:"location-details",children:[(0,Xe.jsx)(ta,{title:"DESCRIPTION",theme:"description",children:(0,Xe.jsx)("div",{className:"notebook-text location-description",children:a.description})}),(0,Xe.jsx)(ta,{title:"FEATURES",theme:"location-features",children:(0,Xe.jsx)("div",{className:"elements-features-list-container",children:a.tags.map(((e,t)=>(0,Xe.jsx)(na,{tag:e,showTooltip:!1,className:"notebook-text elements-features-list text-pill type-location"},t)))})})]})})]})},ca=e=>{let{playerInfo:t,singleColumn:a,clickChar:n=()=>{}}=e;jt();const s=t.player.preferences.filter((e=>e[1]>0)),r=t.player.preferences.filter((e=>e[1]<0));return(0,Xe.jsxs)("div",{className:"notebook-player-container",children:[(0,Xe.jsxs)("div",{className:"player-notebook-upper",children:[!a&&(0,Xe.jsxs)("div",{className:"player-notebook-left-content",children:[(0,Xe.jsxs)("div",{className:"notebook-player-topbar",children:[(0,Xe.jsx)("div",{className:"notebook-player-icon",children:(0,Xe.jsx)(Je,{imageId:t.player.icon})}),(0,Xe.jsx)("div",{className:"notebook-player-name",children:t.player.name})]}),(0,Xe.jsxs)("div",{className:"player-notebook-mid-content",children:[(0,Xe.jsx)("div",{className:"player-notebook-mid-left",children:(0,Xe.jsxs)(ta,{title:"STATS",theme:"stats",children:[(0,Xe.jsx)("div",{className:"character-level",children:(0,Xe.jsx)(qt,{filledSegments:t.player.playerStats.experience,totalSegments:rt[t.player.playerStats.level],theme:"player-level",label:`LEVEL ${t.player.playerStats.level}`})}),(0,Xe.jsx)("div",{className:"character-attitude",children:(0,Xe.jsx)(qt,{filledSegments:t.player.playerStats.enjoyment,totalSegments:t.player.playerStats.maxEnjoyment,theme:"player-level",label:`ATTITUDE ${t.player.playerStats.enjoyment}/${t.player.playerStats.maxEnjoyment}`})}),(0,Xe.jsx)("div",{className:"character-attention",children:(0,Xe.jsx)(qt,{filledSegments:t.player.playerStats.involvement,totalSegments:t.player.playerStats.maxInvolvement,theme:"player-level",label:`ATTENTION ${t.player.playerStats.involvement}/${t.player.playerStats.maxInvolvement}`})}),(0,Xe.jsxs)(ta,{title:"STRESS",theme:"stress",children:[(0,Xe.jsxs)("div",{className:"character-stress",children:["CURRENT STRESS"," ",Math.max(0,t.player.playerStats.stress-t.player.playerStats.stressBuffer),"%"]}),(0,Xe.jsxs)("div",{className:"character-stress",children:["RESILIENCE"," ",Math.min(t.player.playerStats.stressBuffer,t.player.playerStats.stress),"/",t.player.playerStats.stressBuffer]})]})]})}),(0,Xe.jsx)("div",{className:"player-notebook-mid-right",children:(0,Xe.jsxs)(ta,{title:"PREFERENCES",theme:"preferences",children:[(0,Xe.jsx)(ta,{title:"LIKES",theme:"likes",children:(0,Xe.jsx)("div",{className:"player-preferences likes",children:s.map(((e,t)=>(0,Xe.jsx)("div",{className:"text-pill like",children:(0,Xe.jsxs)("div",{className:"player-preference",children:["- ",e[0].name]})},t)))})}),(0,Xe.jsx)(ta,{title:"HATES",theme:"hates",children:(0,Xe.jsx)("div",{className:"player-preferences hates",children:r.map(((e,t)=>(0,Xe.jsx)("div",{className:"text-pill hate",children:(0,Xe.jsxs)("div",{className:"player-preference",children:["- ",e[0].name]})},t)))})})]})})]})]}),(0,Xe.jsx)("div",{className:"player-notebook-right-content",children:!a&&t.player.characters.length>0&&(0,Xe.jsx)(ta,{title:"CHARACTERS",theme:"characters",children:t.player.characters.map(((e,t)=>(0,Xe.jsxs)("div",{className:"player-character-container",onClick:()=>(e=>{n(e)})(t),children:[(0,Xe.jsxs)("div",{className:"player-character-hero-image",children:[(0,Xe.jsx)("div",{className:"challenge-character-icon",children:(0,Xe.jsx)(Je,{imageId:e.icon})}),"injured"===e.injury&&(0,Xe.jsx)("div",{className:"player-character-hero-injury"}),"dead"===e.injury&&(0,Xe.jsx)("div",{className:"player-character-hero-injury dead"})]}),(0,Xe.jsxs)("div",{className:"player-character-text-container",children:[(0,Xe.jsx)("div",{className:"player-character-name-container",children:(0,Xe.jsx)("div",{className:"player-character-name",children:e.name})}),(0,Xe.jsxs)("div",{className:"player-character-info",children:[e.race," ",e.character_class]}),(0,Xe.jsxs)("div",{className:"player-character-info",children:["Level ",e.level]})]})]},t)))})})]}),(0,Xe.jsx)("div",{className:"player-notebook-bottom",children:(0,Xe.jsx)(ta,{title:"PLAYER TRAITS",theme:"traits",children:0===t.player.traits.length?(0,Xe.jsx)("div",{className:"no-traits",children:"level up to unlock traits"}):(0,Xe.jsx)("div",{className:"player-notebook-traits",children:t.player.traits.map(((e,t)=>(0,Xe.jsx)("div",{children:(0,Xe.jsx)(ta,{title:e.name,theme:"trait",children:(0,Xe.jsx)("div",{className:"trait-description",children:e.description})})},t)))})})})]})},da=e=>{let{groupInfo:t}=e;const[a,s]=(0,n.useState)(t.players),r=wt(),[i,o]=(0,n.useState)(r.getGroupAttitudes()),[l,c]=(0,n.useState)(r.aggregateSchedule());return(0,n.useEffect)((()=>{o(r.getGroupAttitudes()),s(t.players),c(r.aggregateSchedule())}),[t,r]),(0,Xe.jsxs)("div",{className:"notebook-group-container",children:[(0,Xe.jsx)("div",{className:"notebook-group-top-content",children:(0,Xe.jsxs)("div",{className:"notebook-group-players notebook-text large",children:[(0,Xe.jsx)("u",{children:"Players"}),(0,Xe.jsx)("div",{className:"notebook-group-players-list",children:0!==a.length&&a.map(((e,t)=>(0,Xe.jsx)("div",{className:"notebook-text player-name",children:e.name},t)))})]})}),(0,Xe.jsxs)("div",{className:"player-attitude",children:[(0,Xe.jsxs)("div",{className:"attitude-column",children:[(0,Xe.jsx)("div",{className:"attitude-title notebook-text large",children:(0,Xe.jsx)("u",{children:"Group Likes"})}),i.likes.map(((e,t)=>(0,Xe.jsx)("div",{className:"attitude-item like",children:(0,Xe.jsx)("div",{className:"attitude-item-text",children:e})},t)))]}),i.conflicted.length>0&&(0,Xe.jsxs)("div",{className:"attitude-column",children:[(0,Xe.jsx)("div",{className:"attitude-title notebook-text large",children:(0,Xe.jsx)("u",{children:"Conflicted"})}),i.conflicted.map(((e,t)=>(0,Xe.jsx)("div",{className:"attitude-item conflicted",children:(0,Xe.jsx)("div",{className:"attitude-item-text",children:e})},t)))]}),(0,Xe.jsxs)("div",{className:"attitude-column",children:[(0,Xe.jsx)("div",{className:"attitude-title notebook-text large",children:(0,Xe.jsx)("u",{children:"Group Hates"})}),i.hates.map(((e,t)=>(0,Xe.jsx)("div",{className:"attitude-item hate",children:(0,Xe.jsx)("div",{className:"attitude-item-text",children:e})},t)))]})]})]})},ua=()=>{const e=wt().aggregateSchedule(),t=e=>0===e?"-":e<33?"X":e<65?" ":"\u2714";return(0,Xe.jsxs)("div",{className:"group-schedule-container",children:[(0,Xe.jsx)("div",{className:"group-schedule-tab",children:"Scheduling"}),(0,Xe.jsx)("div",{className:"week-display-days",children:e.map(((e,a)=>(0,Xe.jsxs)("div",{className:"day-box",children:[(0,Xe.jsx)("div",{className:"day-abbreviation",children:["M","T","W","R","F","St","Sn"][a]}),(0,Xe.jsx)("div",{className:"day-percentage",children:t(e)})]},a)))})]})},ha=e=>{let{tutorialInfo:t}=e;const a=t.message,n=t.icon,s=t.showNext,r=t.showPrev,i=Ot(),o=Rt().getTutorialManager(),l=s?"Next":"Close";return(0,Xe.jsxs)("div",{className:"notebook-tutorial-container",children:[(0,Xe.jsxs)("div",{className:"notebook-tutorial-contents left",children:[(0,Xe.jsx)("div",{className:"tutorial-title-container",children:(0,Xe.jsx)("div",{className:"tutorial-title",children:t.title})}),(0,Xe.jsx)("div",{className:"notebook-icon-container",children:(0,Xe.jsx)(Je,{imageId:n})}),(0,Xe.jsx)("div",{className:"pill-button remove",children:(0,Xe.jsx)("div",{className:"pill-button-disable",onClick:()=>(i.closeTutorial(),void o.disableTutorial()),children:"DISABLE TUTORIAL"})})]}),(0,Xe.jsxs)("div",{className:"notebook-tutorial-contents right",children:[(0,Xe.jsx)("div",{className:"tutorial-message-container",children:(0,Xe.jsx)("div",{className:"tutorial-message",dangerouslySetInnerHTML:{__html:a}})}),(0,Xe.jsxs)("div",{className:"notebook-tutorial-buttons",children:[void 0!==r&&r>=0&&(0,Xe.jsx)("div",{className:"nav-button prev",onClick:()=>{void 0!==r&&r>=0&&i.showTutorialPage(r)},children:"Previous"}),(0,Xe.jsx)("div",{className:"nav-button next",onClick:()=>{void 0!==s&&s>=0?i.showTutorialPage(s):i.closeTutorial()},children:l})]})]})]})},ma=e=>{let{notebookPages:t,singleColumn:a,pageIndex:s}=e;const i=Ot(),[o,l]=n.useState(s||0),c=()=>{i.closeNotebook()};(0,n.useEffect)((()=>{l(s||0)}),[s]);const d=t[o],u=()=>{l(0),i.removePlayer(d.content.player)},h=t.map(((e,t)=>(0,Xe.jsx)("div",{className:`notebook-tab ${e.category} ${t===o?"current":""}`,onClick:()=>l(t),children:(0,Xe.jsx)("div",{className:"notebook-tab-title",children:e.title})},t)));return d?(0,Xe.jsxs)("div",{className:`notebook-modal ${a?"single-column":""} ${d.category===r.d8.TUTORIAL?"tutorial":""}`,children:[d.category===r.d8.TUTORIAL?(0,Xe.jsx)(ha,{tutorialInfo:d.content}):(0,Xe.jsxs)("div",{className:"notebook-container",children:[(0,Xe.jsx)("div",{className:"notebook-tabs",children:h}),(0,Xe.jsxs)("div",{className:`notebook-content ${d.category}`,onClick:e=>e.stopPropagation(),children:[d?d.category===r.d8.ENCOUNTER||d.category===r.d8.LOCATION?(0,Xe.jsxs)("div",{className:`notebook-header ${d.category} `,children:[(0,Xe.jsx)("button",{className:"pill-button",onClick:c,children:"X"}),(0,Xe.jsx)("div",{className:"notebook-header-title",children:d.category.toUpperCase()})]}):d.category===r.d8.PLAYER?(0,Xe.jsxs)("div",{className:"notebook-header player ",children:[a?(0,Xe.jsx)("button",{className:"pill-button remove",onClick:u,children:"REMOVE"}):(0,Xe.jsx)("button",{className:"pill-button",onClick:c,children:"X"}),(0,Xe.jsx)("div",{className:"notebook-header-title",children:d.category.toUpperCase()})]}):d.category===r.d8.CHARACTER?(0,Xe.jsxs)("div",{className:"notebook-header character ",children:[(0,Xe.jsx)("button",{className:"pill-button",onClick:c,children:"X"}),(0,Xe.jsx)("div",{className:"notebook-header-title",children:d.category.toUpperCase()}),(0,Xe.jsx)("div",{className:"notebook-header-container"})]}):d.category===r.d8.GROUP||d.category===r.d8.CHARACTER?(0,Xe.jsxs)("div",{className:`notebook-header player ${d.category}  `,children:[(0,Xe.jsx)("div",{className:"notebook-header-title",children:d.category.toUpperCase()}),(0,Xe.jsx)("div",{className:"notebook-header-container"})]}):(0,Xe.jsxs)("div",{className:`notebook-header  ${d.category} `,children:[(0,Xe.jsx)("button",{className:"pill-button",onClick:c,children:"X"}),(0,Xe.jsx)("div",{className:"title-bar",children:(0,Xe.jsx)("div",{className:"title-text",children:d.title})})]}):(0,Xe.jsx)("div",{className:"notebook-header "}),(0,Xe.jsx)("div",{className:"notebook-body",children:(()=>{if(!d)return(0,Xe.jsx)("div",{className:"notebook-body"});switch(d.category){case r.d8.ENCOUNTER:return(0,Xe.jsx)(sa,{encounterInfo:d.content});case r.d8.CHARACTER:return(0,Xe.jsx)(oa,{characterInfo:d.content});case r.d8.LOCATION:return(0,Xe.jsx)(la,{locationInfo:d.content});case r.d8.PLAYER:return(0,Xe.jsx)(ca,{playerInfo:d.content,singleColumn:a,clickChar:e=>{l(e+1)}});case r.d8.MESSAGE:return(0,Xe.jsx)("div",{className:"notebook-category-message",children:(0,Xe.jsx)("div",{className:"notebook-message-text",children:d.content.message})});case r.d8.TOC:return(0,Xe.jsx)("div",{});case r.d8.GROUP:return(0,Xe.jsx)(da,{groupInfo:d.content});case r.d8.TUTORIAL:return(0,Xe.jsx)(ha,{tutorialInfo:d.content})}})()})]})]}),a&&(0,Xe.jsx)("div",{className:"group-schedule-holder",children:(0,Xe.jsx)(ua,{})})]}):(0,Xe.jsx)("div",{className:"notebook-modal"})},ga=e=>{let{buttonList:t,highlight:a}=e;const n=Rt(),s=e=>{switch(e){case r.P$.PLAYER_RECRUITMENT:n.state=Lt.PLAYER_RECRUITMENT;break;case r.P$.CHARACTER_ASSIGNMENT:n.state=Lt.CHARACTER_CREATION;break;case r.P$.CAMPAIGN:n.state=Lt.CAMPAIGN_SETUP;break;default:console.log("No entry")}};return(0,Xe.jsx)("div",{className:"nav-bar-container",children:t.map((e=>(e=>{let t=e===a?"highlight":"";switch(e){case r.P$.PLAYER_RECRUITMENT:return(0,Xe.jsx)("button",{className:`nav-button player ${t}`,onClick:()=>s(e),children:"Player Recruitment"},e);case r.P$.CHARACTER_ASSIGNMENT:return(0,Xe.jsx)("button",{className:`nav-button character ${t}`,onClick:()=>s(e),children:"Character Assignment"},e);case r.P$.CAMPAIGN:return(0,Xe.jsx)("button",{className:`nav-button campaign ${t}`,onClick:()=>s(e),children:"Campaign Select"},e);default:return null}})(e)))})},pa=e=>{let{appManager:t,playerManager:a}=e;const[s,i]=(0,n.useState)(a.getSelectedPlayerIds()),[o,l]=(0,n.useState)([]),c=(null===a||void 0===a?void 0:a.getRecruitablePlayers())||[],d=Ot(),u=s.length;a.aggregateSchedule();return(0,n.useEffect)((()=>{a.setSelectedPlayers(s),l((e=>{let t,n="",s=[];t={players:e.map((e=>a.getRecruitablePlayers()[e]))},n="Group Info",t.players.forEach((e=>{s.push({category:r.d8.PLAYER,content:{player:e},title:e.name.split(" ").map((e=>e[0])).join("")})}));return[{category:r.d8.GROUP,content:t,title:"Group Info"},...s]})(s))}),[a,s]),(0,n.useEffect)((()=>{const e=e=>{i((t=>{const n=Array.from(t),s=n.indexOf(e.id);return s>-1&&n.splice(s,1),a.setSelectedPlayers(n),n}))};return d.on("removePlayer",e),()=>{d.off("removePlayer",e)}}),[]),(0,Xe.jsxs)("div",{className:"player-recruitment-mode",children:[(0,Xe.jsxs)("div",{className:"player-status-container",children:[(0,Xe.jsx)("div",{className:"player-recruitment-left-container",children:(0,Xe.jsx)(ma,{notebookPages:o,singleColumn:!0})}),(0,Xe.jsx)(ga,{buttonList:[r.P$.CAMPAIGN,r.P$.CHARACTER_ASSIGNMENT],highlight:r.P$.CHARACTER_ASSIGNMENT})]}),(0,Xe.jsxs)("div",{className:"player-grid-container",children:[(0,Xe.jsx)("div",{className:"player-recruitment-status",children:0===u?"Select players to recruit":'Click "Accept Group" to continue'}),(0,Xe.jsx)("div",{className:"player-grid",children:c.map((e=>(0,Xe.jsx)(ea,{player:e,isSelected:s.includes(e.id),onSelect:()=>{return t=e.id,i((e=>{const n=Array.from(e),s=n.indexOf(t);return s>-1?n.splice(s,1):n.push(t),a.setSelectedPlayers(n),n})),void a.getRecruitablePlayers()[t];var t},showSchedule:!0,showPreferences:!0},e.id)))})]})]})},fa=e=>{let{}=e;const t=wt(),a=jt(),[s,i]=(Rt(),(0,n.useState)(null)),[o,l]=(0,n.useState)(t.getPlayers()),[c,d]=(0,n.useState)(a.getCharacterReferences()),[u,h]=(0,n.useState)(!1);(0,n.useEffect)((()=>{!s&&o.length&&i(o[0])}),[o]);const m=()=>{h(!u)},g=e=>o.some((t=>t.id!==(null===s||void 0===s?void 0:s.id)&&t.characters.includes(e)));return(0,Xe.jsxs)("div",{className:"character-creation-container",children:[(0,Xe.jsxs)("div",{className:"character-creation-left-container",children:[(0,Xe.jsx)(ga,{buttonList:[r.P$.PLAYER_RECRUITMENT,r.P$.CAMPAIGN],highlight:r.P$.CAMPAIGN}),(0,Xe.jsx)("div",{className:"player-list-container",children:(0,Xe.jsx)("div",{className:"player-list",children:o.map((e=>(0,Xe.jsx)(ea,{player:e,isSelected:(null===s||void 0===s?void 0:s.id)===e.id,onSelect:()=>(e=>{i(e)})(e),showSchedule:!1,showCharacters:!0,parentUpdate:m},e.id)))})})]}),(0,Xe.jsx)("div",{className:"character-creation-right-container",children:(0,Xe.jsx)("div",{className:"character-grid",children:c.map((e=>{var a;return(0,Xe.jsx)(Kt,{character:e,isSelected:null!==(a=null===s||void 0===s?void 0:s.characters.includes(e))&&void 0!==a&&a,onSelect:()=>(e=>{g(e)||s&&(s.characters.includes(e)?t.removeCharacterFromPlayer(s,e):s.characters.length<4&&t.assignCharactersToPlayer(s,[e]),l([...t.getPlayers()]))})(e),showAbilities:!0,isAssigned:null===s||void 0===s?void 0:s.characters.includes(e),isAssignedToOther:g(e)},e.id)}))})})]})},va=e=>{let{encounter:t}=e;const a=Ot();return(0,Xe.jsxs)("div",{className:`encounter-display ${t.location.themes[0]}`,onClick:()=>{a.showBasicNotebook(r.d8.ENCOUNTER,t)},children:[(0,Xe.jsx)("div",{className:"encounter-name",children:t.name}),(0,Xe.jsx)("div",{className:"encounter-event-icons",children:t.events.map(((e,t)=>(0,Xe.jsx)("div",{className:"encounter-event-icon",children:(0,Xe.jsx)(Je,{imageId:a.getEventIcon(e.type)})},t)))})]})},ya=e=>{let{processedEncounters:t}=e;return t?(0,Xe.jsx)("div",{className:"campaign-display-body",children:t.map(((e,t)=>(0,Xe.jsx)("div",{className:"encounter-row",children:e.map(((e,t)=>(0,Xe.jsx)(va,{encounter:e},t)))},t)))}):(0,Xe.jsx)("div",{children:"No encounters!"})},ba=e=>{let{campaign:t}=e;return(0,Xe.jsxs)("div",{className:"campaign-display-header",children:[(0,Xe.jsx)("div",{className:"campaign-icon",children:(0,Xe.jsx)(Je,{imageId:t.icon})}),(0,Xe.jsxs)("div",{className:"campaign-info",children:[(0,Xe.jsx)("div",{className:"campaign-name",children:(0,Xe.jsx)("strong",{children:t.name})}),(0,Xe.jsx)("div",{className:"campaign-description",children:t.description})]}),(0,Xe.jsxs)("div",{className:"campaign-extra",children:[(0,Xe.jsxs)("div",{children:[t.nbCharacters[0]," - ",t.nbCharacters[1]," characters"]}),(0,Xe.jsxs)("div",{children:[t.nbSessions[0]," - ",t.nbSessions[1]," sessions"]})]})]})},Ea=e=>{let{campaign:t,onSelect:a,collapsed:n,iconOnly:s,onAccept:r,onCancel:i,acceptText:o="ACCEPT"}=e;return(0,Xe.jsx)(Xe.Fragment,{children:s?(0,Xe.jsxs)("div",{className:`campaign-display ${t.theme||""} icon-only`,onClick:a,children:[(0,Xe.jsx)("div",{className:"campaign-name",children:t.name}),(0,Xe.jsx)("div",{className:"campaign-icon solo",children:(0,Xe.jsx)(Je,{imageId:t.icon})})]}):n?(0,Xe.jsx)("div",{className:`campaign-display ${t.theme||""} collapsed pill-shaped`,onClick:a,children:(0,Xe.jsx)(ba,{campaign:t})}):(0,Xe.jsxs)("div",{className:`campaign-display ${t.theme||""} full`,children:[(0,Xe.jsx)(ba,{campaign:t}),(0,Xe.jsx)(ya,{processedEncounters:t.processedEncounters}),(0,Xe.jsx)("div",{className:"campaign-display-footer",children:(0,Xe.jsxs)("div",{className:"ui-actions",children:[(0,Xe.jsx)("button",{className:"campaign-button cancel "+(i?"":" hidden"),onClick:i,children:"Cancel"}),(0,Xe.jsx)("button",{className:"campaign-button accept",onClick:r,children:o})]})})]})})},xa=e=>{let{openCampaign:t}=e;const a=wt(),s=Rt(),i=kt(),[o]=(0,n.useState)(i.getAvailableCampaigns()),[l,c]=(0,n.useState)(t),[d]=(0,n.useState)(a.getPlayers());return(0,n.useEffect)((()=>{}),[l]),(0,Xe.jsxs)("div",{className:"campaign-setup-container",children:[(0,Xe.jsxs)("div",{className:"player-list-container",children:[(0,Xe.jsx)(ga,{buttonList:[r.P$.PLAYER_RECRUITMENT,r.P$.CHARACTER_ASSIGNMENT]}),(0,Xe.jsx)("div",{className:"player-list",children:d.map((e=>(0,Xe.jsx)(ea,{player:e,isSelected:!1,onSelect:()=>{},showCharacters:!0,showSchedule:!1},e.id)))})]}),(0,Xe.jsx)("div",{className:"campaign-display-container",children:(0,Xe.jsx)("div",{className:"campaign-list-container",children:(0,Xe.jsx)("div",{className:"campaign-list",children:o.map(((e,t)=>(0,Xe.jsx)(Ea,{collapsed:l!==t,campaign:e,onSelect:()=>(e=>{c(e)})(t),onAccept:()=>{return e=t,i.startCampaign(e),void(a.readyForGame()&&(s.state=Lt.SESSION));var e},onCancel:()=>{c(void 0)}},t)))})})})]})};var Na=a(8062);const Ta="town",Ca="tavern",Aa="building",Sa="dungeon",Ma="water",ja="forest",wa="mountain",Ra="cave",ka={COMBAT:{name:"Combat",type:nt.COMBAT},ROLEPLAY:{name:"Roleplay",type:nt.ROLEPLAY},EXPLORATION:{name:"Exploration",type:nt.EXPLORATION},PUZZLE:{name:"Puzzle",type:nt.PUZZLE},PERCEPTION:{name:"Perception Check",type:nt.PERCEPTION},TOWN:{name:"Town",type:nt.TOWN},TRAVEL:{name:"Travel",type:nt.TRAVEL},CHALLENGE:{name:"Challenge",type:nt.CHALLENGE},TRAP:{name:"Trap",type:nt.TRAP},CHARACTER_BACKSTORY:{name:"Character Backstory",type:nt.CHARACTER_BACKSTORY},STORY:{name:"Story",type:nt.STORY},EXPOSITION:{name:"Exposition",type:nt.EXPOSITION},DUNGEON:{name:"Dungeon",type:nt.DUNGEON}},Ia={BREWER_KEVIN:{name:"Kevin the Brewer"},KIDNAPPING:{name:"Kidnapping"},OLD_LAKE:{name:"Old Lake"},CULT_LEADER:{name:"Cult Leader"}},Oa={TEMPLE:{name:"Sagewood Temple",type:r.ap.TEMPLE,description:"Heal wounds, or resurrect fallen heroes.",tags:[Ia.CULT_LEADER,Na.D.RELIGION],nbTags:1,effects:[{type:r.Cu.HEAL,value:99},{type:r.Cu.RESURRECT,value:1}]},SHOP:{name:"Ricky's Shop",type:r.ap.SHOP,description:"Magic items, goods, and an attitude...",tags:[Na.D.ARMOR,Na.D.WEAPONS],allowMagicItems:!0,nbTags:3,effects:[{type:r.Cu.REPLENISH_TOOLS,value:1},{type:r.Cu.ADD_TENSION,value:5}]},MARKETPLACE:{name:"Marketplace",type:r.ap.SHOP,description:"Replenish tools and talk with townsfolk.",tags:[Na.D.TOOLS],addFriendlyTags:!0,effects:[{type:r.Cu.REPLENISH_TOOLS,value:99}]},TAVERN:{name:"Tavern",type:r.ap.TAVERN,description:"Gossip, rumors, and conversation.",tags:[Na.D.DRINKS,Na.D.BARRELS,Na.D.HUMANS,Na.D.HALFLINGS],addFriendlyTags:!0,effects:[{type:r.Cu.ADD_ENJOYMENT,value:1}]},GUILD_HALL:{name:"Adventurer's Guild",type:r.ap.GUILD_HALL,description:"Replenish Magic, Level Up, and find magic items.",tags:[Na.D.LEVEL_UP],allowMagicItems:!0,nbTags:3,addFriendlyTags:!0,effects:[{type:r.Cu.REPLENISH_MAGIC,value:99}]},CONFRONTATION:{name:"Tense Standoff",type:r.ap.CONFRONTATION,description:"Hostile strangers walk the streets of Sagewood... ",tags:[Na.D.CULTISTS,Ia.CULT_LEADER],nbTags:1,effects:[{type:r.Cu.ADD_TENSION,value:10}]},CONFRONTATION2:{name:"Slums",type:r.ap.CONFRONTATION,description:"The heroes stumble into a bad part of town... ",tags:[],nbTags:0,effects:[{type:r.Cu.ADD_TENSION,value:10}]}},La={SAGEWOOD_TAVERN:{name:"Sagewood Tavern",description:"A cozy tavern in the heart of Sagewood. Two halfling barmids serve drinks to a variety of customers. Locals gossip and are usually up for a friendly game of dice or a dance with outsiders. A fire crackles on the hearth.",icon:"cd_l_sagewoodtavern",tags:[Na.D.BARRELS,Na.D.FIRE,Na.D.HUMANS,Na.D.HALFLINGS,Na.D.DRINKS],themes:[Ta,Ca]},UNDER_THE_WELL:{name:"Under the Well",description:"A huge underground cavern with a deep pool in the center. The opening to the town well looms above.",icon:"cd_l_underthewell",tags:[Na.D.DUNGEON],themes:[Sa,Ma]},LAKESIDE_BREWERY:{name:"Lakeside Brewery",description:"A small brewery on the edge of the lake. Something sinister has happened here.",icon:"cd_l_sagewoodbrewery",tags:[Na.D.BEER,Na.D.WATER,Na.D.BARRELS],themes:[Ta]},LAKESIDE:{name:"Lakeside",description:"A forested area along a quiet lake. The water is dark and still.",icon:"cd_l_lakeside",tags:[Na.D.WILDERNESS,Na.D.WATER,Na.D.FOLIAGE],themes:[ja]},LAKESIDE_CLIFFS:{name:"Lakeside Cliffs",description:"A series of cliffs overlooking the lake. Signs of Goblins are about.",icon:"cd_l_lakesidecliffs",tags:[Na.D.CAVES,Na.D.GOBLINS,Na.D.WATER,Na.D.FOLIAGE],themes:[wa,ja]}},Pa={SAGEWOOD:{id:1,name:"Cultist Conspiracy",description:"The party arrives at a tavern on the ouskirts of Sagewood just as the sun sets. They each have their own reasons for being there, but for this evening they all have one thing in common... they are the only strangers in the tavern. Some locals seem friendly, while others gather in small clusters around the smoky common room and glare at the party. The barmaids offer the party drinks and food. The party may overhear gossip about Kevin the Brewer, or notice strange tattoos on some of the locals. They may uncover clues to a mysterious goblin treasure by the old lake, or discover that several townspeople have gone missing recently. The party may take part in a dance competition with the locals if they like. A group of the locals with odd tattoos will use any excuse to start a fight with the party. ",icon:"cd_e_sagewoodtavern",location:La.SAGEWOOD_TAVERN,tags:[Na.D.MYSTERIES,Na.D.CULTISTS,Ia.BREWER_KEVIN,Ia.KIDNAPPING],branches:[],events:[{name:"Gossip and Rumors",type:nt.ROLEPLAY,flavorText:"The party chats with locals in the tavern. They may hear interesting rumors."},{name:"Dance Competition",type:nt.CHALLENGE,flavorText:"The party is challenged to a danceoff. Maybe they'll notice something strange about the locals...",tags:[Na.D.HALFLINGS,Na.D.HUMANS]},{name:"Tavern Brawl",type:nt.COMBAT,flavorText:"The party is ambushed in the tavern."},ka.PERCEPTION,{name:"Sagewood",type:nt.TOWN,flavorText:"Shop, rest, and gather information in the town of Sagewood."}],combat:[{name:"Bar Brawl",description:"Things get out of hand in the Sagewood Tavern.",enemy:Na.D.CULTISTS,nbEnemies:2}],challenge:[{name:"Dance-off in the Tavern",description:"The party is challenged to a dance-off by some of the locals. The winner gets a free drink."}],town:[{buildings:[Oa.TAVERN,Oa.SHOP,Oa.GUILD_HALL,Oa.MARKETPLACE,Oa.TEMPLE,Oa.CONFRONTATION,Oa.CONFRONTATION2],nbBuildings:[5,6]}]},UNDER_THE_WELL:{id:2,name:"Fishy Finale!",description:"The heroes stumble into the Cultists Lair. They were set up under the old well in the center of town all along. Their fish-based magic will be put to the test during this long combat-based finale!.",icon:"cd_e_underthewell",location:La.UNDER_THE_WELL,tags:[Na.D.FIGHTING,Na.D.CULTISTS,Na.D.MONSTERS],branches:[],events:[]},BREWERY_FIGHT:{id:3,name:"Brewery Battle",description:"The party investigates a local brewery. The Brewer, Kevin, hasn't been seen in town recently and barrel deliveries to the local tavern have been ...off. The party may be aware of a cult hiding in the brewery, so be sure to adjust the difficulty if the party takes the time to examine thier surroundings to see how best to approach. In any case, the Cult Leaders will attack when they notice the party. While in the brewery, characters may notice a tunnel leading underground towards the old lake and they might even discover signs that indicate some of the kidnapped townspeople had been taken that direction. ",icon:"cd_e_sagewoodbrewery",location:La.LAKESIDE_BREWERY,tags:[Na.D.FIGHTING,Ia.CULT_LEADER,Na.D.BEER],branches:[],events:[{name:"Interrogation",type:nt.ROLEPLAY,flavorText:"The party corners a scared cultist and demands some information...."},{name:"Drinking Competition",type:nt.CHALLENGE,flavorText:"While we are here...",tags:[Na.D.BEER]},{name:"Cult, Culter, Cultist",type:nt.COMBAT,flavorText:"The party confronts the Cult Leader and his followers."},ka.PERCEPTION,ka.EXPOSITION],combat:[{name:"Bar Brawl",description:"Things get out of hand in the Sagewood Tavern.",enemy:Na.D.CULTISTS,nbEnemies:2}],challenge:[{name:"Dance-off in the Tavern",description:"The party is challenged to a dance-off by some of the locals. The winner gets a free drink."}]},BREWERY_EXPLORATION:{id:4,name:"Brewery Exploration",description:"The party investigates the Lakeside Brewery and finds evidence of the cult\u2019s activities.",icon:"cd_e_breweryexploration",location:La.LAKESIDE_BREWERY,tags:[Na.D.EXPLORATION,Na.D.MYSTERIES],branches:[],events:[]},BY_THE_LAKE:{id:5,name:"By the Lake",description:"The party discovers signs of goblins by the lake.",icon:"cd_e_bythelake",location:La.LAKESIDE,tags:[Na.D.TREASURE,Na.D.GOBLINS,Na.D.RELIGION],branches:[],events:[{name:"Explore the Forest",type:nt.PERCEPTION,flavorText:"The party checks in the forest near the lake..."},{name:"Explore the Lakeshore",type:nt.PERCEPTION,flavorText:"The party checks the lakeshore..."},{name:"What's in that tree?!",type:nt.CHALLENGE,flavorText:"A creepy totem hangs in a clearing. The players attempt to cut it down."},{name:"Now where is that treasure?!",type:nt.CHALLENGE,flavorText:"The party search for the hidden treasure."},{name:"Goblin Ambush",type:nt.COMBAT,flavorText:"Goblins rush from the forest and attack!"}],combat:[{name:"Goblin Ambush",description:"Goblins rush from the trees!",enemy:Na.D.GOBLINS,nbEnemies:2}],challenge:[{name:"Cut down creepy totem",description:"An ominous, and magial feeling eminates from a totem hanging from a tree. It will take some thought and some care to cut it down."}]},LAKESIDE_CLIFFS:{id:6,name:"Cliff Catastrophe",description:"The party encounters a crazy goblin shaman in the Lakeside Cliffs.",icon:"cd_e_lakesidecliffs",location:La.LAKESIDE_CLIFFS,tags:[Na.D.FIGHTING,Na.D.GOBLINS],branches:[],events:[]}};Pa.SAGEWOOD.branches.push(Pa.BREWERY_FIGHT),Pa.SAGEWOOD.branches.push(Pa.BY_THE_LAKE),Pa.BREWERY_FIGHT.branches.push(Pa.BREWERY_EXPLORATION),Pa.BREWERY_FIGHT.branches.push(Pa.BY_THE_LAKE),Pa.BY_THE_LAKE.branches.push(Pa.LAKESIDE_CLIFFS),Pa.LAKESIDE_CLIFFS.branches.push(Pa.UNDER_THE_WELL);const Da=[[Pa.SAGEWOOD],[Pa.BREWERY_FIGHT,Pa.BY_THE_LAKE],[Pa.BREWERY_EXPLORATION,Pa.LAKESIDE_CLIFFS],[Pa.UNDER_THE_WELL]],Ua={name:"Cult of the Deep",id:0,description:"Townsfolk are acting strange. Something is moving in the lake. The Cult of the Deep is rising.",icon:"cult_of_the_deep_1",startingEncounter:Pa.SAGEWOOD,finaleEncounter:Pa.UNDER_THE_WELL,theme:"dark",nbCharacters:[2,4],nbSessions:[2,3],encounters:Object.values(Pa),processedEncounters:Da,plotHooks:["The party finds fish 1","The party figures out the cultists and goblins are connected","The party discovers the cultists are kidnapping people","The party learns of a crab-monster eating people"],tooltipTags:{[Pa.SAGEWOOD.name]:{[Na.D.CULTISTS.name]:"mention the group of weirdos in the corner",[Na.D.MYSTERIES.name]:"hint at an overheard secret",[Na.D.GOBLINS.name]:"mention goblins by the lake",[Ia.BREWER_KEVIN.name]:"there's a rumor about Kevin",[Ia.KIDNAPPING.name]:"someone mentions a recent kidnapping",[Na.D.DRINKS.name]:"describe the beer",[Ia.OLD_LAKE.name]:"A rumor about a nearby lake",[Na.D.FIRE.name]:"The fireplace comes up",[Na.D.BARRELS.name]:"a player notices an ale barrel",[Na.D.HALFLINGS.name]:"mention the halfling barmaids",[Na.D.HUMANS.name]:"describe the human patrons",[Na.D.BEER.name]:"converse about beer",[Na.D.TREASURE.name]:"mention the treasure",[Na.D.RELIGION.name]:"mention the goblins religion",[Na.D.FIGHTING.name]:"make sure they realize there will be combat at the brewery"}},chatTriggers:{[Pa.SAGEWOOD.name]:{[Na.D.CULTISTS.name]:"You notice a group of humans in red robes and with a strange octopus tattoo. They seem to be eyeing you suspiciously.",[Na.D.MYSTERIES.name]:"You overhear someone speak about a goblin treasure. Someone else interrupts and claims that they saw a goblin camp near the old lake.",[Na.D.GOBLINS.name]:"A table of townspeople loudly argue nearby. They seem to be discussing goblins, but quiet down when they notice you listening.",[Ia.BREWER_KEVIN.name]:"The bartender mentions that Kevin the Brewer hasn't been seen in days and that strange people have been delivering the beer.",[Ia.KIDNAPPING.name]:"A man says he doesn't recognize you and cautions you to be careful. He goes on to explain that several people have gone missing recently.",[Ia.CULT_LEADER.name]:{message:"With all these cultists, I bet there's a cult LEADER around... maybe at the brewery!",speaker:{type:r.wb.PLAYER,id:1}},[Na.D.DRINKS.name]:"The beer is supposed to be the best in the region, but it tastes awful. When you ask the barmaid about it she says you should complain to Kevin at the Brewery",[Ia.OLD_LAKE.name]:"A young couple loudly complain to some friends, they are trying to find a place to picnic but they indicate that the old lake is now teeming with goblins.",[Na.D.BARRELS.name]:{message:"Hey look at this ale-barrel! It's got an octopus symbol on it. Octobrew..?",speaker:{type:r.wb.CHARACTER,id:1}},[Na.D.FIRE.name]:{message:"I walk to the fire and warm my frigid digits. Fridgits.",speaker:{type:r.wb.CHARACTER,id:0}},[Na.D.HALFLINGS.name]:{message:"I want to chat with the halfling barmaids. See if they know what's good to eat here.",speaker:{type:r.wb.CHARACTER,id:2}},[Na.D.HUMANS.name]:"Most of the locals are humans. Some seem friendly but others are clearly hostile.",[Na.D.BEER.name]:"Some of the locals say that if you want decent beer you should go to the brewery by the lake.",[Na.D.TREASURE.name]:"The bartender says some adventurers came through recently and said he overheard them talking about a treasure they had buried out by the old lake.",[Na.D.RELIGION.name]:"The party asks a priest about the local religious customs. He describes normal enough things, but says a goblin religion seems to have become popular in town...they worship a strange fish god in the nearby lake.",[Na.D.FIGHTING.name]:{message:'Hey guys, I can see the DM notes that say "Brewery Battle". I think we can expect combat if we go there...I\'m just getting that vibe.',speaker:{type:r.wb.PLAYER,id:0}}}}},_a={OLD_MILL:{name:"The Old Mill",description:"An old family-owned mill on the edge of town.",icon:"mm_l_oldMill",tags:[Na.D.STARTING_LOCATION,Na.D.TOWN],themes:[Ta]},QUARRY:{name:"The Quarry",description:"A large quarry where stone is mined.",icon:"mm_l_quarry",tags:[Na.D.WILDERNESS],themes:[wa]},ROAD:{name:"Road",description:"A long wide road",icon:"mm_l_road",tags:[Na.D.ROADS],themes:[Ta]},UNDER_THE_MOUNTAIN:{name:"Under the Mountain",description:"A hidden entrance leads into the gnomish mines.",icon:"mm_l_entrance",tags:[Na.D.CAVES],themes:[wa]},TUNNELS:{name:"Gnome Tunnels",description:"Cramped tunnels deep underground.",icon:"mm_l_tunnel",tags:[Na.D.CAVES],themes:[wa]},BRIDGE:{name:"The Old Bridge",description:"A rickety old bridge over a deep chasm.",icon:"mm_l_bridge",tags:[Na.D.WILDERNESS],themes:[ja]},BEACH:{name:"The Beach",description:"A long stretch of beach.",icon:"mm_l_beach",tags:[Na.D.BEACHES],themes:[Ma]},TOWNVILLE:{name:"TOWNVILLE",description:"A mid-sized village.",icon:"mm_l_townville",tags:[Na.D.TOWN,Na.D.STARTING_LOCATION,Na.D.FINALE_LOCATION,Na.D.HUMANS],themes:[Ta]}},Ba={INTRO_IN_TOWN:{id:0,name:"Intro in Townville",description:"It's a peaceful day in Townville. The Heroes can spend some time buying Gear or Roleplaying. Suddenly the alarm sounds! The Miller has run all the way from the old mill shouting about thieves!",icon:"mm_e_townville",location:_a.TOWNVILLE,tags:[Na.D.HUMANS,Na.D.MYSTERIES,Na.D.SOCIAL],branches:[],events:[]},INTRO_AT_MILL:{id:1,name:"Missing Millstone",description:"The Millstone is missing. The Miller hires the Heroes to travel to the old quarry and transport a new one. There are also some clues around the Old Mill which may reveal more about what happened. This could be the sarting Encounter if you want to shorten the campaign, or to avoid Town.",icon:"mm_e_millstone",location:_a.OLD_MILL,tags:[Na.D.HUMANS,Na.D.MYSTERIES,Na.D.SOCIAL],branches:[],events:[]},ROAD_TO_QUARRY:{id:2,name:"Road to Quarry",description:"A long boring trek to the Quarry.",icon:"mm_e_road",location:_a.ROAD,tags:[Na.D.BORING],branches:[],events:[]},QUARRY_INVESTIGATION:{id:2,name:"Quarry",description:"A large quarry where stone is mined. The millstone might be here.",icon:"mm_e_quarry",location:_a.QUARRY,tags:[Na.D.HUMANS,Na.D.SOCIAL,Na.D.GNOMES],branches:[],events:[]},MOUNTAIN_ENTRANCE:{id:3,name:"Cave Entrance",description:"A hidden entrance in the wall of the quarry leads into the gnomish mines.",icon:"mm_e_cave",location:_a.UNDER_THE_MOUNTAIN,tags:[Na.D.GNOMES,Na.D.COMBAT,Na.D.EXPLORATION],branches:[],events:[]},EXPLORING_THE_TUNNELS:{id:4,name:"Gnomish Tunnel Exploration",description:"Tunnels leading to the South. Towards townville?",icon:"mm_e_tunnels",tags:[Na.D.GNOMES],location:_a.TUNNELS,branches:[],events:[]},BANDITS_ON_THE_BRIDGE:{id:5,name:"Bridge Bandits",description:"Bandits guard the far end. They demand payment!",icon:"mm_e_bandits",tags:[Na.D.HUMANS,Na.D.COMBAT,Na.D.ROLEPLAY],location:_a.BRIDGE,branches:[],events:[]},BEACH_TRAVEL:{id:6,name:"Beach Travel",description:"Traveling along the beach",icon:"mm_e_beach",tags:[Na.D.COMBAT],location:_a.BEACH,branches:[],events:[]},EXPLORE_SHIPWRECK:{id:7,name:"SHIPWRECK",description:"A ship. Has wrecked! Someone is looting it!",icon:"mm_e_shipwreck",tags:[Na.D.HUMANS,Na.D.COMBAT,Na.D.EXPLORATION],location:_a.BEACH,branches:[],events:[]},TOWNVILLE_FIRE:{id:8,name:"Townville Fire",description:"The town of townville is on fire!",icon:"mm_e_fire",tags:[Na.D.HUMANS,Na.D.DISASTERS,Na.D.FIRE],location:_a.TOWNVILLE,branches:[],events:[]}};Ba.INTRO_IN_TOWN.branches.push(Ba.INTRO_AT_MILL),Ba.INTRO_AT_MILL.branches.push(Ba.ROAD_TO_QUARRY),Ba.ROAD_TO_QUARRY.branches.push(Ba.QUARRY_INVESTIGATION),Ba.QUARRY_INVESTIGATION.branches.push(Ba.MOUNTAIN_ENTRANCE),Ba.QUARRY_INVESTIGATION.branches.push(Ba.BEACH_TRAVEL),Ba.QUARRY_INVESTIGATION.branches.push(Ba.BANDITS_ON_THE_BRIDGE),Ba.MOUNTAIN_ENTRANCE.branches.push(Ba.EXPLORING_THE_TUNNELS),Ba.EXPLORING_THE_TUNNELS.branches.push(Ba.TOWNVILLE_FIRE),Ba.BEACH_TRAVEL.branches.push(Ba.EXPLORE_SHIPWRECK),Ba.EXPLORE_SHIPWRECK.branches.push(Ba.TOWNVILLE_FIRE),Ba.BANDITS_ON_THE_BRIDGE.branches.push(Ba.TOWNVILLE_FIRE);const Fa=[[Ba.INTRO_IN_TOWN],[Ba.INTRO_AT_MILL],[Ba.ROAD_TO_QUARRY],[Ba.QUARRY_INVESTIGATION],[Ba.MOUNTAIN_ENTRANCE,Ba.BEACH_TRAVEL,Ba.BANDITS_ON_THE_BRIDGE],[Ba.EXPLORING_THE_TUNNELS,Ba.EXPLORE_SHIPWRECK],[Ba.TOWNVILLE_FIRE]],Ha={name:"Millstone Mystery",id:0,description:"The Millstone has mysteriously gone missing! While investigating what happened, the heroes may be delving into gnomish caves, or fighting scavengers along the beach.",icon:"millstone_mystery_1",theme:"adventure",nbCharacters:[2,4],nbSessions:[4,6],startingEncounter:Ba.INTRO_IN_TOWN,finaleEncounter:Ba.TOWNVILLE_FIRE,encounters:Object.values(Ba),processedEncounters:Fa},Ga={VILLAGE_ELDER:{name:"Elder"},DANCING:{name:"Dancing"},ELVEN_PRIEST:{name:"Elven Priest"}},Wa={ELDERS_HOME:{name:"Elder Rose's Hut",type:r.ap.TEMPLE,description:"Heal wounds, or resurrect fallen heroes.",tags:[Ga.VILLAGE_ELDER],nbTags:1,required:!0,maxCapacity:1,effects:[{type:r.Cu.HEAL,value:99},{type:r.Cu.RESURRECT,value:1}]},SHOP:{name:"Vilage Goods",type:r.ap.SHOP,description:"Basic goods and supplies.",tags:[Na.D.TOOLS],addFriendlyTags:!0,nbTags:3,effects:[{type:r.Cu.REPLENISH_TOOLS,value:99}]},SPECIAL_SHOP:{name:"Adventuring Goods",type:r.ap.SHOP,description:"Replenish tools and talk with townsfolk.",tags:[Na.D.ARMOR,Na.D.WEAPONS],effects:[{type:r.Cu.REPLENISH_TOOLS,value:99}],allowMagicItems:!0},TAVERN:{name:"Tavern",type:r.ap.TAVERN,description:"Drinks, food, and gossip.",tags:[Na.D.FOG,Na.D.HUMANS,Na.D.HALFLINGS,Na.D.BEER],addFriendlyTags:!0,effects:[{type:r.Cu.ADD_ENJOYMENT,value:1}]},CONFRONTATION:{name:"Fog Peril",type:r.ap.CONFRONTATION,description:"Tendrils of fog seem to follow the hero...they are unsettling ",tags:[Na.D.FOG],nbTags:1,effects:[{type:r.Cu.ADD_TENSION,value:10}]},CONFRONTATION2:{name:"Haggle",type:r.ap.CONFRONTATION,description:"The heroes waste time trying to get a better price...cmon! ",tags:[],nbTags:0,effects:[{type:r.Cu.ADD_TENSION,value:-10}]},ELVEN_TEMPLE:{name:"Grand Temple",type:r.ap.TEMPLE,description:"Heal wounds, or resurrect fallen heroes.",tags:[Ga.ELVEN_PRIEST],nbTags:2,effects:[{type:r.Cu.HEAL,value:99},{type:r.Cu.RESURRECT,value:1}]},ELVEN_SHOP:{name:"Elven Goods",type:r.ap.SHOP,description:"Normal goods, but pointier.",tags:[Na.D.TOOLS],addFriendlyTags:!0,nbTags:3,effects:[{type:r.Cu.REPLENISH_TOOLS,value:99}],allowMagicItems:!0},MASSAGE:{name:"Treetop Spa",type:r.ap.TAVERN,description:"Massage, healing, and luxury.",tags:[],addFriendlyTags:!0,nbTags:2,effects:[{type:r.Cu.REPLENISH_MAGIC,value:99},{type:r.Cu.ADD_ENJOYMENT,value:1},{type:r.Cu.HEAL,value:1}]},GATHERING_AREA:{name:"Suspended Plaza",type:r.ap.MARKETPLACE,description:"Shaded outdoor lounge with magic vendors.",tags:[],addFriendlyTags:!0,allowMagicItems:!0,nbTags:2,effects:[]},NASTY_FALL:{name:"Nasty Fall",type:r.ap.CONFRONTATION,description:"The treetop bridges are narrow and falls are always a danger...",tags:[Na.D.TREES],nbTags:1,effects:[{type:r.Cu.INJURE,value:1}]},SLUMS:{name:"Elven Slums",type:r.ap.CONFRONTATION,description:"The heroes wander into a bad tree...",tags:[Na.D.ELVES],nbTags:1,effects:[{type:r.Cu.ADD_TENSION,value:10}]}},za={FAIRLIGHT:{name:"Fairlight Village",description:"A cozy village nestled at the base of the Windy Mountains. Known for it's annual Fairlight Festival and nothing else, this village is mainly just a hangout for peasants, chickens, cows, and the occasional adventurer setting out on a quest into the mountains.",icon:"mm_l_fairlight",tags:[Na.D.HUMANS,Na.D.HALFLINGS,Na.D.CHICKENS,Na.D.BUILDINGS,Na.D.FOG],themes:[Ta]},WINDY_MOUNTAIN_PATH:{name:"Up the Windy Mountain",description:"A long and widing path up the Windy Mountains. Beginning in the small village of Fairlight, the path leads up the Windy Mountains through dense forest and is known to be dangerous, but also mysterious.",icon:"mm_l_mountain_camp",tags:[Na.D.TREES,Na.D.BOULDERS,Na.D.HUNTERS,Na.D.ROADS,Na.D.FOG],themes:[wa]},ELVEN_VILLAGE:{name:"Elven Tree-Village",description:"A beautiful village in and amongst the trees. Rope-bridges share the canopy with the vines and birds as Elves go about their daily business. The only part of the village that stands out is the Temple, a huge tree with ornate doors and windows growing directly from the bark.",icon:"mm_l_elven_town",tags:[Na.D.TREES,Na.D.ELVES,Na.D.BUILDINGS,Na.D.FOG],themes:[ja]},WITCH_CABIN:{name:"Witch's Cabin",description:"A small stone cabin on the side of the mountain in the midst of a dense forest. The cabin is spewing out thick, almost-purple smoke. Inside, a couldron bubbles over a smoky fire, an imp in a cage chatters, and a pentagram inscribed on the floor glows eerily.",icon:"mm_e_cabin",tags:[Na.D.FOG,Na.D.CABIN,Na.D.COULDRON,Na.D.BOOKS,Na.D.MAGIC,Na.D.SMOKE],themes:[Aa]},DWARVEN_TUNNEL:{name:"Tunnel 23",description:"An unassuming door in the side of the mountain leads to a small, but well-constructed corridor which feeds into an impressively huge tunnel with a wide paved road and lined by shops and homes.",icon:"mm_l_tunnel",tags:[Na.D.FOG,Na.D.RUNES,Na.D.DWARVES],themes:[Sa]},SMOKEY_CAVE:{name:"Smokey Cave",description:"A dark and smokey cave. The fog clings to the walls and reaches out with evil tenticles. The ground is littered with bones of recently slain dwarves, and a clicking sound can be heard throught.",icon:"cd_l_underthewell",tags:[Na.D.FOG,Na.D.DWARVES],themes:[Ra]}},Qa={FAIRLIGHT_FESTIVAL:{id:1,name:"Fairlight Festival",description:"The annual Fairlight Festival in the village of Fairlight is a week-long celebration of the harvest. The Mourning Mountain seems to loom above the town, and some hunters from the mountain have come to take part in the festivities. There are dancing competitions, archery contests, and plenty of drinking. All is not perfect, however, as recently an evil, poisonous fog has been spreading down from the mountain and is now even coming close to the town! The Village Elder, Rose will ask the heroes to assist.",icon:"mm_l_fairlight",location:za.FAIRLIGHT,tags:[Na.D.FESTIVALS,Na.D.CURSE,Ga.VILLAGE_ELDER,Na.D.GOSSIP],branches:[],events:[{name:"Farm Country Travel",type:nt.TRAVEL,flavorText:"Chickens? Check. Horses? Check. Corn? Check. Wheat? Chex."},{name:"Fairlight",type:nt.TOWN,flavorText:"Shop, rest, and gather information in the village of Fairlight ."},{name:"Festival Games",type:nt.CHALLENGE,flavorText:"The festival games are open to all, the heroes can try any number of games.",tags:[Ga.DANCING]},{name:"Gossip and Rumors",type:nt.ROLEPLAY,flavorText:"The party can mingle with the townfolk, listen to gossip, and take part in some games."},{name:"Hidden Treasure",type:nt.PUZZLE,flavorText:"Farmer Neb left behind some clues to a treasure he hid around here...",tags:[Ht.STONECUTTER]}],town:[{buildings:[Wa.ELDERS_HOME,Wa.SHOP,Wa.SPECIAL_SHOP,Wa.TAVERN,Wa.CONFRONTATION,Wa.CONFRONTATION2],nbBuildings:[4,5]}],challenge:[{name:"Fairlight Light Feet",description:"The players take part in a dancing competition.",successText:"The players win the dancing competition!",skillThresholds:{combat:5,magic:7,gear:7},revealTag:Na.D.FESTIVALS,generateRandomAssistTags:!1,assistTags:[Na.D.HALFLINGS,Na.D.HUMANS,Na.D.BEER,Na.D.WINE,Na.D.TABLES]}]},UP_THE_MOUNTAIN:{id:2,name:"Mountain Path",description:"blah blah, fog. hunters",icon:"mm_e_up_the_mountain",location:za.WINDY_MOUNTAIN_PATH,tags:[Na.D.CAMP,Na.D.DEER,Na.D.BEARS],branches:[],events:[{name:"Hunter Chatterers",type:nt.ROLEPLAY,flavorText:"The party chats with some hunters and share a meal at their camp."},ka.PERCEPTION,{name:"Deerfight",type:nt.COMBAT,flavorText:"Some deer step out of the fog...but they seem somehow evil. They attack the party!"},{name:"Bearfight",type:nt.COMBAT,flavorText:"A huge ugly bear with fog streaming from it's head rears up!"},{name:"Up up up the road",type:nt.TRAVEL,flavorText:"The way up the road is long."}],combat:[{name:"Deerfighter",description:"Deerscription",enemy:Na.D.DEER,nbEnemies:2},{name:"Bearfighter",description:"Bearrrrrscription",enemy:Na.D.BEAR,nbEnemies:1}]},POINTED_CONVERSATIONS:{id:3,name:"Pointed Conversations",description:"blah blah, fog. elves",icon:"mm_e_pointed",location:za.ELVEN_VILLAGE,tags:[Na.D.TOWER,Ga.ELVEN_PRIEST,Na.D.WINE],branches:[],events:[{name:"Treetop Town",type:nt.TOWN,flavorText:"The party corners a scared cultist and demands some information...."},{name:"Wine Competition",type:nt.CHALLENGE,flavorText:"Elven wine is some of the winey-est wine. The party can try to win a wine competition.",tags:[Na.D.WINE,Na.D.ELVES]},{name:"Priest Chat",type:nt.ROLEPLAY,flavorText:"The party has a conversation with the Elven Priest."},ka.PERCEPTION],town:[{buildings:[Wa.ELVEN_TEMPLE,Wa.ELVEN_SHOP,Wa.MASSAGE,Wa.GATHERING_AREA,Wa.NASTY_FALL,Wa.SLUMS],nbBuildings:[4,5]}]},BELL_SMOKE:{id:4,name:"Bells and Smoke",description:"As the players approach the Witch's Cabin, they will notice that the fog appears to avoid a species of tree growing near the cabin. The owner of the cabin, Fred Witch, is a friendly and relaxed gnome with a traditional red hat and a green thumb. He is proud of his garden and is happy to chat about the fog. He will lead the party to the Dwarven Tunnel if they ask. There is a bell inside the cabin which he seems completely unaware of but which is making a regular deep ringing. Each time it tolls, the characters will become confused. Kevin may ask the party to help with a _____ PUZZLE OF SOME KIND.",icon:"mm_l_witch",location:za.WITCH_CABIN,tags:[Na.D.TREES,Na.D.BELL,Na.D.SMOKE],branches:[],events:[{name:"Approach the Bell",type:nt.CHALLENGE,flavorText:"Disable, or silence the bell to clear your head.",tags:[Na.D.MAGIC,Na.D.BELL,Na.D.ROPE]},{name:"Kevin Witch",type:nt.ROLEPLAY,flavorText:'"The Witch" is Kevin Witch, a gardener-gnome'},{name:"Cabin Snares",type:nt.TRAP,flavorText:"The area around the cabin is full of traps."},{name:"Witch book is witch?",type:nt.PUZZLE,flavorText:"Kevin asks for a hand with something..."},ka.PERCEPTION]},TUNNEL_23:{id:5,name:"Dwarven Tunnel",description:"The entrance to the Dwarven Tunnel lies along a path up the mountain into a cleft in the rock and then deep into the mountain itself. The entrance is lined with statues and traps. It appears to be recently abandoned and no signs of life can be seen. The fog appears to billow out from deep within the mountain. This clearly leads to it's source.",icon:"mm_e_dwarves",location:za.DWARVEN_TUNNEL,tags:[Na.D.TRAPS,Na.D.STATUES,Na.D.MYSTERY],branches:[],events:[{name:"Trap1",type:nt.TRAP,flavorText:"trap1."},{name:"Trap2",type:nt.TRAP,flavorText:"trap2."},ka.PERCEPTION,{name:"Skill Challenge",type:nt.CHALLENGE,flavorText:""}]},SMOKEY:{id:6,name:"Source of Evil",description:"blah blah, fog. Crabs",icon:"cd_l_underthewell",location:za.SMOKEY_CAVE,tags:[Na.D.MONSTERS,Na.D.CLICKING,Na.D.EVIL],branches:[],events:[{name:"Finale",type:nt.FINALE,flavorText:"Finale."}]}};Qa.FAIRLIGHT_FESTIVAL.branches.push(Qa.UP_THE_MOUNTAIN),Qa.UP_THE_MOUNTAIN.branches.push(Qa.POINTED_CONVERSATIONS),Qa.UP_THE_MOUNTAIN.branches.push(Qa.BELL_SMOKE),Qa.POINTED_CONVERSATIONS.branches.push(Qa.TUNNEL_23),Qa.BELL_SMOKE.branches.push(Qa.TUNNEL_23),Qa.TUNNEL_23.branches.push(Qa.SMOKEY);const Va=[[Qa.FAIRLIGHT_FESTIVAL],[Qa.UP_THE_MOUNTAIN],[Qa.POINTED_CONVERSATIONS,Qa.BELL_SMOKE],[Qa.TUNNEL_23],[Qa.SMOKEY]],Ya=[{name:"Dragonsbreath Quest",id:623,description:"blah blah fog",icon:"missing_icon",startingEncounter:Qa.FAIRLIGHT_FESTIVAL,finaleEncounter:Qa.BELL_SMOKE,theme:"dark",nbCharacters:[2,4],nbSessions:[2,3],encounters:Object.values(Qa),processedEncounters:Va,plotHooks:["PLOT HOOK FLAVOR TEXT 1","PLOT HOOK FLAVOR TEXT 2","PLOT HOOK FLAVOR TEXT 3","PLOT HOOK FLAVOR TEXT 4"],tooltipTags:{[Qa.FAIRLIGHT_FESTIVAL.name]:{[Ga.VILLAGE_ELDER.name]:"the village elder appears to be waiting to speak with the party",[Na.D.HUMANS.name]:"describe the humans in the village",[Na.D.HALFLINGS.name]:"mention the halflings",[Na.D.FOG.name]:"Talk about the fog!",[Na.D.CHICKENS.name]:"go into great detail about some chichens",[Na.D.BUILDINGS.name]:"describe the village huts",[Na.D.FESTIVALS.name]:"Bring up the festival",[Na.D.DEER.name]:"bring up the deer in the forest",[Na.D.BEARS.name]:"bring up the story about the bear...",[Na.D.CAMP.name]:"mention the hunter's camp",[Na.D.HUNTERS.name]:"Bring up the hunters",[Na.D.CURSE.name]:"mention the curse...",[Na.D.GOSSIP.name]:"the party wants to listen in on some gossip"},[Qa.UP_THE_MOUNTAIN.name]:{[Na.D.HUNTERS.name]:"See what the hunters have to say...",[Na.D.FOG.name]:'Maybe the players are curious about the fog?"',[Na.D.DEER.name]:"Describe the creepy weirdo horrible deer",[Na.D.BEARS.name]:"The players ask about the Bear that might be on the mountain...",[Na.D.CAMP.name]:"Bring up the hunters camp...",[Na.D.HUNTERS.name]:"Focus on one specific hunter...",[Na.D.BOULDERS.name]:"Talk about the boulders",[Na.D.ROADS.name]:"Describe the road...",[Na.D.TREES.name]:"It's a forest after all....but there is something to be mentioned about the trees...",[Na.D.TOWER.name]:"Talk about the tower in the distance...",[Ga.ELVEN_PRIEST.name]:"Reference the priest that was recently in the area...",[Na.D.WINE.name]:"everyone loves chatting about wine",[Na.D.BELL.name]:"Describe the bell which keeps ringing in the distance...",[Na.D.SMOKE.name]:"there is a lot of smoke that appears distinct from the fog..."},[Qa.BELL_SMOKE.name]:{[Na.D.FOG.name]:"...of course we need to bring up the fog...",[Na.D.BELL.name]:"Describe the Bell",[Na.D.SMOKE.name]:"Talk about the smoke",[Na.D.CABIN.name]:"Give details about the cabin",[Na.D.COULDRON.name]:"Bring up the couldron",[Na.D.BOOKS.name]:"Describe the bookshelf",[Na.D.MAGIC.name]:"Magic is evident everywhere...",[Na.D.TREES.name]:"The trees are different here..."},[Qa.POINTED_CONVERSATIONS.name]:{[Na.D.TOWER.name]:"Describe the Elven Temple's Spire",[Ga.ELVEN_PRIEST.name]:"Remind the Players about the Elven Priest...",[Na.D.WINE.name]:"perhaps the players are cusrious about the wine?",[Na.D.TREES.name]:"talk about the trees",[Na.D.ELVES.name]:"describe some basic elves in the village",[Na.D.BUILDINGS.name]:"bring up how the buildings are trees",[Na.D.FOG.name]:"continue to remind about the whole fog sitch"},[Qa.SMOKEY.name]:{[Na.D.MONSTERS.name]:"",[Na.D.CLICKING.name]:"",[Na.D.EVIL.name]:"",[Na.D.FOG.name]:"",[Na.D.DWARVES.name]:"",[Na.D.FOG.name]:"",[Na.D.DWARVES.name]:""}},chatTriggers:{[Qa.FAIRLIGHT_FESTIVAL.name]:{[Ga.VILLAGE_ELDER.name]:[{message:"The Village Elder is waiting to speak with the party...",speaker:{type:r.wb.DM,id:0}},{message:"Let's not keep her waiting!",speaker:{type:r.wb.PLAYER,id:0}},{message:"She asks the party to investigate the fog and its source in the mountains. It will require journeying up the mountain...",speaker:{type:r.wb.DM,id:0}},{message:"Sounds like we have an adventure on our hands!",speaker:{type:r.wb.PLAYER,id:1}}],[Na.D.FESTIVALS.name]:[{message:"The Fairlight Festival is a day-long celebration of the village's harvest season.",speaker:{type:r.wb.DM,id:0}},{message:"Isn't this place being attacked by demon fog or someting? Are they really celebrating still?",speaker:{type:r.wb.PLAYER,id:0}},{message:"Despite the fog, the Village Elder - Elder Rose, has decided to go ahead with the festival. You hear she wants to speak with the party.",speaker:{type:r.wb.DM,id:0}}],[Na.D.CHICKENS.name]:[{message:"You watch as a chicken scratches around in the dirt. Nearby a tentacle of fog stretches out and almost touches it.",speaker:{type:r.wb.DM,id:0}},{message:"Noooo! Chicky!",speaker:{type:r.wb.CHARACTER,id:0}},{message:"The chicken is startled by your yell and notices the fog. It runs away",speaker:{type:r.wb.DM,id:0}}],[Na.D.CURSE.name]:[{message:"Its just after dark, the party is considering their next move when they are approached by three triplet halfling children walking in lockstep.",speaker:{type:r.wb.DM,id:0}},{message:'As one they stop and stare. "Lift" "The" "Curse" They say in turn: "Set Them Free" they say in unison.',speaker:{type:r.wb.DM,id:0}},{message:"NOPE.",speaker:{type:r.wb.CHARACTER,id:1}},{message:"\"Don't mind them!\" you hear an older halfling trots up out of breath and puts his hand on one the girl's shoulders. ",speaker:{type:r.wb.DM,id:0}},{message:"Listen here, you halfling freakmonger - they mentioned something about a curse. What's going on?",speaker:{type:r.wb.CHARACTER,id:0}},{message:'"Sorry" The man says, though he looks a but hurt. "Well...There IS a curse on the vilage. Some spirits are trapped on top of the mountain or something...we dont know all the details.',speaker:{type:r.wb.DM,id:0}}],[Na.D.GOSSIP.name]:[{message:"You overhear some farmers gossiping about some elves up the mountain.",speaker:{type:r.wb.DM,id:0}},{message:"Elves, hmmm? Interesting.",speaker:{type:r.wb.CHARACTER,id:0}},{message:"Not a minute later you hear another piece of mountain-related gossip. This time some halflings mention a witch that lives in a cabin up the mountain.",speaker:{type:r.wb.DM,id:1}},{message:"A witch? I KNEW it.",speaker:{type:r.wb.CHARACTER,id:1}},{message:"...",speaker:{type:r.wb.DM,id:0}},{message:"Yeah, so elves and witches. Up the ol' mountain. Mount Elfwitch.",speaker:{type:r.wb.PLAYER,id:2}},{message:"...",speaker:{type:r.wb.DM,id:2}}],[Na.D.HUMANS.name]:"The townfolk are mainly humans, but a few halflings live here as well.",[Na.D.HALFLINGS.name]:"Making up about a quarter of the town's population, the halflings are well-represented at the festival, particularly the dancing contest.",[Na.D.BUILDINGS.name]:"The village has a few buildings, most prominently the tavern and the bakery. ",[Na.D.DEER.name]:"Some villagers mention that they saw evil-looking deer up the mountain path.",[Na.D.BEARS.name]:"A huge bear has been seen up the mountain. It appears to be hiding in the fog.",[Na.D.CAMP.name]:"The party learns of a Hunters Camp up the mountain. It may be a good place to rest and get information about the mountain.",[Na.D.HUNTERS.name]:"A hunter is in town for the festival. He invites the party to the camp up the mountain. ",[Na.D.ARCHERY.name]:"Archery is a pretty popular sport in town, so its no surprise that there is an archery ompetition at the fair.",[Na.D.CRAFTING.name]:"Basket Weaving, Pottery, and Carving competitions are all part of the festival. ",[Ga.DANCING.name]:"You aren't sure how these things are judged, but it's fun to dance with some of the locals anyways. ",[Na.D.FOG.name]:[{message:"The festival is going well. People are laughing, and enjoying the games. Suddenly the games, laughter, and chatter stop as an ear-splitting scream stills the crowd.",speaker:{type:r.wb.DM,id:0}},{message:'"What\'s happened?!" I\'ll shout heorically and run towards the source of the scream and pull my weapon. "Out of the way, you filthy peasants!"',speaker:{type:r.wb.CHARACTER,id:0}},{message:"The crowd parts for you, though you get some odd looks for your rudeness. Ahead a woman is pulling an unconsious child from a bank of low-hanging fog.",speaker:{type:r.wb.DM,id:0}},{message:"As a pair of halflings help the woman take her child away, some of the townsfolk explain that a poisonous fog has recently been seen in the town. Sometimes it almost seems alive.",speaker:{type:r.wb.DM,id:0}}]},[Qa.UP_THE_MOUNTAIN.name]:{[Na.D.FOG.name]:"The fog appears to be thicker as you climb the mountain. The tendrils seem more and more dangerous and feel thicker and more substantial. You sometimes see shapes moving in the fog...",[Na.D.DEER.name]:"The deer dart in and out out of the fog and even appear to be playing in it. Occasionally though, you see one glaring at you with evil intent...it's only a matter of time before they attack!",[Na.D.BEARS.name]:"In the fog you see an enormous shape lumbering towards you. A huge head resolves out of the fog and the bear exhales a long clous of mist. It looks angry...",[Na.D.CAMP.name]:"The hunters camp is a well-established mountain base. There are some servicable tents, a firepit, and a few hunters. They are willing to chat but seem to be on edge due to the fog.",[Na.D.HUNTERS.name]:"You talk with some hunters on the mountain near the camp. They say the Fog has been getting worse and worse. They think it is coming from the mountain itself!",[Na.D.BOULDERS.name]:"The area is littered with large boulders",[Na.D.ROADS.name]:"The mountain road is a well-beaten path but occasionally dwindwles to a narrow trail. You doubt a cart could make it up here.",[Na.D.TREES.name]:'The trees and foliage here is thick and green, but some darker...almost "stickier" looking species of shrub can be found. The forest to the east appears to contain more and more of these. The hunters say they were planted by "some Witch"',[Na.D.TOWER.name]:"A tower can be seen above the trees. The local hunters say it is the spire of a temple from an Elven Village farther up the mountain. They say the village is friendly and a Priest there is known to be wise. Perhaps they will know about this fog",[Ga.ELVEN_PRIEST.name]:"The hunters say that there is an Elven Village up the mountain. Some of the fog is coming from that direction...there is a prominane Elven Priest there...perhpas he will have some answers.",[Na.D.WINE.name]:"Hunters along the trail share some amazing wine. They say they got it from the Elven Village farther along the path.",[Na.D.BELL.name]:"There has been a bell ringing in the distance for a while now. The party finally determines that the direction is coming from the same direction as a Witch's Cabin that the hunters mentioned...",[Na.D.SMOKE.name]:"Mixed with the fog is a thick, almost purple smoke. It appears to have similar poperties to the fog and its curling tenticles seem to beckon the party in a certain direction..."},[Qa.BELL_SMOKE.name]:{[Na.D.FOG.name]:"The fog appears to be much thinner as you approach the cabin. However, instead of the fog, the air here is thick with smoke coming from the cabin..",[Na.D.BELL.name]:[{message:"There is a large bell hanging from a thick purple rope. It's ringing regularly and makes you feel odd for a moment each time it tolls.",speaker:{type:r.wb.DM,id:0}},{message:"What is causing it to ring?",speaker:{type:r.wb.PLAYER,id:6}},{message:'And what do you mean "odd"?',speaker:{type:r.wb.PLAYER,id:1}},{message:"It's not clear what is causing the bell to ring, it is likely magical. Every time it rings it makes your head foggy for a moment. The effect gets worse the closer you get.",speaker:{type:r.wb.DM,id:0}},{message:"Dungggggg... Dunggggg... Dungggggg...",speaker:{type:r.wb.CHARACTER,id:2}}],[Na.D.SMOKE.name]:"As you approach the cabin it is impossible to miss the smoke. It is pouring from the chimney of the cabin, but insteads of rising into the air it seems to spill out of the chimney and cascades to the ground where it sits in smoky clumps",[Na.D.CABIN.name]:"The cabin is made of stone and sits on the side of the mountain. Thick purplish smoke pours from the chimney. It's not clearly occupied...",[Na.D.COULDRON.name]:"A bubbling couldron sits in the center of the cabin. A large bell-like hood covers it and seems to direct the smoke to the chinmey stack.",[Na.D.BOOKS.name]:"An ornate bookshelf sits on one wall, a glass door covers the shelves. A strange locking mechanism is evident on the door.",[Na.D.MAGIC.name]:"Everything about this area has at least a subtle hint of magic. Some things more than others...",[Na.D.TREES.name]:[{message:"The trees around the cabin nestled here in the mountain give way to what appear to be cultivated shrubs. They give off a slight not-unpleasant odor - and the fog appears to avoid them.",speaker:{type:r.wb.DM,id:0}},{message:"...I'll collect a few of them. They may come in handy later.",speaker:{type:r.wb.CHARACTER,id:0}}]},[Qa.POINTED_CONVERSATIONS.name]:{[Ga.ELVEN_PRIEST.name]:[{message:"You speak with the Elven Priest. He says that the fog arrived at the same time that he began to sense a great evil presense deep within the mountain. ",speaker:{type:r.wb.DM,id:0}},{message:"Is he about to blame the dwarves? I bet he is. That seems a little...",speaker:{type:r.wb.CHARACTER,id:0}},{message:"cliche?",speaker:{type:r.wb.DM,id:1}},{message:"..racist",speaker:{type:r.wb.CHARACTER,id:0}},{message:"The elven priest ignores your rudeness and continues to explain that while the Dwarves are probably not personally involved, they have a tunnel nearby that may lead the heroes to the source of this evil and fog.",speaker:{type:r.wb.DM,id:0}}],[Na.D.TOWER.name]:"The Grand Temple's Tower is a glittering spire rising high above the trees. The Elven Priest has been informed of the party's arrival, and has asked to chat. He has a stern demeanor, and an odd lisp which makes him hard to understand.",[Na.D.WINE.name]:"You have arrived just at the time of year for the Elven Wine Festival. They invite you to partake and maybe even help judge the competition?",[Na.D.TREES.name]:"The trees in this part of the mountain grow tall and wide along a deep ravine. The trees act as vertical homes and temples for the Elves, with winding rope bridges leading high up into the boughs.",[Na.D.ELVES.name]:"The Elves rarely see outsiders and they are firendly - if perhaps over-curious about the party. Elves of all ages and persuasions can be seen among the trees, doing Elvish stuff.",[Na.D.BUILDINGS.name]:[{message:'The Elves use the trees as their "buildings" and mostly live high above the forest floor.',speaker:{type:r.wb.DM,id:0}},{message:"Notable structures include the Grand Temple, and a beautiful plaza suspended high in the trees that looks ideal for a rest...",speaker:{type:r.wb.DM,id:0}},{message:'...what do they use for bathrooms up there? Do they have "treetop treepotties"? ',speaker:{type:r.wb.PLAYER,id:0}},{message:"...",speaker:{type:r.wb.DM,id:0}}],[Na.D.FOG.name]:"Even in the Elven Village the fog is present, but lies close to the ground and so the Elves don't seem much bothered by it. Those who venture onto the ground seem to have holy-charms which ward it off...",[Na.D.MYSTERY.name]:[{message:"",speaker:{type:r.wb.DM,id:1}},{message:"Well too bad. There aren't any Dwarves here in this Dwarven tunnel.",speaker:{type:r.wb.DM,id:0}},{message:"Haha. Oh you are serious. No Dwarves? Well... why not?! What happened to the Dwarves?",speaker:{type:r.wb.PLAYER,id:0}},{message:"It's not clear. The homes lining the tunnel appear to be abandoned, but valuables and goods are clearly visible in shops and forges.",speaker:{type:r.wb.DM,id:0}}]},[Qa.TUNNEL_23.name]:{[Na.D.TRAPS.name]:"The road leading into the tunnel is paved with large stones and lined with statues. As one of you steps forward, a stone depresses slightly and a large axe swings from the wall. Runes on statues glow menacingly. It is clear there are traps around...",[Na.D.DWARVES.name]:"Though the tunnel is lined with shops, forges, and Dwarf-Sized homes, there are no Dwarves to be seen. The tunnel appears to be abandoned.",[Na.D.MYSTERY.name]:[{message:"I'm looking forward to talking with some Dwarves.",speaker:{type:r.wb.CHARACTER,id:1}},{message:"Well too bad. There aren't any Dwarves here in this Dwarven tunnel.",speaker:{type:r.wb.DM,id:0}},{message:"Haha. Oh you are serious. No Dwarves? Well... why not?! What happened to the Dwarves?",speaker:{type:r.wb.PLAYER,id:0}},{message:"It's not clear. The homes lining the tunnel appear to be abandoned, but valuables and goods are clearly visible in shops and forges.",speaker:{type:r.wb.DM,id:0}}],[Na.D.FOG.name]:"The fog trails in a clear stream from farther along the tunnel. It's clearly coming from inside the mountain via whatever is deeper along the tunnel. You must cover your mouths to keep from breathing it in.",[Na.D.STATUES.name]:"The boulevard, tunnel, road...whatever you want to call it is lined with tall statues of Dwarven Heroes. Indecipherable Runes can be seen on the base of each statue, although something tells you that you shouldn't get too close...",[Na.D.RUNES.name]:[{message:"The runes on the statues glow faintly as you approach. They a-",speaker:{type:r.wb.DM,id:0}},{message:"I poke one with a stick!",speaker:{type:r.wb.PLAYER,id:2}},{message:"Stop it! No we dont do anything...",speaker:{type:r.wb.PLAYER,id:1}},{message:"Ok fine. I cautiously approach it...holding a stick still but ready to poke",speaker:{type:r.wb.PLAYER,id:2}},{message:"The runes glow as you approach. If you had to guess, they list the names and titles of the Dwarves on the statues. However, as you lean in to examine one closer there is a mechanical click and the statues axe swings down swiftly. You narrowly avoid being split in twain!",speaker:{type:r.wb.DM,id:0}}],[Na.D.EVIL.name]:[{message:"The door to a large meeting-hall is open and you can see a large map on the wall inside...",speaker:{type:r.wb.DM,id:0}},{message:"Let's go in. I'm going in.",speaker:{type:r.wb.PLAYER,id:2}},{message:"In Character please...",speaker:{type:r.wb.DM,id:0}},{message:"What have we here then? Some sort of ye-olde mappe? Let us hither to better espy it-",speaker:{type:r.wb.CHARACTER,id:2}},{message:"Better. You enter the hall cautiously, but it is clearly not occupied or trapped. The map on the wall appears to be a map of the tunnels just ahead in the mountain. One branch near the entrance has a large black X and a word newly-scribbled in coal: EVIL! ",speaker:{type:r.wb.DM,id:0}}],[Na.D.CLICKING.name]:"There's a moment in when the wind in the tunnel dies down and there is a period of relative silence. Thats when you hear it. From somewhere deep ahead in the dark tunnel...a rhythmic clicking sound! Click! Cli-Click!",[Na.D.MONSTERS.name]:[{message:"You see a dead dwarf lying slumped with his back to a fountain...",speaker:{type:r.wb.DM,id:0}},{message:"Ew",speaker:{type:r.wb.PLAYER,id:0}},{message:"...as you approach-",speaker:{type:r.wb.DM,id:0}},{message:"WHY WOULD WE APPROACH?! ... Ok sorry. We approach him. Go on. Sorry.",speaker:{type:r.wb.CHARACTER,id:2}},{message:'As you approach, you realize that he is still alive - but barely. He weakly lifts his head when you approach and beckons you over with a nod. With a shaky hand he points down the tunnel and whispers... "MONSTERS!"',speaker:{type:r.wb.DM,id:0}}]},[Qa.SMOKEY.name]:{[Na.D.MONSTERS.name]:"",[Na.D.CLICKING.name]:"",[Na.D.EVIL.name]:"",[Na.D.FOG.name]:"",[Na.D.DWARVES.name]:""}}},Ua,Ha],Ka=e=>{let{score:t,direction:a="row",className:n=""}=e;const s=(e=>{if(e<=0)return[];const t=[];let a=e;if(a>=24){const e=Math.floor(a/24);t.push({type:"d20",count:e}),a%=24}if(a>=4){const e=Math.floor(a/4);for(let a=0;a<e;a++)t.push({type:"d6"});a%=4}if(a>0)for(let n=0;n<a;n++)t.push({type:"d4"});return t})(t);return 0===s.length?(0,Xe.jsx)("div",{className:`dice-score empty ${n}`,children:"-"}):(0,Xe.jsx)("div",{className:`dice-score ${a} ${n}`,children:s.map(((e,t)=>((e,t)=>{const a=`dice-icon dice-${e.type}`;return(0,Xe.jsxs)("div",{className:a,style:{zIndex:"d20"===e.type?10:5-t},children:["d4"===e.type&&(0,Xe.jsx)(Je,{imageId:"die_d4"}),"d6"===e.type&&(0,Xe.jsx)(Je,{imageId:"die_d6"}),"        ","d20"===e.type&&(0,Xe.jsxs)("div",{className:"d20-container",children:[(0,Xe.jsx)(Je,{imageId:"die_d20"}),e.count&&e.count>1&&(0,Xe.jsx)("span",{className:"d20-number",children:e.count})]})]},`${e.type}-${t}`)})(e,t)))})},qa=e=>{let{encounterScore:t,campaignScore:a,onClick:n,className:s=""}=e;const r=kt();return(0,Xe.jsxs)("div",{className:`campaign-header ${s}`,children:[(0,Xe.jsxs)("div",{className:"campaign-header-dm-points",children:[(0,Xe.jsx)("div",{className:"campaign-header-dm-points-label",children:"POTENTIAL SCORE"}),(0,Xe.jsx)("div",{className:"campaign-header-dm-point",children:(0,Xe.jsx)(Ka,{score:t},t)})]}),(0,Xe.jsx)("div",{className:"campaign-header-center-container",onClick:n,children:(0,Xe.jsxs)("div",{className:`campaign-display ${r.getCurrentCampaign().theme} icon-only`,children:[(0,Xe.jsxs)("div",{className:"campaign-info left",children:[(0,Xe.jsx)("div",{className:"campaign-info title",children:r.getCurrentCampaign().name}),(0,Xe.jsx)("div",{className:"campaign-info hooks",children:"PLOT HOOKS"}),(0,Xe.jsx)("div",{className:"circle-display",children:Array.from({length:4},((e,t)=>(0,Xe.jsx)("div",{className:"circle "+(t<r.getCampaignProgress()?"filled":"")},t)))})]}),(0,Xe.jsx)("div",{className:"campaign-icon solo",children:(0,Xe.jsx)(Je,{imageId:r.getCurrentCampaign().icon})})]})}),(0,Xe.jsxs)("div",{className:"campaign-header-dm-points",children:[(0,Xe.jsx)("div",{className:"campaign-header-dm-points-label",children:"CAMPAIGN TOTAL"}),(0,Xe.jsx)("div",{className:"campaign-header-dm-point",children:(0,Xe.jsx)(Ka,{score:a},a)})]})]})},Xa=()=>{const e=kt(),t=Ot(),a=Rt().getTagManager(),[s,i]=(0,n.useState)(e.getCurrentEncounter()),[o,l]=(0,n.useState)(a.getOutstandingEncounterTags()),[c,d]=(0,n.useState)(a.encounterTagsCollected[(null===s||void 0===s?void 0:s.name)||""]||[]),[u,h]=(0,n.useState)(a.locationTagsCollected),[m,g]=(0,n.useState)(e.getEncounterLocationTags()),[p,f]=(0,n.useState)(e.getCompletedEvents()),[v,y]=(0,n.useState)(!1),[b,E]=(0,n.useState)(e.getCampaignScore()),[x,N]=(0,n.useState)(e.getEncounterPoints()),[T,C]=(0,n.useState)(e.getRemainingSnacks()),[A,S]=(0,n.useState)(e.getRemainingBreaks()),M=(0,n.useMemo)((()=>(null===s||void 0===s?void 0:s.location.tags.sort())||[]),[null===s||void 0===s?void 0:s.location.tags]);(0,n.useEffect)((()=>{const t=()=>{f(e.getCompletedEvents()),l(e.getExpectedEncounterTags()),d(a.encounterTagsCollected[(null===s||void 0===s?void 0:s.name)||""]||[]),g(e.getEncounterLocationTags()),h(a.locationTagsCollected),i(e.getCurrentEncounter()),N(e.getEncounterPoints()),E(e.getCampaignScore()),C(e.getRemainingSnacks()),S(e.getRemainingBreaks())};return e.on("encounterUpdated",t),()=>{e.off("updateEncounterState",t)}}),[s,e,a]),(0,n.useEffect)((()=>{const a=e=>{t.showQuestTerminalModal(e.quest,e.node)};return e.on("showQuestTerminal",a),()=>{e.off("showQuestTerminal",a)}}),[e,t]),(0,n.useEffect)((()=>{const t=()=>{C(e.getRemainingSnacks()),S(e.getRemainingBreaks())};return e.on("dmAbilitiesUpdated",t),()=>{e.off("dmAbilitiesUpdated",t)}}),[e]);const j=(0,n.useMemo)((()=>[...M].sort(((e,t)=>e.name.localeCompare(t.name)))),[M]);if(!s)return(0,Xe.jsx)("div",{className:"encounter-overview-container",children:"No Encounter"});const w=Array.from(new Set(s.events.map((e=>e.type)))),R=s.location.themes[0],k=(()=>{for(let e=0;e<s.events.length;e++)if(!p.includes(e))return e;return-1})(),I=e=>{switch(e){case nt.COMBAT:return"Combat";case nt.ROLEPLAY:return"Roleplaying";case nt.PUZZLE:return"Puzzle";case nt.DUNGEON:return"Dungeon Crawl";case nt.PERCEPTION:return"Perception Check";case nt.TOWN:return"Town Stuff";case nt.TRAVEL:return"Travel";case nt.CHALLENGE:return"Skill Challenge";case nt.TRAP:return"Trap";case nt.CHARACTER_BACKSTORY:return"Backstory";case nt.STORY:return"Story";case nt.EXPLORATION:return"Exploration"}};((null===s||void 0===s?void 0:s.tags)||[]).filter((e=>{return t=e,!a.getOutstandingEncounterTags().includes(t);var t})).length;return(0,Xe.jsxs)("div",{className:"encounter-overview-container",children:[(0,Xe.jsx)("div",{className:"encounter-icon-container",children:(0,Xe.jsx)(Je,{imageId:s.icon})}),!v&&(0,Xe.jsxs)("div",{className:"encounter-overview-nonmodal ",children:[(0,Xe.jsxs)("div",{className:"encounter-overview-abilities-row",children:[(0,Xe.jsxs)(ta,{title:"Offer Snacks",theme:"snacks",onClick:()=>{T>0&&(e.useSnacks(),C(T-1))},children:[(0,Xe.jsx)("div",{className:"ability-container",children:(0,Xe.jsx)("div",{className:"ability-info",children:"Increase Attitude"})}),e.hasHostingAbility(0)?(0,Xe.jsx)("div",{className:"ability-amount-label-container",children:(0,Xe.jsxs)("div",{className:"ability-amount-label",children:[T,"/",e.getMaxSnacks()]})}):(0,Xe.jsx)("div",{className:"lock-icon-container",children:(0,Xe.jsx)("div",{className:"lock-icon",children:"\ud83d\udd12"})})]}),"      ",(0,Xe.jsxs)(ta,{title:"Take a Break",theme:"breaks",onClick:()=>{A>0&&(e.useBreak(),S(A-1))},children:[(0,Xe.jsx)("div",{className:"ability-container",children:(0,Xe.jsx)("div",{className:"ability-info",children:"Reduce Exhaustion, Tension, Attention, Stress"})}),e.hasHostingAbility(1)?(0,Xe.jsx)("div",{className:"ability-amount-label-container",children:(0,Xe.jsxs)("div",{className:"ability-amount-label",children:[A,"/",e.getMaxBreaks()]})}):(0,Xe.jsx)("div",{className:"lock-icon-container",children:(0,Xe.jsx)("div",{className:"lock-icon",children:"\ud83d\udd12"})})]})]}),(0,Xe.jsx)("div",{className:"session-control-campaign",children:(0,Xe.jsx)(qa,{encounterScore:x,campaignScore:b,onClick:()=>y(!0),className:"header overview"})}),(0,Xe.jsxs)("div",{className:"encounter-overview-contents",children:[(0,Xe.jsx)("div",{className:"encounter-overview-info-column",children:(0,Xe.jsxs)("div",{className:"encounter-overview-encounter-info",children:[(0,Xe.jsxs)("div",{className:"encounter-header",children:[(0,Xe.jsx)(ut,{callback:()=>t.showBasicNotebook(r.d8.ENCOUNTER,s),classname:"encounter"}),s.name]}),(0,Xe.jsx)("div",{className:"encounter-overview-subtitle small",children:"ENCOUNTER TOPICS"}),(0,Xe.jsxs)("div",{className:"encounter-overview-encounter-info-tags-row",children:[c.map(((e,t)=>(0,Xe.jsx)(na,{tag:e,source:r.UW.ENCOUNTER,theme:R,tooltipClassName:"info-tooltip",tooltipText:"Expectation fulfilled"},t))),o.map(((e,t)=>(0,Xe.jsx)(na,{tag:e,source:r.UW.ENCOUNTER_EXPECTED,theme:R,tooltipClassName:"info-tooltip",tooltipText:"Players still expect to encounter this"},t)))]})]})}),(0,Xe.jsx)("div",{className:"encounter-overview-info-column",children:(0,Xe.jsxs)("div",{className:"encounter-overview-encounter-info",children:[(0,Xe.jsxs)("div",{className:"encounter-header",children:[(0,Xe.jsx)(ut,{callback:()=>t.showBasicNotebook(r.d8.ENCOUNTER,s),classname:"location"}),s.location.name]}),(0,Xe.jsxs)("div",{className:"encounter-overview-encounter-info",children:[(0,Xe.jsx)(qt,{totalSegments:m.length,filledSegments:u.length,theme:R,label:"LOCATION ELEMENTS"}),(0,Xe.jsx)("div",{className:"encounter-overview-encounter-info-tags-row",children:(0,Xe.jsx)("div",{className:"encounter-overview-encounter-info-tags",children:j.map(((e,t)=>(0,Xe.jsx)(na,{tag:e,source:a.locationTagsCollected.includes(e)?r.UW.LOCATION:r.UW.NONE,theme:R,tooltipText:a.locationTagsCollected.includes(e)?"This has been discussed and established":"This part of the location has not yet been described"},t)))})})]})]})})]}),(0,Xe.jsxs)("div",{className:"encounter-overview-events-container",children:[(0,Xe.jsx)("div",{className:"encounter-overview-event-header",children:"ENCOUNTER EVENTS"}),(0,Xe.jsxs)("div",{className:"encounter-overview-events-row",children:[(0,Xe.jsxs)("div",{className:"encounter-overview-legend",children:[w.map(((e,a)=>(0,Xe.jsxs)("div",{className:"event-legend-entry",children:[(0,Xe.jsx)("div",{className:"event-icon",children:(0,Xe.jsx)(Je,{imageId:t.getEventIcon(e)})}),(0,Xe.jsx)("div",{className:"event-name",children:I(e)})]},a))),(0,Xe.jsxs)("div",{className:"event-legend-entry",children:[(0,Xe.jsx)("div",{className:"preferred-event-score",children:(0,Xe.jsx)(Ka,{score:1})}),(0,Xe.jsx)("div",{className:"event-name",children:"Maxim's Choice"})]})]}),0===s.events.length?null:(0,Xe.jsx)("div",{className:"encounter-eventlist",children:s.events.map(((a,n)=>(0,Xe.jsxs)("div",{className:`event-entry ${a.type} ${p.includes(n)?"completed":""}`,onClick:()=>((t,a)=>{e.encounterEventSelected(t),p.push(t),a&&e.addEncounterPoints(1),f([...p])})(n,n===k),children:[(0,Xe.jsx)("div",{className:"event-icon",children:(0,Xe.jsx)(Je,{imageId:t.getEventIcon(a.type)})}),n===k&&(0,Xe.jsx)("div",{className:"preferred-event-score",children:(0,Xe.jsx)(ra,{content:"Gain a bonus point for choosing this event next.",preservePositioning:!0,translate:[270,-120],children:(0,Xe.jsx)(Ka,{score:1})})}),(0,Xe.jsx)("div",{className:"event-name",children:a.name}),a.flavorText&&(0,Xe.jsx)("div",{className:"event-flavor-text",children:a.flavorText})]},n)))})]})]}),s.branches&&s.branches.length>0&&(0,Xe.jsxs)("div",{className:"encounter-overview-bottom-container",children:[(0,Xe.jsxs)("div",{className:"encounter-overview-upcoming-branches-container",children:[(0,Xe.jsx)("div",{className:"encounter-overview-upcoming-branches-header",children:"UPCOMING ENCOUNTERS"}),(0,Xe.jsx)("div",{className:"encounter-overview-upcoming-upcoming-branches",children:s.branches.map(((e,t)=>{return(0,Xe.jsxs)("div",{className:`encounter-overview-upcoming-branch text-theme-${e.location.themes[0]}`,children:[(0,Xe.jsxs)("div",{className:"encounter-overview-upcoming-branch-header",children:[(0,Xe.jsx)("div",{className:"encounter-overview-upcoming-travel-header-text encounter",onClick:()=>{a.showNextEncounterModal()},children:e.name}),(0,Xe.jsx)("div",{className:"encounter-overview-upcoming-travel-header-text",children:e.location.name})]}),(0,Xe.jsx)(qt,{totalSegments:4,filledSegments:Math.min(4,a.encounterTagsCollected[e.name].length),theme:e.location.themes[0],label:e.name}),(0,Xe.jsx)("div",{className:"encounter-overview-upcoming-branch-tags",children:(()=>{const t=a.encounterTagsExpected[e.name],n=a.encounterTagsCollected[e.name]||[],s=4-t.length,i=Array(s).fill({name:"?"});return[...n.map(((t,a)=>(0,Xe.jsx)(na,{tag:t,source:r.UW.FORESHADOWING,theme:e.location.themes[0],tooltipClassName:"info-tooltip",tooltipText:"Players have been led to expect this if/when they get to this encounter."},`collected-${a}`))),...t.filter((e=>!n.some((t=>t.name===e.name)))).map(((t,a)=>(0,Xe.jsx)(na,{tag:t,source:r.UW.FORESHADOWING_EXPECTED,theme:e.location.themes[0],tooltipClassName:"info-tooltip",tooltipText:"This topic can still be exposed to the players to inform them of the upcoming encounter"},`expected-tag-${a}`))),...i.map(((t,a)=>(0,Xe.jsx)(na,{tag:t,source:r.UW.NONE,theme:e.location.themes[0],tooltipClassName:"info-tooltip",tooltipText:"This topic is yet to be determined. Opportunities to choose a topic may arise."},`filler-${a}`)))]})()}),(0,Xe.jsx)("div",{className:"encounter-overview-upcoming-footer",children:(0,Xe.jsx)("div",{className:"encounter-overview-upcoming-travel-footer-text",children:(n=a.encounterTagsCollected[e.name].length,4===n?"WELL PREPARED":3===n?"READY":2===n?"INFORMED":"NOT READY")})})]},t);var n}))})]}),(0,Xe.jsxs)("div",{className:"encounter-overview-advance-container",children:[(0,Xe.jsx)("div",{className:"encounter-overview-advance-text",children:"ADVANCE ENCOUNTER"}),(0,Xe.jsxs)("div",{className:"encounter-overview-advance-button",onClick:()=>{a.showNextEncounterModal()},children:[(0,Xe.jsx)("div",{className:"encounter-overview-advance-button-text",children:"PLAYERS CHOOSE"}),(0,Xe.jsx)("div",{className:"encounter-overview-advance-info",children:e.getEncounterAdvanceReadinessText()})]})]})]})]}),v&&(0,Xe.jsx)(Ea,{campaign:e.getCurrentCampaign(),collapsed:!1,onAccept:()=>y(!1),acceptText:"Close"})]})},Za=e=>{let{event:t}=e;return(0,Xe.jsx)("div",{className:"encounter-event",children:(0,Xe.jsx)("div",{className:"event-content",children:t.name})})},Ja=e=>{let{encounter:t}=e;const[a,s]=(0,n.useState)(t.events),[r,i]=(0,n.useState)(!1);kt(),Ot();return(0,Xe.jsx)("div",{className:"table-encounter-divisions",children:(0,Xe.jsxs)("div",{className:"event-column open",children:[a.map(((e,t)=>(0,Xe.jsx)(Za,{event:e},`${t}`))),(0,Xe.jsx)("div",{className:"event-column-label"})]})})},$a=e=>{let{min:t,max:a,totalSegments:n,isGrim:s}=e;a++;const r=t/n*100-1,i=(a-t)/n*100+1.5;return(0,Xe.jsxs)("div",{className:"range-card",style:{left:`${r}%`,width:`${i}%`},children:[(0,Xe.jsx)("div",{className:"combat-bar-label peril",children:"PERIL"}),(0,Xe.jsx)("div",{className:"combat-bar-label stress",children:"TENSION"}),(0,Xe.jsxs)("div",{className:"combat-bar-label engagement",children:[s?"GRIM ":" ","SCORE"]})]})},en=e=>{let{baseDie:t,displayNumber:a,onClick:n}=e;const s=`number_die_${t}`;return(0,Xe.jsxs)("div",{className:"number-die",onClick:n,children:[(0,Xe.jsx)(Je,{imageId:s}),(0,Xe.jsx)("div",{className:"number-die-text",children:a})]})},tn=e=>{let{modifierCallback:t,side:a,combatState:s,disabled:r}=e;const i=kt(),o=Rt(),[l,c]=(o.getCombatManager(),(0,n.useState)(o.getTagManager().locationTagsCollected));return(0,Xe.jsxs)("div",{className:`combat-modifiers ${a}`,children:[(0,Xe.jsxs)("div",{className:"combat-modifiers-label",children:["Assist ","heroes"===a?"Heroes":"Enemies"]}),(0,Xe.jsxs)("div",{className:"combat-modifier-row",children:[(0,Xe.jsx)("div",{className:"combat-modifiers-tags",children:(0,Xe.jsx)("div",{className:`location-tags ${a}`,children:l.map(((e,n)=>(0,Xe.jsx)("div",{className:"text-pill type-location "+(s.usedTags[n]?"expected":""),onClick:()=>(e=>{s.usedTags||(s.usedTags=l.map((()=>!1)));const n=!s.usedTags[e];t(n?1:-1,a,l[e],e)})(n),children:e.name},n)))})}),(0,Xe.jsx)("div",{className:"combat-modifiers-die "+(r?"disabled":""),children:(0,Xe.jsx)(en,{baseDie:20,displayNumber:"1",onClick:()=>(i.spendDMPoints(1),void t(1,a,{name:"DM"},0))})})]})]})},an=e=>{let{combatantCallback:t,side:a,combatState:n}=e;return(0,Xe.jsxs)("div",{className:`combat-combatants ${a}`,children:[(0,Xe.jsx)("div",{className:"combat-combatants-label",children:"heroes"===a?"Add allied Combatants":"Swap Enemies"}),(0,Xe.jsx)("div",{className:"combat-combatants-row",children:(0,Xe.jsx)("div",{className:"combat-combatants-tags",children:"heroes"===a&&n.friendlyTags.length<=0?(0,Xe.jsx)("div",{className:"combatant-tags",children:(0,Xe.jsx)("div",{className:"none-available",children:"No valid established NPC Races available."})}):"enemies"===a&&n.friendlyTags.length<=0&&n.hostileTags.length<=0?(0,Xe.jsx)("div",{className:"combatant-tags",children:(0,Xe.jsx)("div",{className:"none-available",children:"No valid established Enemy Races available."})}):(0,Xe.jsxs)("div",{className:`combatant-tags ${a}`,children:[n.friendlyTags.map(((e,s)=>(0,Xe.jsx)("div",{className:`text-pill combatant ${a}`,onClick:()=>(e=>{t(a,n.friendlyTags[e],e)})(s),children:e.name},s))),"enemies"===a&&n.hostileTags.map(((e,s)=>(0,Xe.jsx)("div",{className:`text-pill combatant ${a}`,onClick:()=>(e=>{t(a,n.hostileTags[e],e)})(s),children:e.name},s)))]})})})]})},nn=[0,0,5,10,15,25,50,75,100],sn=[0,0,1,5,5,5,10,10,20],rn=[-10,-1,5,10,20,10,5,-1,-5],on=e=>{let{combatState:t}=e;const a=rn.length,s=Rt(),r=s.getCombatManager(),i=s.getPartyManager(),o=(s.getChatManager(),s.getCampaignManager()),l=e=>{const t=e.riskCenter;return[Math.max(t-e.nbEnemies,0),Math.min(t+e.nbEnemies,a-1)]},c=o.getCollectedTones(),[d,u]=(0,n.useState)(sn),[h,m]=(0,n.useState)(nn),[g,p]=(0,n.useState)([]),[f,v]=(0,n.useState)(l(t)),[y,b]=(0,n.useState)(null),[E,x]=(0,n.useState)(!1),[N,T]=(0,n.useState)(null),[C,A]=(0,n.useState)(null),S=!(!c.grim||3!==c.grim),M=(0,n.useRef)({danger:h,stress:d,engagement:g});(0,n.useEffect)((()=>{M.current={danger:h,stress:d,engagement:g}}),[h,d,g]),(0,n.useEffect)((()=>{if(r.setCombatBarAnimating(E),!E)switch(console.log("DONE ANIMATING"+N+" : "+t.round.phase),t.round.phase){case"balance":const e=l(t);console.log("NEW RANGE: "+e),v(e);break;case"setup":null!==C&&(r.modifyCombatRangeCenter(C),T(null))}}),[E]),(0,n.useEffect)((()=>{let e=!1;return k(t),j(t),r.on("combatStateChange",(e=>{if(r){j(t),k(t);const e=l(t);v(e)}})),r.on("combatPhaseChange",(t=>{switch(console.log("Phase change ! "+t.round.phase),t.round.phase){case"setup":E||(console.log("WHATSUUUUP "+e),e=!0,A(I([0,a-1])),b(null));break;case"heroes_attack":case"heroes_resolve":case"enemy_resolve_damage":default:break;case"enemies_attack":A(I(l(t)))}})),()=>{r.removeAllListeners("combatStateChange"),r.removeAllListeners("combatPhaseChange")}}),[r]);const j=e=>{const t=e.enemyStats.attack[0],a=i.getPartyStrength(),n=t*t/(a*a),s=[0,1,5,10,25,50,75,80,90,100].map(((t,a)=>{let s=Math.ceil(t*n);return 1===e.nbEnemies?s*=.8:3===e.nbEnemies&&(s*=1.6),9===a&&(s*=2),8===a&&(s*=1.5),s=5*Math.ceil(s/5),s=Math.min(s,100),s}));m(s),w(s)},w=e=>{const t=[];e.forEach(((e,a)=>{const n=R(e);t.push(n)})),u(t)},R=e=>{let t=0;return t=e<=10?1:e<=25?5:e<=40?10:e<=50?15:e<=80?20:e<=90?25:30,t},k=e=>{const t=[];let a=0;rn.forEach(((n,s)=>{const r=n*(.5*e.nbEnemies);let i=r<0?Math.floor(r):Math.ceil(r);i>a?a=i:S&&(i=a),t.push(i)})),p(t)},I=e=>{const t=Math.floor(Math.random()*(e[1]-e[0]+1))+e[0];return _(e,t),T(t),(e=>{r.setPerilResult([e,M.current.danger[e],M.current.stress[e],M.current.engagement[e]])})(t),t},O=(e,t)=>{const a=Math.min(...e),n=Math.max(...e);return e.map((e=>r.generateColorFromValue(e,a,n,t)))},L=O(h,"danger"),P=O(d,"stress"),D=O(g,"engagement"),U=e=>{const n="danger"===e?L:"stress"===e?P:D,s="danger"===e?h:"stress"===e?d:g,r="balance"===t.round.phase||"setup"===t.round.phase&&E;return Array.from({length:a},((t,a)=>(0,Xe.jsxs)("div",{className:`combat-bar-segment  \n                ${r||a>=f[0]&&a<=f[1]?"in-range":""}\n                ${a===y?"highlighted":""}\n                ${E?"animating":""}\n                ${null===N?"":a===N?"positive-result":"negative-result"}\n            `,style:{backgroundColor:n[a]||"",color:"stress"===e&&s[a]>10?"#777777ff":""},children:["danger"!==e&&s[a]>0?"+":"",s[a],"danger"===e?"%":""]},a)))},_=(e,a)=>{x(!0);let n=1,s=e[0],i=50;const o=()=>{var l;b(s),"setup"===(null===(l=r.getCombatState())||void 0===l?void 0:l.round.phase)&&v([Math.max(0,s-t.nbEnemies),Math.min(8,s+t.nbEnemies)]),i<300?(s+=n,s>=e[1]?(n=-1,s=e[1]):s<=e[0]&&(n=1,s=e[0]),i*=1.1,setTimeout(o,i)):s!==a?(s+=n,s>=e[1]?(n=-1,s=e[1]):s<=e[0]&&(n=1,s=e[0]),setTimeout(o,i)):(b(a),x(!1))};o()},B=(e,t,a,n)=>{r.combatModifiersCallback(e,t,a,n)},F=(e,t,a)=>{r.combatantCallback(e,t,a)};return(0,Xe.jsxs)("div",{className:"combat-peril-row",children:[(0,Xe.jsx)("div",{className:`combat-bar-modifiers left ${"setup"===t.round.phase?"show-arrow":""} `,children:"balance"===t.round.phase?(0,Xe.jsx)(an,{combatantCallback:F,side:"heroes",combatState:t}):"setup"===t.round.phase?(0,Xe.jsx)(tn,{modifierCallback:B,side:"heroes",combatState:t,disabled:E}):null}),(0,Xe.jsx)("div",{className:"combat-bar-container",children:(0,Xe.jsxs)("div",{className:"combat-bar",children:[(0,Xe.jsx)("div",{className:"combat-bar-range-indicator",children:(0,Xe.jsx)($a,{min:f[0],max:f[1],totalSegments:a,isGrim:S})}),(0,Xe.jsx)("div",{className:"segment-container danger",children:U("danger")}),(0,Xe.jsx)("div",{className:"segment-container stress",children:U("stress")}),(0,Xe.jsx)("div",{className:"segment-container engagement",children:U("engagement")})]})}),(0,Xe.jsx)("div",{className:`combat-bar-modifiers right ${"setup"===t.round.phase?"show-arrow":""} `,children:"balance"===t.round.phase?(0,Xe.jsx)(an,{combatantCallback:F,side:"enemies",combatState:t}):"setup"===t.round.phase?(0,Xe.jsx)(tn,{modifierCallback:B,side:"enemies",combatState:t,disabled:E}):null})]})};var ln=a(7284),cn=a.n(ln);const dn={[Na.D.GOBLINS.name]:{defense:[2],magic_defense:[0],health:[5],attack:[2]},[Na.D.GNOMES.name]:{defense:[3],magic_defense:[3],health:[10],attack:[3]},[Na.D.DRAGONS.name]:{defense:[10],magic_defense:[10],health:[100],attack:[10]},[Na.D.UNDEAD.name]:{defense:[5],magic_defense:[5],health:[20],attack:[5]},[Na.D.BEASTS.name]:{defense:[5],magic_defense:[0],health:[20],attack:[5]},[Na.D.CULTISTS.name]:{defense:[2],magic_defense:[5],health:[10],attack:[3]},[Na.D.BANDITS.name]:{defense:[3],magic_defense:[0],health:[10],attack:[3]},[Na.D.MONSTERS.name]:{defense:[5],magic_defense:[5],health:[20],attack:[5]},[Na.D.HUMANS.name]:{defense:[5],magic_defense:[5],health:[20],attack:[5]},[Na.D.ELVES.name]:{defense:[5],magic_defense:[5],health:[20],attack:[5]},[Na.D.DWARVES.name]:{defense:[5],magic_defense:[5],health:[20],attack:[5]},[Na.D.ORCS.name]:{defense:[5],magic_defense:[5],health:[20],attack:[5]},[Na.D.HALFLINGS.name]:{defense:[5],magic_defense:[5],health:[20],attack:[5]},[Na.D.HALF_ELVES.name]:{defense:[5],magic_defense:[5],health:[20],attack:[5]}},un={health:[1],attack:[1],defense:[1],magic_defense:[1]};class hn extends(cn()){constructor(e){super(),this.appManager=void 0,this.characterManager=void 0,this.campaignManager=void 0,this.playerManager=void 0,this.uiManager=void 0,this.chatManager=void 0,this.combatState=void 0,this.partyManager=void 0,this.getCombatMessage=()=>{if(this.combatState)switch(this.combatState.round.phase){case"balance":return"Balance the combat by changing the number or type of enemies and/or add NPCs.";case"setup":return this.combatState.barAnimating?`The players and ${this.combatState.enemyType.name} ready themselves themselves and we see how dangerous this round will be... `:"Balance the fight by using established elements of the environment to make the combat more or less dangerous. Or simply fudge the dice...";case"heroes_attack":return"done in component";case"heroes_resolve":return"Now the enemies will attack! This will determine the chance of injury to the party.";case"enemies_attack":return this.combatState.barAnimating?"Determining the danger and excitement of this round...":`There is a ${this.combatState.perilResult[r.c0.DANGER]}% chance of a party injury.`;case"enemy_resolve_damage":return this.combatState.combatMessage;default:return""}},setTimeout((()=>{this.appManager=e,this.characterManager=e.getCharacterManager(),this.campaignManager=e.getCampaignManager(),this.playerManager=e.getPlayerManager(),this.uiManager=e.getUiManager(),this.chatManager=e.getChatManager(),this.partyManager=e.getPartyManager()}),0)}getCombatState(){return this.combatState}generateCombatRewards(){if(this.combatState)switch(this.combatState.nbEnemies){case 1:default:this.combatState.rewards=1;break;case 2:this.combatState.rewards=3;break;case 3:this.combatState.rewards=5}}generateCombatState(e,t){var a,n,s;if(!e.combat||!e.combat[t])return;if(this.combatState)return this.combatState;const r=e.combat[t],i=r.enemy,o={round:{number:0,phase:"balance"},attacker:"heroes",currentCharacterIndex:0,currentEnemyIndex:0,nbEnemies:r.nbEnemies,enemyType:i,enemyStats:dn[i.name]||{...un},riskCenter:4,usedTags:(null===(a=this.appManager)||void 0===a?void 0:a.getTagManager().locationTagsCollected.map((()=>!1)))||[],hostileTags:(null===(n=this.campaignManager)||void 0===n?void 0:n.getHostileCombatantTags(i.name))||[],friendlyTags:(null===(s=this.campaignManager)||void 0===s?void 0:s.getFriendlyCombatantTags())||[],npcs:[],rewards:1,perilResult:[0,0,0,0],heroAttacks:{},enemyStatsInstance:{health:1,attack:1,defense:1,magic_defense:1}};return this.updateCombatState(o),this.generateCombatRewards(),o}static GetDefaultCombatState(){return{round:{number:0,phase:"balance"},attacker:"heroes",currentCharacterIndex:0,currentEnemyIndex:0,nbEnemies:1,enemyType:{name:"none"},enemyStats:{...un},riskCenter:5,usedTags:[],hostileTags:[],friendlyTags:[],npcs:[],perilResult:[0,0,0,0],heroAttacks:{},rewards:1,enemyStatsInstance:{health:1,attack:1,defense:1,magic_defense:1}}}modifyCombatRangeCenter(e){this.combatState&&(this.combatState.riskCenter=e,this.emit("combatStateChange",this.combatState))}updateCombatState(e){this.combatState=e,this.emit("combatStateChange",this.combatState)}applyPerilResultsToParty(){var e;if(!this.combatState)return;const t=this.combatState.perilResult[r.c0.STRESS];null===(e=this.partyManager)||void 0===e||e.addPartyTension(t)}setCombatBarAnimating(e){this.combatState&&(this.combatState.barAnimating=e,this.emit("combatStateChange",this.combatState))}advanceRound(){var e,t;if(this.combatState){switch(this.combatState.round.phase){case"balance":this.generateEnemyAttributeInstance(),this.combatState.round.phase="setup",this.generateHeroAttacks(),null===(e=this.chatManager)||void 0===e||e.combatIntroMessage(this.combatState.enemyType);break;case"setup":this.combatState.round.phase="heroes_attack",this.combatState.round.number++;break;case"heroes_attack":var a;if(this.combatState.enemyStatsInstance.health<=0)null===(a=this.uiManager)||void 0===a||a.showRewardModal(this.combatState.rewards||0,!0);else this.combatState.round.phase="heroes_resolve";break;case"heroes_resolve":this.combatState.round.phase="enemies_attack";break;case"enemies_attack":this.perilCheck(),this.combatState.round.phase="enemy_resolve_damage",this.applyPerilResultsToParty();break;case"enemy_resolve_damage":this.combatState.round.phase="setup",this.generateHeroAttacks(),null===(t=this.partyManager)||void 0===t||t.exhaustParty(this.getAttackActionCost());break;default:console.log("Unknown phase")}console.log("Changing phase to "+this.combatState.round.phase),this.emit("combatPhaseChange",this.combatState),this.emit("combatStateChange",this.combatState)}}perilCheck(){var e;const t=null===(e=this.combatState)||void 0===e?void 0:e.perilResult;if(!t)return;const a=Math.floor(100*Math.random());var n;a<t[r.c0.DANGER]?this.activatePeril():null===(n=this.chatManager)||void 0===n||n.dmMessage("You guys are safe this round.");this.combatState&&(this.combatState.combatMessage=`${t[r.c0.DANGER]}% chance of injury and rolled a ${a}.`)}activatePeril(){var e;if(void 0===this.combatState)return;let t=null===(e=this.partyManager)||void 0===e?void 0:e.generateHeroes(this.combatState.npcs||[]);if(void 0===t)return;let a=Math.floor(Math.random()*t.length);if(a<this.combatState.npcs.length){var n;this.combatState.npcs.splice(a,1),null===(n=this.chatManager)||void 0===n||n.dmMessage(`The ${t[a].name} were frigtened off!`)}else{var s;let e="";var r;if(t[a].character)e=(null===(r=this.partyManager)||void 0===r?void 0:r.addInjury(t[a].character))||"unknown injury";null===(s=this.chatManager)||void 0===s||s.dmMessage(`Oh no! ${t[a].name} is ${e}`)}}generateEnemyAttributeInstance(){var e,t,a;const n=((null===(e=this.getCombatState())||void 0===e?void 0:e.nbEnemies)||1)-1,s=(null===(t=this.getCombatState())||void 0===t?void 0:t.nbEnemies)||1,r=(null===(a=this.getCombatState())||void 0===a?void 0:a.enemyStats)||{...un},i={health:r.health[n]||r.health[0]*s,attack:r.attack[n]||r.attack[0]*s,defense:r.defense[n]||r.defense[0]*s,magic_defense:r.magic_defense[n]||r.magic_defense[0]*s};this.combatState&&(this.combatState.enemyStatsInstance=i)}generateHeroAttacks(){var e,t;if(!this.combatState)return;const a=null===(e=this.partyManager)||void 0===e?void 0:e.generateHeroes((null===(t=this.combatState)||void 0===t?void 0:t.npcs)||[]);null===a||void 0===a||a.forEach((e=>{this.combatState&&(this.combatState.heroAttacks[e.name]=this.generateAttack(e))}))}heroRethinkAttack(e){var t,a;if(!this.combatState)return;null===(t=this.campaignManager)||void 0===t||t.spendDMPoints(1);let n=this.combatState.heroAttacks[e.name],s=10;for(;n===this.combatState.heroAttacks[e.name]&&s-- >0;)this.combatState.heroAttacks[e.name]=this.generateAttack(e);let r=`${e.name} should really think of a different tactic.`;switch(Math.floor(3*Math.random())){case 0:r=`Do you really want ${e.name} to do that?`;break;case 1:r="That's stupid.";break;case 2:r=`You know ${e.name} has better options, right?`}null===(a=this.chatManager)||void 0===a||a.dmMessage(r),this.emit("combatStateChange",this.combatState)}getHeroAttackDecisionText(e){var t;const a=null===(t=this.combatState)||void 0===t?void 0:t.heroAttacks[e.name];if(!a)return"vxvxcvx";switch(a){case"combat":return`${e.name} attacks with their weapon!`;case"tools":return`${e.name} uses their tools!`;case"magic":return`${e.name} casts a spell!`;default:return"vxvxcvxvxvxc"}}generateAttack(e){let t={};var a;e.npcTag?(e.character=null===(a=this.characterManager)||void 0===a?void 0:a.generateNPC(e.npcTag),t=this.getNPCAttributes(e.npcTag)):t=Wt(e.character,!0);return t[r.Eh.MAGIC]&&t[r.Eh.MAGIC]>0&&Math.random()>.666?"magic":t[r.Eh.TOOLS]&&t[r.Eh.TOOLS]>0&&Math.random()>.5?"tools":"combat"}getNPCAttributes(e){let t=dn[e.name];return{[r.Eh.COMBAT]:Math.max(1,t.attack[0]),[r.Eh.MAGIC]:t.magic_defense[0],[r.Eh.TOOLS]:t.defense[0]}}heroAttack(e){var t,a,n;if(!this.combatState)return;let s;var i,o,l,c;e.character&&(s=null===(i=this.playerManager)||void 0===i?void 0:i.getPlayerAssignedCharacter(e.character),s&&(null===(o=this.partyManager)||void 0===o||o.playersTakeAction([s.name],!1),null===(l=this.partyManager)||void 0===l||l.stressAction([s]),null===(c=this.chatManager)||void 0===c||c.playerMessage(this.getHeroAttackDecisionText(e),s.id)));let d=Wt(e.character,!0);e.npcTag&&(d=this.getNPCAttributes(e.npcTag));const u=Wt(e.character);let h=0,m="combat",g=0,p="",f=!1;switch(this.combatState.heroAttacks[e.name]){case"combat":let s=Math.floor(Math.random()*(d[r.Eh.COMBAT]||0))+1;this.combatState.enemyStatsInstance.defense>0?(p="Defense",this.combatState.enemyStatsInstance.defense=Math.max(0,this.combatState.enemyStatsInstance.defense-s)):this.combatState.enemyStatsInstance.magic_defense>0?(p="Magic Defense",s=1,this.combatState.enemyStatsInstance.magic_defense=Math.max(0,this.combatState.enemyStatsInstance.magic_defense-1)):(p="Health",this.combatState.enemyStatsInstance.health=Math.max(0,this.combatState.enemyStatsInstance.health-s)),g=s,h=s,m="combat";break;case"tools":let i=1;Math.random()<.25&&(i=u[r.Eh.TOOLS],f=!0),this.combatState.enemyStatsInstance.defense>0?(p="Defense",this.combatState.enemyStatsInstance.defense=Math.max(0,this.combatState.enemyStatsInstance.defense-i)):this.combatState.enemyStatsInstance.magic_defense>0?(p="Magic Defense",this.combatState.enemyStatsInstance.magic_defense=Math.max(0,this.combatState.enemyStatsInstance.magic_defense-i)):(p="Health",this.combatState.enemyStatsInstance.health=Math.max(0,this.combatState.enemyStatsInstance.health-i)),null===(t=this.characterManager)||void 0===t||t.setAttributeUsed(e.character,r.Eh.TOOLS,1),h=i,m="tools",g=i;break;case"magic":const o=Math.min(d[r.Eh.MAGIC]||1,(null===(a=e.character)||void 0===a?void 0:a.level)||1),l=o*(Math.floor(3*Math.random())+2);this.combatState.enemyStatsInstance.magic_defense>0?(p="Magic Defense",this.combatState.enemyStatsInstance.magic_defense=Math.max(0,this.combatState.enemyStatsInstance.magic_defense-l)):this.combatState.enemyStatsInstance.defense>0?(p="Defense",this.combatState.enemyStatsInstance.magic_defense=Math.max(0,this.combatState.enemyStatsInstance.defense-l)):(p="Health",this.combatState.enemyStatsInstance.health=Math.max(0,this.combatState.enemyStatsInstance.health-l)),null===(n=this.characterManager)||void 0===n||n.setAttributeUsed(e.character,r.Eh.MAGIC,o),h=l,m="magic",g=o;break;default:console.log("Unknown attack type")}let v="";switch(m){case"combat":v="\u2694\ufe0f".repeat(g);break;case"tools":v="\ud83d\udd27".repeat(g);break;case"magic":v="\u2728".repeat(g)}let y=`${!0===f?"Crit! ":""}  ${v} = ${h} damage ${p}.`;return this.emit("combatStateChange",this.combatState),y}getAttackActionCost(){return this.combatState?this.combatState.round.number*Object.keys(this.combatState.heroAttacks).length:0}reduceEnemies(){var e;this.combatState&&(this.combatState.nbEnemies>1&&(this.combatState.nbEnemies--,null===(e=this.campaignManager)||void 0===e||e.spendDMPoints(1),this.generateCombatRewards(),this.emit("combatStateChange",this.combatState)))}increaseEnemies(){var e;this.combatState&&(this.combatState.nbEnemies<3&&(this.combatState.nbEnemies++,null===(e=this.campaignManager)||void 0===e||e.spendDMPoints(1),this.generateCombatRewards(),this.emit("combatStateChange",this.combatState)))}combatModifiersCallback(e,t,a,n){var s;this.combatState&&("heroes"===t?this.combatState.riskCenter-=e:this.combatState.riskCenter+=e,"DM"!==a.name&&(this.combatState.usedTags[n]=!this.combatState.usedTags[n]),this.emit("combatStateChange",this.combatState),null===(s=this.chatManager)||void 0===s||s.sayCombatModifiedMessage(t,a,this.combatState.enemyType,e))}combatantCallback(e,t,a){if(!this.combatState)return;t.friendly?this.combatState.friendlyTags.splice(a,1):this.combatState.hostileTags.splice(a,1),"enemies"===e?(this.combatState.enemyType.friendly?this.combatState.friendlyTags.push(this.combatState.enemyType):this.combatState.hostileTags.push(this.combatState.enemyType),this.setEnemyType(t)):this.combatState.npcs.push(t),this.generateCombatRewards(),this.emit("combatStateChange",this.combatState)}setEnemyType(e){this.combatState&&(this.combatState.enemyType=e,this.combatState.enemyStats=dn[e.name]||{...un},this.emit("combatStateChange",this.combatState))}setPerilResult(e){this.combatState&&(this.combatState.perilResult=e,this.emit("combatStateChange",this.combatState))}generateColorFromValue(e,t,a,n){let s,r={negative:{r:255,g:61,b:61},neutral:{r:255,g:139,b:105},positive:{r:255,g:0,b:0}};switch(n){case"danger":r={negative:{r:255,g:255,b:255},neutral:{r:179,g:139,b:105},positive:{r:200,g:25,b:20}};break;case"stress":r={negative:{r:255,g:255,b:255},neutral:{r:130,g:130,b:130},positive:{r:0,g:0,b:0}};break;case"engagement":r={negative:{r:139,g:61,b:61},neutral:{r:179,g:139,b:105},positive:{r:92,g:148,b:87}};break;case"reward":r={negative:{r:255,g:255,b:255},neutral:{r:255,g:255,b:255},positive:{r:255,g:215,b:0}}}if(e<0){const a=(e-t)/(0-t);s={r:Math.round(r.negative.r+(r.neutral.r-r.negative.r)*a),g:Math.round(r.negative.g+(r.neutral.g-r.negative.g)*a),b:Math.round(r.negative.b+(r.neutral.b-r.negative.b)*a)}}else{const t=e/a;s={r:Math.round(r.neutral.r+(r.positive.r-r.neutral.r)*t),g:Math.round(r.neutral.g+(r.positive.g-r.neutral.g)*t),b:Math.round(r.neutral.b+(r.positive.b-r.neutral.b)*t)}}return`#${s.r.toString(16).padStart(2,"0")}${s.g.toString(16).padStart(2,"0")}${s.b.toString(16).padStart(2,"0")}`}}const mn=hn,gn=(pn=e=>{let{onClick:t,className:a,children:n}=e;return(0,Xe.jsx)("div",{className:`themed-button ${a||""}`,onClick:()=>{},children:n})},e=>{const t=kt(),[a,s]=(0,n.useState)(null);(0,n.useEffect)((()=>{if(Math.random()<.25){const e=Object.values(r.Co),t=e[Math.floor(Math.random()*e.length-1)];s(t)}}),[e.regenerateKey]);const i=a?`${e.className||""} theme-${a}`:e.className;return(0,Xe.jsxs)("div",{className:"theme-wrapper",onClick:n=>{e.onClick&&e.onClick(a),a&&t.themedUiClicked(a),s(null)},children:[(0,Xe.jsx)(pn,{...e,className:i}),a&&(0,Xe.jsx)("div",{className:"tag-tooltip",children:`This action will be done in a ${a} way`})]})});var pn;const fn=e=>{var t,a,s,i;let{encounter:o}=e;const l=Rt(),c=Ot(),d=l.getCombatManager(),u=(l.getCharacterManager(),l.getPartyManager()),h=(null===d||void 0===d?void 0:d.generateCombatState(o,0))||mn.GetDefaultCombatState(),[m,g]=(0,n.useState)(!1),[p,f]=(0,n.useState)(),[v,y]=(0,n.useState)(h.nbEnemies),[b,E]=(0,n.useState)(h.enemyType),[x,N]=(0,n.useState)(h.perilResult),[T,C]=(0,n.useState)(!1),[A,S]=(0,n.useState)(),[M,j]=(0,n.useState)(h.rewards||1),[w,R]=(0,n.useState)(u.generateHeroes(h.npcs)),[k,I]=(0,n.useState)(w.map((()=>"false"))),O=e=>{var t,a;const n=((null===d||void 0===d||null===(t=d.getCombatState())||void 0===t?void 0:t.nbEnemies)||1)-1,s=(null===d||void 0===d||null===(a=d.getCombatState())||void 0===a?void 0:a.nbEnemies)||1;return{health:e.health[n]||e.health[0]*s,attack:e.attack[n]||e.attack[0]*s,defense:e.defense[n]||e.defense[0]*s,magic_defense:e.magic_defense[n]||e.magic_defense[0]*s}};(0,n.useEffect)((()=>(d.on("combatStateChange",(e=>{y(e.nbEnemies),E(e.enemyType),R(u.generateHeroes(e.npcs)),N(e.perilResult),j(e.rewards||1),"balance"===e.round.phase?f(O(e.enemyStats)):f(e.enemyStatsInstance),"setup"===e.round.phase&&I(Object.keys(e.heroAttacks).map((()=>"false"))),S(e.combatMessage),C(e.barAnimating||!1)})),f(O(h.enemyStats)),()=>{d.removeAllListeners("combatStateChange")})),[d,o]);const L=e=>{e<1?d.reduceEnemies():d.increaseEnemies()},P=o.combat?null===(t=o.combat[0])||void 0===t?void 0:t.description:"";return(0,Xe.jsxs)("div",{className:"game-encounter-combat",children:[(0,Xe.jsx)("div",{className:"combat-encounter-upper-container",children:(0,Xe.jsxs)("div",{className:"combat-encounter-header",children:[(0,Xe.jsxs)("div",{className:"combat-encounter-header-title",children:["Combat Event in ",o.location.name]}),(0,Xe.jsx)("div",{className:"combat-encounter-description",children:P})]})}),(0,Xe.jsxs)("div",{className:"combat-encounter-body-container",children:[(0,Xe.jsx)(on,{combatState:h}),(0,Xe.jsxs)("div",{className:"combat-encounter-enemies-row",children:[(()=>{if("heroes_attack"===h.round.phase)return(0,Xe.jsx)("div",{className:"combat-message-container",children:(0,Xe.jsxs)("div",{className:"combat-message-legend",children:[(0,Xe.jsx)("div",{className:"combat-message-legend-item",children:"\u2694\ufe0f:  1-\u2694\ufe0f to Health or Defense."}),(0,Xe.jsx)("div",{className:"combat-message-legend-item",children:"\u2694\ufe0f:  1 to Magic Defense."}),(0,Xe.jsx)("div",{className:"combat-message-legend-item",children:"\ud83d\udd27:  1 to anything"}),(0,Xe.jsx)("div",{className:"combat-message-legend-item",children:"\ud83d\udd27:  Chance to crit for \ud83d\udd27"}),(0,Xe.jsx)("div",{className:"combat-message-legend-item",children:"\u2728:  2-4 Damage to anything."}),(0,Xe.jsx)("div",{className:"combat-message-legend-item",children:"\u2728:  at higher levels"}),(0,Xe.jsx)("br",{}),(0,Xe.jsx)("div",{className:"combat-message-legend-item",children:"\ud83d\udd27 / \u2728: limited uses"})]})});let e=d.getCombatMessage();return(0,Xe.jsx)("div",{className:"combat-message-container",children:(0,Xe.jsx)("div",{className:"combat-message",children:e})})})(),(0,Xe.jsxs)("div",{className:"combat-encounter-enemies",children:[(0,Xe.jsxs)("div",{className:"combat-encounter-enemies-number",children:["balance"===h.round.phase&&(0,Xe.jsxs)("div",{className:"combat-enemies-ui",onClick:()=>L(-1),children:[(0,Xe.jsx)(en,{baseDie:20,displayNumber:"1"}),"less"]}),(0,Xe.jsx)("div",{className:"combat-encounter-enemies-list",children:(()=>{const e=[],t=[0,1,3,5,7];for(let a=0;a<t[v];a++)e.push((0,Xe.jsx)("div",{className:`enemy-icon enemy-type-${b.name}`,children:(0,Xe.jsx)(Je,{imageId:`combat_${b.name}`})},`${a}`));return e})()}),"balance"===h.round.phase&&(0,Xe.jsxs)("div",{className:"combat-enemies-ui",onClick:()=>L(1),children:[(0,Xe.jsx)(en,{baseDie:20,displayNumber:"1"}),"more"]})]}),(0,Xe.jsx)("div",{className:"combat-encounter-enemies-attributes",children:(0,Xe.jsxs)("div",{className:"combat-encounter-enemies-attributes-display",children:[(0,Xe.jsxs)("div",{className:"combat-enemy-attribute defense",children:[(0,Xe.jsx)("div",{className:"combat-enemy-attribute-title",children:"Defense"}),(0,Xe.jsx)("div",{className:"combat-enemy-attribute-value",children:null===p||void 0===p?void 0:p.defense})]}),(0,Xe.jsxs)("div",{className:"combat-enemy-attribute magic-defense",children:[(0,Xe.jsx)("div",{className:"combat-enemy-attribute-title",children:"Magic Defense"}),(0,Xe.jsx)("div",{className:"combat-enemy-attribute-value",children:null===p||void 0===p?void 0:p.magic_defense})]}),(0,Xe.jsxs)("div",{className:"combat-enemy-attribute health",children:[(0,Xe.jsx)("div",{className:"combat-enemy-attribute-title",children:"Health"}),(0,Xe.jsx)("div",{className:"combat-enemy-attribute-value",children:null===p||void 0===p?void 0:p.health})]})]})}),(0,Xe.jsx)("div",{className:"combat-encounter-enemies-header",children:(0,Xe.jsx)("div",{className:"combat-encounter-enemy-name",children:b.name})})]}),(0,Xe.jsx)("div",{className:"combat-advance-box",children:(0,Xe.jsx)("div",{className:`combat-encounter-advance-button-container ${T?"disabled":""} `,onClick:()=>null===d||void 0===d?void 0:d.advanceRound(),children:(0,Xe.jsxs)("div",{className:"combat-encounter-advance-button",children:[(()=>{switch(h.round.phase){case"balance":return"Begin Fight";case"setup":return"Heroes Attack";case"heroes_attack":return h.enemyStatsInstance.health<=0?"End Combat":w.every(((e,t)=>"false"!==k[t]))?"Continue":"Skip Hero Attack";case"heroes_resolve":return"Enemies Attack";case"enemies_attack":return h.barAnimating?"...":"Resolve Peril";case"enemy_resolve_damage":return"End Round";default:return""}})(),"enemy_resolve_damage"===h.round.phase&&d.getAttackActionCost()>0&&(0,Xe.jsxs)("div",{className:"combat-button-exhaustion-label",children:["+",d.getAttackActionCost()," Exhaustion"]}),"heroes_attack"===h.round.phase&&h.enemyStatsInstance.health<=0&&(0,Xe.jsxs)("div",{className:"combat-button-exhaustion-label",children:["+",null===(a=d.getCombatState())||void 0===a?void 0:a.perilResult[r.c0.SCORE]," Score"]}),"enemies_attack"===h.round.phase&&!h.barAnimating&&(0,Xe.jsxs)("div",{children:[(0,Xe.jsxs)("div",{className:"combat-button-exhaustion-label",children:["+",null===(s=d.getCombatState())||void 0===s?void 0:s.perilResult[r.c0.STRESS]," Tension"]}),(0,Xe.jsxs)("div",{className:"combat-button-exhaustion-label",children:["+",null===(i=d.getCombatState())||void 0===i?void 0:i.perilResult[r.c0.SCORE]," Score"]})]})]})})})]}),M?(0,Xe.jsxs)("div",{className:"combat-encounter-rewards",children:[(0,Xe.jsx)("div",{className:"combat-encounter-rewards-title",children:"Players will expect"}),(0,Xe.jsxs)("div",{className:"combat-encounter-rewards-list",children:[M," rewards"]})]}):null,(0,Xe.jsx)("div",{className:"combat-encounter-heroes",children:w&&w.map(((e,t)=>(0,Xe.jsxs)("div",{className:"combat-encounter-hero-row",children:[(e.npcTag||e.character&&"dead"!==e.character.injury)&&"heroes_attack"===h.round.phase&&(0,Xe.jsxs)("div",{className:"combat-hero-attack-results-container",children:[(0,Xe.jsx)(gn,{className:"combat-hero-button "+("false"!==k[t]?"acted":""),onClick:()=>((e,t)=>{const a=[...k];a[t]=(null===d||void 0===d?void 0:d.heroAttack(e))||"false",I(a)})(e,t),children:"false"===k[t]?d.getHeroAttackDecisionText(e):k[t]}),(0,Xe.jsxs)("div",{className:`combat-hero-button ${"false"===k[t]?"":"hide"} `,onClick:()=>null===d||void 0===d?void 0:d.heroRethinkAttack(e),children:[(0,Xe.jsx)("div",{className:"combat-sure-text",children:"'Are you Sure?'"}),(0,Xe.jsx)(en,{baseDie:20,displayNumber:"1"})]})]}),(0,Xe.jsxs)("div",{className:"combat-encounter-hero-container",children:[(0,Xe.jsxs)("div",{className:"combat-encounter-hero",children:[(0,Xe.jsx)("div",{className:"combat-encounter-hero-name",children:c.getHeroFirstName(e.name)}),(0,Xe.jsx)("div",{className:"combat-character-icon",children:(0,Xe.jsx)(Je,{imageId:e.icon})}),e.character&&"injured"===e.character.injury&&(0,Xe.jsx)("div",{className:"combat-encounter-hero-injury"}),e.character&&"dead"===e.character.injury&&(0,Xe.jsx)("div",{className:"combat-encounter-hero-injury dead"})]}),(0,Xe.jsx)("div",{className:"combat-encounter-hero-attributes",children:(0,Xe.jsx)(Yt,{hero:e,category:r.lq.ALL,showAttributeLoss:!0})})]})]},e.name)))})]})]})},vn=e=>{let{encounter:t}=e;return(0,Xe.jsx)("div",{className:"game-encounter-combat",children:(0,Xe.jsx)("div",{className:"encounter-type-title",children:"Exploration"})})},yn=e=>{let{title:t,description:a,leftContent:n,rightContent:s,centerContent:r,instructions:i=[!1,!1],childClass:o=""}=e;return(0,Xe.jsx)("div",{className:"encounter-header",children:(0,Xe.jsxs)("div",{className:"encounter-header-content",children:[n&&(0,Xe.jsx)("div",{className:`encounter-header-left ${i[0]?"with-instructions":""}  ${o||""}  `,children:n}),(0,Xe.jsx)("div",{className:"encounter-header-center",children:r||(0,Xe.jsxs)(Xe.Fragment,{children:[(0,Xe.jsx)("div",{className:"encounter-header-title",children:t}),a&&(0,Xe.jsx)("div",{className:"encounter-header-description",children:a})]})}),s&&(0,Xe.jsx)("div",{className:`encounter-header-right ${i[1]?"with-instructions":""} ${o||""}`,children:s})]})})},bn=e=>{let{tooltip:t,visible:a,preservePositioning:n,translate:s,children:r}=e;return a?(0,Xe.jsx)(ra,{content:t,preservePositioning:n,translate:s,children:r}):(0,Xe.jsx)(Xe.Fragment,{children:r})},En=e=>{let{theme:t,tag:a,message:n}=e;return(0,Xe.jsx)("div",{className:`tooltip theme-${t}`,children:(0,Xe.jsx)("div",{className:"tooltip-content",children:n})})},xn=e=>{let{encounter:t}=e;const a=wt(),s=kt(),i=Ot(),o=Rt(),l=o.getChatManager(),c=o.getTagManager(),d=o.getPartyManager(),u=a.getAllPlayerCharacters(),[h,m]=(0,n.useState)(u.map((()=>!1))),[g,p]=(0,n.useState)(u.map((()=>!1))),[f,v]=(0,n.useState)([]),y=(e,t)=>{const a=[...h],n=[...f];n[t]=s.getPerceptionTags(e),h[t]||(0!==h.filter((e=>e)).length&&d.perceptionEventReveal(e),a[t]=!0),m(a),v(n)},b=e=>i.getPlayerAttitudesStyle(e),E=(e,t,a)=>{let n="";const i=s.getCampaignTooltipForTag(e);if(i)return i;switch(f[t].type){case r.lM.CURRENT_LOCATION:n=`The character carefully examines ${e.tag.name}.`;break;case r.lM.BRANCH_LOCATION:n=`Reveal hints connecting ${e.tag.name} to an upcoming encounter.`;break;case r.lM.CHARACTER_BACKSTORY:n="Connect the player's backstory to this new topic.";break;case r.lM.CHARACTER_BACKSTORY_PROGRESS:n=`Reveal ${e.tag.name}, which relates to a character's backstory.`;break;case r.lM.MAGIC_ITEM:n="Reveal a magic item."}switch(e.theme){case"comedic":n+=" The players find something funny about this.";break;case"grim":n+=" this is discussed in a grim manner";break;case"fantasy":n+=" the discussion around this is fantastical";break;case"heroic":n+=" this evokes a feeling of heroism";break;case"horror":n+=" something about this is scary";break;case"romantic":n+=" this is discussed with romantic undertones";break;case"serious":n+=" the players take this very seriously";break;case"dramatic":n+=" the table gets very dramatic about this"}return n},x=e=>{switch(f[e].type){case r.lM.CURRENT_LOCATION:return(0,Xe.jsxs)("div",{className:"perception-display current-location",children:[(0,Xe.jsxs)("div",{className:"perception-description",children:["Nothing interesting found. Simply learned basic info about ",f[e].name,":"]}),(0,Xe.jsx)("div",{className:"perception-tags",children:f[e].tags.map(((t,a)=>(0,Xe.jsxs)("div",{className:`perception-tag text-pill type-${t.source} ${b(t.tag)} theme-${t.theme}`,children:[t.tag.name,t.theme&&(0,Xe.jsx)(En,{theme:"",tag:t.tag,message:E(t,e)})]},a)))})]});case r.lM.BRANCH_LOCATION:return(0,Xe.jsxs)("div",{className:"perception-display branch-location",children:[(0,Xe.jsxs)("div",{className:"perception-description",children:["Learned some things about an upcoming encounter called ",f[e].name," which may be interesting:"]}),(0,Xe.jsx)("div",{className:"perception-tags",children:f[e].tags.map(((t,a)=>(0,Xe.jsxs)("div",{className:`perception-tag text-pill type-foreshadowing ${b(t.tag)} theme-${t.theme}`,children:[t.tag.name,t.theme&&(0,Xe.jsx)(En,{theme:"",tag:t.tag,message:E(t,e)})]},a)))})]});case r.lM.CHARACTER_BACKSTORY:return(0,Xe.jsxs)("div",{className:"perception-display backstory",children:[(0,Xe.jsxs)("div",{className:"perception-description",children:["Shocking new information revealed about ",f[e].name,"'s Backstory!"]}),(0,Xe.jsx)("div",{className:"perception-tags",children:f[e].tags.map(((t,a)=>(0,Xe.jsxs)("div",{className:`perception-tag text-pill expected ${b(t.tag)} theme-${t.theme}`,children:[t.tag.name,t.theme&&(0,Xe.jsx)(En,{theme:"",tag:t.tag,message:E(t,e)})]},a)))})]});case r.lM.CHARACTER_BACKSTORY_PROGRESS:return(0,Xe.jsxs)("div",{className:"perception-display backstory",children:[(0,Xe.jsxs)("div",{className:"perception-description",children:["Confirmation regarding ",f[e].name,"'s Backstory:"]}),(0,Xe.jsx)("div",{className:"perception-tags",children:f[e].tags.map(((t,a)=>(0,Xe.jsxs)("div",{className:`perception-tag text-pill expected ${b(t.tag)} theme-${t.theme}`,children:[t.tag.name,t.theme&&(0,Xe.jsx)(En,{theme:"",tag:t.tag,message:E(t,e)})]},a)))})]});case r.lM.MAGIC_ITEM:let t=c.magicItemRumors.includes(f[e].tags[0].tag);return f.forEach(((a,n)=>{g[n]&&a.type===r.lM.MAGIC_ITEM&&a.tags.forEach((a=>{a.tag.name===f[e].tags[0].tag.name&&(t=!1)}))})),(0,Xe.jsxs)("div",{className:"perception-display magic-item",children:[(0,Xe.jsx)("div",{className:"perception-description",children:t?"Discovered a Magic Item you have heard of!":"Learned about a nearby Magic Item."}),(0,Xe.jsx)("div",{className:"perception-tags",children:f[e].tags.map(((a,n)=>(0,Xe.jsxs)("div",{className:`perception-tag text-pill ${t?"":"expected"}  type-${a.source} ${b(a.tag)} theme-${a.theme}`,children:[a.tag.name,a.theme&&(0,Xe.jsx)(En,{theme:"",tag:a.tag,message:E(a,e)})]},n)))})]});case r.lM.PLOT_HOOK:return(0,Xe.jsxs)("div",{className:"perception-display-campaign-container",children:[(0,Xe.jsxs)("div",{className:"perception-description",children:[s.getCampaignName()," Progress:"]}),(0,Xe.jsxs)("div",{className:"perception-display plot-hook",children:[(0,Xe.jsx)("div",{className:"campaign-icon",children:(0,Xe.jsx)(Je,{imageId:s.getCampaignIcon()})}),(0,Xe.jsxs)("div",{className:"campaign-plot-hook",children:[(0,Xe.jsx)("b",{children:f[e].tags[0].tag.name})," ",`${s.getNextPlotHookText()}`]})]})]})}};return(0,Xe.jsxs)("div",{className:"game-encounter-perception",children:[(0,Xe.jsx)(yn,{title:`Perception in ${t.location.name}`,description:"Characters can search for clues and information",rightContent:(0,Xe.jsxs)("div",{className:"perception-stats",children:["Revealed: ",h.filter((e=>e)).length,"/",u.length]})}),(0,Xe.jsx)("div",{className:"perception-container",children:(0,Xe.jsx)("div",{className:"character-list",children:u.map(((e,t)=>(0,Xe.jsxs)("div",{className:"perception-row",children:[(0,Xe.jsx)("div",{className:"character-container",children:(0,Xe.jsxs)("div",{className:"character-display",children:[(0,Xe.jsx)("div",{className:"character-name",children:e.name.split(" ")[0]}),(0,Xe.jsx)("div",{className:"character-icon",children:(0,Xe.jsx)(Je,{imageId:e.icon})})]})}),h[t]?(0,Xe.jsxs)("div",{className:"character-perception-tags-container",children:[x(t),g[t]?(0,Xe.jsx)("div",{className:"character-perception-buttons",children:(0,Xe.jsx)("div",{className:"character-perception-accepted",children:"\u2713"})}):(0,Xe.jsxs)("div",{className:"character-perception-buttons",children:[(0,Xe.jsxs)("div",{className:"character-perception-reroll-button",onClick:()=>((e,t)=>{y(e,t),s.spendDMPoints(1)})(e,t),children:["REROLL",(0,Xe.jsx)(en,{baseDie:20,displayNumber:1})]}),(0,Xe.jsx)("div",{className:"character-perception-accept-button",onClick:()=>((e,t)=>{const a=[...g];a[t]=!0,p(a),s.acceptPerceptionTags(f[t],e),l.perceptionEvent(e,f[t])})(e,t),children:"ACCEPT"})]})]}):(0,Xe.jsx)("div",{className:"character-perception-reveal-button",onClick:()=>y(e,t),children:(0,Xe.jsx)("div",{className:"reveal-title",children:"PERCEPTION CHECK"})})]},t)))})})]})},Nn=e=>{let{instructions:t}=e;return(0,Xe.jsxs)("div",{className:"encounter-instructions",children:[(0,Xe.jsx)("div",{className:"tooltip-help-icon",children:(0,Xe.jsx)("span",{className:"tooltip-help-icon-text",children:"i"})}),t.map(((e,t)=>(0,Xe.jsx)("div",{className:"encounter-instructions-text",children:e},`instruction-${t}`)))]})},Tn=[{text:"Organic Conversation",top:"4%",score:2},{text:"Guided Interactions",top:"39%",score:1},{text:"Off Topic",top:"74%",score:0}],Cn=e=>{var t;let{encounter:a}=e;const s=Ot(),i=kt(),o=Rt(),l=o.getChatManager(),c=o.getPartyManager(),d=(jt(),wt()),u=o.getTagManager(),[h,m]=(0,n.useState)([]),[g,p]=(0,n.useState)((()=>i.generateRoleplayEventTags())),[f,v]=(0,n.useState)(5),y=(0,n.useRef)(null);(0,n.useEffect)((()=>{const e=[],t=[{min:5,max:20},{min:40,max:55},{min:77,max:88}],a=(e,t,a)=>Math.abs(parseFloat(e.top)-parseFloat(t))<10&&Math.abs(parseFloat(e.left)-parseFloat(a))<15;g.forEach((()=>{let n,s,r,i=0;do{i++;const o=Math.floor(3*Math.random()),l=t[o];n=`${l.min+Math.random()*(l.max-l.min)}%`,s=80*Math.random()+"%",r=e.some((e=>a(e,n,s)))}while(r&&i<100);e.push({top:n,left:s})})),m(e)}),[g]),(0,n.useEffect)((()=>{const e=()=>{const e=y.current;if(!e)return;const t=e.getBoundingClientRect();e.querySelectorAll("[data-tooltip], .encounter-rp-icon, .encounter-flavor-tag").forEach((e=>{try{const a=e.querySelector('.tooltip-text, [role="tooltip"]');if(!a)return;a.style.visibility="hidden",a.style.display="block",a.style.opacity="1";const n=a.getBoundingClientRect(),s=e.getBoundingClientRect(),r=s.top-t.top,i=t.bottom-s.bottom,o=s.left-t.left,l=t.right-s.right;n.width>l&&o>l?(a.style.left="auto",a.style.right="0",a.style.transform="translateX(0)"):n.width>o&&l>o?(a.style.left="0",a.style.right="auto",a.style.transform="translateX(0)"):(a.style.left="50%",a.style.right="auto",a.style.transform="translateX(-50%)"),n.height>i&&r>i?(a.style.bottom="100%",a.style.top="auto"):(a.style.top="100%",a.style.bottom="auto"),a.style.visibility="visible",a.style.display="",a.style.opacity=""}catch(a){console.debug("Tooltip positioning skipped:",a)}}))},t=setTimeout(e,100);return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e),clearTimeout(t)}}),[h,g]);const b=(e,t)=>{const a=(e=>{const t=parseFloat(e);return t<=20?Tn[0].score:t<=55?Tn[1].score:Tn[2].score})(h[t].top);v(f-1),f>0&&i.collectEncounterPoints(a),i.selectRoleplayFlavorTag(e,f),p(i.generateRoleplayEventTags())},E=(null===(t=i.getCurrentEvent())||void 0===t?void 0:t.flavorText)||"",x=f>0?E:"You may keep roleplaying, but your players are growing bored.";return(0,Xe.jsxs)("div",{className:"encounter-roleplay-container",children:[(0,Xe.jsx)(yn,{title:`Roleplay in ${a.location.name}`,description:x,leftContent:(0,Xe.jsx)(Nn,{instructions:["Click on the topics below to discuss.","Players will lose attention after losing patience.","Increase tension by hurrying the players."]}),rightContent:(0,Xe.jsxs)("div",{className:"encounter-roleplay-skill-container",children:[(0,Xe.jsx)(qt,{totalSegments:5,filledSegments:f,theme:"engagement",label:"Party Patience"}),(0,Xe.jsx)("div",{className:"encounter-roleplay-hurry-button",onClick:()=>{f>0?(c.addPartyTension(10),v(f-1),l.dmMessage(["Lets moooove along!","Blah Blah blah","Theres a lot more game to get to."]),p(i.generateRoleplayEventTags())):i.backToOverview()},children:f>0?"Hurry Players":"End Roleplay"}),(0,Xe.jsx)("div",{className:"encounter-roleplay-hurry-text",children:f>0?"+10 Tension":""})]}),instructions:[!0,!1]}),(0,Xe.jsxs)("div",{className:`encounter-roleplay-flavor-tags-container  ${f<=0?"disabled":""} `,ref:y,children:[Tn.map(((e,t)=>(0,Xe.jsxs)("div",{className:`band-label ${f<=0?"disabled":""} `,style:{top:e.top},children:[e.text,(0,Xe.jsx)(Ka,{score:e.score,className:"band-score"})]},`band-label-${t}`))),g.map(((e,t)=>{return e.tag?(0,Xe.jsx)(aa,{tag:e.tag,style:h[t],onClick:()=>b(e,t),className:`text-pill theme-${e.tag.theme} type-${e.tag.source} ${o=e.tag.tag,s.getPlayerAttitudesStyle(o)}`,tooltipText:u.getTooltipText(e)},t):"treasure"===e.type?(0,Xe.jsx)(aa,{tag:{tag:{name:"Treasure"},source:r.UW.TREASURE,theme:r.Co.NONE},style:h[t],onClick:()=>b(e,t),tooltipText:u.getTooltipText(e),className:"encounter-flavor-tag"},t):"dmpoint"===e.type?(0,Xe.jsx)(aa,{tag:{tag:{name:"DM Point"},source:r.UW.DM_POINT,theme:r.Co.NONE},style:h[t],onClick:()=>b(e,t),tooltipText:u.getTooltipText(e),className:"encounter-flavor-tag"},t):(0,Xe.jsx)("div",{className:"encounter-rp-icon theme-character",style:h[t],"data-tooltip":`${u.getTooltipText(e)}`,onClick:()=>b(e,t),children:(0,Xe.jsx)(ra,{content:`Click to focus on ${null===(a=e.character)||void 0===a?void 0:a.name}. This may bore some of your players, but ${null===(n=d.getPlayerAssignedCharacter(e.character))||void 0===n?void 0:n.name} will like it.`,preservePositioning:!0,translate:[-30,-150],children:(0,Xe.jsx)("div",{className:"encounter-rp-icon-container",children:(0,Xe.jsx)(Je,{imageId:(null===(i=e.character)||void 0===i?void 0:i.icon)||"icon_character"})})})},t);var a,n,i,o}))]})]})},An=e=>{let{character:t,isSelected:a=!1,onClick:n,mini:s=!1,style:r={},"data-character-id":i,className:o=""}=e;return(0,Xe.jsxs)("div",{className:`character-token ${a?"selected":""} ${s?"mini":""}  ${o}`,onClick:n,style:r,"data-character-id":i,children:[(0,Xe.jsx)("div",{className:"character-icon",children:(0,Xe.jsx)(Je,{imageId:t.icon})}),!s&&(0,Xe.jsx)("div",{className:"character-name",children:t.name})]})},Sn=e=>{var t,a,n,s;let{building:i,onClick:o,isSelectable:l,"data-building-id":c,onCharacterClick:d,onTagClick:u}=e;const h=Rt(),m=(h.getTownManager(),h.getUiManager(),e=>{const t=e.value;let a=!1,n="",s="",i=";";switch(e.type){case r.Cu.CAMPAIGN_POINT:return(0,Xe.jsx)(Ka,{score:e.value});case r.Cu.ADD_TREASURE:a=!0,s="icon_treasure1";break;case r.Cu.ADD_ENJOYMENT:n=t>0?"\ud83d\ude0a":"\ud83d\ude1e";break;case r.Cu.ADD_TENSION:return n=""+t,t>0?(n="+"+n,i=" tension-up"):i=" tension-down",(0,Xe.jsxs)("div",{className:"effect-score",children:[(0,Xe.jsx)("div",{className:"effect-score-label",children:"TENSION"}),(0,Xe.jsx)("div",{className:"effect-score-value",children:n})]});case r.Cu.INJURE:n="\ud83d\udc94"}return a?(0,Xe.jsx)("div",{className:`effect-display-icon ${i}`,children:(0,Xe.jsx)(Je,{imageId:s})}):(0,Xe.jsx)("div",{className:`effect-emoji-display ${i}`,children:n})}),g=e=>{let t="",a="";switch(e.type){case r.Cu.ADD_TENSION:t=(e.value>0?"+":"")+e.value+" tension",a="tension-"+(e.value>0?"up":"down");break;case r.Cu.ADD_ENJOYMENT:t=e.value>0?"\ud83d\ude0a":"\ud83d\ude1e";break;case r.Cu.REPLENISH_MAGIC:t="\u2728";break;case r.Cu.REPLENISH_TOOLS:t="\ud83d\udd27";break;case r.Cu.HEAL:t="\u2764\ufe0f";break;case r.Cu.RESURRECT:t="\ud83d\udd04";break;case r.Cu.INJURE:t="\ud83d\udc94";break;case r.Cu.USE_TOOLS:a="use-tools",t="-\ud83d\udd27";break;case r.Cu.USE_MAGIC:a="use-magic",t="-\u2728";break;case r.Cu.ADD_TREASURE:return(0,Xe.jsx)("div",{className:"effect-display-icon",children:(0,Xe.jsx)(Je,{imageId:"icon_treasure1"})});default:t+=e.type}return(0,Xe.jsx)("div",{className:`town-effect-display ${a}`,children:t})};return(0,Xe.jsxs)("div",{className:"building-card "+(l?"selectable":""),style:{left:`${null===(t=i.position)||void 0===t?void 0:t.x}%`,top:`${null===(a=i.position)||void 0===a?void 0:a.y}%`,width:`${null===(n=i.size)||void 0===n?void 0:n.width}px`,height:`${null===(s=i.size)||void 0===s?void 0:s.height}px`},onClick:o,"data-building-id":c,children:[(0,Xe.jsxs)("div",{className:"building-header",children:[(0,Xe.jsx)("div",{className:"building-name",children:i.building.name}),(0,Xe.jsx)("div",{className:"effect-row",children:i.effects.map(((e,t)=>(0,Xe.jsx)("div",{className:`effect ${e.type}`,children:g(e)},t)))})]}),(0,Xe.jsx)("div",{className:"visitor-slots",children:Array(i.capacity).fill(0).map(((e,t)=>(0,Xe.jsx)("div",{className:"slot "+(t<i.currentVisitors.length?"occupied":""),children:i.currentVisitors[t]?(0,Xe.jsx)(An,{character:i.currentVisitors[t],mini:!0,onClick:e=>d(i.currentVisitors[t],e.currentTarget.getBoundingClientRect())}):(0,Xe.jsx)("div",{className:"slot-effect",children:i.positionEffects[t].map(((e,t)=>(0,Xe.jsx)("div",{className:`effect ${e.type}`,children:m(e)},t)))})},t)))}),(0,Xe.jsx)("div",{className:"building-effect "+(i.isHighlighted?"hidden":""),children:i.building.description}),i.isHighlighted&&(0,Xe.jsx)("div",{className:"interaction-hint",children:"Click on tags to gain their effects"})]})},Mn=e=>{let{characters:t,selectedCharacter:a,onCharacterClick:n,exhaustion:s,onRandomClick:r,onEndClick:i}=e;return(0,Xe.jsxs)("div",{className:"character-holder",children:[(0,Xe.jsx)("div",{className:"characters-title",children:0===s?"Click a Character":`Next action ${s} Party Exhaustion`}),(0,Xe.jsx)("div",{className:"characters-display",children:(0,Xe.jsxs)("div",{className:"characters-row",children:[r&&(0,Xe.jsx)("div",{className:"selector-button random-button",onClick:r,children:"RANDOM"}),(0,Xe.jsx)("div",{className:"character-selector-line",children:t.map(((e,t)=>(0,Xe.jsx)(An,{character:e,isSelected:a===e,onClick:t=>n(e,t.currentTarget.getBoundingClientRect()),"data-character-id":String(e.id)},t)))}),i&&(0,Xe.jsx)("div",{className:"selector-button end-button",onClick:i,children:"LEAVE"})]})})]})},jn={BARRACKS:{name:"Barracks",type:r.ap.BARRACKS,description:"Train and improve combat skills",tags:[Na.D.WEAPONS,Na.D.ARMOR],effects:[]},TEMPLE:{name:"Temple",type:r.ap.TEMPLE,description:"Heal wounds or resurrect fallen heroes",tags:[Na.D.MAGIC,Na.D.HEALING],effects:[]},SHOP:{name:"Shop",type:r.ap.SHOP,description:"Replenish tools and find magic items.",tags:[Na.D.TOOLS,Na.D.WEAPONS],allowMagicItems:!0,effects:[]},MARKETPLACE:{name:"Marketplace",type:r.ap.SHOP,description:"Replenish tools and find magic items.",tags:[Na.D.TOOLS],effects:[]},TAVERN:{name:"Tavern",type:r.ap.TAVERN,description:"Gossip, rumors, and conversation.",tags:[],addFriendlyTags:!0,effects:[]},GUILD_HALL:{name:"Guild Hall",type:r.ap.GUILD_HALL,description:"Replenish Magic, Level Up, and find magic items.",tags:[Na.D.LEVEL_UP],allowMagicItems:!0,effects:[]},LIBRARY:{name:"Library",type:r.ap.LIBRARY,description:"Replenish Magic",tags:[Na.D.BOOKS],effects:[]},FIRE:{name:"Fire",type:r.ap.FIRE,description:"Replenish \u2728, \ud83d\udd27",tags:[],effects:[]},CONFRONTATION:{name:"Confrontation",type:r.ap.CONFRONTATION,description:"Increase Stress, chance of reduced attitude",tags:[],addFriendlyTags:!0,effects:[]}},wn=[jn.BARRACKS,jn.TEMPLE,jn.SHOP,jn.MARKETPLACE,jn.TAVERN,jn.GUILD_HALL,jn.LIBRARY,jn.FIRE,jn.CONFRONTATION],Rn=e=>{var t;let{encounter:a}=e;const s=Rt(),i=s.getTownManager(),o=jt(),[l,c]=(0,n.useState)([]),[d,u]=(0,n.useState)(null),[h,m]=(0,n.useState)(o.getCharacters()),[g,p]=(0,n.useState)(0),[f,v]=(0,n.useState)(new Set),[y,b]=(0,n.useState)(!1),[E,x]=(0,n.useState)(null),[N,T]=(0,n.useState)(0),[C,A]=(0,n.useState)(),[S,M]=(0,n.useState)(null),[j,w]=(0,n.useState)(!0),R=kt(),k=()=>l.filter((e=>e.currentVisitors.length<e.capacity)),I=(0,n.useCallback)((e=>{var t,a,n,s,o,l;Object.values(r.ap);const c=[],d=(null===(t=e.town)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.nbBuildings[0])||4,u=(null===(n=e.town)||void 0===n||null===(s=n[0])||void 0===s?void 0:s.nbBuildings[1])||7,h=d+Math.floor(Math.random()*(u-d+1)),m=100/3,g=new Set,p=[...(null===(o=e.town)||void 0===o||null===(l=o[0])||void 0===l?void 0:l.buildings)||wn],f=p.filter((e=>e.required));for(let r=0;r<h;r++){const e=f.length>r?f[r]:p[Math.floor(Math.random()*p.length)];let t,a;p.splice(p.indexOf(e),1);do{t=Math.floor(4*Math.random()),a=Math.floor(3*Math.random())}while(g.has(`${t},${a}`));g.add(`${t},${a}`);const n=25*t+6.25*Math.random(),s=a*m,o=(Math.random(),Math.random(),Math.max(e.maxCapacity||1,Math.floor(2*Math.random())+1)),l={building:e,tags:i.getTagsForBuilding(e),resolvedTags:[],capacity:o,currentVisitors:[],effects:[...e.effects],positionEffects:D(e,o),position:{x:n,y:s},id:`${r}`};c.push(l)}return c}),[i]),O=()=>{b(!1),A(void 0)},L=(0,n.useCallback)(((e,t)=>{R.exposeTag(e);const a=l.map((a=>{if(a.id===t.id){const t={...a,isHighlighted:!1,resolvedTags:[...a.resolvedTags,e.tag]};return E&&E.id===a.id&&x(t),t}return a}));c(a);const n=document.querySelector(`[data-building-id="${t.id}"]`);n&&n.classList.remove("highlight")}),[s,R,l,E]),P=(0,n.useCallback)((e=>{C&&E&&(T((e=>e-1)),s.getUiManager().closeModal(),L(e,E),b(!1))}),[C,E,L]);(0,n.useEffect)((()=>{y&&C&&E&&s.getUiManager().showTagModal({title:C.title,description:C.description,tags:C.tags,effects:C.results,selectedTags:E.resolvedTags,remainingClicks:N,tagInstructions:"Click on the tags to reveal them.",onTagClick:P,onClose:O})}),[y,C,E,N,s,P]);const D=(e,t)=>{const a=()=>{if(Math.random()<.5)return{type:r.Cu.NONE,value:0};if(Math.random()<.3)switch(Math.floor(9*Math.random())){case 0:case 1:case 2:if(e.effects.some((e=>e.type===r.Cu.ADD_TENSION)))break;return{type:r.Cu.ADD_TENSION,value:Math.random()>.5?5:-5};case 3:case 4:if(e.effects.some((e=>e.type===r.Cu.ADD_ENJOYMENT)))break;return{type:r.Cu.ADD_ENJOYMENT,value:Math.random()>.5?1:-1};case 5:if(e.effects.some((e=>e.type===r.Cu.CAMPAIGN_POINT)))break;return{type:r.Cu.CAMPAIGN_POINT,value:Math.floor(4*Math.random())+1};case 6:case 7:if(e.effects.some((e=>e.type===r.Cu.ADD_TREASURE)))break;return{type:r.Cu.ADD_TREASURE,value:1};case 8:if(e.effects.some((e=>e.type===r.Cu.INJURE)))break;if(e.effects.some((e=>e.type===r.Cu.HEAL)))break;return{type:r.Cu.INJURE,value:1};default:return{type:r.Cu.ADD_TREASURE,value:1}}return{type:r.Cu.ADD_TREASURE,value:1}};return Array.from({length:t},(()=>[a()]))};(0,n.useEffect)((()=>{const e=I(a);c(e)}),[a,I]);const U=(e,t,a,n)=>{const s=t.currentVisitors.length,r=_(n,s,t.capacity);M({character:e,from:a,to:r}),requestAnimationFrame((()=>{const e=document.querySelector(".character-token.animating");e&&(e.style.setProperty("--move-x",r.left-a.left+"px"),e.style.setProperty("--move-y",r.top-a.top+"px"),e.classList.add("moving"))})),v((t=>new Set([...t,String(e.id)]))),setTimeout((()=>{M(null);const a=l.map((a=>({...a,isHighlighted:a.id===t.id,currentVisitors:a.id===t.id?[...a.currentVisitors,e]:a.currentVisitors})));c(a);const n=document.querySelector(`[data-building-id="${t.id}"]`);n&&n.classList.add("highlight"),setTimeout((()=>{const a=i.townBuildingResolved(e,t,s);A(a),T(1),x(t),b(!0)}),100)}),1e3)},_=(e,t,a)=>{const n=e.left+42,s=e.bottom-122;return new DOMRect(n+110*t,s,100,100)},B=(e,t)=>{if(j){const a=k();if(a.length>0){const n=a[Math.floor(Math.random()*a.length)],r=document.querySelector(`[data-building-id="${n.id}"]`);if(r){const a=r.getBoundingClientRect();U(e,n,t,a),i.townBuildingAssigned(e,n),g>0&&s.getPartyManager().exhaustParty(g),p(g+2)}}}else u(e)};return(0,Xe.jsxs)("div",{className:"town-encounter",children:[(0,Xe.jsx)(yn,{title:a.location.name,description:(null===(t=R.getCurrentEvent())||void 0===t?void 0:t.flavorText)||"",leftContent:(0,Xe.jsx)(Nn,{instructions:["Click a character on the right to","urge a player to visit a location","Non-active players lose attention "]}),rightContent:(0,Xe.jsx)(Mn,{characters:h,selectedCharacter:d,onCharacterClick:B,exhaustion:g,onEndClick:()=>R.backToOverview(),onRandomClick:()=>{const e=k();if(e.length>0){const t=e[Math.floor(Math.random()*e.length)],a=h[Math.floor(Math.random()*h.length)],n=document.querySelector(`[data-building-id="${t.id}"]`),r=document.querySelector(`[data-character-id="${a.id}"]`);if(n&&r){const e=n.getBoundingClientRect(),o=r.getBoundingClientRect();U(a,t,o,e),i.townBuildingAssigned(a,t),g>0&&s.getPartyManager().exhaustParty(g),p(g+2)}}}}),instructions:[!0,!1],childClass:"small-font"}),(0,Xe.jsxs)("div",{className:"buildings-container",children:[l.map(((e,t)=>(0,Xe.jsx)(Sn,{building:e,onClick:t=>((e,t)=>{if(!d||e.currentVisitors.length>=e.capacity)return;const a=document.querySelector(`[data-character-id="${d.id}"]`);if(a){const n=a.getBoundingClientRect();U(d,e,n,t)}u(null)})(e,t.currentTarget.getBoundingClientRect()),isSelectable:null!==d&&e.currentVisitors.length<e.capacity,"data-building-id":e.id,onTagClick:L,onCharacterClick:B},t)))," "]}),S&&(0,Xe.jsx)(An,{character:S.character,style:{position:"fixed",left:`${S.from.left}px`,top:`${S.from.top}px`,width:`${S.from.width}px`,height:`${S.from.height}px`,transition:"transform 1.0s ease"},className:"animating",mini:!0,onClick:()=>{}})]})},kn=e=>{var t;let{encounter:a}=e;const[s,i]=(0,n.useState)("setup"),[o,l]=(0,n.useState)([{type:"death",minRoll:0,maxRoll:0,dmRewards:[]},{type:"injured",minRoll:1,maxRoll:3,dmRewards:[]},{type:"survived",minRoll:4,maxRoll:5,dmRewards:[]},{type:"success",minRoll:6,maxRoll:7,dmRewards:[]}]),[c,d]=(0,n.useState)([]),[u,h]=(0,n.useState)(new Set),[m,g]=(0,n.useState)([]),[p,f]=(0,n.useState)(!1),[v,y]=(0,n.useState)(null),[b,E]=(0,n.useState)({}),x=Rt(),N=kt(),T=wt(),C=x.getCharacterManager(),A=x.getTagManager(),S=x.getPartyManager(),M=T.getPlayers(),j=M.flatMap((e=>e.characters.map((t=>({character:t,player:e}))))),w=(null===(t=N.currentEncounter)||void 0===t?void 0:t.location.tags)||[],R=A.locationTagsCollected,k=w.filter((e=>!R.some((t=>t.name===e.name))));(0,n.useEffect)((()=>{I(),O()}),[]),(0,n.useEffect)((()=>{O()}),[o]);const I=()=>{const e=o.map((e=>({...e,dmRewards:Array.from({length:e.maxRoll-e.minRoll+1},(()=>Math.floor(6*Math.random())+1))})));l(e)},O=()=>{const e=o.find((e=>"success"===e.type));if(!e)return;const t=(e.maxRoll-e.minRoll+1)/8*100,a=Math.max(0,t-50),n={};M.forEach((e=>{n[e.id.toString()]=Math.min(90,a+(20*Math.random()-10))})),E(n)},L=e=>{const t=10*(C.getRemainingAttributes(e,r.Eh.TOOLS)||0),a=0===k.length;return Math.min(95,t+(a?25:0))},P=e=>k.length>0?k[e%k.length]:R.length>0?R[e%R.length]:null,D=()=>{const e=[];j.forEach((t=>{let{character:a,player:n}=t;const s=Math.floor(8*Math.random()),r=o.find((e=>s>=e.minRoll&&s<=e.maxRoll)),i=(null===r||void 0===r?void 0:r.dmRewards[s-r.minRoll])||0;r&&e.push({character:a,player:n,roll:s,result:r,dmReward:i})})),d(e),g(e.map((e=>({character:e.character.id.toString(),roll:e.roll})))),setTimeout((()=>{U(e)}),1500)},U=e=>{const t=[];let a=0;e.forEach((e=>{let{character:n,player:s,result:r,dmReward:i}=e;"injured"===r.type?(S.addInjury(n),t.push({object:n,effects:[{effect:"Injured",class:"character-injury"}]})):"death"===r.type&&(S.addInjury(n),S.addInjury(n),t.push({object:n,effects:[{effect:"Died",class:"character-death"}]})),i>0&&(a+=i,t.push({object:n,effects:[{effect:`+${i} DM Points`,class:"dm-points"}]}));const o=b[s.id.toString()]||0;100*Math.random()<o&&(S.updateAttention(s,-1),t.push({object:s,effects:[{effect:"-1 Attention (Boredom)",class:"player-attention"}]}))})),a>0&&N.addDmExp(a),g([]),_("Trap Results","Characters have reacted to the trap!",t),i("resolved")},_=(e,t,a)=>{y({results:a,title:e,description:t,tags:[],travelOption:{id:"trap_result",name:e,description:t,time:0,tags:0,score:0,boredom:0,exhaustion:0,tagInstructions:"",repeatable:!1},info:{score:0,time:0,boredom:0,exhaustion:0}}),f(!0)};return(0,Xe.jsxs)("div",{className:"game-encounter-trap",children:[(0,Xe.jsx)(yn,{title:`Trap - ${a.location.name}`,description:"Configure the trap difficulty and manage character survival!",childClass:"small-font"}),(0,Xe.jsxs)("div",{className:"trap-content",children:[(0,Xe.jsxs)("div",{className:"trap-grid",children:[(0,Xe.jsxs)("div",{className:"grid-labels",children:[(0,Xe.jsx)("div",{className:"result-label success",children:"Success"}),(0,Xe.jsx)("div",{className:"result-label survived",children:"Survived"}),(0,Xe.jsx)("div",{className:"result-label injured",children:"Injured"}),(0,Xe.jsx)("div",{className:"result-label death",children:"Death"})]}),(0,Xe.jsxs)("div",{className:"grid-content",children:[Array.from({length:8},((e,t)=>7-t)).map((e=>{const t=o.find((t=>e>=t.minRoll&&e<=t.maxRoll)),a=(null===t||void 0===t?void 0:t.dmRewards[e-t.minRoll])||0;return(0,Xe.jsxs)("div",{className:"grid-row",children:[(0,Xe.jsx)("div",{className:"roll-number",children:e}),j.map(((n,s)=>{let{character:r}=n;const i=m.some((t=>t.character===r.id.toString()&&t.roll===e));return(0,Xe.jsxs)("div",{className:`grid-cell ${(null===t||void 0===t?void 0:t.type)||""} ${i?"highlighted":""}`,children:[i&&(0,Xe.jsx)("div",{className:"character-marker",children:"\ud83d\udc64"}),a>0&&!i&&(0,Xe.jsx)("div",{className:"dm-reward-marker",children:a})]},`${e}-${r.id}`)}))]},e)})),(0,Xe.jsxs)("div",{className:"character-headers",children:[(0,Xe.jsx)("div",{className:"roll-number-header",children:"#"}),j.map((e=>{let{character:t,player:a}=e;return(0,Xe.jsxs)("div",{className:"character-header",children:[(0,Xe.jsx)("div",{className:"character-name",children:t.name}),(0,Xe.jsxs)("div",{className:"character-player",children:["(",a.name,")"]})]},t.id)}))]})]})]}),(0,Xe.jsxs)("div",{className:"trap-controls",children:["setup"===s&&(()=>{const{deathChance:e,injuryChance:t}=(()=>{const e=o.find((e=>"death"===e.type)),t=o.find((e=>"injured"===e.type));return{deathChance:e?(e.maxRoll-e.minRoll+1)/8*100:0,injuryChance:t?(t.maxRoll-t.minRoll+1)/8*100:0}})(),a=(()=>{const e=o.find((e=>"death"===e.type)),t=o.find((e=>"injured"===e.type));if(!e||!t)return 0;const a=(e.maxRoll-e.minRoll+1)/8*100,n=(t.maxRoll-t.minRoll+1)/8*100;return Math.floor(2*a+1*n)})();return(0,Xe.jsxs)("div",{className:"difficulty-adjustment",children:[(0,Xe.jsx)("h3",{children:"Trap Difficulty Configuration"}),(0,Xe.jsxs)("div",{className:"risk-stats",children:[(0,Xe.jsxs)("div",{className:"risk-stat",children:["Death: ",e.toFixed(1),"%"]}),(0,Xe.jsxs)("div",{className:"risk-stat",children:["Injury: ",t.toFixed(1),"%"]}),(0,Xe.jsxs)("div",{className:"risk-stat",children:["Tension: +",a]})]}),(0,Xe.jsxs)("div",{className:"boredom-risks",children:[(0,Xe.jsx)("h4",{children:"Boredom Risks:"}),M.map((e=>(0,Xe.jsxs)("div",{className:"boredom-risk",children:[e.name,": ",(b[e.id.toString()]||0).toFixed(1),"%"]},e.id)))]}),(0,Xe.jsx)("button",{className:"introduce-trap-button",onClick:()=>i("disarm"),children:"Introduce Trap"})]})})(),"disarm"===s&&(0,Xe.jsxs)("div",{className:"disarm-interface",children:[(0,Xe.jsx)("h3",{children:"Disarm Attempts"}),(0,Xe.jsx)("div",{className:"character-disarm-options",children:j.map(((e,t)=>{let{character:a,player:n}=e;const s=L(a),i=u.has(a.id.toString()),c=P(t),d=s<35?"#e74c3c":s>75?"#27ae60":"#f39c12";return(0,Xe.jsxs)("div",{className:"character-disarm-card "+(i?"disabled":""),style:{borderColor:d},children:[(0,Xe.jsxs)("div",{className:"character-info",children:[(0,Xe.jsx)("div",{className:"character-name",children:a.name}),(0,Xe.jsxs)("div",{className:"character-player",children:["(",n.name,")"]})]}),c&&(0,Xe.jsx)(aa,{tag:{tag:c,source:r.UW.LOCATION,theme:A.getTheme()},disabled:!1,className:"assigned-tag",showTooltip:!0}),(0,Xe.jsxs)("div",{className:"disarm-chance",children:[s,"% success"]}),(0,Xe.jsx)("button",{className:"disarm-button",disabled:i,onClick:()=>((e,t)=>{const a=e.id.toString();if(u.has(a))return;const n=L(e),s=100*Math.random()<n;h((e=>new Set([...e,a])));const i=j.findIndex((t=>t.character.id===e.id)),c=P(i),d=[];T.addPlayerExp(t,1),d.push({object:t,effects:[{effect:"+1 Experience",class:"player-exp"}]});const m=C.getRemainingAttributes(e,r.Eh.TOOLS)||0,g=Math.floor(m/2);if(g>0&&(C.setAttributeUsed(e,r.Eh.TOOLS,g),d.push({object:e,effects:[{effect:`-${g} Tools`,class:"character-tools"}]})),s){const t=o.map((e=>({...e,minRoll:Math.min(7,e.minRoll+1),maxRoll:Math.min(7,e.maxRoll+1)})));if(l(t),c&&k.some((e=>e.name===c.name))){const e={tag:c,source:r.UW.LOCATION,theme:A.getTheme()};N.exposeTag(e),d.push({object:"party",effects:[{effect:`Exposed: ${c.name}`,class:"location-tag"}]})}_("Trap Disarmed!",`${e.name} successfully disarmed the trap!`,d)}else{const t=o.map((e=>({...e,minRoll:Math.max(0,e.minRoll-1),maxRoll:Math.max(0,e.maxRoll-1)})));l(t),S.addPartyTension(10),d.push({object:"party",effects:[{effect:"+10 Tension",class:"tension"}]}),_("Disarm Failed",`${e.name} failed to disarm the trap!`,d)}})(a,n),children:i?"Used":"Disarm"})]},a.id)}))}),(0,Xe.jsx)("button",{className:"react-to-trap-button",onClick:D,children:"React to Trap"})]}),"resolved"===s&&(0,Xe.jsx)("button",{className:"end-trap-button",onClick:()=>N.backToOverview(),children:"End Trap Encounter"})]})]}),p&&v&&(0,Xe.jsx)("div",{className:"modal-overlay",children:(0,Xe.jsxs)("div",{className:"modal-container",children:[(0,Xe.jsxs)("div",{className:"modal-header",children:[v.title,(0,Xe.jsx)("button",{className:"close-button",onClick:()=>f(!1),children:"\xd7"})]}),(0,Xe.jsx)("div",{className:"modal-description",children:v.description}),(0,Xe.jsx)("div",{className:"trap-results",children:v.results.map(((e,t)=>{var a;return(0,Xe.jsxs)("div",{className:"effect-display",children:[(0,Xe.jsx)("div",{className:"effect-target",children:"string"===typeof e.object?e.object:e.object.name}),(0,Xe.jsx)("div",{className:"effect-list",children:null===(a=e.effects)||void 0===a?void 0:a.map(((e,t)=>(0,Xe.jsx)("div",{className:`effect ${e.class}`,children:e.effect},t)))})]},t)}))}),(0,Xe.jsx)("div",{className:"modal-actions",children:(0,Xe.jsx)("button",{onClick:()=>f(!1),children:"OK"})})]})})]})},In=e=>{let{children:t,title:a,variant:n="primary",className:s="",style:r}=e;const i=["c-container",`c-container--${n}`,s].filter(Boolean).join(" ");return(0,Xe.jsxs)("div",{className:i,style:r,children:[a&&(0,Xe.jsx)("div",{className:"c-container__title-bar",children:(0,Xe.jsx)("span",{className:"c-container__title",children:a})}),(0,Xe.jsx)("div",{className:"c-container__content",children:t})]})},On=2500,Ln=100,Pn=800;let Dn=function(e){return e.USE_ATTRIBUTE_COMBAT="use_attribute_combat",e.USE_ATTRIBUTE_MAGIC="use_attribute_magic",e.USE_ATTRIBUTE_TOOLS="use_attribute_tools",e.UNLOCK_ASSIST="free_spot",e}({});const Un=e=>{var t;let{challengeLength:a=10,authoredTag:s,skillThresholds:i={combat:5,magic:5,gear:5},onComplete:o,authoredAssistTags:l=[],generateRandomAssistTags:c=!1,config:d}=e;const u=Rt(),h=kt(),m=jt(),g=u.getTagManager(),p=u.getChatManager(),[f]=(0,n.useState)(m.getCharacters()),[v,y]=(0,n.useState)(null),[b,E]=(0,n.useState)([]),[x,N]=(0,n.useState)(f.map((e=>({characterId:String(e.id),rowIndex:-1,position:-1})))),T=s||g.getOutstandingEncounterTags()[0]||(null===(t=g.generateRelevantFlavorTags(1)[0])||void 0===t?void 0:t.tag),[C,A]=(0,n.useState)({combat:0,magic:0,gear:0}),[S,M]=(0,n.useState)([]),[j,w]=(0,n.useState)(0),[R,k]=(0,n.useState)(0),[I,O]=(0,n.useState)(!1),[L,P]=(0,n.useState)(0),D=()=>0===$(),[U,_]=(0,n.useState)(null),[B,F]=(0,n.useState)(null),H=[{id:"failure",name:"Failure",description:"-50 Tension, -1 Attention",tensionChange:-50,attentionChange:-1,scoreBonus:0},{id:"simple",name:"Simple",description:"-5 Tension",tensionChange:-5,attentionChange:0,scoreBonus:1},{id:"challenging",name:"Challenging",description:"+5 Tension",tensionChange:5,attentionChange:0,scoreBonus:2},{id:"hard",name:"Hard",description:"+15 Tension, +1 Attention",tensionChange:15,attentionChange:1,scoreBonus:3}],G=function(e){return Array(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1).fill("\u25cf").join("")},W=e=>{switch(e){case"COMBAT":return"\u2694\ufe0f";case"MAGIC":return"\u2728";case"GEAR":return"\ud83d\udd27";default:return"\u2753"}},z=e=>{switch(e){case Dn.USE_ATTRIBUTE_COMBAT:return"theme-combat";case Dn.USE_ATTRIBUTE_MAGIC:return"theme-magic";case Dn.USE_ATTRIBUTE_TOOLS:return"theme-gear";case Dn.UNLOCK_ASSIST:default:return"theme-neutral"}},Q=function(e){const t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?L:0,a=e+t,n={1:["center"],2:["top-left","bottom-right"],3:["top-left","center","bottom-right"],4:["top-left","top-right","bottom-left","bottom-right"],5:["top-left","top-right","center","bottom-left","bottom-right"],6:["top-left","top-right","middle-left","middle-right","bottom-left","bottom-right"]}[Math.min(Math.max(a,1),6)]||["center"];return(0,Xe.jsx)("div",{className:"dice-face",children:n.map(((a,n)=>{const s=n>=e&&t>0;return(0,Xe.jsx)("div",{className:`pip ${a} ${s?"assist-bonus":""}`},n)}))})},V=e=>{switch(b[e].theme){case"COMBAT":default:return r.Eh.COMBAT;case"MAGIC":return r.Eh.MAGIC;case"GEAR":return r.Eh.TOOLS}},Y=(e,t)=>{const a=V(t);return m.getRemainingAttributes(e,a)>=1},K=e=>{const t=V(e);return`Character uses one ${m.getUFAttributeName(t)}`},q=e=>{switch(e){case"COMBAT":return"Might";case"GEAR":return"Skill";case"MAGIC":return"Magic";default:return"Unknown"}},X=()=>{const e=[];if(l&&l.length>0&&l.forEach(((t,a)=>{e.push({id:`authored_assist_${a}`,tag:t,state:g.isTagCollected(t)?"AVAILABLE":"UNAVAILABLE",isLocationTag:!0})})),c){g.getOutstandingLocationTags().forEach(((t,a)=>{e.push({id:`location_${a}`,tag:t,state:"UNAVAILABLE",isLocationTag:!0})}));g.getCollectedLocationTags().forEach(((t,a)=>{e.push({id:`collected_location_${a}`,tag:t,state:"AVAILABLE",isLocationTag:!0})}));g.generateRelevantFlavorTags(5).forEach(((t,a)=>{e.push({id:`assist_${a}`,tag:t.tag,state:g.isTagCollected(t.tag)?"AVAILABLE":"UNAVAILABLE",isLocationTag:!1})}))}const t=e.slice(0,5);M(t);(e=>{const t=["COMBAT","GEAR","MAGIC"],n=[];Math.ceil(e/t.length);let s=0;for(t.forEach(((e,t)=>{const s=[];for(let n=0;n<a;n++){let t;if(Math.random()<.7)switch(e){case"COMBAT":t=Dn.USE_ATTRIBUTE_COMBAT;break;case"GEAR":t=Dn.USE_ATTRIBUTE_TOOLS;break;case"MAGIC":t=Dn.USE_ATTRIBUTE_MAGIC}else{const e=[Dn.USE_ATTRIBUTE_COMBAT,Dn.USE_ATTRIBUTE_MAGIC,Dn.USE_ATTRIBUTE_TOOLS];t=e[Math.floor(Math.random()*e.length)]}const r=n===Math.floor(Math.random()*a)?Math.floor(3*Math.random())+1:void 0,i=Math.floor(3*Math.random())+1;s.push({id:`${e.toLowerCase()}_row_spot_${n}`,type:t,position:n,used:!1,icon:G(t,i),scorePoints:r,challengePoints:i})}n.push({id:`row_${t}`,theme:e,name:`${q(e)}`,description:`Focus on ${e.toLowerCase()} skills`,cspots:s,selected:!1})}));s<e;){const e=Math.floor(Math.random()*n.length),t=n[e],a=t.cspots.map(((e,t)=>e.type!==Dn.UNLOCK_ASSIST?t:-1)).filter((e=>-1!==e));if(0===a.length)continue;const r=a[Math.floor(Math.random()*a.length)];t.cspots[r]={id:`${t.theme.toLowerCase()}_row_spot_${r}_unlock`,type:Dn.UNLOCK_ASSIST,position:r,used:!1,icon:G(Dn.UNLOCK_ASSIST),challengePoints:0},s++}E(n)})(t.filter((e=>"UNAVAILABLE"===e.state)).length)};(0,n.useEffect)((()=>{X()}),[]);const Z=S.filter((e=>"AVAILABLE"===e.state)).length,J=(e,t,a)=>{if(E((n=>n.map(((n,s)=>s===e?{...n,cspots:n.cspots.map((e=>e.id===t.id?{...e,used:!0,characterId:String(a.id)}:e))}:n)))),t.type===Dn.UNLOCK_ASSIST)ne();else{const n=(e=>{switch(e){case Dn.USE_ATTRIBUTE_COMBAT:return"combat";case Dn.USE_ATTRIBUTE_MAGIC:return"magic";case Dn.USE_ATTRIBUTE_TOOLS:return"gear";default:return"combat"}})(t.type);A((e=>({...e,[n]:e[n]+t.challengePoints+L})));const s=V(e);m.addUsedAttribute(a,s)}k((e=>{const t=e+1;return ee(t),t})),y(null),E((e=>e.map((e=>({...e,selected:!1}))))),M((e=>e.map((e=>"ACTIVE"===e.state?{...e,state:"USED"}:e)))),P(0),t.scorePoints&&(h.addEncounterPoints(t.scorePoints),console.log(`Character ${a.name} gained ${t.scorePoints} encounter points!`))},$=()=>(C.magic>=i.magic?1:0)+(C.combat>=i.combat?1:0)+(C.gear>=i.gear?1:0),ee=e=>{const t=$();w(0===t?0:1===t?1:2===t?2:3)},te=()=>{const e=$();return 0===e?0:1===e?1:2===e?2:3},ae=()=>{O(!0);const e=H[j];console.log(`Challenge completed with reward: ${e.name}`),s?u.getUiManager().showTagModal({title:"Challenge Completed",description:null===d||void 0===d?void 0:d.successText,tags:[g.tagToEncounterFlavorTag(s,r.UW.ENCOUNTER,r.Co.NONE)],effects:[],selectedTags:[],remainingClicks:1,onTagClick:e=>{setTimeout((()=>{u.getUiManager().closeModal(),o&&o(),h.exposeTag(e)}),100)},onClose:()=>{o&&o()}}):o&&o()},ne=()=>{const e=S.filter((e=>"UNAVAILABLE"===e.state));if(0===e.length)return;const t=e.map((e=>g.tagToEncounterFlavorTag(e.tag,h.getPotentialTagSource(e.tag),r.Co.NONE)));u.getUiManager().showTagModal({title:"Exposition Opportunity",description:"During the challenge, an opportunity to introduce one of the following topics comes up.",tags:t,effects:[],selectedTags:[],remainingClicks:1,onTagClick:t=>{const a=e.find((e=>e.tag.name===t.tag.name));a&&(M((e=>e.map((e=>e.id===a.id?{...e,state:"AVAILABLE"}:e)))),h.exposeTag(t),setTimeout((()=>{u.getUiManager().closeModal()}),100))},onClose:()=>{console.log("Assist options modal closed")}})};return(0,Xe.jsx)("div",{className:"enhanced-skill-challenge",children:(0,Xe.jsx)("div",{className:"challenge-layout",children:(0,Xe.jsxs)("div",{className:"left-section",children:[(0,Xe.jsx)("div",{className:"character-column",children:(0,Xe.jsx)("div",{className:"character-section",children:(re=!v,(0,Xe.jsx)(In,{title:"Heroes",variant:re?"primary":"secondary",children:f.map((e=>{var t,a,n;const s=Wt(e),i=(null===(t=e.attributeLoss)||void 0===t?void 0:t[r.Eh.COMBAT])||0,o=(null===(a=e.attributeLoss)||void 0===a?void 0:a[r.Eh.MAGIC])||0,l=(null===(n=e.attributeLoss)||void 0===n?void 0:n[r.Eh.TOOLS])||0,c=s[r.Eh.COMBAT]||0,d=s[r.Eh.MAGIC]||0,u=s[r.Eh.TOOLS]||0;return(0,Xe.jsxs)("div",{className:"character-item "+((null===v||void 0===v?void 0:v.id)===e.id?"selected":v?"disabled":""),onClick:()=>(e=>{if(v&&v.id===e.id)return y(null),M((e=>e.map((e=>"ACTIVE"===e.state?{...e,state:"AVAILABLE"}:e)))),void P(0);y(e)})(e),children:[(0,Xe.jsxs)("div",{className:"left-side",children:[(0,Xe.jsx)("div",{className:"character-name",children:e.name}),(0,Xe.jsx)("div",{className:"character-icon",children:(0,Xe.jsx)(Je,{imageId:e.icon})})]}),(0,Xe.jsxs)("div",{className:"character-info",children:[(0,Xe.jsxs)("div",{className:"attribute-row",children:[(0,Xe.jsx)("span",{className:"attribute-label"}),(0,Xe.jsx)("div",{className:"attribute-icons",children:Array.from({length:Math.max(1,c)},((e,t)=>(0,Xe.jsx)("span",{className:"attribute-icon "+(0===c||t>=c-i?"used":"available"),children:"\u2694\ufe0f"},`combat-${t}`)))})]}),(0,Xe.jsxs)("div",{className:"attribute-row",children:[(0,Xe.jsx)("span",{className:"attribute-label"}),(0,Xe.jsx)("div",{className:"attribute-icons",children:Array.from({length:Math.max(1,d)},((e,t)=>(0,Xe.jsx)("span",{className:"attribute-icon "+(0===d||t>=d-o?"used":"available"),children:"\u2728"},`magic-${t}`)))})]}),(0,Xe.jsxs)("div",{className:"attribute-row",children:[(0,Xe.jsx)("span",{className:"attribute-label"}),(0,Xe.jsx)("div",{className:"attribute-icons",children:Array.from({length:Math.max(1,u)},((e,t)=>(0,Xe.jsx)("span",{className:"attribute-icon "+(0===u||t>=u-l?"used":"available"),children:"\ud83d\udd27"},`tools-${t}`)))})]})]})]},e.id)}))}))})}),(0,Xe.jsxs)("div",{className:"challenge-column",children:[(0,Xe.jsx)("div",{className:"challenge-section",children:(se=!!v,(0,Xe.jsx)(In,{title:"Methods and Tactics",variant:se?"primary":"secondary",children:(0,Xe.jsx)("div",{className:"challenge-rows",children:b.map(((e,t)=>{const a=v&&!Y(v,t),n=v&&Y(v,t);return(0,Xe.jsxs)("div",{className:`challenge-row theme-${e.theme.toLowerCase()} \n                ${e.selected?"selected":""} \n                ${e.animatingSelection?"animating":""}\n                ${v?"":"disabled"}\n                ${a?"attribute-disabled":""}\n                ${n?"show-cost":""}`,"data-cost-text":n?K(t):"",onClick:()=>(async e=>{if(!v)return;if(!Y(v,e))return;const t=u.getPlayerManager().getPlayerAssignedCharacter(v);u.getPartyManager().playersTakeAction(t&&[t.name]||void 0,!0),_(null),F(null),E((t=>t.map(((t,a)=>({...t,selected:a===e,animatingSelection:a===e})))));const a=b[e],n=a.cspots.filter((e=>!e.used)),s=Math.floor(Math.random()*n.length),r=n[s],i=a.cspots.findIndex((e=>e.id===r.id));let o=0,l=Date.now(),c=!1;const d=setInterval((()=>{if(n.length>0){const t=a.cspots.findIndex((e=>e.id===n[o].id));_({rowIndex:e,spotIndex:t}),Date.now()-l>=On-Pn&&(c=!0),o=(o+1)%n.length,c&&t===i&&(clearInterval(d),_(null),F({rowIndex:e,spotIndex:i}),setTimeout((()=>{E((e=>e.map(((e,t)=>({...e,animatingSelection:!1}))))),F(null),J(e,r,v)}),Pn))}}),Ln)})(t),children:[(0,Xe.jsxs)("div",{className:"row-header",children:[(0,Xe.jsx)("div",{className:"row-icon",children:W(e.theme)}),(0,Xe.jsx)("div",{className:"row-label",children:e.name})]}),(0,Xe.jsx)("div",{className:"challenge-spots",children:e.cspots.map(((e,a)=>{var n;const s=(null===U||void 0===U?void 0:U.rowIndex)===t&&(null===U||void 0===U?void 0:U.spotIndex)===a,i=(null===B||void 0===B?void 0:B.rowIndex)===t&&(null===B||void 0===B?void 0:B.spotIndex)===a;return(0,Xe.jsxs)("div",{className:`challenge-spot ${e.used?"used":"available"} ${s?"cycling-highlight":""} ${i?"final-selected":""} ${z(e.type)}`,"data-row":t,"data-spot-position":e.position,children:[(0,Xe.jsx)("div",{className:"spot-icon",children:e.used||e.type!==Dn.UNLOCK_ASSIST?!e.used&&Q(e.challengePoints||1):(0,Xe.jsx)(aa,{showTooltip:!0,disabled:!1,tag:g.tagToEncounterFlavorTag({name:"?"},r.UW.NONE,r.Co.NONE)})}),!e.used&&e.scorePoints&&(0,Xe.jsx)("div",{className:"score-indicator",children:(0,Xe.jsx)(Ka,{score:e.scorePoints})}),e.used&&e.characterId&&(0,Xe.jsx)("div",{className:"character-marker",children:(0,Xe.jsx)(Je,{imageId:null===(n=f.find((t=>String(t.id)===e.characterId)))||void 0===n?void 0:n.icon})})]},e.id)}))})]},e.id)}))})}))}),(0,Xe.jsx)("div",{className:"assist-section",children:(e=>(0,Xe.jsx)(In,{title:"Potential Assistance",variant:e?"primary":"secondary",children:(0,Xe.jsx)("div",{className:"assist-tags-container "+(v?"":"disabled"),children:S.map((e=>(0,Xe.jsxs)("div",{className:`assist-tag ${e.state.toLowerCase()}`,onClick:()=>("AVAILABLE"===e.state||"ACTIVE"===e.state)&&(e=>{const t=S.find((t=>t.id===e));t&&("AVAILABLE"===t.state?(M((t=>t.map((t=>t.id===e?{...t,state:"ACTIVE"}:t)))),P((e=>e+1)),p.triggerChallengeAssistChat(t.tag,v||void 0)):"ACTIVE"===t.state&&(M((t=>t.map((t=>t.id===e?{...t,state:"AVAILABLE"}:t)))),P((e=>Math.max(0,e-1)))))})(e.id),children:[(0,Xe.jsx)("span",{className:"tag-name",children:(0,Xe.jsx)(aa,{showTooltip:!1,disabled:"ACTIVE"!==e.state&&"AVAILABLE"!==e.state,tag:g.tagToEncounterFlavorTag(e.tag,h.getPotentialTagSource(e.tag),r.Co.NONE)})}),(0,Xe.jsx)("span",{className:"tag-state",children:e.state})]},e.id)))})}))(!!v&&Z>0)})]}),(0,Xe.jsx)("div",{className:"right-section",children:(0,Xe.jsxs)("div",{className:"totals-column",children:[(0,Xe.jsx)(In,{title:"Challenge Status",variant:"primary-container",children:(0,Xe.jsxs)("div",{className:"skill-totals",children:[(0,Xe.jsxs)("div",{className:"skill-bar",children:[(0,Xe.jsx)(qt,{totalSegments:i.combat,filledSegments:C.combat,label:`${C.combat}/${i.combat}`,theme:"combat"}),(0,Xe.jsx)("div",{className:"skill-icon "+(C.combat>=i.combat?"completed":""),children:(0,Xe.jsx)("div",{className:"skill-circle combat-circle"})})]}),(0,Xe.jsxs)("div",{className:"skill-bar",children:[(0,Xe.jsx)(qt,{totalSegments:i.gear,filledSegments:C.gear,label:`${C.gear}/${i.gear}`,theme:"gear"}),(0,Xe.jsx)("div",{className:"skill-icon "+(C.gear>=i.gear?"completed":""),children:(0,Xe.jsx)("div",{className:"skill-circle gear-circle"})})]}),(0,Xe.jsxs)("div",{className:"skill-bar",children:[(0,Xe.jsx)(qt,{totalSegments:i.magic,filledSegments:C.magic,label:`${C.magic}/${i.magic}`,theme:"magic"}),(0,Xe.jsx)("div",{className:"skill-icon "+(C.magic>=i.magic?"completed":""),children:(0,Xe.jsx)("div",{className:"skill-circle magic-circle"})})]}),(0,Xe.jsxs)("div",{className:"result-tag-container "+(D()?"failure":"success"),onClick:ae,style:D()?{backgroundColor:"var(--ui-color-failure)",border:"6px solid var(--ui-color-failure-border)"}:{backgroundColor:"var(--ui-color-primary)",border:"6px solid white"},children:[s&&(0,Xe.jsxs)("div",{className:"tag-content",children:[(0,Xe.jsx)(aa,{showTooltip:!1,disabled:D(),tag:g.tagToEncounterFlavorTag(T,g.isTagCollected(T)?r.UW.ENCOUNTER:r.UW.ENCOUNTER_EXPECTED,r.Co.NONE)}),D()&&(0,Xe.jsx)("div",{className:"diagonal-stripe"})]}),(0,Xe.jsx)("div",{className:"accept-label",children:D()?"Accept Failure":"Accept Results"})]})]})}),(0,Xe.jsxs)("div",{className:"results-meter",children:[H.map(((e,t)=>(0,Xe.jsxs)("div",{className:"reward-level "+(t===te()?"current":""),children:[(0,Xe.jsx)("div",{className:"reward-indicators",children:[0,1,2].map((e=>(0,Xe.jsx)("div",{className:"indicator-dot "+(e<t?"filled":"")},e)))}),(0,Xe.jsxs)("div",{className:"reward-content",children:[(0,Xe.jsx)("span",{className:"level-name",children:e.name}),(0,Xe.jsx)("span",{className:"level-description",children:e.description})]})]},e.id))),(0,Xe.jsx)("div",{className:"results-label",children:"CURRENT RESULT"})]})]})})]})})});var se,re},_n=e=>{var t;let{encounter:a}=e;const n=kt(),s=null===(t=a.challenge)||void 0===t?void 0:t[0];return(0,Xe.jsxs)("div",{className:"game-encounter-skill-challenge",children:[(0,Xe.jsx)(yn,{title:(null===s||void 0===s?void 0:s.name)||"Enhanced Skill Challenge",description:(null===s||void 0===s?void 0:s.description)||a.location.name||"Select characters and challenge rows to overcome themed obstacles and collect skill points.",instructions:[!0,!1],childClass:"skill-challenge-header"}),(0,Xe.jsx)(Un,{challengeLength:10,authoredTag:null===s||void 0===s?void 0:s.revealTag,authoredAssistTags:null===s||void 0===s?void 0:s.assistTags,skillThresholds:null===s||void 0===s?void 0:s.skillThresholds,onComplete:()=>{n.backToOverview()},config:s})]})},Bn=1e3,Fn=e=>{let{encounter:t}=e;const[a,s]=(0,n.useState)("setup"),[i,o]=(0,n.useState)("simple"),[l,c]=(0,n.useState)(3),d=e=>{switch(e){case"simple":return{rows:4,cols:4,reward:2,extraFrustration:0};case"clever":return{rows:4,cols:5,reward:4,extraFrustration:1};case"tricky":return{rows:5,cols:5,reward:6,extraFrustration:2}}},[u,h]=(0,n.useState)([]),[m,g]=(0,n.useState)(null),[p,f]=(0,n.useState)(0),[v,y]=(0,n.useState)(!1),[b,E]=(0,n.useState)(0),[x,N]=(0,n.useState)([]),[T,C]=(0,n.useState)(null),[A,S]=(0,n.useState)(new Set),[M,j]=(0,n.useState)(!1),[w,R]=(0,n.useState)(!0),[k,I]=(0,n.useState)(""),[O,L]=(0,n.useState)(!1),[P,D]=(0,n.useState)(null),[U,_]=(0,n.useState)(null),[B,F]=(0,n.useState)(null),[H,G]=(0,n.useState)([]),W=Rt(),z=kt(),Q=wt(),V=Ot(),Y=W.getTagManager(),K=W.getPartyManager(),q=W.getChatManager(),X=Q.getPlayers(),Z=()=>2-b,J=()=>{for(let e=0;e<u.length;e++)for(let t=0;t<u[e].length;t++)if("hint"===u[e][t].type)return!0;return!1},$=function(e){switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"tricky"){case"simple":return 4;case"clever":return 6;case"tricky":return 8}return 1},ee=e=>(console.log("calculateAbandonmentCost called with score:",e),{attitude:1,tension:20}),te=(e,t,a)=>{const n=[];return e>0&&n.push("up"),e<a.rows-1&&n.push("down"),t>0&&n.push("left"),t<a.cols-1&&n.push("right"),n},ae=(e,t)=>{const a=["up","right","down","left"],n=a.indexOf(e);for(let s=1;s<=4;s++){const e=a[(n+s)%4];if(t.includes(e))return e}return e},ne=e=>{switch(e){case"boring":return"--";case"low":return"-";case"high":return"+";case"crisis":return"++"}},se=(0,n.useCallback)((()=>{const e=Y.getCollectedTags(),t=Y.locationTagsCollected;return[...e.filter((e=>!t.some((t=>t.name===e.name))))].sort((()=>Math.random()-.5))}),[Y]),re=(0,n.useCallback)((()=>{var e,t,a,n;const s=d(i),o=((e,t)=>{const a=[];for(let n=0;n<e;n++){a[n]=[];for(let e=0;e<t;e++)a[n][e]={type:"unexposed",visited:!1,pinned:!1,scoreReward:0,isAnswer:!1,isFrustration:!1,isTemporaryFrustration:!1}}return a})(s.rows,s.cols),c=s.rows*s.cols,u=new Set,h=(null===(e=z.currentEncounter)||void 0===e?void 0:e.location.tags)||[],m=Y.getOutstandingLocationTags(),g=null!==(t=null===(a=z.getCurrentEvent())||void 0===a||null===(n=a.tags)||void 0===n?void 0:n[0])&&void 0!==t?t:{name:"MAXIM Fix Me",description:"Placeholder answer tag",theme:"neutral"},p=(e,t)=>{const a=[];return e>0&&a.push("up"),e<s.rows-1&&a.push("down"),t>0&&a.push("left"),t<s.cols-1&&a.push("right"),a},f=()=>{const e=[];for(let t=0;t<s.rows;t++)for(let a=0;a<s.cols;a++){const n=`${t}-${a}`;u.has(n)||e.push({row:t,col:a})}return 0===e.length?null:e[Math.floor(Math.random()*e.length)]};[g].forEach((e=>{const t=f();if(t){const a=e.name?Y.tagToEncounterFlavorTag(e,r.UW.PUZZLE_ANSWER):{tag:{name:"MAXIM Fix Me",description:"Placeholder answer tag",theme:"neutral"},source:"ENCOUNTER",theme:Y.getTheme()};o[t.row][t.col]={type:"answer",tag:a,visited:!1,pinned:!0,scoreReward:0,isAnswer:!0,isFrustration:!1,isTemporaryFrustration:!1},u.add(`${t.row}-${t.col}`)}})),h.forEach((e=>{const t=f();if(t){const a=!m.some((t=>t.name===e.name)),n=p(t.row,t.col),s=n[Math.floor(Math.random()*n.length)],i=Y.tagToEncounterFlavorTag(e,r.UW.LOCATION);o[t.row][t.col]={type:a?"hint":"unexposed",tag:i,hintDirection:a?s:void 0,visited:!1,pinned:!0,scoreReward:0,isAnswer:!1,isFrustration:!1,isTemporaryFrustration:!1},u.add(`${t.row}-${t.col}`)}}));const v=Math.min(l,H.length);for(let i=0;i<v;i++){const e=f();if(e){const t=p(e.row,e.col),a=t[Math.floor(Math.random()*t.length)],n=Y.tagToEncounterFlavorTag(H[i],r.UW.PUZZLE);o[e.row][e.col]={type:"hint",tag:n,hintDirection:a,visited:!1,pinned:!0,scoreReward:0,isAnswer:!1,isFrustration:!1,isTemporaryFrustration:!1},u.add(`${e.row}-${e.col}`)}}const y=Math.floor(4*Math.random())+1+s.extraFrustration;for(let r=0;r<y;r++){const e=f();e&&(o[e.row][e.col]={type:"frustration",visited:!1,pinned:!0,scoreReward:0,isAnswer:!1,isFrustration:!0,isTemporaryFrustration:!1},u.add(`${e.row}-${e.col}`))}const b=[];for(let r=0;r<s.rows;r++)for(let e=0;e<s.cols;e++)b.push({row:r,col:e});const E=Math.floor(.5*c),x=b.sort((()=>Math.random()-.5)).filter((e=>!o[e.row][e.col].isFrustration)),N=[],T="tricky"===i?6:4;N.push(T),"tricky"===i&&N.push(3,3),N.push(2,2,2);const C=E-N.length;for(let r=0;r<C;r++)N.push(1);for(let r=0;r<N.length&&r<x.length;r++){const e=x[r];o[e.row][e.col].scoreReward=N[r]}const A=b.find((e=>o[e.row][e.col].isAnswer));return A&&(o[A.row][A.col].scoreReward=T),o}),[i,l,z,Y,H]);(0,n.useEffect)((()=>{if("instructions"===a){const e=re();h(e),I("The players are considering what they know so far. You will need to call on one of them to start.")}}),[a,i,l,re]),(0,n.useEffect)((()=>{const e=se();G(e)}),[i,l,Y,se]),(0,n.useEffect)((()=>{const e=Y.getCollectedTags(),t=Y.locationTagsCollected,a=e.length-t.length;l>a&&c(Math.max(0,a))}),[i,Y,l]);const ie=()=>{K.exhaustParty(Ce()),s("instructions")},oe=()=>{const e=(e=>{const t=d(i),a=e.map((e=>e.map((e=>({...e}))))),n=[];for(let s=0;s<t.rows;s++)for(let e=0;e<t.cols;e++)a[s][e].pinned||n.push({row:s,col:e});if(n.length>0){const e=Y.generateRelevantFlavorTags(n.length,[r.UW.ENCOUNTER,r.UW.PUZZLE_ANSWER,r.UW.LOCATION,r.UW.QUEST,r.UW.QUEST_TERMINAL,r.UW.FORESHADOWING_RANDOM]);n.forEach(((t,n)=>{n<e.length&&(a[t.row][t.col]={type:"unexposed",tag:e[n],visited:!1,pinned:!1,scoreReward:a[t.row][t.col].scoreReward,tensionLevel:a[t.row][t.col].tensionLevel,isAnswer:!1,isFrustration:!1,isTemporaryFrustration:!1})}))}return a})(u);h(e),s("solving")},le=(e,t)=>{if("instructions"!==a&&("solving"!==a||m))return;const n=d(i),s=te(e,t,n),r=u[e][t].hintDirection;if(r){const a=ae(r,s);h((n=>{const s=[...n];return s[e][t]={...s[e][t],hintDirection:a},s}))}},ce=(e,t)=>{const a=d(i),n=[];for(let s=0;s<a.rows;s++)for(let e=0;e<a.cols;e++){const a=t[s][e];a.isFrustration||a.isTemporaryFrustration||n.push({row:s,col:e})}if(n.length>0){const t=n[Math.floor(Math.random()*n.length)];setTimeout((()=>{de(t.row,t.col,e)}),Bn)}},de=function(e,t,a){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const s=u[e][t];if(F({player:a,row:e,col:t,isVisible:!0}),n&&ue(e,t,a),n){var r,i,o;const n=[`${a.name} ponders ${(null===(r=s.tag)||void 0===r?void 0:r.tag.name)||"the puzzle"}`,`${a.name} examines the possibility of ${(null===(i=s.tag)||void 0===i?void 0:i.tag.name)||"a bug (this is a bug...really)"}`,`${a.name} looks into ${(null===(o=s.tag)||void 0===o?void 0:o.tag.name)||"the puzzle"}`,`${a.name} has an idea...`,`${a.name} points to something they wrote on their notes from earlier`,`${a.name} considers thoughtfully for a minute and makes a totally random guess`];I(n[Math.floor(Math.random()*n.length)]),h((a=>{const n=[...a];return n[e][t]={...n[e][t],isFlashing:!0},n})),setTimeout((()=>{v&&y(!1),h((n=>{const s=[...n];return s[e][t]={...s[e][t],visited:!0,playerIcon:a,isTemporaryFrustration:!0,isFlashing:!1},s})),C({row:e,col:t}),setTimeout((()=>{he(e,t,a,s)}),Bn)}),Bn)}else h((n=>{const s=[...n];return s[e][t]={...s[e][t],visited:!0,playerIcon:a,isTemporaryFrustration:!0},s})),C({row:e,col:t}),he(e,t,a,s)},ue=(e,t,a)=>{const n=500+195*t,s=300+195*e;D((a=>a?{...a,x:n,y:s,targetRow:e,targetCol:t}:null)),setTimeout((()=>{D(null)}),1e3)},he=(e,t,a,n)=>{if("hint"===n.type?(I(`${a.name} found a hint!`),me(e,t,a)):n.isFrustration?(I(`${a.name} is annoyed by the puzzle.`),pe(a)):n.isTemporaryFrustration?(I(`${a.name} already came to this conclusion earlier and is frustrated.`),pe(a)):n.isAnswer?(I(`${a.name} found the answer!`),fe(a)):"unexposed"===n.type?(I(`${a.name} considers a new topic!`),ve(e,t,a),R(!0)):"exposed"===n.type||"directionless"===n.type?(I(`${a.name} needs to choose a think...`),ye(e,t,a)):(I(`${a.name} explores the square...`),j(!1)),n.scoreReward>0&&(f((e=>e+n.scoreReward)),z.addEncounterPoints(n.scoreReward),h((a=>{const n=[...a];return n[e][t]={...n[e][t],scoreReward:0},n})),n.scoreReward=0),n.tensionLevel){const e=(e=>{switch(e){case"boring":return-5;case"low":return-2;case"high":return 2;case"crisis":return 5}})(n.tensionLevel);K.addPartyTension(e)}},me=(e,t,a)=>{const n=u[e][t].hintDirection;if(n){const s=ge(e,t,n);s?(K.exhaustParty(1),I(`Hint points ${n}! ${a.name} is following the hint...`),setTimeout((()=>{N([s]),I(`${a.name} is moving to the indicated square...`),setTimeout((()=>{N([]),h((a=>{const n=[...a];return n[e][t]={...n[e][t],visited:!0},n})),F((e=>e?{...e,row:s.row,col:s.col}:null)),de(s.row,s.col,a,!0)}),2e3)}),Bn)):(j(!1),R(!0))}else j(!1),R(!0)},ge=(e,t,a)=>{const n=d(i);switch(a){case"up":return e>0?{row:e-1,col:t}:null;case"down":return e<n.rows-1?{row:e+1,col:t}:null;case"left":return t>0?{row:e,col:t-1}:null;case"right":return t<n.cols-1?{row:e,col:t+1}:null}},pe=e=>{K.addEnjoyment(e,-1),K.updateAttention(e,-1);const t=[];t.push({object:e,effects:[{effect:"-1 Attention",class:"player-attention"},{effect:"-1 Attitude",class:"player-attitude"}]}),V.showModal({title:`${e.name} became frustrated!`,type:"puzzle",effectData:t,options:[{id:"continue",title:"Continue",description:`${e.name} became frustrated!`,callback:()=>{j(!1),R(!0),s("player-stopped")}}],onClose:()=>{j(!1),R(!0),s("player-stopped")}})},fe=e=>{const t=$(l,!1,i);z.addEncounterPoints(t);const a=[];Q.addPlayerExp(e,1),a.push({object:e,effects:[{effect:"+1 Experience",class:"player-exp"}]}),X.forEach((t=>{t.id!==e.id&&(K.addEnjoyment(t,1),a.push({object:t,effects:[{effect:"+1 Attitude",class:"player-attitude"}]}))})),V.showRewardModal(d(i).reward,!0),j(!1),R(!0)},ve=(e,t,a)=>{const n=u[e][t];if(n.tag){z.exposeTag(n.tag),h((a=>{const n=[...a];return n[e][t]={...n[e][t],type:"directionless",pinned:!0},n}));let r=`${a.name} investigated ${n.tag.tag.name}`;Math.random()>.5&&(r=`${a.name} thought ${n.tag.tag.name} was related somehow`),I(r),j(!1),R(!0),s("player-stopped")}else j(!1),R(!0),s("player-stopped")},ye=(e,t,a)=>{I(`${a.name} needs to choose what to do next...`),j(!1),R(!0),s("player-stopped")},be=()=>{var e;if(!m||!T||v||b>=2)return;X.forEach((e=>{e.id!==m.id&&K.updateAttention(e,-1)})),K.addPartyTension(-5*(b+1)),y(!0),E((e=>e+1)),R(!1),q.dmMessage(`Ah, close...${(null===(e=u[T.row][T.col].tag)||void 0===e?void 0:e.tag.name)||"that"} was misleading but you are close...`),I(`nudge ${m.name} in the right direction`);const t=Ee(T.row,T.col).filter((e=>!u[e.row][e.col].isAnswer));N(t)},Ee=(e,t)=>{const a=d(i),n=[];for(let s=e-1;s<=e+1;s++)for(let r=t-1;r<=t+1;r++)s>=0&&s<a.rows&&r>=0&&r<a.cols&&(s!==e||r!==t)&&n.push({row:s,col:r});return n},xe=e=>{const t=ee(e);K.addPartyTension(-t.tension);const a=[];X.forEach((e=>{K.addEnjoyment(e,-t.attitude),a.push({object:e,effects:[{effect:`-${t.attitude} Attitude`,class:"player-attitude"}]})})),K.addPartyTension(t.tension),a.push({object:"party",effects:[{effect:`+${t.tension}% Tension`,class:"tension"}]}),V.showModal({title:"Puzzle Abandoned",options:[{id:"ok",title:"Back to Session",callback:()=>{z.backToOverview()}}],type:"puzzle",effectData:a,onClose:()=>{z.backToOverview()}})},Ne=()=>{d(i);K.exhaustParty(10),L(!0),I("Click on hint squares to rotate their directions.")},Te=()=>{const e=d(i);C(null),(()=>{const e=d(i);h((t=>{const a=[...t];for(let n=0;n<e.rows;n++)for(let t=0;t<e.cols;t++)if("directionless"===a[n][t].type){const s=te(n,t,e),r=s[Math.floor(Math.random()*s.length)];a[n][t]={...a[n][t],type:"hint",hintDirection:r}}return a}))})(),h((t=>{const a=[...t];for(let n=0;n<e.rows;n++)for(let t=0;t<e.cols;t++){const s=a[n][t];if(s.visited=!1,"directionless"===s.type){const s=te(n,t,e),r=s[Math.floor(Math.random()*s.length)];a[n][t]={...a[n][t],type:"hint",hintDirection:r}}}return a})),g(null),_(null),F(null),s("solving"),L(!1)},Ce=()=>l*(e=>{switch(e){case"simple":return 1;case"clever":return 2;case"tricky":return 3}})(i),Ae=(e,t,n)=>{return"answer"===e.type?"This is the answer! Guide your players here with a trail of clues.":"hint"===e.type?"instructions"===a?"Prior discussions of "+((null===(s=e.tag)||void 0===s?void 0:s.tag.name)||" this ")+" will help the players solve the puzzle. Click to set the direction that this clue leads to.":"solving"!==a||m?"player-stopped"===a&&O?"Click to rotate the hint direction for "+((null===(r=e.tag)||void 0===r?void 0:r.tag.name)||" this hint")+".":"Prior discussions of "+((null===(i=e.tag)||void 0===i?void 0:i.tag.name)||" this ")+" will help the players solve the puzzle.":"Prior discussions of "+((null===(o=e.tag)||void 0===o?void 0:o.tag.name)||" this ")+" will help the players solve the puzzle. Click to adjust the hint direction before selecting a player.":"unexposed"===e.type?"instructions"===a?"You aren't yet sure what conclusions your players may come to.":x.some((e=>e.row===t&&e.col===n))?"Click to expose this tag and see what your players think.":"Players may come to the conclusion that this is relevant":"directionless"===e.type?"Your players arent sure how "+((null===(l=e.tag)||void 0===l?void 0:l.tag.name)||"stuff ")+" relates to the puzzle, so you aren't sure how they will react.":"exposed"===e.type?"Exposed Tag: Relevance unknown.":"frustration"===e.type?"A player reaching this will become frustrated and lose one attitude.":"Empty Square: No special properties.";var s,r,i,o,l},Se=(e,t,n)=>{const s=x.some((e=>e.row===t&&e.col===n)),o=(null===T||void 0===T?void 0:T.row)===t&&(null===T||void 0===T?void 0:T.col)===n,l=("solving"===a||"player-stopped"===a)&&s&&!M||"instructions"===a&&"hint"===e.type||"solving"===a&&!m&&"hint"===e.type||"player-stopped"===a&&O&&"hint"===e.type;return(0,Xe.jsx)(ra,{content:Ae(e,t,n),position:"top",translate:[-50,-50],children:(0,Xe.jsxs)("div",{className:`grid-cell ${e.type} ${s?"highlighted":""} ${o?"player-position":""} ${e.isFlashing?"flashing":""}`,style:{cursor:l?"pointer":"default"},onClick:()=>{"solving"!==a&&"player-stopped"!==a||!s||M?"instructions"===a&&"hint"===e.type?le(t,n):"solving"!==a||m||"hint"!==e.type?"player-stopped"===a&&O&&"hint"===e.type&&((e,t)=>{if(!O||"player-stopped"!==a)return;const n=d(i),s=te(e,t,n),r=u[e][t].hintDirection;if(r){const a=ae(r,s);h((n=>{const s=[...n];return s[e][t]={...s[e][t],hintDirection:a},s}))}})(t,n):le(t,n):(N([]),de(t,n,m))},children:[e.scoreReward>0&&(0,Xe.jsx)("div",{className:"score-reward",children:(0,Xe.jsx)(Ka,{score:e.scoreReward})}),e.tensionLevel&&(0,Xe.jsx)("div",{className:"tension-indicator",style:{color:(c=e.tensionLevel,"boring"===c||"low"===c?"black":"orange")},children:ne(e.tensionLevel)}),(0,Xe.jsx)("div",{className:"cell-tag",children:"hint"===e.type?(0,Xe.jsx)("div",{className:"hint-tag",children:e.tag&&(0,Xe.jsx)(aa,{tag:e.tag,showTooltip:!1})}):"exposed"===e.type||"directionless"===e.type?(0,Xe.jsx)("div",{className:"exposed-tag",children:e.tag&&(0,Xe.jsx)(aa,{tag:e.tag,showTooltip:!1})}):e.tag?(0,Xe.jsx)(aa,{tag:e.tag,showTooltip:!1}):"unexposed"===e.type?(0,Xe.jsx)("div",{className:"unexposed-tag",children:(0,Xe.jsx)(aa,{tag:Y.tagToEncounterFlavorTag({name:"?"},r.UW.NONE),showTooltip:!1})}):null}),"hint"===e.type&&e.hintDirection&&(0,Xe.jsxs)("div",{className:`grid-hint-arrow ${e.hintDirection} ${e.visited?"visited":""}`,children:["up"===e.hintDirection&&"\u25b2","down"===e.hintDirection&&"\u25bc","left"===e.hintDirection&&"\u25c0","right"===e.hintDirection&&"\u25b6"]}),e.visited&&"directionless"!==e.type&&(0,Xe.jsx)("div",{className:"visited-overlay"}),e.isAnswer&&(0,Xe.jsx)("div",{className:"answer-indicator"}),e.isFrustration&&(0,Xe.jsx)("div",{className:"frustration-indicator",children:"?!"})]},`${t}-${n}`)},`tooltip-${t}-${n}`);var c};return(0,Xe.jsxs)("div",{className:"game-encounter-puzzle",children:[(0,Xe.jsx)(yn,{title:(()=>{const e=z.getCurrentEvent();return e&&e.flavorText?e.flavorText:"Puzzle Event"})(),description:"You've been leaving clues leading up to this all along.",childClass:"small-font"}),(0,Xe.jsxs)("div",{className:"puzzle-content",children:["setup"!==a&&(0,Xe.jsx)("div",{className:"puzzle-left",children:(()=>{if(0===u.length)return null;const e=d(i);return(0,Xe.jsxs)("div",{className:"grid-container",children:[(0,Xe.jsxs)("div",{className:"grid-hint-instructions",children:["Click hints and location clues"," ",(0,Xe.jsx)("span",{className:"hint-symbol",children:(0,Xe.jsx)("span",{className:"hint-pill",children:(0,Xe.jsx)("span",{className:"hint-arrow-symbol",children:"\u25b2"})})})," ","to indicate where discussions will lead."]}),(0,Xe.jsxs)("div",{className:"puzzle-grid",style:{gridTemplateRows:`repeat(${e.rows}, 1fr)`,gridTemplateColumns:`repeat(${e.cols}, 1fr)`,position:"relative"},children:[u.map(((e,t)=>e.map(((e,a)=>Se(e,t,a))))),B&&B.isVisible&&(0,Xe.jsx)("div",{className:"grid-player-icon",style:{position:"absolute",left:B.col/e.cols*100+"%",top:B.row/e.rows*100+"%",width:100/e.cols+"%",height:100/e.rows+"%"},children:(0,Xe.jsx)(Je,{imageId:B.player.icon})})]}),(0,Xe.jsxs)("div",{className:"grid-legend",children:[(0,Xe.jsxs)("div",{className:"legend-item",children:[(0,Xe.jsx)("span",{className:"legend-frustration",children:"?!"}),(0,Xe.jsx)("span",{className:"legend-text",children:"Frustration: -1 active player Attitude"})]}),(0,Xe.jsxs)("div",{className:"legend-item",children:[(0,Xe.jsx)("span",{className:"legend-dice-score",children:(0,Xe.jsx)(Ka,{score:4})})," ","and"," ",(0,Xe.jsx)("span",{className:"legend-dice-score",children:(0,Xe.jsx)(Ka,{score:1})})," ","Interesting topics: adds potential score"]})]})]})})()}),"setup"===a?(0,Xe.jsx)("div",{className:"puzzle-setup-container",children:(()=>{const e=Y.getCollectedTags(),t=Y.locationTagsCollected,a=e.length-t.length,n=Math.min(8,a),s=H.slice(0,n);return(0,Xe.jsxs)("div",{className:"puzzle-setup-modal",children:[(0,Xe.jsx)("div",{className:"setup-header",children:(0,Xe.jsx)("h2",{children:"Adjust Difficulty and Hints"})}),(0,Xe.jsx)("div",{className:"difficulty-options",children:["simple","clever","tricky"].map((e=>{const t="simple"===e?4:"clever"===e?6:9,a=d(e);return(0,Xe.jsxs)("div",{className:"difficulty-option "+(i===e?"selected":""),onClick:()=>o(e),children:[(0,Xe.jsx)("div",{className:"difficulty-name",children:e.toUpperCase()}),(0,Xe.jsx)("div",{className:"difficulty-icon",children:Array.from({length:t}).map(((e,t)=>(0,Xe.jsx)("div",{className:"icon-square"},t)))}),(0,Xe.jsxs)("div",{className:"party-reward",children:[(0,Xe.jsx)("span",{className:"reward-label",children:"Party Reward"}),(0,Xe.jsx)("span",{className:"reward-value",children:a.reward})]})]},e)}))}),a>0&&(0,Xe.jsxs)("div",{className:"hints-control",children:[(0,Xe.jsxs)("div",{className:"hints-header",children:[(0,Xe.jsxs)("span",{children:["Hints: ",l]}),(0,Xe.jsxs)("div",{className:"hint-arrows",children:[(0,Xe.jsx)("button",{className:"hint-arrow",onClick:()=>c(Math.min(n,l+1)),disabled:l>=n,children:"\u25b2"}),(0,Xe.jsx)("button",{className:"hint-arrow",onClick:()=>c(Math.max(0,l-1)),disabled:l<=0,children:"\u25bc"})]})]}),l>=n&&(0,Xe.jsx)("div",{className:"hints-limit-info",children:"(Limited by previously discussed topics)"}),l>0&&(0,Xe.jsxs)("span",{className:"hint-info",children:["You've been leaving clues and crafting this puzzle all",(0,Xe.jsx)("br",{})," along using the following topics as hints."]}),(0,Xe.jsxs)("div",{className:"available-hint-tags",children:[s.slice(0,l).map(((e,t)=>(0,Xe.jsx)(aa,{tag:Y.tagToEncounterFlavorTag(e,r.UW.PUZZLE),showTooltip:!1},t))),0===l&&(0,Xe.jsx)("span",{className:"no-hints",children:"\u2298"})]}),l>0&&(0,Xe.jsxs)("span",{className:"exhaustion-info",children:["Exhaustion:",Ce()]}),(0,Xe.jsxs)("div",{className:"score-display",children:[(0,Xe.jsx)("span",{children:"Solving score: "}),(0,Xe.jsx)(Ka,{score:$(l,0===a,i)})]})]}),0===a&&(0,Xe.jsx)("div",{className:"no-hints-display",children:(0,Xe.jsxs)("div",{className:"score-info",children:[(0,Xe.jsx)("div",{className:"hint-rewards-note",children:"No hints available."}),(0,Xe.jsx)("div",{className:"hint-rewards-sub",children:(0,Xe.jsx)("i",{children:"Discuss topics with your players before asking them to solve puzzles!"})}),(0,Xe.jsxs)("div",{className:"score-display",children:[(0,Xe.jsx)("span",{children:"Score if players solve: "}),(0,Xe.jsx)(Ka,{score:$(0,!0,i)})]})]})}),(0,Xe.jsx)("div",{className:"setup-actions",children:(0,Xe.jsx)("button",{className:"present-puzzle-btn",onClick:ie,children:"PRESENT PUZZLE"})})]})})()}):(0,Xe.jsxs)("div",{className:"puzzle-right",children:["instructions"===a&&(()=>{var e,t,a;return(0,Xe.jsxs)("div",{className:"puzzle-instructions",children:[(0,Xe.jsx)("div",{className:"instructions-header",children:(0,Xe.jsxs)("h3",{children:[(null===(e=z.getCurrentEvent())||void 0===e||null===(t=e.tags)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.name)||""," Puzzle"]})}),(0,Xe.jsx)("div",{className:"instructions-content",children:(0,Xe.jsx)("p",{children:"In addition to clues you have left so far leading up to this puzzle, the players will use things they have learned about the current location to make guesses. Direct them to a desired outcome by modifying where the clues lead. Be careful, certain paths or cirular logic leads to frustration."})}),(0,Xe.jsx)("button",{className:"players-attempt-btn",onClick:oe,children:"BEGIN"})]})})(),"solving"===a&&(e=>{const t=ee(e);return(0,Xe.jsxs)("div",{className:"puzzle-solving",children:[(0,Xe.jsx)("div",{className:"solving-header",children:(0,Xe.jsx)("h3",{children:"Prompt a player to solve the puzzle"})}),k&&(0,Xe.jsxs)("div",{className:"current-step",children:[k,U&&U.isVisible&&(0,Xe.jsx)("div",{className:"current-step-player-icon",children:(0,Xe.jsx)(Je,{imageId:U.player.icon})})]}),(0,Xe.jsx)("div",{className:"player-selection",children:X.map((e=>{const t=A.has(e.id),n=(null===m||void 0===m?void 0:m.id)===e.id;return(0,Xe.jsxs)("button",{className:`player-btn ${n?"selected":""} ${t?"used":""}`,onClick:()=>(e=>{"solving"!==a||A.has(e.id)||M||(g(e),y(!1),C(null),j(!0),R(!1),I(`${e.name} looks through their notes fom earlier in the session...`),_({player:e,isVisible:!0}),S((t=>new Set([...t,e.id]))),F(null),setTimeout((()=>{ce(e,u)}),250))})(e),disabled:t||!w,children:[(0,Xe.jsx)("div",{className:"player-icon-container",children:(0,Xe.jsx)("div",{className:"player-icon-display",children:(0,Xe.jsx)(Je,{imageId:e.icon})})}),(0,Xe.jsx)("span",{className:"player-name",children:e.name}),t&&(0,Xe.jsx)("span",{className:"used-indicator",children:"\u2713"})]},e.id)}))}),(0,Xe.jsxs)("button",{className:"abandon-btn",onClick:()=>xe(e),disabled:!w,children:["Abandon Puzzle",(0,Xe.jsxs)("div",{className:"btn-subtitle",children:["-",t.attitude," attitude"]}),t.tension>0&&(0,Xe.jsxs)("div",{className:"btn-subtitle",children:["-",t.tension," tension"]})]})]})})(p),"player-stopped"===a&&(e=>{const t=ee(e);console.log("renderPlayerStoppedPhase - currentScore:",e,"abandonmentCost:",t);const a=X.filter((e=>!A.has(e.id)));return(0,Xe.jsxs)("div",{className:"puzzle-solving",children:[k&&(0,Xe.jsx)("div",{className:"current-step",children:k}),(0,Xe.jsxs)("div",{className:"player-stopped-options",children:[a.length>0&&(0,Xe.jsxs)("button",{className:"next-player-btn",onClick:Te,disabled:!w||0===a.length,children:["Next Player",(0,Xe.jsx)("div",{className:"btn-subtitle",children:"continue with another player"})]}),Z()>0&&(0,Xe.jsxs)("button",{className:"so-close-btn",onClick:be,disabled:!w||b>=2,children:["Suggest",(0,Xe.jsx)("div",{className:"btn-subtitle",children:"Guide current player to an adjacent topic."}),(0,Xe.jsx)("div",{className:"btn-subtitle",children:"Other players lose 1 attention"})]}),(a.length>0||Z()>0)&&(0,Xe.jsxs)("button",{className:"adjust-hints-btn",onClick:Ne,disabled:!w||!J(),children:["Adjust Hints",(0,Xe.jsx)("div",{className:"btn-subtitle",children:"modify hint directions"})]}),(0,Xe.jsxs)("button",{className:"abandon-btn",onClick:()=>xe(e),disabled:!w,children:["Abandon Puzzle",(0,Xe.jsxs)("div",{className:"btn-subtitle",children:["-",t.attitude," attitude"]}),t.tension>0&&(0,Xe.jsxs)("div",{className:"btn-subtitle",children:["-",t.tension," tension"]})]})]})]})})(p)]})]}),P&&P.isAnimating&&(0,Xe.jsx)("div",{className:"floating-player-icon",style:{position:"absolute",left:P.x,top:P.y,zIndex:1e3,transition:"all 1s ease-in-out"},children:(0,Xe.jsx)(Je,{imageId:P.player.icon})})]})},Hn=e=>{let{encounter:t}=e;return(0,Xe.jsx)("div",{className:"game-encounter-combat",children:(0,Xe.jsx)("div",{className:"encounter-type-title",children:"Story"})})},Gn=e=>{var t;let{effectData:a}=e;const n=(e,t)=>{if("attribute-gains"===e.class)try{const a=(e=>{const t=[];return e[r.Eh.COMBAT]&&e[r.Eh.COMBAT]>0&&t.push((0,Xe.jsxs)("div",{className:"attribute-gain-item",children:[(0,Xe.jsx)("span",{className:"attribute-icon combat",children:"\u2694\ufe0f"}),(0,Xe.jsxs)("span",{className:"attribute-value",children:["+",e[r.Eh.COMBAT]]})]},"combat")),e[r.Eh.MAGIC]&&e[r.Eh.MAGIC]>0&&t.push((0,Xe.jsxs)("div",{className:"attribute-gain-item",children:[(0,Xe.jsx)("span",{className:"attribute-icon magic",children:"\u2728"}),(0,Xe.jsxs)("span",{className:"attribute-value",children:["+",e[r.Eh.MAGIC]]})]},"magic")),e[r.Eh.TOOLS]&&e[r.Eh.TOOLS]>0&&t.push((0,Xe.jsxs)("div",{className:"attribute-gain-item",children:[(0,Xe.jsx)("span",{className:"attribute-icon tools",children:"\ud83d\udd27"}),(0,Xe.jsxs)("span",{className:"attribute-value",children:["+",e[r.Eh.TOOLS]]})]},"tools")),t.length>0?(0,Xe.jsx)("div",{className:"attribute-gains-container",children:t}):null})(JSON.parse(e.effect));return a?(0,Xe.jsx)("div",{className:`effect-display-effect ${e.class}`,children:a},t):null}catch(a){return(0,Xe.jsx)("div",{className:`effect-display-effect ${e.class}`,children:e.effect},t)}return(0,Xe.jsx)("div",{className:`effect-display-effect ${e.class}`,children:e.effect},t)};return(0,Xe.jsxs)("div",{className:"effect-display",children:[(0,Xe.jsxs)("div",{className:"effect-display-header",children:[(0,Xe.jsx)("div",{className:"effect-display-name",children:"party"===a.object?"Party":a.object.name}),"party"!==a.object&&a.object.icon&&(0,Xe.jsx)(Je,{imageId:a.object.icon})]}),null===(t=a.effects)||void 0===t?void 0:t.map(((e,t)=>n(e,t)))]})},Wn=e=>{let{resultConfig:t,renderResultInfo:a,onClose:n,onTagClick:s,selectedTags:r,remainingClicks:i}=e;return(0,Xe.jsx)("div",{className:"results-panel",children:(0,Xe.jsxs)("div",{className:"results-panel-container",children:[(0,Xe.jsxs)("div",{className:"results-panel-header",children:[t.title,(0,Xe.jsx)("div",{className:"results-panel-description",children:t.description}),(0,Xe.jsx)("button",{className:"close-button",onClick:n,children:"\xd7"})]}),(0,Xe.jsx)("div",{className:"result-info",children:a()}),(0,Xe.jsx)("div",{className:"travel-results",children:t.results.map(((e,t)=>(0,Xe.jsx)(Gn,{effectData:e},t)))}),t.tags.length>0&&i>0&&(0,Xe.jsxs)("div",{className:"travel-tag-container",children:[(0,Xe.jsx)("div",{className:"clicks-remaining",children:(0,Xe.jsx)(ra,{content:"Click on the tags to reveal them.",maxWidth:"200",preservePositioning:!0,translate:[0,-80],children:i})}),(0,Xe.jsx)("div",{className:"travel-tags-instructions",children:t.travelOption.tagInstructions}),(0,Xe.jsx)("div",{className:"travel-tags-container",children:(0,Xe.jsx)("div",{className:"travel-tags",children:t.tags.map((e=>{const t=r.includes(e.tag);return(0,Xe.jsx)(aa,{tag:e,onClick:s,className:""+(t?"used":""),disabled:t},e.tag.name)}))})})]}),i>0&&0===t.tags.length&&(0,Xe.jsx)("div",{className:"remaining-clicks-warning",children:"Nothing new to present to the players."}),(0===t.tags.length||0===i)&&(0,Xe.jsx)("div",{className:"bottom-container",children:(0,Xe.jsx)("div",{className:"return-button "+(i>0?"disabled":""),onClick:n,children:"Return"})})]})})},zn=e=>{let{travelOption:t,theme:a,onClick:n,length:s}=e;const{id:i,name:o,description:l,time:c,tags:d,score:u,boredom:h,tag:m,exhaustion:g,travelOptionType:p}=t,f=Rt(),v=kt().getEventTag(t),y=e=>f.getTagManager().collectedTags.includes(e),b=e=>-1===e?"?":e,E=v&&!y(v);return(0,Xe.jsxs)("div",{className:`travel-option ${s} ${E?"locked":"unlocked"}`,onClick:n,children:[E&&(0,Xe.jsx)("div",{className:"locked-banner",children:(0,Xe.jsx)(ra,{content:`Unlocked by introducing ${null===v||void 0===v?void 0:v.name}`,preservePositioning:!1,children:(0,Xe.jsx)("span",{children:"UNDISCOVERED"})})}),(0,Xe.jsxs)("div",{className:"travel-option-header",children:[(0,Xe.jsx)("span",{className:"travel-option-name",children:o}),v&&(0,Xe.jsx)(bn,{tooltip:"Unlocked from previous discussions about "+v.name,visible:!E,preservePositioning:!0,translate:[0,-40],children:(0,Xe.jsx)("span",{className:"travel-option-tag text-pill type-travel "+(y(v)?"":"missing"),children:v.name})}),(0,Xe.jsx)("div",{className:"travel-option-description",children:l})]})," ",(0,Xe.jsx)(bn,{tooltip:"Journey Length increase",visible:!E,preservePositioning:!0,translate:[100,-80],children:(0,Xe.jsxs)("span",{className:"travel-option-detail",children:["\ud83d\udd52:",b(c)]})}),(0,Xe.jsx)(bn,{tooltip:"Boredom Risk Increase",visible:!E,preservePositioning:!0,translate:[-110,-80],children:(0,Xe.jsxs)("span",{className:"travel-option-detail time",children:["\ud83d\udc41\ufe0f:",b(h)]})}),d>0&&(0,Xe.jsx)(bn,{tooltip:t.tagInstructions||"Location tags",visible:!E,preservePositioning:!0,translate:[-135,10],children:(0,Xe.jsx)("span",{className:`travel-option-detail tags text-pill ${E?"disabled":""} ${(e=>{switch(e){case r.HU.EXPLORE_CURRENT_LOCATION:return"type-explore-current";case r.HU.EXPLORE_UPCOMING_LOCATION:return"type-explore-upcoming";case r.HU.CAMP:return"type-camp";case r.HU.AMBUSH:case r.HU.AMBUSH2:return"type-ambush";case r.HU.TRADERS:return"type-traders";case r.HU.SIDE_QUEST:return"type-sidequest";case r.HU.MAGIC_CACHE:return"type-magic-item";case r.HU.CHARACTER_BACKSTORY:return"type-backstory";default:return""}})(t.travelOptionType)}`,children:(0,Xe.jsx)("div",{className:"travel-option-tag-label",children:d})})})," ",void 0!==u&&0!==u&&(0,Xe.jsx)(bn,{tooltip:"Impact on campaign score",visible:!E,preservePositioning:!0,children:(0,Xe.jsxs)("span",{className:"travel-option-detail score",children:["Score: ",b(u)]})})," ",void 0!==g&&0!==g&&(0,Xe.jsx)(bn,{tooltip:"Party Exhaustion increase",visible:!E,preservePositioning:!0,children:(0,Xe.jsxs)("span",{className:"travel-option-detail score",children:["Exhaustion: ",b(g)]})})]})},Qn=e=>{var t;let{encounter:a}=e;const[s,i]=(0,n.useState)([]),[o,l]=(0,n.useState)(""),[c,d]=(0,n.useState)([]),u=Rt(),h=u.getTagManager(),m=kt(),g=jt(),[p]=(u.getPartyManager(),(0,n.useState)(m.getTravelOptions())),[f,v]=(0,n.useState)(null),[y,b]=(0,n.useState)([]),[E,x]=(0,n.useState)(0),[N,T]=(0,n.useState)(0),[C,A]=(0,n.useState)(!1),[S,M]=(0,n.useState)(),[j,w]=(0,n.useState)(null),[R,k]=(0,n.useState)(0);(0,n.useEffect)((()=>{I()}),[]);const I=()=>{const e=["SHORT","GOOD","GREAT","EPIC"],t=Math.floor(Math.random()*e.length),a=e[t];let n=[];if("EPIC"===a)n=["GOOD","GREAT"];else if("SHORT"===a)n=["FUTILE","GOOD"];else{const s=Math.max(0,t-1),r=Math.min(e.length-1,t+1);n=[e[s],e[r]].filter((e=>e!==a))}l(a),d(n)},O=e=>e>=80?{rating:"EPIC",score:100}:e>=60?{rating:"GREAT",score:75}:e>=40?{rating:"GOOD",score:50}:e>=20?{rating:"SHORT",score:25}:{rating:"FUTILE",score:0},L=e=>e>=66?"ZERO":e>=33?"LOW":"BASIC",P=e=>{var t;const a={...e};-1===a.time&&(a.time=Math.floor(10*Math.random())+1),-1===a.boredom&&(a.boredom=Math.floor(10*Math.random())+1),T(Math.min(N+a.boredom,100)),x(Math.min(E+a.time,100)),e.repeatable||i((t=>[...t,e.id]));const n=m.selectTravelOption(a,N),s=null===n||void 0===n||null===(t=n.travelResults.find((e=>(null===e||void 0===e?void 0:e.object)&&"party"!==e.object)))||void 0===t?void 0:t.object;w(s&&"party"!==s?s:null);const r=(null===n||void 0===n?void 0:n.travelResults)||[],o=((null===n||void 0===n?void 0:n.travelTags)||[]).filter((e=>!h.isTagCollected(e.tag)));v(e),M({results:r,title:e.name,description:e.description,tags:o,travelOption:e,info:{boredom:e.boredom,score:e.score,time:e.time,exhaustion:e.exhaustion||0}}),k(e.tags),A(!0)},D=e=>{if(R>0&&k(R-1),(null===f||void 0===f?void 0:f.travelOptionType)===r.HU.CHARACTER_BACKSTORY)g.assignBackstory(j,e.tag);else m.exposeTag(e);b([...y,e.tag])},U=(e,t)=>{const a=e.filter((e=>!s.includes(e.id))).sort((()=>.5-Math.random()));return a.slice(0,Math.min(t,a.length))},_=U(p[0],3),B=U(p[1],3),F=U(p[2],3),H=()=>S?(0,Xe.jsxs)(Xe.Fragment,{children:[(0,Xe.jsx)("div",{className:"travel-result-info-item boredom",children:(0,Xe.jsxs)(ra,{content:"Boredom risk is a measure of player patience and quality of the event.",children:["\ud83d\udc41\ufe0f Boredom Risk : +",S.info.boredom]})}),(0,Xe.jsx)("div",{className:"travel-result-info-item time",children:(0,Xe.jsxs)(ra,{content:"Journey Length is an indication of time passing in game.",children:["\ud83d\udd52 Journey Length : +",S.info.time]})})]}):null;return(0,Xe.jsxs)("div",{className:"game-encounter-travel-container",children:[(0,Xe.jsx)(yn,{title:`Travel through ${a.location.name}`,description:(null===(t=m.getCurrentEvent())||void 0===t?void 0:t.flavorText)||"",instructions:[!0,!0],childClass:"small-font"}),(0,Xe.jsxs)("div",{className:"game-encounter-travel",children:[(0,Xe.jsx)(ra,{content:"Every action applies the current Boredom Risk which may result in loss of attention",children:(0,Xe.jsxs)("div",{className:"travel-meter-container left",children:[(0,Xe.jsx)("div",{className:"travel-meter-label",children:"Boredom Risk \ud83d\udc41\ufe0f"}),(0,Xe.jsxs)("div",{className:"travel-meter-container left2",children:[(0,Xe.jsxs)("div",{className:"travel-thermometer",children:[(0,Xe.jsx)("div",{className:"meter-fill",style:{height:`${N}%`},children:(0,Xe.jsx)("span",{className:"meter-value",children:N})}),(0,Xe.jsx)("div",{className:"meter-markers",children:[0,33,66,100].map((e=>(0,Xe.jsx)("div",{className:"marker",children:(0,Xe.jsx)("span",{className:"marker-value",children:e})},e)))})]}),(0,Xe.jsxs)("div",{className:"travel-sections",children:[(0,Xe.jsxs)("div",{className:"travel-section zero "+("ZERO"===L(N)?"active":""),children:[(0,Xe.jsx)("span",{className:"section-label title",children:"HIGH"}),(0,Xe.jsx)("span",{className:"section-label details",children:"Attention Loss"}),(0,Xe.jsx)("span",{className:"section-label details",children:"15% Attitude Loss"}),(0,Xe.jsx)("span",{className:"section-label details",children:"-10 Tension"})]}),(0,Xe.jsxs)("div",{className:"travel-section low "+("LOW"===L(N)?"active":""),children:[(0,Xe.jsx)("span",{className:"section-label title",children:"RISING"}),(0,Xe.jsx)("span",{className:"section-label details",children:"50% Attention Loss"}),(0,Xe.jsx)("span",{className:"section-label details",children:"5% Attitude Loss"}),(0,Xe.jsx)("span",{className:"section-label details",children:"-10 Tension"})]}),(0,Xe.jsxs)("div",{className:"travel-section basic "+("BASIC"===L(N)?"active":""),children:[(0,Xe.jsx)("span",{className:"section-label title",children:"LOW"}),(0,Xe.jsx)("span",{className:"section-label details",children:"20% Chance of Boredom"}),(0,Xe.jsx)("span",{className:"section-label details",children:"-5 Tension"})]})]})]})]})}),C?S?(0,Xe.jsx)(Wn,{resultConfig:S,renderResultInfo:H,onClose:()=>A(!1),onTagClick:D,selectedTags:y,remainingClicks:R}):null:(0,Xe.jsxs)("div",{className:"travel-options-panel",children:[(0,Xe.jsxs)("div",{className:"travel-options-container short",children:[(0,Xe.jsx)("div",{className:"travel-section-title",children:"Short Tasks"}),(0,Xe.jsx)("div",{className:"travel-options",children:_.map((e=>(0,Xe.jsx)(zn,{travelOption:e,onClick:()=>P(e),length:r.wc.SHORT},e.id)))})]}),(0,Xe.jsxs)("div",{className:"travel-options-container medium",children:[(0,Xe.jsx)("div",{className:"travel-section-title",children:"Moderate Events"}),(0,Xe.jsx)("div",{className:"travel-options",children:B.map((e=>(0,Xe.jsx)(zn,{travelOption:e,onClick:()=>P(e),length:r.wc.MEDIUM},e.id)))})]}),(0,Xe.jsxs)("div",{className:"travel-options-container long",children:[(0,Xe.jsx)("div",{className:"travel-section-title",children:"Extensive Travel Options"}),(0,Xe.jsx)("div",{className:"travel-options",children:F.map((e=>(0,Xe.jsx)(zn,{travelOption:e,onClick:()=>P(e),length:r.wc.LONG},e.id)))})]})]}),(0,Xe.jsx)(ra,{content:"Accepting the journey will award any highlighted score",children:(0,Xe.jsxs)("div",{className:"right-meter-container",children:[(0,Xe.jsx)("div",{className:"travel-meter-label",children:"Journey Length \ud83d\udd52"}),(0,Xe.jsxs)("div",{className:"travel-meter-container",children:[(0,Xe.jsx)("div",{className:"travel-sections",children:["FUTILE","SHORT","GOOD","GREAT","EPIC"].map((e=>(0,Xe.jsx)("div",{className:`travel-section ${e.toLowerCase()} ${e===O(E).rating?"active":""}`,children:(0,Xe.jsxs)("span",{className:"section-label",children:[e,e===o&&(0,Xe.jsx)("span",{className:"dm-points reward big-reward",children:(0,Xe.jsx)(Ka,{score:8,direction:"row",className:"small"})}),c.includes(e)&&(0,Xe.jsx)("span",{className:"dm-points reward small-reward",children:(0,Xe.jsx)(Ka,{score:3,direction:"row",className:"small"})})]})},e)))}),(0,Xe.jsxs)("div",{className:"travel-thermometer journey",children:[(0,Xe.jsx)("div",{className:"meter-fill",style:{height:`${E}%`},children:(0,Xe.jsx)("span",{className:"meter-value",children:E})}),(0,Xe.jsx)("div",{className:"meter-markers",children:[0,20,40,60,80,100].map((e=>(0,Xe.jsx)("div",{className:"marker",children:(0,Xe.jsx)("span",{className:"marker-value",children:e})},e)))})]})]}),(0,Xe.jsxs)("div",{className:"accept-journey-button "+(C?" disabled":""),onClick:()=>{const e=O(E).rating;e===o?m.collectEncounterPoints(8):c.includes(e)&&m.collectEncounterPoints(3),m.backToOverview()},children:["Accept ",O(E).rating.toUpperCase()," ","journey"]})]})})]})]})},Vn=e=>{let{size:t,color:a,style:n}=e;return(0,Xe.jsx)("div",{style:{position:"absolute",width:t,height:t,...n},children:(0,Xe.jsx)("div",{style:{position:"absolute",width:.6*t,height:.6*t,borderRadius:"50%",backgroundColor:a,left:"20%",top:"20%"}})})},Yn={town:{backgroundColor:"#765f4a",shapes:[{type:"rectangle",minSize:7,maxSize:14,count:{min:10,max:20},color:"#695a4b",rotate:!1}]},forest:{backgroundColor:"#2F4F2F",shapes:[{type:"tree",minSize:80,maxSize:200,count:{min:50,max:100},color:"#1B3B1B"}]},brewery:{backgroundColor:"#765f4a",shapes:[{type:"furniture",minSize:80,maxSize:200,count:{min:50,max:100},color:"#695a4b"}]},building:{backgroundColor:"#765f4a",shapes:[{type:"furniture",minSize:80,maxSize:200,count:{min:50,max:100},color:"#695a4b"}]},mountain:{backgroundColor:"#6B6B6B",shapes:[{type:"rectangle",minSize:7,maxSize:10,count:{min:50,max:100},color:"#787878"}]},cave:{backgroundColor:"#6B6B6B",shapes:[{type:"rectangle",minSize:7,maxSize:10,count:{min:50,max:100},color:"#787878"}]},dungeon:{backgroundColor:"#333",shapes:[{type:"wall",count:{min:1,max:1},minSize:100,maxSize:100,rotate:!1,color:"#2b2b2b"}]}},Kn=e=>{const t=[],a=Math.floor(Math.random()*(e.count.max-e.count.min+1))+e.count.min;for(let n=0;n<a;n++){const a=Math.floor(Math.random()*(e.maxSize-e.minSize+1))+e.minSize;let s=100*Math.random()+"%",r=100*Math.random()+"%";"wall"===e.type&&(s="0%",r="0%");const i={left:s,top:r,transform:e.rotate?`rotate(${360*Math.random()}deg)`:""};t.push({id:n,size:a,style:i,type:e.type,color:e.color})}return t},qn=e=>{let{theme:t,regenKey:a}=e;const n=Yn[t],s=n.shapes.flatMap(Kn);return(0,Xe.jsx)("div",{className:`encounter-scenery-container ${t}`,style:{backgroundColor:n.backgroundColor},children:(0,Xe.jsx)("div",{className:"encounter-scenery-background",children:s.map((e=>{switch(e.type){case"tree":return(0,Xe.jsx)(Vn,{...e,style:e.style||{}},e.id);case"rectangle":const t=e.size+Math.random()*e.size/2+"%",a=e.size+Math.random()*e.size/2+"%";return(0,Xe.jsx)("div",{style:{position:"absolute",width:t,height:a,backgroundColor:e.color,...e.style}},e.id);case"wall":return(0,Xe.jsx)("div",{className:"wall-pattern",style:{position:"absolute",width:e.size+"%",height:e.size+"%",opacity:.8,left:"0%",top:"0%",...e.style}},e.id);default:return null}}))})})},Xn=e=>{let{encounter:t}=e;const[a]=(0,n.useState)(5),[s]=(0,n.useState)(20),[i,o]=(0,n.useState)(0),[l,c]=(0,n.useState)([]),[d,u]=(0,n.useState)([]),[h,m]=(0,n.useState)(null),[g,p]=(0,n.useState)({combat:0,magic:0,tools:0}),[f,v]=(0,n.useState)(null),[y,b]=(0,n.useState)([]),[E,x]=(0,n.useState)(!1),[N,T]=(0,n.useState)(null),[C,A]=(0,n.useState)(!1),S=Rt(),M=kt(),j=wt(),w=S.getCharacterManager(),R=S.getTagManager(),k=S.getPartyManager(),I=j.getPlayers(),O=I.flatMap((e=>e.characters.map((t=>({character:t,player:e})))));(0,n.useEffect)((()=>{L()}),[]);const L=()=>{c([{id:"start",name:"Dungeon Entrance",flavorText:"You stand before the dark entrance to the ancient dungeon. The air is thick with mystery and danger.",combat:0,magic:0,tools:0,isCompleted:!1}]),o(0)},P=()=>{const e=[],t={id:"party",type:"party",characters:O.map((e=>e.character)),players:I,combat:D(r.Eh.COMBAT),magic:D(r.Eh.MAGIC),tools:D(r.Eh.TOOLS),dmReward:Math.floor(3*Math.random())+1};e.push(t);for(let a=0;a<3;a++){const t=Math.floor(3*Math.random())+1,n=[];for(let e=0;e<t&&e<O.length;e++){const e=O[Math.floor(Math.random()*O.length)];n.some((t=>t.character.id===e.character.id))||n.push(e)}const s={id:`option_${a}`,type:"character",characters:n.map((e=>e.character)),players:n.map((e=>e.player)),combat:n.reduce(((e,t)=>e+(w.getRemainingAttributes(t.character,r.Eh.COMBAT)||0)),0),magic:n.reduce(((e,t)=>e+(w.getRemainingAttributes(t.character,r.Eh.MAGIC)||0)),0),tools:n.reduce(((e,t)=>e+(w.getRemainingAttributes(t.character,r.Eh.TOOLS)||0)),0),dmReward:Math.floor(3*Math.random())+1};e.push(s)}u(e)},D=e=>O.reduce(((t,a)=>{let{character:n}=a;return t+(w.getRemainingAttributes(n,e)||0)}),0),U=()=>{const e=[];for(let t=0;t<3;t++){const t=_();e.push(t)}b(e)},_=()=>{var e;const t=[{name:"Ancient Library",flavorText:"Dusty tomes and forgotten knowledge fill this chamber."},{name:"Crystal Cavern",flavorText:"Glowing crystals illuminate the rocky walls."},{name:"Trapped Corridor",flavorText:"Pressure plates and dart holes line this narrow passage."},{name:"Throne Room",flavorText:"A decaying throne sits atop a dais of cracked marble."},{name:"Alchemist's Lab",flavorText:"Bubbling cauldrons and strange apparatus fill the room."},{name:"Guardian Chamber",flavorText:"Ancient statues watch over this circular room."},{name:"Treasure Vault",flavorText:"Golden glints catch the light in this secured chamber."},{name:"Ritual Circle",flavorText:"Arcane symbols are carved into the stone floor."}],a=t[Math.floor(Math.random()*t.length)],n=Math.random()<.7;return{id:`room_${Date.now()}_${Math.random()}`,name:a.name,flavorText:a.flavorText,tag:n?null===(e=R.generateRelevantFlavorTags(1)[0])||void 0===e?void 0:e.tag:void 0,combat:Math.floor(3*Math.random()),magic:Math.floor(3*Math.random()),tools:Math.floor(3*Math.random()),isCompleted:!1}},B=()=>{const e=[...l];e[0].isCompleted=!0,c(e),U()},F=()=>{if(!h)return;const e=l[i];if(!e)return;A(!0);const a={combat:g.combat+h.combat,magic:g.magic+h.magic,tools:g.tools+h.tools};p(a);if(t.location.tags.some((t=>e.tag&&t.name===e.tag.name))&&e.tag)G("Encounter Triggered",`You have triggered an encounter: ${e.tag.name}`,[]);else{const t=[];t.push({object:"party",effects:[{effect:"+5 Exhaustion",class:"party-exhaustion"}]});const a=h.players.map((e=>e.id));if(I.forEach((e=>{a.includes(e.id)?(j.addPlayerExp(e,1),t.push({object:e,effects:[{effect:"+1 Experience",class:"player-exp"}]})):(k.updateAttention(e,-1),t.push({object:e,effects:[{effect:"-1 Attention",class:"player-attention"}]}))})),h.dmReward>0&&(M.addDmExp(h.dmReward),t.push({object:"party",effects:[{effect:`+${h.dmReward} DM Points`,class:"dm-points"}]})),e.tag){const t={tag:e.tag,source:r.UW.LOCATION,theme:R.getTheme()};M.exposeTag(t)}G("Room Completed",`You have successfully navigated ${e.name}!`,t)}},H=()=>{G("Dungeon Complete","You have successfully navigated the entire dungeon!",[{object:"party",effects:[{effect:"Dungeon Completed!",class:"dungeon-complete"}]}])},G=(e,t,a)=>{T({results:a,title:e,description:t,tags:[],travelOption:{id:"dungeon_result",name:e,description:t,time:0,tags:0,score:0,boredom:0,exhaustion:0,tagInstructions:"",repeatable:!1},info:{score:0,time:0,boredom:0,exhaustion:0}}),x(!0)},W=()=>{x(!1),i>=a-1?M.backToOverview():(()=>{const e=[...l];e[i].isCompleted=!0,c(e),i>=a-1?H():U()})()};return(0,n.useEffect)((()=>{var e;i>0&&(null===(e=l[i])||void 0===e||!e.isCompleted)&&P()}),[i]),(0,Xe.jsxs)("div",{className:"game-encounter-dungeon-crawl",children:[(0,Xe.jsx)(yn,{title:`Dungeon Crawl - ${t.location.name}`,description:`Navigate through ${a} rooms of this ancient dungeon!`,childClass:"small-font"}),(0,Xe.jsxs)("div",{className:"dungeon-content",children:[(0,Xe.jsx)("div",{className:"dungeon-main",children:(0,Xe.jsxs)("div",{className:"dungeon-rooms",children:[l.filter(((e,t)=>t<i&&e.isCompleted)).map(((e,t)=>(0,Xe.jsx)("div",{className:"dungeon-room completed",children:(0,Xe.jsxs)("div",{className:"completed-room-summary",children:[(0,Xe.jsx)("span",{className:"room-name",children:e.name}),e.tag&&(0,Xe.jsx)("span",{className:"room-tag",children:e.tag.name}),(0,Xe.jsxs)("div",{className:"room-attributes",children:[(0,Xe.jsxs)("span",{children:["\u2694\ufe0f",e.combat]}),(0,Xe.jsxs)("span",{children:["\u2728",e.magic]}),(0,Xe.jsxs)("span",{children:["\ud83d\udd27",e.tools]})]})]})},e.id))),(()=>{const e=l[i];return e?"start"!==e.id||e.isCompleted?e.isCompleted?(0,Xe.jsx)("div",{className:"dungeon-room completed",children:(0,Xe.jsxs)("div",{className:"completed-room-summary",children:[(0,Xe.jsx)("span",{className:"room-name",children:e.name}),e.tag&&(0,Xe.jsx)("span",{className:"room-tag",children:e.tag.name}),(0,Xe.jsxs)("div",{className:"room-attributes",children:[(0,Xe.jsxs)("span",{children:["\u2694\ufe0f",e.combat]}),(0,Xe.jsxs)("span",{children:["\u2728",e.magic]}),(0,Xe.jsxs)("span",{children:["\ud83d\udd27",e.tools]})]})]})}):(0,Xe.jsxs)("div",{className:"dungeon-room active",children:[(0,Xe.jsxs)("div",{className:"room-header",children:[(0,Xe.jsx)("h3",{children:e.name}),(0,Xe.jsx)("p",{children:e.flavorText})]}),(0,Xe.jsxs)("div",{className:"room-main",children:[(0,Xe.jsxs)("div",{className:"room-requirements",children:[(0,Xe.jsxs)("div",{className:"requirement-item",children:[(0,Xe.jsx)("span",{className:"icon",children:"\u2694\ufe0f"}),(0,Xe.jsx)("span",{className:"value",children:(null===h||void 0===h?void 0:h.combat)||e.combat})]}),(0,Xe.jsxs)("div",{className:"requirement-item",children:[(0,Xe.jsx)("span",{className:"icon",children:"\u2728"}),(0,Xe.jsx)("span",{className:"value",children:(null===h||void 0===h?void 0:h.magic)||e.magic})]}),(0,Xe.jsxs)("div",{className:"requirement-item",children:[(0,Xe.jsx)("span",{className:"icon",children:"\ud83d\udd27"}),(0,Xe.jsx)("span",{className:"value",children:(null===h||void 0===h?void 0:h.tools)||e.tools})]})]}),(0,Xe.jsx)("div",{className:"room-tag-area",children:e.tag&&(0,Xe.jsx)("div",{className:`room-tag ${C?"activated":""} ${h?"highlighted":""}`,onClick:h?F:void 0,children:e.tag.name})}),(0,Xe.jsx)("div",{className:"room-options",children:d.map((e=>(0,Xe.jsxs)("div",{className:"room-option "+((null===h||void 0===h?void 0:h.id)===e.id?"selected":""),onClick:()=>(e=>{m(e)})(e),children:[(0,Xe.jsxs)("div",{className:"option-attributes",children:[(0,Xe.jsxs)("span",{children:["\u2694\ufe0f",e.combat]}),(0,Xe.jsxs)("span",{children:["\u2728",e.magic]}),(0,Xe.jsxs)("span",{children:["\ud83d\udd27",e.tools]})]}),(0,Xe.jsx)("div",{className:"option-characters",children:"party"===e.type?(0,Xe.jsx)("span",{children:"Party"}):(0,Xe.jsx)("div",{className:"character-icons",children:e.characters.map(((t,a)=>(0,Xe.jsx)("div",{className:"character-icon",style:{zIndex:e.characters.length-a},children:(0,Xe.jsx)(Je,{imageId:t.icon})},t.id)))})}),e.dmReward>0&&(0,Xe.jsxs)("div",{className:"dm-reward-indicator",children:["+",e.dmReward," DM"]})]},e.id)))})]})]}):(0,Xe.jsxs)("div",{className:"dungeon-room starting-room",children:[(0,Xe.jsx)("div",{className:"room-header",children:(0,Xe.jsx)("h3",{children:e.name})}),(0,Xe.jsxs)("div",{className:"room-content",children:[(0,Xe.jsx)("p",{children:e.flavorText}),(0,Xe.jsx)("button",{className:"start-dungeon-button",onClick:B,children:"Enter Dungeon"})]})]}):null})(),0===y.length?null:(0,Xe.jsxs)("div",{className:"next-room-options",children:[(0,Xe.jsx)("h4",{children:"Choose Next Room:"}),(0,Xe.jsx)("div",{className:"room-options-grid",children:y.map((e=>(0,Xe.jsxs)("div",{className:"next-room-option",onClick:()=>(e=>{const t=[...l,e];c(t),o(i+1),m(null),A(!1),b([]),P()})(e),onMouseEnter:()=>v({combat:g.combat+e.combat,magic:g.magic+e.magic,tools:g.tools+e.tools}),onMouseLeave:()=>v(null),children:[(0,Xe.jsx)("h5",{children:e.name}),(0,Xe.jsx)("p",{children:e.flavorText}),(0,Xe.jsx)(Vt,{attributes:{[r.Eh.COMBAT]:e.combat,[r.Eh.MAGIC]:e.magic,[r.Eh.TOOLS]:e.tools},collapsed:!0})]},e.id)))})]})]})}),(0,Xe.jsxs)("div",{className:"dungeon-sidebar",children:[(()=>{const e=f||g;return(0,Xe.jsxs)("div",{className:"dungeon-totals-ui",children:[(0,Xe.jsxs)("div",{className:"totals-bar combat",children:[(0,Xe.jsx)("div",{className:"bar-fill",style:{height:e.combat/s*100+"%"},children:(0,Xe.jsx)("div",{className:"dm-reward",style:{bottom:"50%"},children:"6"})}),f&&(0,Xe.jsx)("div",{className:"bar-preview",style:{height:(f.combat-g.combat)/s*100+"%",bottom:g.combat/s*100+"%"}}),(0,Xe.jsx)("div",{className:"bar-icon",children:"\u2694\ufe0f"})]}),(0,Xe.jsxs)("div",{className:"totals-bar magic",children:[(0,Xe.jsx)("div",{className:"bar-fill",style:{height:e.magic/s*100+"%"},children:(0,Xe.jsx)("div",{className:"dm-reward",style:{bottom:"50%"},children:"6"})}),f&&(0,Xe.jsx)("div",{className:"bar-preview",style:{height:(f.magic-g.magic)/s*100+"%",bottom:g.magic/s*100+"%"}}),(0,Xe.jsx)("div",{className:"bar-icon",children:"\u2728"})]}),(0,Xe.jsxs)("div",{className:"totals-bar tools",children:[(0,Xe.jsx)("div",{className:"bar-fill",style:{height:e.tools/s*100+"%"},children:(0,Xe.jsx)("div",{className:"dm-reward",style:{bottom:"50%"},children:"6"})}),f&&(0,Xe.jsx)("div",{className:"bar-preview",style:{height:(f.tools-g.tools)/s*100+"%",bottom:g.tools/s*100+"%"}}),(0,Xe.jsx)("div",{className:"bar-icon",children:"\ud83d\udd27"})]})]})})(),(0,Xe.jsxs)("div",{className:"dungeon-progress",children:[(0,Xe.jsx)("h4",{children:"Progress"}),(0,Xe.jsxs)("div",{className:"progress-indicator",children:["Room ",i+1," of ",a+1]})]})]})]}),E&&N&&(0,Xe.jsx)("div",{className:"modal-overlay",children:(0,Xe.jsxs)("div",{className:"modal-container",children:[(0,Xe.jsxs)("div",{className:"modal-header",children:[N.title,(0,Xe.jsx)("button",{className:"close-button",onClick:W,children:"\xd7"})]}),(0,Xe.jsx)("div",{className:"modal-description",children:N.description}),(0,Xe.jsx)("div",{className:"dungeon-results",children:N.results.map(((e,t)=>{var a;return(0,Xe.jsxs)("div",{className:"effect-display",children:[(0,Xe.jsx)("div",{className:"effect-target",children:"string"===typeof e.object?e.object:e.object.name}),(0,Xe.jsx)("div",{className:"effect-list",children:null===(a=e.effects)||void 0===a?void 0:a.map(((e,t)=>(0,Xe.jsx)("div",{className:`effect ${e.class}`,children:e.effect},t)))})]},t)}))}),(0,Xe.jsx)("div",{className:"modal-actions",children:(0,Xe.jsx)("button",{onClick:W,children:i>=a-1?"Exit Dungeon":"Continue"})})]})})]})},Zn=e=>{let{encounter:t,showOverview:a}=e;const[s,i]=(0,n.useState)(t.events),[o,l]=(0,n.useState)(!1),c=kt(),d=Ot(),u=t.location.themes[0],[h,m]=(0,n.useState)(c.getEncounterState()),[g,p]=(0,n.useState)(d.showImageForEvent()),[f,v]=(0,n.useState)(d.getEventImageOpacity());(0,n.useEffect)((()=>{const e=()=>{const e=c.getEncounterState();void 0!==(null===e||void 0===e?void 0:e.sessionState)&&void 0!==e.eventIndex&&m({...e})};return d.on("updateEncounterState",e),d.on("eventUpdated",(()=>{p(d.showImageForEvent()),v(d.getEventImageOpacity())})),()=>{d.off("updateEncounterState",e)}}),[c,d]);const y=e=>{if(!h)return null;switch(t.events[h.eventIndex].type){case nt.COMBAT:return(0,Xe.jsx)(fn,{encounter:t});case nt.ROLEPLAY:return(0,Xe.jsx)(Cn,{encounter:t});case nt.PUZZLE:return(0,Xe.jsx)(Fn,{encounter:t});case nt.PERCEPTION:return(0,Xe.jsx)(xn,{encounter:t});case nt.TOWN:return(0,Xe.jsx)(Rn,{encounter:t});case nt.TRAVEL:return(0,Xe.jsx)(Qn,{encounter:t});case nt.CHALLENGE:return(0,Xe.jsx)(_n,{encounter:t});case nt.TRAP:return(0,Xe.jsx)(kn,{encounter:t});case nt.STORY:return(0,Xe.jsx)(Hn,{encounter:t});case nt.EXPLORATION:return(0,Xe.jsx)(vn,{encounter:t});case nt.DUNGEON:return(0,Xe.jsx)(Xn,{encounter:t});default:return null}};return(0,Xe.jsx)("div",{className:`table-encounter-container ${u}`,children:a?(0,Xe.jsx)(Ja,{encounter:t}):(0,Xe.jsxs)("div",{className:"table-encounter-scene",children:[(0,Xe.jsx)("div",{className:"scenery-opacity-container",style:{opacity:g?1-f:1},children:(0,Xe.jsx)(qn,{theme:u})}),g&&(0,Xe.jsx)("div",{className:"encounter-icon-container",style:{opacity:f},children:(0,Xe.jsx)(Je,{imageId:t.location.icon})}),(0,Xe.jsx)("div",{className:"table-encounter-title",children:t.name}),(0,Xe.jsx)("div",{className:"table-encounter-session",children:(()=>{if(!h)return null;switch(h.sessionState){case r.$t.INTRO_EVENTS:return y();case r.$t.INTRO_MAIN:return(0,Xe.jsx)("div",{children:"Intro Main"});case r.$t.MAIN_EVENTS:return y();case r.$t.INTRO_EXIT:return(0,Xe.jsx)("div",{children:"Intro Exit"});case r.$t.EXIT_EVENTS:return y();case r.$t.EXIT:return(0,Xe.jsx)("div",{children:"Exit"})}})()})]})})},Jn=[{name:"Gold",value:1,type:r.FX.TREASURE,cost:1,description:"Increase all players happiness by one"},{name:"Gear",value:1,type:r.FX.TOOLS,cost:1,description:"Replenish all tools for all players"},{name:"Healing",value:1,type:r.FX.HEALING,cost:1,description:"Remove wounded state from all characters"},{name:"Plot Hook",value:1,type:r.FX.PLOT_HOOK,cost:1,description:"Reveal information about the plot. Restore full attention"},{name:"Replenish Magic",value:2,type:r.FX.MAGIC,cost:2,description:"Replenish all Magic for all characters"},{name:"Raise Dead",value:2,type:r.FX.HEALING,cost:2,description:"Raise a dead character"},{name:"Treasure Chest",value:2,type:r.FX.TREASURE,cost:3,description:"Increase all player happiness by two"},{name:"Level Up",value:1,type:r.FX.XP,cost:3,description:"Level up the lowest level Character"}],$n=e=>{let{rewardsAcceptedCallback:t}=e;const a=Ot(),s=It(),i=kt(),o=Rt().getTagManager(),[l,c]=n.useState(!1),[d,u]=n.useState(0),[h,m]=(0,n.useState)([]),g=h.reduce(((e,t)=>e+t.cost),0),[p,f]=(0,n.useState)([]),[v,y]=(0,n.useState)(s.generateHeroes([])),[b,E]=(0,n.useState)(!1),x=()=>g<d?"low":g===d?"match":"high";(0,n.useEffect)((()=>{if(l){const e=[...Jn],t=o.magicItemRumors;m([]),t.length>0&&e.push({name:"Magic Item",value:1,type:r.FX.ITEM,cost:2,description:t[0].name,tag:t[0]}),f(e)}}),[i,l]),(0,n.useEffect)((()=>{const e=(e,t)=>{e>0?(c(!0),u(e),E(t)):c(!1)};return a.on("showRewardModal",e),()=>{a.off("showRewardModal",e)}}),[a]);const N=()=>{t(h,g-d,b),c(!1)};return l?(0,Xe.jsx)("div",{className:"reward-modal-container",children:(0,Xe.jsxs)("div",{className:"reward-modal-body",children:[(0,Xe.jsxs)("div",{className:"reward-modal-title",children:[(0,Xe.jsx)("div",{className:"reward-modal-title-text",children:"Reward your players"}),(0,Xe.jsxs)("div",{className:"reward-modal-instructions",children:["Based on the diffifculty of the event, they expect the equivalent of ",d," rewards."]})]}),(0,Xe.jsxs)("div",{className:"reward-panels",children:[(0,Xe.jsxs)("div",{className:"panel too-low "+("low"===x()?"active":""),children:[(0,Xe.jsx)("div",{className:"panel-title",children:"Too Low"}),"low"===x()&&(0,Xe.jsxs)("div",{className:"panel-contents",children:[(0,Xe.jsx)("div",{className:"panel-value",children:g}),(0,Xe.jsx)("div",{className:"panel-low-text",children:((e,t)=>e-t===1?"All players \ud83d\ude1e":"All players \ud83d\ude1e\ud83d\ude1e")(d,g)}),(0,Xe.jsx)("button",{className:"accept-button",onClick:()=>N(),children:"ACCEPT"})]})]}),(0,Xe.jsxs)("div",{className:"panel match "+("match"===x()?"active":""),children:[(0,Xe.jsx)("div",{className:"panel-title",children:"Expected"}),(0,Xe.jsx)("div",{className:"panel-value expected",children:d}),"match"===x()&&(0,Xe.jsx)("button",{className:"accept-button",onClick:()=>N(),children:"ACCEPT"})]}),(0,Xe.jsxs)("div",{className:"panel too-high "+("high"===x()?"active":""),children:[(0,Xe.jsx)("div",{className:"panel-title",children:"Too High"}),"high"===x()&&(0,Xe.jsxs)("div",{className:"panel-contents",children:[(0,Xe.jsx)("div",{className:"panel-value",children:g}),(0,Xe.jsx)("div",{className:"panel-high-text",children:((e,t)=>t-e===1?"-50% Intensity":"-100% Intensity")(d,g)}),(0,Xe.jsx)("button",{className:"accept-button",onClick:()=>N(),children:"ACCEPT"})]})]})]}),(0,Xe.jsx)("div",{className:"reward-items-list",children:p.map((e=>(0,Xe.jsxs)("div",{className:"reward-item "+(h.includes(e)?"selected":""),onClick:()=>(e=>{if(h.includes(e))m(h.filter((t=>t!==e)));else{if(g+e.cost>d+2)return;m([...h,e])}})(e),children:[(0,Xe.jsxs)("div",{className:"item-header",children:[(0,Xe.jsx)("span",{className:"item-name",children:e.name}),(0,Xe.jsx)("span",{className:"item-cost",children:e.cost})]}),(0,Xe.jsx)("div",{className:"item-description",children:e.description})]},e.name)))}),(0,Xe.jsx)("div",{className:"reward-modal-heroes",children:v&&v.map(((e,t)=>(0,Xe.jsx)("div",{className:"reward-modal-hero-row",children:(0,Xe.jsxs)("div",{className:"reward-modal-hero-container",children:[(0,Xe.jsxs)("div",{className:"reward-modal-hero",children:[(0,Xe.jsx)("div",{className:"reward-modal-hero-name",children:e.name}),(0,Xe.jsx)("div",{className:"combat-character-icon",children:(0,Xe.jsx)(Je,{imageId:e.icon})}),e.character&&"injured"===e.character.injury&&(0,Xe.jsx)("div",{className:"reward-modal-hero-injury"}),e.character&&"dead"===e.character.injury&&(0,Xe.jsx)("div",{className:"reward-modal-hero-injury dead"})]}),(0,Xe.jsx)("div",{className:"reward-modal-hero-attributes",children:(0,Xe.jsx)(Yt,{hero:e,category:r.lq.ALL,showAttributeLoss:!0})})]})},e.name)))})]})}):null},es=()=>{const e=kt(),t=e.getCurrentEncounter(),a=Rt();return t?(0,Xe.jsxs)("div",{className:"game-table-slab",children:[(0,Xe.jsx)(Zn,{encounter:t,showOverview:a.state===Lt.SESSION_OVERVIEW}),(0,Xe.jsx)($n,{rewardsAcceptedCallback:e.rewardsAccepted})]}):null},ts=(e,t,a,n,s)=>{const r=as(e,t,a,s),i=as(e,t,a,n),o=s-n<=180?"0":"1";return["M",r.x,r.y,"A",a,a,0,o,0,i.x,i.y].join(" ")},as=(e,t,a,n)=>{const s=(n-90)*Math.PI/180;return{x:e+a*Math.cos(s),y:t+a*Math.sin(s)}},ns=e=>{let{value:t,max:a,segments:n=10,colors:s=["#FFA500","#FFD700","#FFD700","#ADFF2F","#ADFF2F","#ADFF2F","#32CD32","#eF4500","#eF4500","#FF0000"],descriptions:r,segmentRanges:i}=e;const o=100,l=180;const c={transform:`rotate(${t/a*l-180}deg)`,transformOrigin:"100px 100px"};return(0,Xe.jsx)("div",{className:"needle-gauge",children:(0,Xe.jsxs)("svg",{viewBox:"20 50 1 160",preserveAspectRatio:"xMidYMid meet",children:[(()=>{const e=[];if(i&&i.length>0){let t=0;const n=Math.min(s.length,i.length);for(let r=0;r<n;r++){const n=Math.min(i[r],a);if(n<=t)continue;const c=ts(o,o,90,t/a*l-90,n/a*l-90);if(e.push((0,Xe.jsx)("path",{d:c,fill:"none",stroke:s[r],strokeWidth:20},r)),t=n,n>=a)break}}else{const t=l/s.length;for(let a=0;a<s.length;a++){const n=a*t-90,r=ts(o,o,90,n,n+t);e.push((0,Xe.jsx)("path",{d:r,fill:"none",stroke:s[a],strokeWidth:20},a))}}return e})(),(0,Xe.jsx)("line",{x1:o,y1:o,x2:200,y2:o,stroke:"#000000bb",strokeWidth:"5",style:c}),(0,Xe.jsx)("circle",{cx:o,cy:o,r:"5",fill:"white"})]})})},ss=e=>{let{stress:t,displayNumber:a}=e;const n=It(),s=kt().getTensionColor(t);return(0,Xe.jsxs)("div",{className:"stress-info "+(a?"number":"description"),style:{backgroundColor:s,transition:"background-color 0.3s ease"},children:[a&&(0,Xe.jsx)("div",{className:"stress-value",children:t}),!a&&(0,Xe.jsx)("div",{className:"stress-description",children:(r=t,n.getTensionDescription(r))})]});var r},rs=()=>{var e;const t=Rt(),a=kt(),s=t.getTagManager(),i=t.getUiManager(),o=a.getCurrentEncounter(),l=a.getCampaignScore(),c=t.getPartyManager(),[d,u]=(0,n.useState)(a.getEncounterPoints()),[h,m]=(0,n.useState)(0),[g,p]=(0,n.useState)(c.getPartyTension());(0,n.useEffect)((()=>{const e=()=>{u(a.getEncounterPoints())};return a.on("dmScreenUpdated",e),a.on("encounterScoreUpdated",e),()=>{a.off("dmScreenUpdated",e),a.off("encounterScoreUpdated",e)}}),[a]),(0,n.useEffect)((()=>{const e=()=>{m((e=>e+1))};return a.on("tensionDescriptionsUpdated",e),()=>{a.off("tensionDescriptionsUpdated",e)}}),[a]),(0,n.useEffect)((()=>{const e=()=>{p(c.getPartyTension())};return i.on("playerUpdate",e),()=>{i.off("playerUpdate",e)}}),[i,c]);const f=o&&s.encounterTagsCollected[o.name||""]||[],v=o&&(null===(e=s.encounterTagsExpected[o.name||""])||void 0===e?void 0:e.filter((e=>!f.includes(e))))||[],y=o?a.getEncounterLocationTags():[],b=o&&s.locationTagsCollected||[];if(!o||t.state!==Lt.SESSION)return(0,Xe.jsx)(Xe.Fragment,{});const E=null===o||void 0===o?void 0:o.branches,x=f.length+v.length,N=y.length,T=f.length,C=b.length,A=x+N,S=T+C,M=A>0?Math.round(S/A*100):0,j=(e,t,a)=>{const n=[];for(let s=0;s<e;s++)n.push((0,Xe.jsx)("div",{className:`tag-dot ${s<t?"filled":"hollow"} ${a}`},s));return n};a.getCampaignName();return(0,Xe.jsx)("div",{className:"bottom-bar-container",children:(0,Xe.jsxs)("div",{className:"bottom-bar-content",children:[(0,Xe.jsx)(ra,{content:(0,Xe.jsxs)("div",{className:"encounter-tooltip-content",children:[(0,Xe.jsxs)("div",{className:"tooltip-section",children:[(0,Xe.jsxs)("h4",{children:["Encounter Tags (",T,"/",x,")"]}),(0,Xe.jsxs)("div",{className:"tooltip-tags",children:[f.map(((e,t)=>(0,Xe.jsx)(na,{tag:e,source:r.UW.ENCOUNTER,theme:null===o||void 0===o?void 0:o.location.themes[0],tooltipClassName:"info-tooltip",tooltipText:"Expectation fulfilled"},t))),v.map(((e,t)=>(0,Xe.jsx)(na,{tag:e,source:r.UW.ENCOUNTER_EXPECTED,theme:null===o||void 0===o?void 0:o.location.themes[0],tooltipClassName:"info-tooltip",tooltipText:"Players still expect to encounter this"},t)))]})]}),(0,Xe.jsxs)("div",{className:"tooltip-section",children:[(0,Xe.jsxs)("h4",{children:["Location Tags (",C,"/",N,")"]}),(0,Xe.jsx)("div",{className:"tooltip-tags",children:y.map(((e,t)=>(0,Xe.jsx)(na,{tag:e,source:b.includes(e)?r.UW.LOCATION:r.UW.LOCATION_EXPECTED,theme:null===o||void 0===o?void 0:o.location.themes[0],tooltipClassName:"info-tooltip",tooltipText:b.includes(e)?"This location element has been established.":"Describe the location using these elements."},t)))})]})]}),children:(0,Xe.jsxs)("div",{className:"bottom-bar-encounter",children:[(0,Xe.jsxs)("div",{className:"encounter-header-row",children:[(0,Xe.jsx)("span",{className:"encounter-name",children:null===o||void 0===o?void 0:o.name}),(0,Xe.jsxs)("span",{className:"encounter-percent",children:[M,"%"]})]}),(0,Xe.jsxs)("div",{className:"encounter-dots-row",children:[(0,Xe.jsxs)("div",{className:"encounter-dots-section",children:[(0,Xe.jsx)("span",{className:"dots-label",children:"Encounter Topics:"}),(0,Xe.jsx)("div",{className:"dots-container",children:j(x,T,"encounter-dot")})]}),(0,Xe.jsxs)("div",{className:"location-dots-section",children:[(0,Xe.jsxs)("span",{className:"dots-label",children:[o.location.name,":"]}),(0,Xe.jsx)("div",{className:"dots-container",children:j(N,C,"location-dot")})]})]})]})}),(()=>{const e=a.getCurrentEvent();return(0,Xe.jsxs)("div",{className:"bottom-bar-scoring",children:[e&&(0,Xe.jsxs)("div",{className:"scoring-event-side",children:[(0,Xe.jsx)("div",{className:"event-header-row",children:(0,Xe.jsx)("span",{className:"event-name",children:"ENCOUNTER SCORE"})}),(0,Xe.jsx)("div",{className:"event-score-row",children:(0,Xe.jsx)(Ka,{score:d})})]}),(0,Xe.jsxs)("div",{className:"scoring-tension-side",children:[(0,Xe.jsx)("div",{className:"tension-header-row",children:(0,Xe.jsx)("span",{className:"tension-name",children:"TENSION"})}),(0,Xe.jsx)("div",{className:"tension-gauge-container",children:(0,Xe.jsxs)("div",{className:"bottom-bar-stress-needle",children:[(0,Xe.jsx)(ss,{stress:g}),(0,Xe.jsx)(ns,{value:g/10,max:10,colors:a.getTensionColors(),descriptions:a.getTensionDescriptions().map((e=>e.description)),segmentRanges:a.getTensionRanges().map((e=>e/10))},h)]})})]}),(0,Xe.jsxs)("div",{className:"scoring-campaign-side",children:[(0,Xe.jsx)("div",{className:"campaign-header-row",children:(0,Xe.jsx)("span",{className:"campaign-name",children:"QUEST SCORE"})}),(0,Xe.jsx)("div",{className:"campaign-score-row",children:(0,Xe.jsx)(Ka,{score:l})})]})]})})(),E&&0!==E.length?(0,Xe.jsx)(ra,{content:(0,Xe.jsxs)("div",{className:"next-encounters-tooltip-content",children:[(0,Xe.jsx)("h4",{children:"Upcoming Encounters"}),E.map(((e,t)=>{const a=s.encounterTagsCollected[e.name||""]||[],n=s.encounterTagsExpected[e.name||""]||[];return(0,Xe.jsxs)("div",{className:"tooltip-branch",children:[(0,Xe.jsxs)("h5",{children:[e.name," (",a.length," exposed)"]}),(0,Xe.jsxs)("div",{className:"tooltip-tags",children:[a.map(((t,a)=>(0,Xe.jsx)(na,{tag:t,source:r.UW.FORESHADOWING,theme:e.location.themes[0],tooltipClassName:"info-tooltip",tooltipText:"Players have been led to expect this if/when they get to this encounter."},`collected-${a}`))),n.filter((e=>!a.some((t=>t.name===e.name)))).map(((t,a)=>(0,Xe.jsx)(na,{tag:t,source:r.UW.FORESHADOWING_EXPECTED,theme:e.location.themes[0],tooltipClassName:"info-tooltip",tooltipText:"This topic can still be exposed to the players to inform them of the upcoming encounter"},`expected-${a}`)))]})]},t)}))]}),children:(0,Xe.jsxs)("div",{className:"bottom-bar-next-encounters",children:[(0,Xe.jsx)("div",{className:"next-encounters-header",children:(0,Xe.jsx)("span",{className:"next-encounters-title",children:"Upcoming Encounters"})}),(0,Xe.jsx)("div",{className:"next-encounters-row",children:E.map(((e,t)=>{var a,n;const r=(null===(a=s.encounterTagsCollected[e.name||""])||void 0===a?void 0:a.length)||0,i=(null===(n=s.encounterTagsExpected[e.name||""])||void 0===n?void 0:n.length)||0,o=Math.max(4,r+i);return(0,Xe.jsxs)("div",{className:"next-encounter-item",children:[(0,Xe.jsx)("span",{className:"next-encounter-name",children:e.name}),(0,Xe.jsx)("div",{className:"dots-container",children:j(o,r,"next-encounter-dot")})]},t)}))})]})}):null]})})},is=e=>{let{chatMessage:t,newMessage:a}=e;const n=Ot(),s=t.message,r=n.getMessageIconId(t.speaker);let i=n.getMessageSpeakerName(t.speaker);return(0,Xe.jsxs)("div",{className:`chat-message-display ${t.speaker.type}`,children:[(0,Xe.jsxs)("div",{className:"chat-message-speaker-container",children:[(0,Xe.jsx)("div",{className:"chat-message-speaker under-icon",children:i}),(0,Xe.jsx)("div",{className:"chat-message-icon",children:(0,Xe.jsx)(Je,{imageId:r})})]}),(0,Xe.jsxs)("div",{className:"chat-messager-content",children:[(0,Xe.jsx)("div",{className:"chat-message-speaker  over-message",children:i}),(0,Xe.jsx)("div",{className:`chat-message-text ${t.speaker.type}`,children:(0,Xe.jsx)("div",{className:"chat-message-words",dangerouslySetInnerHTML:{__html:s}})})]})]})},os=e=>{let{event:t}=e;return(0,Xe.jsx)("div",{className:`chat-event-tile ${(()=>{var e;switch(t.type){case r.p6.CAMPAIGN_START:return"campaign-start";case r.p6.ENCOUNTER_EVENT:return`encounter-event ${(null===(e=t.data)||void 0===e?void 0:e.eventType)||"unknown"}`;case r.p6.LOCATION_CHANGE:return"location-change";case r.p6.COMBAT_START:return"combat-start";case r.p6.COMBAT_END:return"combat-end";default:return"generic"}})()}`,children:(0,Xe.jsxs)("div",{className:"event-content",children:[(0,Xe.jsx)("div",{className:"event-title",children:t.subtitle||t.title}),t.subtitle&&(0,Xe.jsx)("div",{className:"event-subtitle",children:t.title})]})})},ls=()=>{const e=(0,n.useRef)(null),t=(0,n.useRef)(null),a=Rt(),s=a.getChatManager(),i=a.getChatEventManager(),[o,l]=(0,n.useState)((()=>s.getRecentMessages())),[c,d]=(0,n.useState)((()=>i.getEventHistory())),[u,h]=(0,n.useState)(null),[m,g]=(0,n.useState)(""),[p,f]=(0,n.useState)(!1),[v,y]=(0,n.useState)(!1),[b,E]=(0,n.useState)({}),[x,N]=(0,n.useState)(!1),T=(0,n.useRef)(null);(0,n.useEffect)((()=>{const e=e=>{l(s.getRecentMessages()),h(e),y(!!e.hasMoreMessages);const t=`message-${s.getRecentMessages().length-1}`;E((e=>({...e,[t]:{highlighted:!0,pulsing:!0}}))),setTimeout((()=>{E((e=>{const a={...e};return delete a[t],a}))}),3e3),C(e.message)};return s.on("chat-message",e),()=>{s.off("chat-message",e)}}),[s]),(0,n.useEffect)((()=>{const e=e=>{d((t=>[...t,e]))};return i.on("chat-event",e),()=>{i.off("chat-event",e)}}),[i]),(0,n.useEffect)((()=>{const t=e.current;if(!t)return;const a=()=>{t.scrollHeight-t.scrollTop-t.clientHeight<10?N(!1):(N(!0),T.current&&clearTimeout(T.current),T.current=setTimeout((()=>{N(!1)}),2e3))};return t.addEventListener("scroll",a),()=>{t.removeEventListener("scroll",a),T.current&&clearTimeout(T.current)}}),[]),(0,n.useEffect)((()=>{const e=()=>{const e=s.getRecentMessages();l(e)};e();const t=setInterval(e,1e3);return()=>{clearInterval(t)}}),[s]),(0,n.useEffect)((()=>{if(e.current&&!x){const t=e.current;t.scrollHeight-t.scrollTop-t.clientHeight<50&&setTimeout((()=>{e.current&&(e.current.scrollTop=e.current.scrollHeight)}),10)}}),[o,c,x]);const C=a=>{f(!0),g(""),t.current&&clearInterval(t.current);const n=a.split(/(?<=\s)|(?=\s)/);let s=0,r=n.map((e=>({word:e,visible:!1})));t.current=setInterval((()=>{r[s].word.match(/^\s+$/)||(r[s].visible=!0,g(r.map((e=>{let{word:t,visible:a}=e;return t.match(/^\s+$/)?t:`<span class="chat-word ${a?"visible":""}">${t}</span>`})).join(""))),s++,s>=n.length&&(t.current&&(clearInterval(t.current),t.current=null),f(!1),setTimeout((()=>{e.current&&(e.current.scrollTop=e.current.scrollHeight)}),50))}),10)},A=()=>{p?(t.current&&(clearInterval(t.current),t.current=null),f(!1),g((null===u||void 0===u?void 0:u.message)||"")):v&&s.advanceQueue()};return(0,Xe.jsx)("div",{className:"chat-exterior",children:(0,Xe.jsx)("div",{className:"chat-messages-container",ref:e,children:(()=>{const e=[...o.map(((e,t)=>({type:"message",data:e,timestamp:e.timestamp||Date.now()-1e3*(o.length-t),originalIndex:t}))),...c.map((e=>({type:"event",data:e,timestamp:e.timestamp})))];return e.sort(((e,t)=>e.timestamp-t.timestamp)),e.map(((t,a)=>{if("event"===t.type)return(0,Xe.jsx)(os,{event:t.data},`event-${t.timestamp}`);{const n=t.data;return function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=a&&p?{...e,message:m}:e,i=`message-${t}`,o=b[i],l=["chat-new-message",a&&p?"animating":"",null!==o&&void 0!==o&&o.highlighted?"highlighted":"",null!==o&&void 0!==o&&o.pulsing?"pulsing":""].filter(Boolean).join(" "),c=n&&v,d=e.speaker.type===r.wb.PLAYER||e.speaker.type===r.wb.CHARACTER?"chat-queue-indicator-right":"chat-queue-indicator";return(0,Xe.jsxs)("div",{className:l,onClick:a?A:void 0,style:{cursor:a&&(p||v)?"pointer":"default"},children:[(0,Xe.jsx)(is,{chatMessage:s,newMessage:a}),c&&(0,Xe.jsx)("div",{className:`${d} ${c?"visible":""}`,children:"..."})]},i)}(n,t.originalIndex,!!u&&n===u,a===e.length-1&&"message"===t.type)}}))})()})})},cs=e=>{let{themes:t,maxSegments:a,onRedeem:n}=e;const s=(e,t)=>{if(t<a)switch(e){case r.Co.COMEDIC:return"When filled: All players gain +1 attitude.";case r.Co.DRAMATIC:return"When filled: All players gain full attention.";case r.Co.HEROIC:return"When filled: Set Tension to 50";case r.Co.GRIM:return"When filled: High-tension rewards increased";case r.Co.ROMANTIC:return"When filled: Low-tension rewards increased";case r.Co.NONE:default:return"defaultTooltip"}switch(e){case r.Co.COMEDIC:return"Click: All players gain +1 attitude.";case r.Co.DRAMATIC:return"Click: All players gain full attention.";case r.Co.FANTASY:case r.Co.HEROIC:return"Click: Set Tension to 50";case r.Co.GRIM:return"Click: Adjust high-tension rewards";case r.Co.ROMANTIC:return"Click: Adjust low-tension rewards";case r.Co.HORROR:case r.Co.NONE:default:return"defaultTooltip"}};return(0,Xe.jsxs)("div",{className:"tone-tracker",children:[(0,Xe.jsx)("div",{className:"tone-header",children:(0,Xe.jsx)(ra,{content:"Once a tone is established, it will generate party points. Tones can also be redeemed for unique effects once established.",position:"top",children:(0,Xe.jsx)("span",{className:"tone-title",children:"Session Tones"})})}),(0,Xe.jsx)("div",{className:"tone-grid",children:Object.entries(t).map((e=>{let[t,r]=e;return(0,Xe.jsx)(ra,{content:s(t,r),translate:[-100,-10],children:(0,Xe.jsxs)("div",{className:`tone-item theme-${t} muted ${r>=a?"active":""}`,onClick:r>=a?()=>n(t):void 0,children:[(0,Xe.jsxs)("div",{className:"tone-item-header",children:[(0,Xe.jsx)("span",{className:"tone-name",children:t}),r<a&&(0,Xe.jsxs)("span",{className:"tone-count",children:[r,"/",a]})]}),(0,Xe.jsx)("div",{className:"tone-progress-container",children:(0,Xe.jsx)("div",{className:`tone-progress-bar theme-${t}`,style:{width:r/a*100+"%"}})})]},t)},t)}))})]})};var ds=a(7382);const us=e=>{let{onClose:t,isEmbedded:a=!1}=e;const s=kt(),i=Rt(),o=(i.getChatManager(),i.getTagManager()),[l,c]=(0,n.useState)("all"),d=o.getCollectedTags(),u=ds.TAG_COLLECTIONS.filter((e=>e.tags.every((e=>d.some((t=>t.name===e.name)))))),h=ds.TAG_COLLECTIONS.filter((e=>e.tags.some((e=>d.some((t=>t.name===e.name))))&&!e.tags.every((e=>d.some((t=>t.name===e.name)))))),[m,g]=(0,n.useState)(!0),[p,f]=(0,n.useState)(!0),[v,y]=(0,n.useState)(!0),b=e=>{switch(l){case"npc_races":return!!e.friendly;case"enemies":return!!e.enemy||!!e.friendly;case"travel":return!!e.travel;case"magic_item":return e.type===r.Mf.GEAR;case"all":return e.type!==r.Mf.GEAR;default:return!0}},E=[...d].sort(((e,t)=>m?e.name.localeCompare(t.name):t.name.localeCompare(e.name))),x=[...u].sort(((e,t)=>p?e.name.localeCompare(t.name):t.name.localeCompare(e.name))),N=[...h].sort(((e,t)=>p?e.name.localeCompare(t.name):t.name.localeCompare(e.name))),T=o.getOutstandingBackstoryTags(),C=o.magicItemRumors,A=o.collectedTags.filter((e=>e.type===r.Mf.GEAR&&!C.includes(e))),S=()=>{const e=i.getQuestManager().getOutstandingQuestTags();return 0===e.length?null:(0,Xe.jsxs)("div",{className:"minor-tag-collection",children:[(0,Xe.jsx)("div",{className:"tag-collections-header",children:"Upcoming Quest Clues"}),(0,Xe.jsx)("div",{className:"small-tags-container",children:(0,Xe.jsx)("div",{className:"tag-list",children:e.map((e=>{const t=i.getTagManager().tagToEncounterFlavorTag(e);return t.source=r.UW.QUEST,(0,Xe.jsx)(aa,{tag:t,showTooltip:!1},e.name)}))})})]})},M=()=>(0,Xe.jsxs)(Xe.Fragment,{children:[(0,Xe.jsx)("div",{className:"tag-collections-header",children:"Established Topics"}),(0,Xe.jsxs)("div",{className:"collected-tags-container",children:[(0,Xe.jsx)("div",{className:"collections-controls",children:(0,Xe.jsxs)("div",{className:"control-group",children:[(0,Xe.jsx)("div",{className:"filter-controls "+("all"===l?"active":""),onClick:()=>c("all"),children:"ALL"}),(0,Xe.jsx)("div",{className:"filter-controls "+("npc_races"===l?"active":""),onClick:()=>c("npc_races"),children:"NPC"}),(0,Xe.jsx)("div",{className:"filter-controls "+("enemies"===l?"active":""),onClick:()=>c("enemies"),children:"COMBATANT"}),(0,Xe.jsx)("div",{className:"filter-controls "+("travel"===l?"active":""),onClick:()=>c("travel"),children:"TRAVEL"})]})}),(0,Xe.jsx)("div",{className:"tag-list",children:E.filter(b).map((e=>{const t=i.getTagManager().tagToEncounterFlavorTag(e);return t.source=r.UW.COLLECTION_COLLECTED,(0,Xe.jsx)(aa,{tag:t,showTooltip:!1},e.name)}))})]})]}),j=()=>(0,Xe.jsxs)(Xe.Fragment,{children:[(0,Xe.jsx)("div",{className:"tag-collections-header",children:"Established Themes"}),(0,Xe.jsx)("div",{className:"collections-list",children:x.map((e=>(0,Xe.jsxs)("div",{className:"collection-item complete",children:[(0,Xe.jsxs)("div",{className:"collection-header",children:[(0,Xe.jsx)("div",{className:"collection-name completed",children:e.name}),!o.isCollectionCashedIn(e.name)&&(0,Xe.jsx)("button",{className:"cash-in-button",onClick:()=>{return t=e.name,o.cashInCollection(t),s.spendDMAbilityPoints(-1),s.emit("dmScreenUpdated"),s.emit("dmAbilitiesUpdated",s.getDMAbilityPoints()),void console.log(`Cashed in collection: ${t}, added +1 DM ability point`);var t},children:"Cash In"}),o.isCollectionCashedIn(e.name)&&(0,Xe.jsx)("span",{className:"cashed-in-label",children:"Cashed In"})]}),(0,Xe.jsx)("div",{className:"tag-list",children:e.tags.map((e=>{const t=d.some((t=>t.name===e.name)),a=i.getTagManager().tagToEncounterFlavorTag(e);return a.source=t?r.UW.COLLECTION_COLLECTED:r.UW.COLLECTION,(0,Xe.jsx)(aa,{tag:a,className:t?"collected":"uncollected",showTooltip:!1},e.name)}))})]},e.name)))})]}),w=()=>v?(0,Xe.jsxs)(Xe.Fragment,{children:[(0,Xe.jsx)("div",{className:"tag-collections-header",children:"Introduced Themes"}),(0,Xe.jsx)("div",{className:"collections-list",children:N.map((e=>(0,Xe.jsxs)("div",{children:[(0,Xe.jsx)("div",{className:"collection-name",children:e.name}),(0,Xe.jsx)("div",{className:"collection-item",children:(0,Xe.jsx)("div",{className:"tag-list",children:e.tags.map((e=>{const t=d.some((t=>t.name===e.name)),a=i.getTagManager().tagToEncounterFlavorTag(e);return a.source=t?r.UW.COLLECTION_COLLECTED:r.UW.COLLECTION,(0,Xe.jsx)(aa,{tag:a,className:t?"collected":"uncollected",showTooltip:!1},e.name)}))})})]},e.name)))})]}):null;return(0,Xe.jsxs)("div",{className:"tag-collections-overlay green-theme",children:[(0,Xe.jsxs)("div",{className:"tag-collections-container",children:[!a&&(0,Xe.jsx)("div",{className:"close-button",onClick:t,children:"\xd7"}),(0,Xe.jsxs)("div",{className:"main-content",children:[M(),(0,Xe.jsxs)("div",{className:"minor-tag-containers",children:[0===T.length?null:(0,Xe.jsxs)("div",{className:"minor-tag-collection",children:[(0,Xe.jsx)("div",{className:"tag-collections-header",children:"Backstory Leads"}),(0,Xe.jsx)("div",{className:"small-tags-container",children:(0,Xe.jsx)("div",{className:"tag-list",children:T.map((e=>{const t=i.getTagManager().tagToEncounterFlavorTag(e);return t.source=r.UW.BACKSTORY,(0,Xe.jsx)(aa,{tag:t,showTooltip:!1},e.name)}))})})]}),0===C.length?null:(0,Xe.jsxs)("div",{className:"minor-tag-collection",children:[(0,Xe.jsx)("div",{className:"tag-collections-header",children:"Rumored Magic Items"}),(0,Xe.jsx)("div",{className:"small-tags-container",children:(0,Xe.jsx)("div",{className:"tag-list",children:C.map((e=>{const t=i.getTagManager().tagToEncounterFlavorTag(e);return t.source=r.UW.MAGIC_ITEM_EXPECTED,(0,Xe.jsx)(aa,{tag:t,showTooltip:!1},e.name)}))})})]}),S(),0===A.length?null:(0,Xe.jsxs)("div",{className:"minor-tag-collection",children:[(0,Xe.jsx)("div",{className:"tag-collections-header",children:"Discovered Magic Items"}),(0,Xe.jsx)("div",{className:"small-tags-container",children:(0,Xe.jsx)("div",{className:"tag-list",children:A.map((e=>{const t=i.getTagManager().tagToEncounterFlavorTag(e);return t.source=r.UW.MAGIC_ITEM,(0,Xe.jsx)(aa,{tag:t,showTooltip:!1},e.name)}))})})]})]})]})]}),x.length>0||N.length>0?(0,Xe.jsx)("div",{className:"tag-collections-container narrow",children:(0,Xe.jsxs)("div",{className:"side-panel",children:[x.length>0&&j(),N.length>0&&w()]})}):null]})},hs=e=>{let{label:t="LOCKED",subtitle:a="Coming Soon",className:n="",visible:s=!0}=e;return s?(0,Xe.jsx)("div",{className:`coming-soon-overlay ${n}`,children:(0,Xe.jsxs)("div",{className:"coming-soon-content",children:[(0,Xe.jsx)("div",{className:"coming-soon-label",children:t}),(0,Xe.jsx)("div",{className:"coming-soon-subtitle",children:a})]})}):null},ms=[1,2,3,4],gs=[3,6,9,15],ps=[10,20,30,40],fs=[{max:15,description:"Too Low",scoreMultiplier:0,stressIncrease:0,color:"#efd50dda"},{max:30,description:"Very Low",scoreMultiplier:.5,stressIncrease:0,color:"#FFA500da"},{max:60,description:"Good",scoreMultiplier:1,stressIncrease:0,color:"#32CD32da"},{max:70,description:"Perfect!",scoreMultiplier:2,stressIncrease:0,color:"#009900da"},{max:90,description:"Stressfull",scoreMultiplier:1.5,stressIncrease:5,color:"#FF4500da"},{max:100,description:"High Stress",scoreMultiplier:1.5,stressIncrease:10,color:"#FF0000da"},{max:1/0,description:"Impossible",scoreMultiplier:0,stressIncrease:20,color:"#222222da"}],vs=()=>{const e=kt(),[t,a]=(0,n.useState)(0),[s,i]=(0,n.useState)([]),[o,l]=(0,n.useState)([]),[c,d]=(0,n.useState)([]);(0,n.useEffect)((()=>{const t=[{id:"tones",name:"Tones",color:"#9123a1",maxLevel:5,currentLevel:e.getDMAbilityMeterLevel("tones"),abilities:["Comedic","Dramatic","Heroic","Romantic","Grim"],themes:[r.Co.COMEDIC,r.Co.DRAMATIC,r.Co.HEROIC,r.Co.ROMANTIC,r.Co.GRIM],hoverText:["Unlock the Comedy Tone","Unlock the Dramatic Tone","Unlock the Heroic Tone","Unlock the Romantic Tone","Unlock the Grim Tone"],pointsPerLevel:1},{id:"hosting",name:"Hosting",color:"#DC143C",maxLevel:4,currentLevel:e.getDMAbilityMeterLevel("hosting"),abilities:["Snacks","Breaks","Props","Comfort"],hoverText:["Use snacks to improve party attitude.","Breaks reduce tension, stress, and exhaustion.","Props provide a bonus Encounter Score per Level","Comfort levels increase maximum Party Exhaustion"],pointsPerLevel:1},{id:"storytelling",name:"Storytelling",color:"#4682B4",maxLevel:3,currentLevel:e.getDMAbilityMeterLevel("storytelling"),abilities:["Preparation","Living World","Dramatic Narration"],hoverText:["Describe 1 location and 1 upcoming encounter element at the start of each campaign, +1 score bonus for those prep thingers.","Players gain 1 Attention at the beginning of each event.","Widen the x2 area on the Tension Meter"],pointsPerLevel:1}];i(t)}),[e]),(0,n.useEffect)((()=>{const t=[{id:"roleplaying",name:"Roleplaying",currentLevel:e.getDMGameMasteryLevel("roleplaying"),maxLevel:3,color:"#9d7020",rankLabels:["Novice","Adept","Expert"]},{id:"combat",name:"Combat",currentLevel:e.getDMGameMasteryLevel("combat"),maxLevel:3,color:"#9d7020",rankLabels:["Novice","Adept","Expert"]},{id:"travel",name:"Travel",currentLevel:e.getDMGameMasteryLevel("travel"),maxLevel:3,color:"#9d7020",rankLabels:["Novice","Adept","Expert"]}];d(t)}),[e]),(0,n.useEffect)((()=>{const t=[{id:"snacks",name:"Snacks",value:e.getMaxSnacks(),cost:1,color:"#FF6347",icon:"\ud83d\udd12",unlockedBy:"hosting",unlockLevel:1},{id:"breaks",name:"Breaks",value:e.getMaxBreaks(),cost:1,color:"#32CD32",icon:"\ud83d\udd12",unlockedBy:"hosting",unlockLevel:2},{id:"props",name:"Props",value:e.getCurrentProps(),cost:1,color:"#FFD700",icon:"\ud83d\udd12",unlockedBy:"hosting",unlockLevel:3},{id:"comfort",name:"Venue",value:e.getCurrentVenue(),cost:1,color:"#FFD700",icon:"\ud83d\udd12",unlockedBy:"hosting",unlockLevel:4}];l(t)}),[e]);(0,n.useEffect)((()=>{a(e.getDMAbilityPoints());const t=t=>{a(t),l((t=>t.map((t=>{let a;switch(t.id){case"snacks":a=e.getMaxSnacks();break;case"breaks":a=e.getMaxBreaks();break;case"props":a=e.getCurrentProps();break;case"comfort":a=e.getCurrentVenue();break;default:a=t.value}return{...t,value:a}}))))};return e.on("dmAbilitiesUpdated",t),()=>{e.off("dmAbilitiesUpdated",t)}}),[e]);const u=a=>{const n=a.currentLevel/a.maxLevel*100,r=a.currentLevel<a.maxLevel&&t>=a.pointsPerLevel;return(0,Xe.jsxs)("div",{className:"ability-meter",children:[(0,Xe.jsx)("button",{className:"ability-button "+(r?"can-upgrade":""),onClick:()=>(t=>{const a=s.find((e=>e.id===t));if(!a||a.currentLevel>=a.maxLevel)return;const n=a.pointsPerLevel;e.upgradeDMAbilityMeter(t,n)&&i((e=>e.map((e=>e.id===t?{...e,currentLevel:e.currentLevel+1}:e))))})(a.id),disabled:!r,style:{backgroundColor:a.color},children:(0,Xe.jsx)("span",{className:"ability-name",children:a.name})}),(0,Xe.jsxs)("div",{className:"ability-track",children:[(0,Xe.jsxs)("div",{className:"ability-circles",children:[(0,Xe.jsx)("div",{className:"ability-circle-spacer"}),Array.from({length:a.maxLevel},((e,t)=>(0,Xe.jsx)("div",{className:"ability-circle background",style:{backgroundColor:"black"}},`background-${t}`)))]}),(0,Xe.jsxs)("div",{className:"ability-circles names",children:[(0,Xe.jsx)("div",{className:"ability-circle-spacer"}),Array.from({length:a.maxLevel},((e,t)=>{var n;return(0,Xe.jsx)(bn,{tooltip:(null===(n=a.hoverText)||void 0===n?void 0:n[t])||a.abilities[t],visible:!0,children:(0,Xe.jsx)("div",{className:"ability-circle-name "+(t<a.currentLevel?"highlighted":""),children:(0,Xe.jsx)("div",{className:"ability-circle-name-text",children:a.abilities[t]})})},`name-${t}`)}))]}),(0,Xe.jsx)("div",{className:"ability-progress",style:{width:"100%",backgroundColor:"#000000"}}),(0,Xe.jsxs)("div",{className:"ability-circles foreground",children:[(0,Xe.jsx)("div",{className:"ability-circle-spacer"}),Array.from({length:a.maxLevel},((e,t)=>(0,Xe.jsx)("div",{className:"ability-circle "+(t<a.currentLevel?"filled":""),style:{backgroundColor:t<a.currentLevel?a.color:"transparent"}},`foreground-${t}`)))]}),(0,Xe.jsx)("div",{className:"ability-progress filled",style:{width:`${n}%`,backgroundColor:a.color}})]}),(0,Xe.jsxs)("div",{className:"ability-info",children:[(0,Xe.jsxs)("span",{className:"ability-level",children:[a.currentLevel,"/",a.maxLevel]}),a.currentLevel>0&&(0,Xe.jsx)("span",{className:"ability-unlock",children:a.abilities[a.currentLevel-1]})]})]},a.id)};return(0,Xe.jsxs)("div",{className:"dm-abilities-screen",children:[(0,Xe.jsx)("div",{className:"abilities-header",children:(0,Xe.jsxs)("div",{className:"available-points",children:[(0,Xe.jsx)("span",{className:"points-label",children:"Available Points:"}),(0,Xe.jsx)("span",{className:"points-value",children:t})]})}),(0,Xe.jsx)("div",{className:"abilities-meters",children:s.map((e=>"storytelling"===e.id?(0,Xe.jsxs)("div",{style:{position:"relative"},children:[u(e),(0,Xe.jsx)(hs,{})]},e.id):u(e)))}),(0,Xe.jsxs)("div",{className:"game-mastery-section",style:{position:"relative"},children:[(0,Xe.jsxs)("div",{className:"game-mastery-row",children:[(0,Xe.jsx)("div",{className:"game-mastery-label",children:(0,Xe.jsx)("span",{className:"ability-name",children:"Game Mastery"})}),c.map((a=>{const n=a.currentLevel<a.maxLevel&&t>=1,s=a.currentLevel>0?a.rankLabels[a.currentLevel-1]:"Untrained";return(0,Xe.jsxs)("div",{className:"mastery-container",children:[(0,Xe.jsxs)("div",{className:"mastery-label-top",children:[(0,Xe.jsx)("span",{className:"mastery-name",children:a.name}),(0,Xe.jsxs)("span",{className:"mastery-level",children:["Level ",a.currentLevel,"/",a.maxLevel]})]}),(0,Xe.jsx)("button",{className:"ability-button "+(n?"can-upgrade":""),onClick:()=>(t=>{const a=c.find((e=>e.id===t));!a||a.currentLevel>=a.maxLevel||e.upgradeDMGameMastery(t,1)&&d((e=>e.map((e=>e.id===t?{...e,currentLevel:e.currentLevel+1}:e))))})(a.id),disabled:!n,style:{backgroundColor:a.color},children:(0,Xe.jsx)("span",{className:"mastery-rank",children:s})})]},a.id)}))]}),(0,Xe.jsx)(hs,{})]}),(0,Xe.jsx)("div",{className:"consumables-section",children:(0,Xe.jsxs)("div",{className:"consumable-row",children:[(0,Xe.jsx)("div",{className:"consumable-header",children:(0,Xe.jsx)("span",{className:"section-title",children:"HOSTING UPGRADES"})}),(0,Xe.jsx)("div",{className:"consumable-grid",children:o.map((a=>{const n=(e=>{const t=["Battlemaps","Cardboard Buildings","Miniatures","3D Printed Everything"],a=["Background Music","Nice Chairs","Gaming Table","Custom Game Room"];switch(e.id){case"snacks":return{displayName:"Snacks",currentDescription:e.value>0?`${e.value} per Encounter `:"None",currentEffect:"increases attitude by 1",upgradeButtonText:"+1 Snacks",maxLevel:10};case"breaks":return{displayName:"Breaks",currentDescription:e.value>0?`${e.value} per Encounter`:"None",currentEffect:"decreases tension, stress, exhastion",upgradeButtonText:"+1 Breaks",maxLevel:10};case"props":return{displayName:"Props",currentDescription:e.value>0?t[e.value-1]||"Max Level":"None",upgradeButtonText:e.value>0&&e.value<t.length?`Upgrade to ${t[e.value]}`:0===e.value?"Unlock Props":"Max Level",currentEffect:e.value>0?`+${gs[e.value-1]} Encounter Score`:"",maxLevel:t.length};case"comfort":return{displayName:"Venue",currentDescription:e.value>0?a[e.value-1]||"Max Level":"Basic Setup",upgradeButtonText:e.value>0&&e.value<a.length?`Upgrade to ${a[e.value]}`:0===e.value?"Unlock Venue":"Max Level",currentEffect:e.value>0?`+${ps[e.value-1]} Max Exhaustion`:"",maxLevel:a.length};default:return{displayName:e.name,currentDescription:e.value>0?`Level ${e.value}`:"None",upgradeButtonText:`+1 ${e.name}`,currentEffect:"",maxLevel:10}}})(a),s=(t=>!t.unlockedBy||e.isDMUpgradeUnlocked(t.id,t.unlockedBy,t.unlockLevel||1))(a),r=t>=a.cost&&s,i=a.value>=n.maxLevel;return(0,Xe.jsxs)("div",{className:"consumable-item",children:[(0,Xe.jsx)("div",{className:"consumable-category-label",children:n.displayName}),(0,Xe.jsx)("div",{className:"consumable-current-status",children:s?(0,Xe.jsxs)("div",{className:"current-info",children:[(0,Xe.jsx)("span",{className:"current-level",children:n.currentDescription}),(0,Xe.jsx)("span",{className:"current-effect",children:n.currentEffect})]}):(0,Xe.jsx)("span",{className:"locked-status",children:"\ud83d\udd12 Locked"})}),s?(0,Xe.jsx)("button",{className:"consumable-upgrade-button "+(r&&!i?"can-upgrade":"disabled"),onClick:()=>(t=>{const a=o.find((e=>e.id===t));if(a&&e.purchaseDMConsumable(t,a.cost)){let a;switch(t){case"snacks":a=e.getMaxSnacks();break;case"breaks":a=e.getMaxBreaks();break;case"props":a=e.getCurrentProps();break;case"comfort":a=e.getCurrentVenue();break;default:a=0}l((e=>e.map((e=>e.id===t?{...e,value:a}:e))))}})(a.id),disabled:!r||i,children:i?"Max Level":n.upgradeButtonText}):(0,Xe.jsxs)("div",{className:"locked-indicator",children:[(0,Xe.jsx)("span",{className:"lock-icon",children:"\ud83d\udd12"}),(0,Xe.jsxs)("span",{className:"unlock-requirement",children:["Hosting Level ",a.unlockLevel]})]})]},a.id)}))})]})})]})},ys=e=>{let{onClose:t,initialView:a="collections"}=e;const[s,r]=(0,n.useState)(a);return(0,Xe.jsx)("div",{className:"dm-collections-modal-overlay",onClick:e=>{e.target===e.currentTarget&&t()},children:(0,Xe.jsxs)("div",{className:"dm-collections-modal-container "+("collections"===s?"green-theme":"blue-theme"),children:[(0,Xe.jsxs)("div",{className:"dm-collections-modal-header",children:[(0,Xe.jsx)("h2",{children:"collections"===s?"Topics & Themes":"DM Abilities"}),(0,Xe.jsx)("button",{className:"close-button",onClick:t,children:"\xd7"})]}),(0,Xe.jsx)("div",{className:"dm-collections-modal-content",children:(()=>{switch(s){case"collections":return(0,Xe.jsx)("div",{className:"collections-content",children:(0,Xe.jsx)(us,{onClose:()=>{},isEmbedded:!0})});case"abilities":return(0,Xe.jsx)("div",{className:"abilities-content",children:(0,Xe.jsx)(vs,{})});default:return null}})()})]})})},bs=e=>{let{isOpen:t,onClose:a}=e;const s=Rt().getChatManager().getLLMService(),[r,i]=(0,n.useState)(""),[o,l]=(0,n.useState)("https://api.openai.com/v1"),[c,d]=(0,n.useState)("gpt-3.5-turbo"),[u,h]=(0,n.useState)("idle"),[m,g]=(0,n.useState)("");(0,n.useEffect)((()=>{if(t){const e=localStorage.getItem("llm_api_key")||"",t=localStorage.getItem("llm_base_url")||"https://api.openai.com/v1",a=localStorage.getItem("llm_model")||"gpt-3.5-turbo";i(e),l(t),d(a)}}),[t]);return t?(0,Xe.jsx)("div",{className:"llm-config-modal-overlay",children:(0,Xe.jsxs)("div",{className:"llm-config-modal",children:[(0,Xe.jsxs)("div",{className:"modal-header",children:[(0,Xe.jsx)("h2",{children:"LLM Configuration"}),(0,Xe.jsx)("button",{className:"close-button",onClick:a,children:"\xd7"})]}),(0,Xe.jsx)("div",{className:"modal-content",children:(0,Xe.jsxs)("div",{className:"config-section",children:[(0,Xe.jsx)("h3",{children:"API Configuration"}),(0,Xe.jsxs)("div",{className:"form-group",children:[(0,Xe.jsx)("label",{htmlFor:"apiKey",children:"API Key *"}),(0,Xe.jsx)("input",{id:"apiKey",type:"password",value:r,onChange:e=>i(e.target.value),placeholder:"Enter your OpenAI API key",className:"form-control"}),(0,Xe.jsxs)("small",{className:"form-text",children:["Get your API key from ",(0,Xe.jsx)("a",{href:"https://platform.openai.com/api-keys",target:"_blank",rel:"noopener noreferrer",children:"OpenAI Platform"})]})]}),(0,Xe.jsxs)("div",{className:"form-group",children:[(0,Xe.jsx)("label",{htmlFor:"baseUrl",children:"Base URL"}),(0,Xe.jsx)("input",{id:"baseUrl",type:"url",value:o,onChange:e=>l(e.target.value),placeholder:"https://api.openai.com/v1",className:"form-control"})]}),(0,Xe.jsxs)("div",{className:"form-group",children:[(0,Xe.jsx)("label",{htmlFor:"model",children:"Model"}),(0,Xe.jsxs)("select",{id:"model",value:c,onChange:e=>d(e.target.value),className:"form-control",children:[(0,Xe.jsx)("option",{value:"gpt-3.5-turbo",children:"GPT-3.5 Turbo (Recommended)"}),(0,Xe.jsx)("option",{value:"gpt-4",children:"GPT-4"}),(0,Xe.jsx)("option",{value:"gpt-4-turbo",children:"GPT-4 Turbo"})]})]}),(0,Xe.jsxs)("div",{className:"test-section",children:[(0,Xe.jsx)("button",{onClick:async()=>{if(!r.trim())return h("error"),void g("Please enter an API key first");h("testing"),g("Testing connection...");try{s.setApiKey(r.trim()),s.setConfiguration({baseUrl:o,model:c});const e=await s.generateContextualResponse({tag:{name:"magic sword"},gameContext:{},partyTension:.5});e?(h("success"),g(`Success! Response: "${e.message}"`)):(h("error"),g("Failed to get response from LLM service"))}catch(e){h("error"),g(`Error: ${e instanceof Error?e.message:"Unknown error"}`)}},disabled:"testing"===u,className:`test-button ${u}`,children:"testing"===u?"Testing...":"Test Connection"}),m&&(0,Xe.jsx)("div",{className:`test-result ${u}`,children:m})]})]})}),(0,Xe.jsxs)("div",{className:"modal-footer",children:[(0,Xe.jsx)("button",{onClick:a,className:"btn btn-secondary",children:"Cancel"}),(0,Xe.jsx)("button",{onClick:()=>{r.trim()&&(s.setApiKey(r.trim()),s.setConfiguration({baseUrl:o,model:c}),localStorage.setItem("llm_base_url",o),localStorage.setItem("llm_model",c),a())},className:"btn btn-primary",disabled:!r.trim(),children:"Save Configuration"})]})]})}):null};class Es{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.rules=[],this.debugMode=!0,this.rules=[...e]}setDebugMode(e){this.debugMode=e}isDebugMode(){return this.debugMode}}const xs=e=>{let{onClose:t}=e;const[a,s]=(0,n.useState)({speakerType:"character",playerAttitude:5,mood:"neutral",theme:"adventure"}),[r,i]=(0,n.useState)([]),[o,l]=(0,n.useState)(!0);return(0,Xe.jsxs)("div",{className:"chat-rule-test-panel",children:[(0,Xe.jsxs)("div",{className:"panel-header",children:[(0,Xe.jsx)("h3",{children:"Chat Rule Test Panel"}),(0,Xe.jsx)("button",{onClick:t,className:"close-btn",children:"\xd7"})]}),(0,Xe.jsxs)("div",{className:"test-controls",children:[(0,Xe.jsxs)("div",{className:"control-group",children:[(0,Xe.jsx)("label",{children:"Speaker Type:"}),(0,Xe.jsxs)("select",{value:a.speakerType,onChange:e=>s({...a,speakerType:e.target.value}),children:[(0,Xe.jsx)("option",{value:"player",children:"Player"}),(0,Xe.jsx)("option",{value:"character",children:"Character"}),(0,Xe.jsx)("option",{value:"dm",children:"DM"})]})]}),(0,Xe.jsxs)("div",{className:"control-group",children:[(0,Xe.jsx)("label",{children:"Player Attitude (1-10):"}),(0,Xe.jsx)("input",{type:"range",min:"1",max:"10",value:a.playerAttitude,onChange:e=>s({...a,playerAttitude:parseInt(e.target.value)})}),(0,Xe.jsx)("span",{children:a.playerAttitude})]}),(0,Xe.jsxs)("div",{className:"control-group",children:[(0,Xe.jsx)("label",{children:"Mood:"}),(0,Xe.jsxs)("select",{value:a.mood,onChange:e=>s({...a,mood:e.target.value}),children:[(0,Xe.jsx)("option",{value:"positive",children:"Positive"}),(0,Xe.jsx)("option",{value:"negative",children:"Negative"}),(0,Xe.jsx)("option",{value:"neutral",children:"Neutral"})]})]}),(0,Xe.jsxs)("div",{className:"control-group",children:[(0,Xe.jsx)("label",{children:"Theme:"}),(0,Xe.jsxs)("select",{value:a.theme,onChange:e=>s({...a,theme:e.target.value}),children:[(0,Xe.jsx)("option",{value:"adventure",children:"Adventure"}),(0,Xe.jsx)("option",{value:"combat",children:"Combat"}),(0,Xe.jsx)("option",{value:"social",children:"Social"}),(0,Xe.jsx)("option",{value:"mystery",children:"Mystery"}),(0,Xe.jsx)("option",{value:"exploration",children:"Exploration"})]})]}),(0,Xe.jsxs)("div",{className:"control-group",children:[(0,Xe.jsx)("label",{children:"Debug Mode:"}),(0,Xe.jsx)("input",{type:"checkbox",checked:o,onChange:e=>l(e.target.checked)}),(0,Xe.jsx)("span",{children:o?"Enabled":"Disabled"})]}),(0,Xe.jsxs)("div",{className:"button-group",children:[(0,Xe.jsx)("button",{onClick:()=>{(new Es).setDebugMode(o);const e=[].map((e=>`${e.name}: ${e.action.instruction}`));i(e)},className:"test-btn",children:"Test Rules"}),(0,Xe.jsx)("button",{onClick:()=>{(new Es).setDebugMode(o);i(["Rules loaded: 0 total rules"])},className:"reset-btn",children:"Reset Rules"})]})]}),(0,Xe.jsxs)("div",{className:"test-results",children:[(0,Xe.jsx)("h4",{children:"Active Rule Effects:"}),r.length>0?(0,Xe.jsx)("ul",{children:r.map(((e,t)=>(0,Xe.jsx)("li",{children:e},t)))}):(0,Xe.jsx)("p",{children:"Run a test to see which rules apply..."})]}),(0,Xe.jsxs)("div",{className:"rule-examples",children:[(0,Xe.jsx)("h4",{children:"Example Rule Behaviors:"}),(0,Xe.jsxs)("ul",{children:[(0,Xe.jsxs)("li",{children:[(0,Xe.jsx)("strong",{children:"Third Person Speech:"})," Characters sometimes speak in third person when attitude is high"]}),(0,Xe.jsxs)("li",{children:[(0,Xe.jsx)("strong",{children:"Player Narration:"})," Players describe actions narratively based on mood"]}),(0,Xe.jsxs)("li",{children:[(0,Xe.jsx)("strong",{children:"Attitude Responses:"})," High attitude = enthusiastic, Low attitude = reluctant"]}),(0,Xe.jsxs)("li",{children:[(0,Xe.jsx)("strong",{children:"Mood Adaptation:"})," Positive mood adds optimistic language"]}),(0,Xe.jsxs)("li",{children:[(0,Xe.jsx)("strong",{children:"Theme Matching:"})," Combat themes use action words, social themes use diplomatic language"]})]})]})]})},Ns=e=>{let{data:t,onComplete:a,duration:s=5e3}=e;return(0,n.useEffect)((()=>{const e=setTimeout((()=>{a()}),s);return()=>clearTimeout(e)}),[a,s]),(0,Xe.jsxs)("div",{className:`game-toast ${t.type}-toast ${t.isComplete?"complete":""}`,children:[(0,Xe.jsxs)("div",{className:"toast-header",children:[(0,Xe.jsx)("div",{className:"toast-title",children:t.title}),t.subtitle&&(0,Xe.jsx)("div",{className:"toast-subtitle",children:t.subtitle})]}),(0,Xe.jsx)("div",{className:"tag-list",children:t.tags.map((e=>{const a=t.isTagCollected(e);return(0,Xe.jsx)(aa,{tag:{tag:e,source:t.getTagSource(e,a),theme:t.getTagTheme(e,a)},className:`\n                ${e.name===t.newTag.name?"pulse":""} \n                ${t.isComplete?"glow":""} \n                ${a?"collected":"uncollected"}\n              `.trim()},e.name)}))})]})},Ts=()=>{const e=Rt(),t=kt(),a=Ot(),s=e.getQuestManager(),i=e.getTagManager(),o=e.getPartyManager(),[l,c]=(0,n.useState)(t.getCollectedTones()),[d,u]=(0,n.useState)(o.getPartyExhaustion()),[h,m]=(0,n.useState)(o.getPartyTension()),[g,p]=(0,n.useState)(0),[f,v]=(0,n.useState)(!1),[y,b]=(0,n.useState)("collections"),[E,x]=(0,n.useState)(!1),[N,T]=(0,n.useState)(!1),[C,A]=(0,n.useState)(t.getDMAbilityPoints()),[S,M]=(0,n.useState)([]),j=(0,n.useRef)(new Set);(0,n.useEffect)((()=>{const e=()=>{u(o.getPartyExhaustion())};return o.on("dmScreenUpdated",e),()=>{o.off("dmScreenUpdated",e)}}),[o]),(0,n.useEffect)((()=>{const e=()=>{m(o.getPartyTension())};return a.on("playerUpdate",e),()=>{a.off("playerUpdate",e)}}),[a,o]),(0,n.useEffect)((()=>{const e=()=>{p((e=>e+1))};return t.on("tensionDescriptionsUpdated",e),()=>{t.off("tensionDescriptionsUpdated",e)}}),[t]);const w=()=>{M((e=>e.slice(1)))};(0,n.useEffect)((()=>{const e=()=>{c({...t.getCollectedTones()})},a=e=>{A(e)};return t.on("dmScreenUpdated",e),t.on("dmAbilitiesUpdated",a),()=>{t.off("dmScreenUpdated",e),t.off("dmAbilitiesUpdated",a)}}),[t,s]),(0,n.useEffect)((()=>{const e=()=>{const e=i.getCollectedTags(),t=e.length,a=j.current.size;if(console.log("RightSidebar: Collection toast check triggered",{currentTagCount:t,lastKnownCount:a,processedTagsList:Array.from(j.current)}),t<=a)return void console.log("RightSidebar: No new tags detected, skipping toast logic");const n=e.filter((e=>!j.current.has(e.name)));console.log("RightSidebar: Newly collected tags:",n.map((e=>e.name))),n.length>0&&n.forEach((t=>{ds.TAG_COLLECTIONS.forEach((a=>{if(a.tags.some((e=>e.name===t.name))){const n=a.tags.every((t=>e.some((e=>e.name===t.name)))),s=((e,t,a,n)=>{const s=ds.TAG_COLLECTIONS.find((t=>t.name===e));if(!s)throw new Error(`Collection not found: ${e}`);return{id:`collection-${e}-${t.name}`,type:"collection",title:e,subtitle:a?"Collection Complete!":"New Topic Collected",tags:s.tags,newTag:t,isComplete:a,isTagCollected:e=>n.getCollectedTags().some((t=>e.name===t.name)),getTagSource:(e,t)=>t?r.UW.COLLECTION_COLLECTED:r.UW.COLLECTION,getTagTheme:(e,t)=>a?r.Co.GLOW:r.Co.NONE}})(a.name,t,n,i);M((e=>[...e,s]))}})),j.current.add(t.name)}))};return t.on("dmScreenUpdated",e),()=>{t.off("dmScreenUpdated",e)}}),[t,i]),(0,n.useEffect)((()=>{const e=e=>{const t=(e=>{const{quest:t,newTag:a,completedTags:n,currentNode:s}=e,i=0===s.children.length;return{id:`quest-${t.id}-${a.name}`,type:"quest",title:t.name,subtitle:i?"Quest Complete!":"Quest Progress",tags:(()=>{const e=[];for(const t of s.children)e.push(t.tag);return e})(),newTag:a,isComplete:i,isTagCollected:e=>n.includes(e.name),getTagSource:(e,t)=>r.UW.QUEST,getTagTheme:(e,t)=>r.Co.NONE}})(e);M((e=>[...e,t]))};return t.on("showQuestToast",e),()=>{t.off("showQuestToast",e)}}),[t]);const R=t.getTensionColor(h);return(0,Xe.jsxs)("div",{className:"right-sidebar",children:[(0,Xe.jsxs)("div",{className:"right-sidebar-content",children:[(0,Xe.jsx)("div",{className:"player-tension-holder",children:(0,Xe.jsxs)("div",{className:"stress-needle",onClick:()=>o.setPartyTension(h+4),style:{borderColor:R,transition:"background-color 0.3s ease"},children:[(0,Xe.jsx)(ss,{stress:h}),(0,Xe.jsx)(ns,{value:h/10,max:10,colors:t.getTensionColors(),descriptions:t.getTensionDescriptions().map((e=>e.description)),segmentRanges:t.getTensionRanges().map((e=>e/10))},g),(0,Xe.jsxs)("div",{className:"stress-label-containers",children:[(0,Xe.jsxs)("div",{className:"stress-labels",children:[(0,Xe.jsx)("div",{className:"stress-label title",children:"PARTY TENSION"}),(0,Xe.jsx)(ss,{stress:h,displayNumber:!0})]}),(0,Xe.jsx)("div",{className:"stress-labels bottom",children:(0,Xe.jsx)("div",{className:"stress-label",children:o.getTensionDescription2(h)})})]})]})}),(0,Xe.jsx)("div",{className:"player-row-exhaustion",children:(0,Xe.jsxs)("div",{className:"party-exhaustion",children:[(0,Xe.jsxs)("div",{className:"party-exhaustion-label-row",children:[(0,Xe.jsx)("div",{className:"party-exhaustion-label",children:"0"}),(0,Xe.jsx)("div",{className:"party-exhaustion-label",children:"EXHAUSTION"}),(0,Xe.jsx)("div",{className:"party-exhaustion-label",children:o.getMaxPartyExhaustion()})]}),(0,Xe.jsx)(qt,{totalSegments:20,filledSegments:d/5,theme:"exhaustion",label:""}),(0,Xe.jsx)("div",{className:"party-exhaustion-label number",children:d})]})}),Object.entries(l).length>0&&(0,Xe.jsx)(cs,{themes:l,maxSegments:3,onRedeem:e=>{t.redeemTheme(e)}}),(0,Xe.jsx)("div",{className:"chat-container",children:(0,Xe.jsx)(ls,{})})," ",(0,Xe.jsxs)("div",{className:"dm-control-panel",children:[(0,Xe.jsxs)("button",{className:"dm-control-button collections-button",onClick:()=>{b("collections"),v(!0)},children:[(0,Xe.jsx)("span",{children:"TOPICS"}),i.getAvailableCollectionRewards()>0&&(0,Xe.jsx)("div",{className:"reward-count",children:i.getAvailableCollectionRewards()})]}),(0,Xe.jsxs)("button",{className:"dm-control-button skill-button",onClick:()=>{b("abilities"),v(!0)},children:[(0,Xe.jsx)("span",{children:"SKILLS"}),C>0&&(0,Xe.jsx)("div",{className:"reward-count",children:C})]}),(0,Xe.jsxs)("button",{className:"dm-control-button quest-button",onClick:()=>{s.activateQuest.length&&a.showActiveQuestsModal()},children:[(0,Xe.jsx)("span",{children:"QUESTS"}),s.getActiveQuests().length>0&&(0,Xe.jsx)("div",{className:"reward-count",children:s.getActiveQuests().length})]})]}),(0,Xe.jsx)("div",{className:"settings-panel",children:(0,Xe.jsxs)("button",{className:"settings-button llm-button",onClick:()=>x(!0),title:"Configure AI-powered contextual chat responses",children:[(0,Xe.jsx)("span",{children:"\ud83e\udd16 LLM"}),e.getChatManager().getLLMService().isEnabled()&&(0,Xe.jsx)("div",{className:"status-indicator enabled"})]})})]}),f&&(0,Xe.jsx)(ys,{initialView:y,onClose:()=>v(!1)}),E&&(0,Xe.jsx)(bs,{isOpen:E,onClose:()=>x(!1)}),N&&(0,Xe.jsx)(xs,{onClose:()=>T(!1)}),(0,Xe.jsx)("div",{className:"game-toasts-container",children:S.map(((e,t)=>(0,Xe.jsx)("div",{children:(0,Xe.jsx)(Ns,{data:e,onComplete:w})},e.id)))})]})},Cs=["#FFCCCC","#FFDDCC","#FFFFCC","#DDFFCC","#CCFFCC","#aaFFaa"],As=["#AA0000","#663300","#666600","#336600","#006600","#008800"],Ss=e=>{let{player:t}=e;jt();const[a,s]=(0,n.useState)(!1),[i,o]=(0,n.useState)(null),[l,c]=(0,n.useState)(t.characters),d=Ot(),[u,h]=(0,n.useState)(t.playerStats.enjoyment),[m,g]=(0,n.useState)(t.playerStats.involvement),[p,f]=(0,n.useState)(t.playerStats.stress),v=function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?e<30?"#4CAF50":e<60?"#ffff00":"#ff4d4d":e<.3?"#ff4d4d":e<.6?"#ffa500":"#4CAF50"};(0,n.useEffect)((()=>{const e=()=>{h(t.playerStats.enjoyment),g(t.playerStats.involvement),f(t.playerStats.stress),c(t.characters),console.log("player updated "+t.name),console.log(t.playerStats)};return d.on("playerUpdate",e),()=>{d.off("playerUpdate",e)}}),[d,t.playerStats,t.characters,t.name]);const y=t.preferences.filter((e=>e[1]>0)),b=t.preferences.filter((e=>e[1]<0)),E=t.traits;return(0,Xe.jsxs)("div",{className:"player-display",onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),onClick:()=>d.showBasicNotebook(r.d8.PLAYER,t),children:[(0,Xe.jsxs)("div",{className:"character-level-icon-column",children:[(0,Xe.jsx)("div",{className:"player-diamond-holder",children:(0,Xe.jsx)("div",{className:"player-diamond",style:{backgroundColor:Cs[t.playerStats.enjoyment],borderColor:As[t.playerStats.enjoyment]}})}),(0,Xe.jsx)("div",{className:"player-icon-container",children:(0,Xe.jsx)(Je,{imageId:t.icon})}),(0,Xe.jsx)("div",{className:"character-level",children:(0,Xe.jsx)(qt,{filledSegments:t.playerStats.experience,totalSegments:rt[t.playerStats.level],theme:"player-level",label:`LEVEL ${t.playerStats.level}`})})]}),(0,Xe.jsx)("div",{className:"character-icons",children:l.map(((e,t)=>(0,Xe.jsxs)("div",{className:"character-icon-container",children:[i===t&&(0,Xe.jsxs)("div",{className:"character-tooltip",children:[(0,Xe.jsx)("div",{className:"tooltip-header",children:e.name}),(0,Xe.jsx)("div",{className:"tooltip-content",children:(0,Xe.jsx)(Yt,{hero:e,category:r.lq.ALL,showAttributeLoss:!0,overviewDisplay:!0})})]}),(0,Xe.jsx)("div",{className:"character-icon",onMouseEnter:()=>o(t),onMouseLeave:()=>o(null),onClick:t=>{t.stopPropagation(),d.showBasicNotebook(r.d8.CHARACTER,e)},children:(0,Xe.jsx)(Je,{imageId:e.icon})})]},e.id)))}),(0,Xe.jsxs)("div",{className:"player-stats",children:[(0,Xe.jsx)("div",{className:"player-stat-label name",children:t.name}),(0,Xe.jsx)("div",{className:"player-stat-label",style:{color:v(u/t.playerStats.maxEnjoyment)},children:"attitude"}),(0,Xe.jsx)("div",{className:"stat-bar",children:(0,Xe.jsx)("div",{className:"fill happiness",style:{width:u/5*100+"%",backgroundColor:v(u/t.playerStats.maxEnjoyment)}})}),(0,Xe.jsx)("div",{className:"player-stat-label",style:{color:v(m/t.playerStats.maxInvolvement)},children:"attention"}),(0,Xe.jsx)("div",{className:"stat-bar",children:(0,Xe.jsx)("div",{className:"fill attention",style:{width:m/5*100+"%",backgroundColor:v(m/t.playerStats.maxInvolvement)}})}),(0,Xe.jsx)("div",{className:"player-stat-label",style:{color:v(Math.max(0,p-t.playerStats.stressBuffer),!0)},children:"stress"}),(0,Xe.jsx)("div",{children:(0,Xe.jsxs)("div",{className:"stat-item stress",children:[(0,Xe.jsxs)("div",{className:"stress-value",style:{color:v(Math.max(0,p-t.playerStats.stressBuffer),!0)},children:[Math.max(0,t.playerStats.stress-t.playerStats.stressBuffer),"%"]}),(0,Xe.jsx)("div",{className:"stress-buffer",children:t.playerStats.stress<t.playerStats.stressBuffer&&(0,Xe.jsxs)("div",{className:"stress-buffer-value",children:["[",Math.max(0,t.playerStats.stressBuffer-t.playerStats.stress),"]"]})})]})})]}),a&&null===i&&(0,Xe.jsxs)("div",{className:"player-tooltip",children:[(0,Xe.jsx)("div",{className:"tooltip-header",children:t.name}),(0,Xe.jsxs)("div",{className:"tooltip-content",children:["Likes:",(0,Xe.jsx)("div",{className:"preference-list",children:y.map(((e,t)=>(0,Xe.jsx)("div",{className:"text-pill preference-item like",children:e[0].name},t)))})]}),(0,Xe.jsxs)("div",{className:"tooltip-content",children:["Hates:",(0,Xe.jsx)("div",{className:"preference-list",children:b.map(((e,t)=>(0,Xe.jsx)("div",{className:"text-pill preference-item hate",children:e[0].name},t)))})]}),E.length>0&&(0,Xe.jsxs)("div",{className:"tooltip-content",children:["Player Traits:",(0,Xe.jsx)("div",{className:"preference-list",children:E.map(((e,t)=>(0,Xe.jsxs)("div",{className:"preference-item trait ",children:[e.name,":",(0,Xe.jsx)("div",{children:e.description})]},t)))})]})]})]})},Ms=e=>{let{treasureLevel:t,treasurePoints:a}=e;const n=Rt().getPartyManager();for(;n.getTreasureThreshold(t+1)<=a;)t++;const s=n.getTreasureThreshold(t+1),r=(n.getTreasureThreshold(t),n.getTreasureReward(t));return(0,Xe.jsxs)("div",{className:"treasure-display-container",children:[(0,Xe.jsx)("div",{className:"treasure-header",children:(0,Xe.jsx)("span",{className:"treasure-title",children:"TREASURE"})}),(0,Xe.jsx)("div",{className:"treasure-reward",children:(0,Xe.jsx)("span",{className:"reward-value",children:"score"===r.type?(0,Xe.jsx)(Ka,{score:r.value}):(0,Xe.jsxs)("span",{children:["+",r.value," Attitude"]})})}),(0,Xe.jsxs)("div",{className:"treasure-progress",children:[(0,Xe.jsxs)("span",{className:"progress-text",children:[a,"/",s]}),(0,Xe.jsx)(qt,{totalSegments:s,filledSegments:a,theme:"treasure"})]})]})},js=e=>{let{characters:t,onClick:a}=e;const n=e=>{switch(Bt(e)){case _t.VERY_UNREADY:return"unready2";case _t.UNREADY:return"unready1";case _t.READY:return"ready";case _t.PERFECT:return"perfect";case _t.OVERREADY:return"overready";default:return"unknown"}};return(0,Xe.jsx)("div",{className:"level-up-button",onClick:a,children:(0,Xe.jsxs)("div",{className:"inner-content",children:[(0,Xe.jsx)("div",{className:"level-up-label",children:"Level Up!"}),(0,Xe.jsx)("div",{className:"character-readiness-row",children:t.map(((e,t)=>(0,Xe.jsx)("div",{className:`readiness-symbol ${n(e.experience)}`,children:Ft(e.experience)},e.id)))})]})})},ws=e=>{let{character:t,isSelected:a,onToggle:s}=e;const[r,i]=(0,n.useState)(""),o=[{start:0,end:Ut.VERY_UNREADY-1,backgroundColor:"#ffcdd2",fillColor:"#f44336",label:"Very Unready: All other players -2 happiness"},{start:Ut.VERY_UNREADY,end:Ut.UNREADY-1,backgroundColor:"#ffe0b2",fillColor:"#ff9800",label:"Unready: All other players -1 happiness"},{start:Ut.READY_START,end:Ut.READY_END,backgroundColor:"#c8e6c9",fillColor:"#8bc34a",label:"Ready: +1 Happiness"},{start:Ut.PERFECT_START,end:Ut.PERFECT_END,backgroundColor:"#4caf50",fillColor:"#2e7d32",label:"Perfect: +2 Happiness"},{start:Ut.READY_SECOND_START,end:Ut.READY_SECOND_END,backgroundColor:"#c8e6c9",fillColor:"#8bc34a",label:"Ready: +1 Happiness"},{start:Ut.OVERREADY,end:100,backgroundColor:"#ffab91",fillColor:"#ff5722",label:"Overready: +0 Happiness (-1 Happiness when OTHER Player's Characters level up)"}],l=Bt(t.experience);return(0,Xe.jsxs)("div",{className:"character-level-row",children:[(0,Xe.jsxs)("button",{className:`character-toggle ${a?"selected":""} ${l}`,onClick:s,children:[(0,Xe.jsx)("div",{className:"character-icon",children:(0,Xe.jsx)(Je,{imageId:t.icon})}),(0,Xe.jsx)("div",{className:"character-name",children:t.name})]}),(0,Xe.jsx)("div",{className:"experience-bar "+(a?"selected":""),children:(0,Xe.jsx)(ia,{totalSegments:100,filledSegments:t.experience,ranges:o,onHover:e=>{i(`Level Up: Full Attention\n${e}`)},onLeave:()=>{i("")}})}),r&&(0,Xe.jsx)("div",{className:"tooltip",children:r.split("\n").map(((e,t)=>(0,Xe.jsx)("div",{children:e},t)))})]})},Rs=e=>{let{player:t,selectedCharacters:a,onCharacterToggle:n}=e;const s=t.characters.some((e=>a.has(e.id)));return(0,Xe.jsxs)("div",{className:"player-character-level-row "+(s?"highlighted":""),children:[(0,Xe.jsxs)("div",{className:"player-info",children:[(0,Xe.jsx)("div",{className:"player-icon",children:(0,Xe.jsx)(Je,{imageId:t.icon})}),(0,Xe.jsx)("div",{className:"player-name",children:t.name})]}),(0,Xe.jsx)("div",{className:"characters-list",children:t.characters.map((e=>(0,Xe.jsx)(ws,{character:e,isSelected:a.has(e.id),onToggle:()=>n(e.id)},e.id)))})]})},ks=e=>{let{onClose:t}=e;const[a,s]=(0,n.useState)(new Set),[i,o]=(0,n.useState)(!1),[l,c]=(0,n.useState)(null),d=Rt(),u=jt(),h=wt(),m=h.getPlayers(),g=e=>{const t=new Set(a);t.has(e)?t.delete(e):t.add(e),s(t)},p=()=>{const e=[],t=d.getPartyManager(),n=(t,a,n)=>{if(!t)return;const s=e.find((e=>e.object===t));s&&s.effects?s.effects.push({effect:a,class:n}):e.push({object:t,effects:[{effect:a,class:n}]})},s=Array.from(a).map((e=>u.getCharacterById(e))).filter((e=>void 0!==e)),i=new Set;s.forEach((e=>{const t=m.find((t=>t.characters.some((t=>t.id===e.id))));t&&i.add(t.id)})),s.forEach((e=>{const a=m.find((t=>t.characters.some((t=>t.id===e.id))));if(!a)return;const s=Bt(e.experience),i=e.level+1,o=(e=>{const t=zt(e.character_class,e.level),a=zt(e.character_class,e.level+1);return{[r.Eh.COMBAT]:a[r.Eh.COMBAT]-t[r.Eh.COMBAT],[r.Eh.MAGIC]:a[r.Eh.MAGIC]-t[r.Eh.MAGIC],[r.Eh.TOOLS]:a[r.Eh.TOOLS]-t[r.Eh.TOOLS]}})(e);n(e,`Level ${i}`,"character-level"),n(e,"+2 Attributes","character-attributes"),n(e,JSON.stringify(o),"attribute-gains"),a.playerStats.involvement=a.playerStats.maxInvolvement,n(a,"Full Attention","player-attention"),h.addPlayerExp(a,1),n(a,"+1 Experience","player-exp");let l=0;switch(s){case _t.VERY_UNREADY:l=-2;break;case _t.UNREADY:l=-1;break;case _t.READY:l=1;break;case _t.PERFECT:l=2;break;case _t.OVERREADY:l=0}s===_t.VERY_UNREADY||s===_t.UNREADY?m.forEach((e=>{e.id!==a.id&&(t.addEnjoyment(e,l),n(e,`${l} Happiness`,"player-attitude"))})):l>0&&(t.addEnjoyment(a,l),n(a,`+${l} Happiness`,"player-attitude"))})),m.forEach((e=>{if(e.characters.some((e=>Bt(e.experience)===_t.OVERREADY))&&!i.has(e.id)){const a=-1*s.length;t.addEnjoyment(e,a),n(e,`${a} Happiness (Overready Penalty)`,"player-attitude")}}));return t.exhaustParty(25),n("party","+25 Exhaustion","exhaustion"),e},f=e=>{e.target===e.currentTarget&&t()},v=m.filter((e=>e.characters.length>0)),y=()=>null;return i&&l?(0,Xe.jsx)("div",{className:"party-level-up-modal-overlay",onClick:f,children:(0,Xe.jsx)("div",{className:"party-level-up-modal-container",children:(0,Xe.jsx)("div",{className:"level-up-results-wrapper",children:(0,Xe.jsx)(Wn,{resultConfig:l,renderResultInfo:y,onClose:t,onTagClick:()=>{},selectedTags:[],remainingClicks:0})})})}):(0,Xe.jsx)("div",{className:"party-level-up-modal-overlay",onClick:f,children:(0,Xe.jsxs)("div",{className:"party-level-up-modal-container",children:[(0,Xe.jsxs)("div",{className:"party-level-up-modal-header",children:[(0,Xe.jsx)("h2",{children:"Character Level Up"}),(0,Xe.jsx)("button",{className:"close-button",onClick:t,children:"\xd7"})]}),(0,Xe.jsxs)("div",{className:"party-level-up-modal-content",children:[(0,Xe.jsx)("p",{className:"selection-prompt",children:"Select characters to level up:"}),(0,Xe.jsx)("div",{className:"players-list",children:v.map((e=>(0,Xe.jsx)(Rs,{player:e,selectedCharacters:a,onCharacterToggle:g},e.id)))})]}),(0,Xe.jsx)("div",{className:"party-level-up-modal-footer",children:(0,Xe.jsx)("button",{className:"confirm-button "+(0===a.size?"exit":""),onClick:0===a.size?t:()=>{const e=p();a.forEach((e=>{const t=u.getCharacterById(e);t&&(t.level+=1,t.experience=0)}));const t={results:e,title:"Level Up Results",description:`Successfully leveled up ${a.size} character${1===a.size?"":"s"}!`,tags:[],travelOption:{tagInstructions:""},info:{}};c(t),o(!0)},children:0===a.size?"Exit":`Level Up ${a.size} Characters`})})]})})},Is=e=>{let{overviewMode:t=!1}=e;const a=Rt(),s=wt().getPlayers(),r=Ot(),i=a.getPartyManager(),[o,l]=(0,n.useState)(!1),[c,d]=(0,n.useState)(i.getTreasureLevel()),[u,h]=(0,n.useState)(i.getTreasurePoints());(0,n.useEffect)((()=>{const e=()=>{d(i.getTreasureLevel()),h(i.getTreasurePoints())};return r.on("playerUpdate",e),()=>{r.off("playerUpdate",e)}}),[r,i]);return(0,Xe.jsxs)("div",{className:"gameroom-container",children:[(0,Xe.jsxs)("div",{className:"gameroom-layout",children:[(0,Xe.jsxs)("div",{className:"gameroom-main-content",children:[(0,Xe.jsx)("div",{className:"gameroom-top-container",children:(0,Xe.jsx)("div",{className:"player-display-container",children:(0,Xe.jsxs)("div",{className:"player-row",children:[(0,Xe.jsx)("div",{className:"gameroom-player-row",children:s.map((e=>(0,Xe.jsx)(Ss,{player:e},e.id)))}),(0,Xe.jsx)(js,{characters:a.getCharacterManager().getPlayerCharacters(),onClick:()=>l(!0)}),(0,Xe.jsx)(Ms,{treasureLevel:c,treasurePoints:u})]})})}),!t&&(0,Xe.jsx)("div",{className:"gameroom-table-container",children:(0,Xe.jsx)(es,{})})," ",!t&&(0,Xe.jsx)(rs,{})]}),!t&&(0,Xe.jsx)(Ts,{})]}),o&&(0,Xe.jsx)(ks,{onClose:()=>l(!1)})]})},Os=()=>{kt();return(0,Xe.jsxs)("div",{className:"session-control-container",children:[(0,Xe.jsx)(Is,{overviewMode:!0}),(0,Xe.jsx)("div",{className:"encounter-overview",children:(0,Xe.jsx)(Xa,{})})]})},Ls=e=>{let{appManager:t}=e;return(0,Xe.jsx)("div",{className:"session-run-container",children:(0,Xe.jsx)(Is,{})})},Ps=e=>{let{appManager:t}=e;return(0,Xe.jsx)("div",{className:"final-stats-container",children:"FINAL STATS"})},Ds=e=>{let{appManager:t}=e;return(0,Xe.jsx)("div",{className:"main-menu-container",children:(0,Xe.jsxs)("div",{className:"main-menu-content",children:[(0,Xe.jsx)("div",{className:"main-menu-options",children:(0,Xe.jsx)(ga,{buttonList:[r.P$.PLAYER_RECRUITMENT,r.P$.CHARACTER_ASSIGNMENT,r.P$.CAMPAIGN],highlight:r.P$.PLAYER_RECRUITMENT})}),(0,Xe.jsx)("div",{className:"game-start-container",children:(0,Xe.jsx)("div",{className:"buitton-container",children:(0,Xe.jsx)("div",{className:"quickstart-button  nav-button",onClick:()=>{t.initiateQuickStartSetup(),t.state=Lt.SESSION_OVERVIEW},children:"Quick Start"})})})]})})},Us=e=>{let{}=e;const t=Rt(),[a,s]=(0,n.useState)(t.state),[r,i]=(0,n.useState)(!1),[o,l]=(0,n.useState)(!1),[c,d]=(0,n.useState)(!1),u=Ot(),h=t.getDataManager(),m=kt();(0,n.useEffect)((()=>{const e=()=>{l(!1),i(!1),s(t.state),function(e){if(!u)return;switch(e){case Lt.MAIN_MENU:break;case Lt.PLAYER_RECRUITMENT:case Lt.CHARACTER_CREATION:case Lt.CAMPAIGN_SETUP:i(!0),setTimeout((()=>{i(!1),l(!0)}),1e3);case Lt.SESSION_OVERVIEW:case Lt.SESSION:case Lt.SCORE:}}(t.state)};return t.on("stateChange",e),()=>{t.off("stateChange",e)}}),[t]);return(0,Xe.jsxs)("div",{className:"mode-container",children:[(0,Xe.jsx)("div",{className:"bgImageContainer",children:(0,Xe.jsxs)("div",{className:`mode-background ${(()=>{switch(h.getStateProps().bg_transition_mode){case"slide-left":return`${r?"slide-left":""} ${o?"left":""}`;case"slide-right":return`${r?"slide-right":""} ${o?"right":""}`;case"slide-down":return`${r?"slide-down":""} ${o?"down":""}`;default:return""}})()}`,children:[(0,Xe.jsx)("div",{className:"mode-background-image",style:{backgroundRepeat:"repeat"},children:(0,Xe.jsx)(Je,{imageId:h.getStateProps().background_image_id})}),(0,Xe.jsx)("div",{className:"mode-background-overlay",children:(0,Xe.jsx)(Je,{imageId:h.getStateProps().background_image_id})}),(0,Xe.jsx)("div",{className:"mode-background-bottom",children:(0,Xe.jsx)(Je,{imageId:h.getStateProps().secondary_bg_image_id})})]})}),(0,Xe.jsx)("div",{className:"mode-component",children:function(){switch(a){case Lt.MAIN_MENU:return(0,Xe.jsx)(Ds,{appManager:t});case Lt.PLAYER_RECRUITMENT:return(0,Xe.jsx)(pa,{appManager:t,playerManager:t.getPlayerManager()});case Lt.CHARACTER_CREATION:return(0,Xe.jsx)(fa,{});case Lt.CAMPAIGN_SETUP:return(0,Xe.jsx)(xa,{openCampaign:m.getOpenCampaignIndex()});case Lt.SESSION_OVERVIEW:return(0,Xe.jsx)(Os,{});case Lt.SESSION:return(0,Xe.jsx)(Ls,{appManager:t});case Lt.SCORE:return(0,Xe.jsx)(Ps,{appManager:t})}return(0,Xe.jsx)("div",{children:"NOT YET IMPLEMENTED"})}()})]})},_s=e=>{let{modalConfig:t,onClose:a,onOptionSelect:n}=e;if(!t.sceneData)return null;const{location:s,encounter:i}=t.sceneData;return(0,Xe.jsx)("div",{className:"modal-overlay",children:(0,Xe.jsxs)("div",{className:"modal-container setscene",children:[(0,Xe.jsxs)("div",{className:"modal-header",children:[(0,Xe.jsx)("h2",{children:t.title}),(0,Xe.jsx)("button",{className:"close-button",onClick:a,children:"\xd7"})]}),(0,Xe.jsxs)("div",{className:"setscene-content",children:[(0,Xe.jsx)("div",{className:"setscene-image",children:(0,Xe.jsx)(Je,{imageId:s.icon})}),(0,Xe.jsxs)("div",{className:"setscene-info",children:[(0,Xe.jsx)("h3",{className:"location-name",children:s.name}),(0,Xe.jsx)("p",{className:"location-description",children:s.description}),(0,Xe.jsxs)("div",{className:"encounter-info",children:[(0,Xe.jsx)("h4",{children:"Set the Scene"}),(0,Xe.jsx)("p",{children:"Now that the Location is fully described, your players can imagine the details more clearly."}),(0,Xe.jsx)("p",{children:"You will gain a multiplier during encounter scoring for the rest of this Encounter."})]}),(0,Xe.jsx)("div",{className:"location-tags",children:(0,Xe.jsx)("div",{className:"tags-grid",children:s.tags.map(((e,t)=>(0,Xe.jsx)(na,{tag:e,disabled:!0,highlighted:!1,showTooltip:!1,theme:r.Co.NONE,source:r.UW.LOCATION,className:"setscene-tag"},t)))})})]})]}),(0,Xe.jsx)("div",{className:"setscene-actions",children:t.options.map((e=>(0,Xe.jsx)("button",{className:"setscene-continue-button",onClick:()=>n(e.id),children:e.title},e.id)))})]})})},Bs=e=>{let{messages:t,onComplete:a,speedUp:s}=e;const[i,o]=(0,n.useState)(0),[l,c]=(0,n.useState)([]),d=(0,n.useRef)(null),u=Rt().getUiManager(),h=t[i];(0,n.useEffect)((()=>{c(t.map((()=>({text:"",complete:!1}))))}),[t]),(0,n.useEffect)((()=>{if(!h)return void a();return(()=>{const e=h.message.split(/(?<=\s)|(?=\s)/);let n=0,r=e.map((e=>({word:e,visible:!1})));const l=()=>{if(n<e.length){if(!r[n].word.match(/^\s+$/)){r[n].visible=!0;const e=r.map((e=>{let{word:t,visible:a}=e;return t.match(/^\s+$/)?t:`<span class="chat-word ${a?"visible":""}">${t}</span>`})).join("");c((t=>{const a=[...t];return a[i]={text:e,complete:!1},a}))}n++;const e=s?5:10;d.current=setTimeout(l,e)}else if(c((e=>{const t=[...e];return t[i]={text:h.message,complete:!0},t})),i<t.length-1){const e=s?50:800;d.current=setTimeout((()=>{o((e=>e+1))}),e)}else setTimeout((()=>a()),500)};l()})(),()=>{d.current&&clearTimeout(d.current)}}),[i,h,s,t.length,a]),(0,n.useEffect)((()=>{s&&(d.current&&clearTimeout(d.current),c(t.map((e=>({text:e.message,complete:!0})))),o(t.length-1),setTimeout((()=>a()),100))}),[s,t,a]);return(0,Xe.jsx)("div",{className:"conversation-display chat-expanded-messages",children:t.map(((e,t)=>{const a=l[t];return t<=i?(0,Xe.jsx)("div",{className:`chat-message-container ${n=e.speaker,n.type===r.wb.DM?"dm":n.type===r.wb.PLAYER?"player":"character"} ${null!==a&&void 0!==a&&a.complete?"complete":"current"}`,children:(0,Xe.jsxs)("div",{className:"chat-message-display",children:[(0,Xe.jsxs)("div",{className:"chat-message-speaker-container",children:[(0,Xe.jsx)("div",{className:"chat-message-speaker",children:u.getMessageSpeakerName(e.speaker)}),(0,Xe.jsx)("div",{className:"chat-message-icon",children:(0,Xe.jsx)(Je,{imageId:u.getMessageIconId(e.speaker)||"icon_dm"})})]}),(0,Xe.jsx)("div",{className:"chat-messager-content",children:(0,Xe.jsx)("div",{className:"chat-message-text",children:(0,Xe.jsx)("div",{className:"chat-message-words",dangerouslySetInnerHTML:{__html:(null===a||void 0===a?void 0:a.text)||e.message}})})})]})},t):null;var n}))})},Fs=e=>{let{messages:t,title:a,onComplete:n,speedUp:s}=e;const r=t.length>0;return(0,Xe.jsx)("div",{className:"conversation-section",children:(0,Xe.jsx)("div",{className:"conversation-content",children:r?(0,Xe.jsx)(Bs,{messages:t,onComplete:n,speedUp:s}):(0,Xe.jsx)("div",{className:"no-conversation",children:(0,Xe.jsx)("p",{children:"This tag was discovered without recorded conversation."})})})})};function Hs(e){return e.reduce(((e,t)=>t.multiplier?e*t.points:e+t.points),0)}const Gs=e=>{let{initialCampaignScore:t,newScore:a,onRewardClaim:s,claimedRewards:r=[],onDMPointClaim:i,claimedDMPoints:o=[],showScore:l=!0,onThresholdCrossed:c}=e;const d=t+a,[u,h]=(0,n.useState)(t),[m,g]=(0,n.useState)([]),p=120,f=l?d:t,v=(0,n.useMemo)((()=>[24,48,72,96,120]),[]),y=v.map(((e,t)=>({threshold:e,index:t}))).filter((e=>{let{threshold:t,index:a}=e;return f>=t&&!r.includes(a)})),b=(0,n.useMemo)((()=>[12,36,60,84,108]),[]),E=b.map(((e,t)=>({threshold:e,index:t}))).filter((e=>{let{threshold:t,index:a}=e;return f>=t&&!o.includes(a)})),x=y.length>0,N=E.length>0;(0,n.useEffect)((()=>{if(!l)return void h(t);const e=d;if(e!==u){const a=[...v,...b].filter((t=>u<t&&e>=t));a.length>0&&(g(a),a.forEach((e=>{null===c||void 0===c||c(e)})),setTimeout((()=>g([])),1500));const n=setTimeout((()=>{h(e)}),u===t&&e>t?500:100);return()=>clearTimeout(n)}}),[d,u,l,t,v,b,c]);const T=Math.min(u/p*100,100),C=T,A=(0,n.useMemo)((()=>{const e=[];for(let t=4;t<=p;t+=4)if(t%24!==0){const a=b.indexOf(t),n=-1!==a,s=n&&f>=t&&!o.includes(a);e.push({position:t/p*100,type:"d6",score:t,isDMPoint:n,isAvailableDMPoint:s})}for(let t=24;t<=p;t+=24)e.push({position:t/p*100,type:"d20",score:t});return e}),[p,4,24,b,f,o]),S=()=>{if(N&&E.length>0&&i){const e=E[0];i(e.index)}};return(0,Xe.jsx)("div",{className:"reward-fill-bar",children:(0,Xe.jsx)("div",{className:"reward-fill-container",children:(0,Xe.jsxs)("div",{className:"reward-progress-bar",children:[(0,Xe.jsx)("div",{className:"progress-track",children:(0,Xe.jsx)("div",{className:"progress-fill",style:{width:`${T}%`}})}),(0,Xe.jsx)("div",{className:"milestone-markers",children:A.map(((e,t)=>(0,Xe.jsx)("div",{className:`milestone-marker ${e.type} ${m.includes(e.score)?"flashing":""} ${e.isDMPoint?"dmpoint-dice":""} ${e.isAvailableDMPoint?"available-dmpoint":""}`,style:{left:`${e.position}%`},onClick:e.isAvailableDMPoint?S:void 0,children:(0,Xe.jsx)(Je,{imageId:"d6"===e.type?"die_d6":"die_d20"})},t)))}),(0,Xe.jsxs)("div",{className:"score-bubble",style:{left:`${C}%`},children:[(0,Xe.jsx)("div",{className:"bubble-arrow"}),(0,Xe.jsx)("div",{className:"bubble-content",children:x?(0,Xe.jsx)("button",{className:"reward-claim-button",onClick:()=>{if(x&&y.length>0){const e=y[0];s(e.index)}},children:"QUEST"}):N?(0,Xe.jsx)("button",{className:"dmpoint-claim-button",onClick:S,children:"DM POINT"}):(0,Xe.jsx)("span",{className:"score-text",children:(0,Xe.jsx)(Ka,{score:u})})})]})]})})})},Ws=e=>{let{entries:t,totalScore:a,currentCampaignScore:s,newTotalCampaignScore:r,onComplete:i,speedUp:o}=e;const[l,c]=(0,n.useState)(0),[d,u]=(0,n.useState)(!1),h=(0,n.useRef)(null);return(0,n.useEffect)((()=>{if(o)return c(t.length),u(!0),void setTimeout((()=>i()),100);return l<t.length?h.current=setTimeout((()=>{c((e=>e+1))}),800):d||(h.current=setTimeout((()=>{u(!0),setTimeout((()=>i()),500)}),800)),()=>{h.current&&clearTimeout(h.current)}}),[l,d,t.length,i,o]),(0,Xe.jsxs)("div",{className:"scoring-ledger",children:[" ",(0,Xe.jsx)("div",{className:"score-entries",children:t.slice(0,l).map(((e,t)=>(0,Xe.jsxs)("div",{className:"score-entry animate-in "+(e.multiplier?e.points<1?"multiplier-low":"multiplier-high":""),style:{borderColor:e.color?e.color:void 0,boxShadow:e.color?`0 0 10px ${e.color}`:void 0},children:[(0,Xe.jsx)("span",{className:"score-description",children:e.description}),e.multiplier?(0,Xe.jsxs)("span",{className:"score-points multiplier-"+(e.points<1?"low":"high"),children:["x",e.points]}):(0,Xe.jsx)("span",{className:"score-points",children:(0,Xe.jsx)(Ka,{score:Math.abs(e.points),direction:"row",className:"score-dice "+(e.points<0?"negative":"positive")})})]},t)))}),d&&(0,Xe.jsxs)("div",{className:"score-total animate-in",children:[(0,Xe.jsx)("div",{className:"total-separator"}),(0,Xe.jsxs)("div",{className:"total-entry glow",children:[(0,Xe.jsx)("span",{className:"total-label",children:"Added Score"}),(0,Xe.jsx)("span",{className:"total-points "+(a>=0?"positive":"negative"),children:(0,Xe.jsx)(Ka,{score:Math.abs(a),direction:"row",className:"total-dice "+(a<0?"negative":"positive")})})]}),(0,Xe.jsxs)("div",{className:"total-entry campaign-score-entry",children:[(0,Xe.jsx)("span",{className:"total-label",children:"Total Score"}),(0,Xe.jsx)("span",{className:"campaign-score-breakdown",children:(0,Xe.jsx)("span",{className:"final-score",children:(0,Xe.jsx)(Ka,{score:r,direction:"row"})})})]})]})]})},zs=e=>{var t,a,s,i,o;let{modalConfig:l,onClose:c,onOptionSelect:d}=e;const u=Rt().getUiManager(),[h,m]=(0,n.useState)(!1),[g,p]=(0,n.useState)(!1),[f,v]=(0,n.useState)(!1),[y,b]=(0,n.useState)([]),[E,x]=(0,n.useState)([]),N=Rt(),T=N.getTagManager(),C=N.getCampaignManager(),A=null===(t=l.tagData)||void 0===t?void 0:t.tag,S=null===(a=l.tagData)||void 0===a?void 0:a.chatTrigger,M=null===(s=l.tagData)||void 0===s?void 0:s.encounter,j=n.useMemo((()=>S?Array.isArray(S)?S:S.conversation?[]:S.length>0?[{message:S,speaker:{type:r.wb.DM,id:0}}]:S.message?[{message:S.message,speaker:S.speaker||{type:r.wb.DM,id:0}}]:[]:[]),[S]),w=n.useMemo((()=>A?C.getEncounterScoring(A)||[{description:"Encounter",points:25,isPositive:!0},{description:"Event ",points:15,isPositive:!0},{description:"Narrative Cohesion",points:10,isPositive:!0},{description:"Time Efficiency",points:-5,isPositive:!1},{description:"Creative Solution",points:20,isPositive:!0}]:[]),[C,A]),R=n.useMemo((()=>Hs(w)),[w]),k=C.getCampaignScore(),I=k+R;if(!l.tagData||!A)return null;const O=()=>{h&&g||v(!0)},L=e=>!T.getOutstandingEncounterTags().includes(e),P=((null===M||void 0===M?void 0:M.tags)||[]).filter((e=>L(e))).length,D=h&&g;return(0,Xe.jsx)("div",{className:"modal-overlay blue-theme",onClick:O,children:(0,Xe.jsxs)("div",{className:"modal-container encountertag",onClick:e=>{e.stopPropagation(),O()},children:[(0,Xe.jsxs)("div",{className:"encountertag-header",children:[(0,Xe.jsx)("div",{className:"header-background",children:(null===M||void 0===M?void 0:M.icon)&&(0,Xe.jsx)(Je,{imageId:M.icon})}),(0,Xe.jsx)("div",{className:"header-overlay"}),(0,Xe.jsxs)("div",{className:"header-content",children:[(0,Xe.jsx)("div",{className:"header-left",children:(0,Xe.jsxs)("div",{className:"encounter-info",children:[(0,Xe.jsx)("h2",{className:"encounter-title",children:(null===M||void 0===M?void 0:M.name)||"Unknown Encounter"}),(0,Xe.jsxs)("div",{className:"tag-discovery",children:[(0,Xe.jsx)("span",{className:"tag-name",children:A.name}),A.type&&(0,Xe.jsx)("span",{className:"tag-type",children:A.type})]})]})}),(0,Xe.jsx)("div",{className:"header-right",children:(0,Xe.jsx)("div",{className:"encounter-tags",children:null===M||void 0===M||null===(i=M.tags)||void 0===i?void 0:i.map(((e,t)=>(0,Xe.jsx)(aa,{tag:{tag:{...e},source:L(e)?r.UW.ENCOUNTER:r.UW.ENCOUNTER_EXPECTED,theme:r.Co.NONE},off:!0,showTooltip:!1,className:"encounter-tag"},t)))})})]})]}),(0,Xe.jsxs)("div",{className:"encountertag-body",children:[(0,Xe.jsx)(Fs,{messages:j,title:`Encounter Topic ${P} : ${A.name}`,onComplete:()=>m(!0),speedUp:f}),(0,Xe.jsxs)("div",{className:"scoring-section",children:[(0,Xe.jsx)("div",{className:"section-header",children:(0,Xe.jsx)("h3",{children:"Encounter Scoring"})}),(0,Xe.jsx)("div",{className:"scoring-content",children:(0,Xe.jsx)(Ws,{entries:w,totalScore:R,currentCampaignScore:k,newTotalCampaignScore:I,onComplete:()=>p(!0),speedUp:f})})]})]}),(0,Xe.jsxs)("div",{className:"encountertag-footer",children:[(0,Xe.jsx)("div",{className:"campaign-reward-section",children:(0,Xe.jsx)(Gs,{initialCampaignScore:k,newScore:R,onRewardClaim:e=>{b((t=>[...t,e])),u.showSelectQuestModal()},onDMPointClaim:e=>{C.addDMAbilityPoints(1),x((t=>[...t,e])),console.log(`Claimed DM point ${e+1}!`)},claimedRewards:y,claimedDMPoints:E,showScore:g,onThresholdCrossed:e=>{console.log(`Crossed reward threshold: ${e}`)}})}),(0,Xe.jsx)("button",{className:"encountertag-continue-button "+(D?"":"disabled"),onClick:()=>D&&(()=>{var e;D&&(C.bankCampaignScore(Hs(w)),C.clearEncounterScore(),d((null===(e=l.options[0])||void 0===e?void 0:e.id)||"continue"),c())})(),disabled:!D,children:(null===(o=l.options[0])||void 0===o?void 0:o.title)||"CONTINUE"})]})]})})},Qs=e=>{let{modalConfig:t,onClose:a,onOptionSelect:n}=e;const s=Rt(),i=s.getPlayerManager(),o=s.getTagManager();if(!t.encounterData)return null;const{branches:l}=t.encounterData,{preferredEncounters:c,notWantedEncounters:d}=i.evaluateEncounterPreferences(l),u=i.calculateIncompleteExplorationPenalties(o),h=u.totalStressPenalty>0||u.totalAttentionPenalty>0,m=1===l.length,g=(e,t)=>({tag:e,source:t,theme:r.Co.NONE});return(0,Xe.jsx)("div",{className:"modal-overlay",children:(0,Xe.jsxs)("div",{className:"modal-container nextencounter",children:[(0,Xe.jsxs)("div",{className:"modal-header",children:[(0,Xe.jsx)("h2",{children:t.title}),(0,Xe.jsx)("button",{className:"close-button",onClick:a,children:"\xd7"})]}),(0,Xe.jsxs)("div",{className:"nextencounter-content",children:[(0,Xe.jsx)("div",{className:"encounter-options",children:l.map((e=>{const t=(a=e.name,c[a]||[]);var a;const s=(e=>d[e]||[])(e.name);return(0,Xe.jsx)("div",{className:"encounter-option",onClick:()=>n(e.name),children:(0,Xe.jsxs)("div",{className:"encounter-card",children:[(0,Xe.jsx)("div",{className:"encounter-image",children:(0,Xe.jsx)(Je,{imageId:e.icon})}),(0,Xe.jsxs)("div",{className:"encounter-info",children:[(0,Xe.jsx)("h3",{className:"encounter-name",children:e.name}),(0,Xe.jsx)("p",{className:"encounter-description",children:e.description}),(0,Xe.jsxs)("div",{className:"encounter-location",children:[(0,Xe.jsx)("strong",{children:"Location:"})," ",e.location.name]}),e.location.tags&&e.location.tags.length>0&&(0,Xe.jsx)("div",{className:"encounter-tags",children:(0,Xe.jsx)("div",{className:"tags-list",children:e.location.tags.map(((e,t)=>(0,Xe.jsx)(aa,{tag:g(e,r.UW.LOCATION),showTooltip:!0},t)))})}),e.tags&&e.tags.length>0&&(0,Xe.jsxs)("div",{className:"encounter-tags",children:[(0,Xe.jsx)("div",{className:"tags-label",children:"Elements:"}),(0,Xe.jsx)("div",{className:"tags-list",children:e.tags.map(((e,t)=>(0,Xe.jsx)(aa,{tag:g(e,r.UW.ENCOUNTER),showTooltip:!0},t)))})]})]}),(0,Xe.jsxs)("div",{className:"player-preferences-container",children:[t.length>0&&(0,Xe.jsxs)("div",{className:"player-preferences preferred",children:[(0,Xe.jsx)("div",{className:"preferences-label",children:"Preferred by:"}),(0,Xe.jsx)("div",{className:"preferences-effect",children:"+1 Attitude"}),(0,Xe.jsx)("div",{className:"player-icons",children:t.map((e=>(0,Xe.jsx)("div",{className:"player-icon",title:e.name,children:(0,Xe.jsx)(Je,{imageId:e.icon})},e.id)))})]}),(s.length>0||m||h)&&(0,Xe.jsxs)("div",{className:"player-preferences not-wanted",children:[(0,Xe.jsx)("div",{className:"preferences-label",children:"Penalties:"}),h&&(0,Xe.jsxs)(Xe.Fragment,{children:[u.totalStressPenalty>0&&(0,Xe.jsxs)("div",{className:"penalty",children:["Undescribed location topics : +",u.totalStressPenalty," Stress"]}),u.totalAttentionPenalty>0&&(0,Xe.jsxs)("div",{className:"penalty",children:["Need to describe ",u.encounterTagPenalty," encounter topics : -",u.totalAttentionPenalty," Attention"]})]}),m&&(0,Xe.jsx)("div",{className:"penalty",children:"Railroading: -1 Attention"}),s.length>0&&!m&&!h&&(0,Xe.jsx)("div",{className:"penalty",children:"Player Dislikes: -1 Attitude"}),(0,Xe.jsx)("div",{className:"player-icons",children:(h||m?i.playersAffectedByRailroading():s).map((e=>(0,Xe.jsx)("div",{className:"player-icon not-wanted-icon",title:e.name,children:(0,Xe.jsx)(Je,{imageId:e.icon})},e.id)))})]})]}),(0,Xe.jsx)("div",{className:"encounter-overlay",children:(0,Xe.jsx)("div",{className:"select-text",children:"Select Encounter"})})]})},e.name)}))}),(0,Xe.jsx)("div",{className:"selection-help",children:(0,Xe.jsx)("p",{children:"Choose the next encounter for your party. Player preferences are shown based on their attitudes toward the encounter elements and preparation level."})})]})]})})},Vs=e=>{let{handleOpenCampaignNotes:t}=e;return(0,Xe.jsx)("div",{className:"game-info-panel",children:(0,Xe.jsxs)("div",{className:"info-content",children:[(0,Xe.jsxs)("div",{className:"info-section",children:[(0,Xe.jsx)("h3",{children:"Welcome to Dungeon Master Sim"}),(0,Xe.jsx)("p",{children:"Take the role of Dungeon Master and run a Campaign by ushering your players through a series of Encounters."}),(0,Xe.jsx)("p",{children:"Encounters are made up of Events, each with their own rules, goals, and basis in real-life tabletop rpgs."}),(0,Xe.jsx)("p",{children:"Keep your players happy by engaging in topics they like, awarding treasure, and attitude bonuses. Players will get bored if their Characters are ignored."}),(0,Xe.jsxs)("p",{children:["Score points by building ",(0,Xe.jsxs)("span",{className:"inline-dice-symbols",children:[(0,Xe.jsx)(Je,{imageId:"die_d4"}),(0,Xe.jsx)(Je,{imageId:"die_d6"}),(0,Xe.jsx)(Je,{imageId:"die_d20"})]})," during events, and then collect them by hitting key encounter points."]}),(0,Xe.jsx)("div",{className:"button-container-center",children:(0,Xe.jsx)("button",{className:"welcome-button info",onClick:()=>{t()},children:"Open Campaign Notes"})})]}),(0,Xe.jsxs)("div",{className:"info-section highlight",children:[(0,Xe.jsx)("h3",{children:"Gameplay Tips"}),(0,Xe.jsxs)("ul",{children:[(0,Xe.jsx)("li",{children:"Pay attention to your players' preferences and attitudes"}),(0,Xe.jsx)("li",{children:"Balance different encounter types to keep things interesting"}),(0,Xe.jsx)("li",{children:"Use the campaign notes to track important story elements"}),(0,Xe.jsx)("li",{children:"Experiment with different approaches to see what works"})]})]})]})})},Ys=e=>{let{onClose:t}=e;const a=Rt(),s=a.getChatManager(),[r,i]=(0,n.useState)(!1),[o,l]=(0,n.useState)(!1),c=(0,n.useMemo)((()=>s.getConversationById("WELCOME_CONVERSATION")||[]),[s]),d=()=>{r||l(!0)};return(0,Xe.jsx)("div",{className:"modal-overlay blue-theme",onClick:d,children:(0,Xe.jsxs)("div",{className:"modal-container welcome",onClick:e=>{e.stopPropagation(),d()},children:[(0,Xe.jsxs)("div",{className:"welcome-header",children:[(0,Xe.jsx)("div",{className:"header-background",children:(0,Xe.jsx)(Je,{imageId:"logo.png"})}),(0,Xe.jsx)("div",{className:"header-overlay"}),(0,Xe.jsxs)("div",{className:"header-content",children:[(0,Xe.jsx)("h1",{className:"welcome-title",children:"Dungeon Master Sim v0.0.1"}),(0,Xe.jsx)("p",{className:"welcome-subtitle",children:"Prepare for an unfinished experience!"})]})]}),(0,Xe.jsxs)("div",{className:"welcome-body",children:[(0,Xe.jsx)("div",{className:"info-section",children:(0,Xe.jsx)("div",{className:"info-content",children:(0,Xe.jsx)(Vs,{handleOpenCampaignNotes:()=>{t(),a.getCampaignManager().displayNewEncounter()}})})}),(0,Xe.jsx)("div",{className:"conversation-section",children:(0,Xe.jsx)("div",{className:"conversation-content",children:c.length>0?(0,Xe.jsx)(Fs,{messages:c,title:"Welcome",onComplete:()=>i(!0),speedUp:o}):(0,Xe.jsx)("div",{className:"no-conversation",children:(0,Xe.jsx)("p",{children:"What is happening? Why did Maxim break this? Ugh."})})})})]}),(0,Xe.jsx)("div",{className:"welcome-footer",children:(0,Xe.jsx)("button",{className:"welcome-button "+(r?"":"disabled"),onClick:()=>{t()},disabled:!r,children:"BEGIN THE ADVENTURE!"})})]})})},Ks=e=>{let{modalConfig:t,onClose:a}=e;if(!t.tagModalConfig)return null;const{title:n,description:s,tags:r,effects:i,selectedTags:o,remainingClicks:l,tagInstructions:c,onTagClick:d,onClose:u}=t.tagModalConfig,h=()=>{u(),a()};return(0,Xe.jsx)("div",{className:"modal-overlay",children:(0,Xe.jsxs)("div",{className:"modal-container",children:[(0,Xe.jsxs)("div",{className:"modal-header",children:[(0,Xe.jsx)("h2",{children:n}),s&&(0,Xe.jsx)("div",{className:"modal-description",children:s}),(0,Xe.jsx)("button",{className:"close-button",onClick:h,children:"\xd7"})]}),i&&i.length>0&&(0,Xe.jsx)("div",{className:"modal-effects",children:i.map(((e,t)=>(0,Xe.jsx)(Gn,{effectData:e},t)))}),r.length>0&&l>0&&(0,Xe.jsxs)("div",{className:"modal-tag-container",children:[(0,Xe.jsx)("div",{className:"clicks-remaining",children:(0,Xe.jsx)(ra,{content:"Click on the tags to reveal them.",maxWidth:"200",preservePositioning:!0,translate:[0,-80],children:l})}),c&&(0,Xe.jsx)("div",{className:"tag-instructions",children:c}),(0,Xe.jsx)("div",{className:"modal-tags-container",children:(0,Xe.jsx)("div",{className:"modal-tags",children:r.map((e=>{const t=o.includes(e.tag);return(0,Xe.jsx)(aa,{tag:e,onClick:d,className:""+(t?"used":""),disabled:t,showTooltip:!1},e.tag.name)}))})})]}),l>0&&0===r.length&&(0,Xe.jsx)("div",{className:"remaining-clicks-warning",children:"Nothing new to present to the players."}),(0===r.length||0===l)&&(0,Xe.jsx)("div",{className:"modal-actions",children:(0,Xe.jsx)("button",{className:"modal-action-button "+(l>0?"disabled":""),onClick:h,disabled:l>0,children:"Close"})})]})})},qs=()=>{const{modalConfig:e,handleOptionSelect:t,closeModal:a}=(()=>{const[e,t]=(0,n.useState)(null),a=Rt().getUiManager();return(0,n.useEffect)((()=>{const e=e=>{t(e)};return a.on("modalStateChanged",e),()=>{a.off("modalStateChanged",e)}}),[a]),{modalConfig:e,handleOptionSelect:e=>a.handleModalOptionSelected(e),closeModal:()=>a.closeModal()}})();return e?"setscene"===e.type?(0,Xe.jsx)(_s,{modalConfig:e,onClose:a,onOptionSelect:t}):"encountertag"===e.type?(0,Xe.jsx)(zs,{modalConfig:e,onClose:a,onOptionSelect:t}):"nextencounter"===e.type?(0,Xe.jsx)(Qs,{modalConfig:e,onClose:a,onOptionSelect:t}):"tagmodal"===e.type&&e.tagModalConfig?(0,Xe.jsx)(Ks,{modalConfig:e,onClose:a}):"levelup"===e.type?(0,Xe.jsx)("div",{className:"modal-overlay",children:(0,Xe.jsxs)("div",{className:"modal-container",children:[(0,Xe.jsxs)("div",{className:"modal-header",children:[(0,Xe.jsx)("h2",{children:e.title}),(0,Xe.jsx)("button",{className:"close-button",onClick:a,children:"\xd7"})]}),(0,Xe.jsx)("div",{className:"modal-options",children:e.options.map((e=>(0,Xe.jsxs)("button",{className:`modal-option ${e.class||""}`,onClick:()=>t(e.id),children:[(0,Xe.jsx)("div",{className:"option-content",children:(0,Xe.jsx)("h3",{children:e.title})}),e.icon&&(e.id===st.CHARACTER?(0,Xe.jsx)(Je,{imageId:e.icon}):(0,Xe.jsx)("span",{className:"option-icon",children:e.icon})),(0,Xe.jsx)("div",{className:"option-content",children:e.description&&(0,Xe.jsx)("p",{children:e.description})})]},e.id)))})]})}):"travelresult"===e.type&&e.travelConfig?(0,Xe.jsx)("div",{className:"modal-overlay",children:(0,Xe.jsxs)("div",{className:"modal-container travel",children:[(0,Xe.jsxs)("div",{className:"modal-header",children:[e.title,(0,Xe.jsx)("button",{className:"close-button",onClick:a,children:"\xd7"})]}),(0,Xe.jsx)("div",{className:"travel-results",children:e.travelConfig.results.map(((e,t)=>(0,Xe.jsx)(Gn,{effectData:e},t)))}),(0,Xe.jsx)("div",{className:"modal-actions",children:e.options.map((e=>(0,Xe.jsx)("button",{className:"modal-action-button",onClick:()=>t(e.id),children:e.title},e.id)))})]})}):"puzzle"===e.type&&e.effectData?(0,Xe.jsx)("div",{className:"modal-overlay",children:(0,Xe.jsxs)("div",{className:"modal-container puzzle",children:[(0,Xe.jsxs)("div",{className:"modal-header",children:[e.title,(0,Xe.jsx)("button",{className:"close-button",onClick:a,children:"\xd7"})]}),(0,Xe.jsx)("div",{className:"puzzle-results",children:e.effectData.map(((e,t)=>(0,Xe.jsx)(Gn,{effectData:e},t)))}),(0,Xe.jsx)("div",{className:"modal-actions",children:e.options.map((e=>(0,Xe.jsx)("button",{className:"modal-action-button",onClick:()=>t(e.id),children:e.title},e.id)))})]})}):"welcome"===e.type?(0,Xe.jsx)(Ys,{onClose:a}):(0,Xe.jsx)("div",{className:"modal-overlay",children:(0,Xe.jsxs)("div",{className:"modal-container",children:[(0,Xe.jsxs)("div",{className:"modal-header",children:[(0,Xe.jsx)("h2",{children:e.title}),(0,Xe.jsx)("button",{className:"close-button",onClick:a,children:"\xd7"})]}),(0,Xe.jsx)("div",{className:"modal-options",children:e.options.map((e=>(0,Xe.jsxs)("button",{className:`modal-option ${e.class||""}`,onClick:()=>t(e.id),children:[(0,Xe.jsx)("div",{className:"option-content",children:(0,Xe.jsx)("h3",{children:e.title})}),e.icon&&(e.id===st.CHARACTER?(0,Xe.jsx)(Je,{imageId:e.icon}):(0,Xe.jsx)("span",{className:"option-icon",children:e.icon})),(0,Xe.jsx)("div",{className:"option-content",children:e.description&&(0,Xe.jsx)("p",{children:e.description})})]},e.id)))})]})}):null},Xs=e=>{let{reward:t}=e;const a=Ot().getRewardDisplayConfig(t);switch(a.type){case"dice":return(0,Xe.jsx)(Ka,{score:a.score});case"treasurePills":return(0,Xe.jsx)(Xe.Fragment,{children:Array.from({length:a.amount},((e,t)=>(0,Xe.jsx)(aa,{tag:a.tagConfig,highlighted:!1,showTooltip:!1,className:"encounter-flavor-tag"},t)))});default:return(0,Xe.jsx)("span",{children:a.text})}},Zs=e=>{let{quests:t,activeQuestIds:a,onQuestSelect:n,onClose:s}=e;return(0,Xe.jsx)("div",{className:"select-quest-modal-overlay",children:(0,Xe.jsx)("div",{className:"quest-modal-container",children:(0,Xe.jsxs)(ta,{title:"Quest Opportunity",theme:"quests",children:[(0,Xe.jsxs)("div",{className:"modal-header",children:[(0,Xe.jsx)("div",{className:"quest-subheader",children:"Choose a side-story to introduce to the players."}),(0,Xe.jsx)("div",{className:"quest-subheader",children:"  Quest-related topics will grab the players attention."})," "]}),(0,Xe.jsx)("div",{className:"quest-tiles",children:t.map((e=>(0,Xe.jsx)(ta,{title:e.name,theme:"quest",onClick:()=>n(e.id),children:(0,Xe.jsxs)("div",{className:"quest-tile-content","data-quest-icon":e.icon||"default",children:[(0,Xe.jsx)("div",{className:"quest-icon-background",children:e.icon&&(0,Xe.jsx)(Je,{imageId:e.icon})}),(0,Xe.jsxs)("div",{className:"quest-content-overlay",children:[(0,Xe.jsxs)("div",{className:"quest-info",children:[(0,Xe.jsx)("div",{className:"quest-cost",children:e.cost.map(((e,t)=>(0,Xe.jsxs)("span",{className:"quest-cost-item",children:["+",e.amount," ",e.type]},t)))}),(0,Xe.jsx)("div",{className:"quest-description",children:e.description}),(0,Xe.jsxs)("div",{className:"quest-rewards",children:[(0,Xe.jsx)("div",{className:"rewards-title",children:"Rewards:"}),(0,Xe.jsx)("div",{className:"quest-reward-row",children:e.rewards.map(((e,t)=>(0,Xe.jsx)("span",{className:"quest-reward",children:(0,Xe.jsx)("div",{className:"quest-reward-treasure",children:(0,Xe.jsx)(Xs,{reward:e})})},t)))})]})]}),a.includes(e.id)&&(0,Xe.jsx)("div",{className:"active-indicator",children:"ACTIVE"})]})]})})))})]})})})},Js=e=>{let{quest:t,node:a,players:s,onComplete:i,onClose:o}=e;const[l,c]=(0,n.useState)(null),[d,u]=(0,n.useState)(a.conversation),[h]=(0,n.useState)((()=>{const e=[],a=[r.zo.LIKE,r.zo.HATE,r.zo.NEUTRAL];if(t.playerChoices)for(let n=0;n<t.playerChoices.length;n++)for(const t of s){const s=a[Math.floor(3*Math.random())];e.push({playerId:t.id,optionIndex:n,attitude:s})}return e})),m=e=>{switch(e){case r.zo.LIKE:return"#4CAF50";case r.zo.HATE:return"#F44336";case r.zo.NEUTRAL:default:return"#999999"}},g=e=>{const t=s.find((t=>t.id===e));return(null===t||void 0===t?void 0:t.icon)||"\ud83d\udc64"};return(0,Xe.jsx)("div",{className:"quest-terminal-modal-overlay",children:(0,Xe.jsxs)("div",{className:"quest-terminal-modal",children:[(0,Xe.jsxs)("div",{className:"modal-header",children:[(0,Xe.jsxs)("h2",{children:[t.name," - Terminal"]}),(0,Xe.jsx)("button",{className:"close-button",onClick:o,children:"\xd7"})]}),(0,Xe.jsxs)("div",{className:"modal-content",children:[(0,Xe.jsxs)("div",{className:"conversation-panel",children:[(0,Xe.jsx)("h3",{children:"Conversation"}),(0,Xe.jsx)("div",{className:"conversation-content",children:(p=d,p.map(((e,t)=>(0,Xe.jsxs)("div",{className:"conversation-message",children:[(0,Xe.jsx)("div",{className:"speaker",children:"dm"===e.speaker.type?"DM":"player"===e.speaker.type?`Player ${e.speaker.id}`:"character"===e.speaker.type?`Character ${e.speaker.id}`:"Unknown"}),(0,Xe.jsx)("div",{className:"message",children:e.message})]},t))))})]}),(0,Xe.jsxs)("div",{className:"options-panel",children:[(0,Xe.jsx)("h3",{children:"Player Choices"}),t.playerChoices&&t.playerChoices.length>0?(0,Xe.jsxs)("div",{className:"player-options",children:[t.playerChoices.map(((e,a)=>{return(0,Xe.jsxs)("div",{className:"option-tile "+(l===a?"selected":""),onClick:()=>{return c(e=a),void(t.playerChoices&&t.playerChoices[e]&&u(t.playerChoices[e].conversation));var e},children:[(0,Xe.jsxs)("div",{className:"option-content",children:[(0,Xe.jsx)("h4",{children:e.name}),(0,Xe.jsx)("p",{children:e.description})]}),(0,Xe.jsx)("div",{className:"player-preferences",children:(n=a,h.filter((e=>e.optionIndex===n))).map(((e,t)=>(0,Xe.jsx)("div",{className:"player-preference",style:{borderColor:m(e.attitude)},title:`${g(e.playerId)} - ${e.attitude}`,children:g(e.playerId)},t)))})]},a);var n})),null!==l&&(0,Xe.jsxs)("div",{className:"accept-rewards",children:[(0,Xe.jsx)("h4",{children:"Rewards:"}),(0,Xe.jsx)("ul",{children:t.rewards.map(((e,t)=>(0,Xe.jsxs)("li",{children:[e.name||e.type,": ",e.amount,e.description&&(0,Xe.jsxs)("span",{children:[" - ",e.description]})]},t)))}),(0,Xe.jsx)("button",{className:"accept-button",onClick:i,children:"Accept Rewards"})]})]}):(0,Xe.jsxs)("div",{className:"no-choices",children:[(0,Xe.jsx)("p",{children:"No player choices available for this quest."}),(0,Xe.jsx)("button",{className:"accept-button",onClick:i,children:"Complete"})]})]})]})]})});var p},$s=e=>{let{quest:t,currentNode:a,collectedTags:s,onClose:r,onAccept:i}=e;const o=Rt(),l=o.getQuestManager(),[c,d]=(0,n.useState)(!1),[u,h]=(0,n.useState)(!1),[m,g]=(0,n.useState)(null),p=(0,n.useCallback)(((e,t)=>{if(e.tag.name===t.name)return e;for(const a of e.children){const e=p(a,t);if(e)return e}return null}),[]),f=(0,n.useMemo)((()=>{if(m&&s.length>0){const e=p(t.startingNode,m);return(null===e||void 0===e?void 0:e.conversation)||[]}return a.conversation||[]}),[a,m,t.startingNode,s,p]),v=(0,n.useMemo)((()=>l.isQuestComplete(t.id)),[l,t.id]),y=(0,n.useMemo)((()=>[t.startingNode.tag,...s].filter(((e,t,a)=>a.findIndex((t=>t.name===e.name))===t))),[t.startingNode.tag,s]);(0,n.useMemo)((()=>{const e=l.getActiveQuests().find((e=>e.quest.id===t.id));return!e||v?[]:e.currentNode.children.map((e=>e.tag))}),[l,t.id,v]);(0,n.useEffect)((()=>{if(y.length>0&&!m){const e=s.length>0?s[s.length-1]:t.startingNode.tag;g(e)}}),[y,m,s,t.startingNode.tag]);const b=()=>{c||h(!0)};return(0,Xe.jsx)("div",{className:"modal-overlay blue-theme",onClick:b,children:(0,Xe.jsxs)("div",{className:"modal-container questprogress",onClick:e=>{e.stopPropagation(),b()},children:[(0,Xe.jsxs)("div",{className:"questprogress-header",children:[(0,Xe.jsx)("div",{className:"header-background",children:t.icon&&(0,Xe.jsx)(Je,{imageId:t.icon})}),(0,Xe.jsx)("div",{className:"header-overlay"}),(0,Xe.jsxs)("div",{className:"header-content",children:[(0,Xe.jsx)("div",{className:"header-left",children:(0,Xe.jsxs)("div",{className:"quest-info",children:[(0,Xe.jsx)("div",{className:"quest-title",children:t.name}),(0,Xe.jsx)("div",{className:"quest-description",children:t.description})]})}),(0,Xe.jsx)("div",{className:"header-right",children:(0,Xe.jsx)("button",{className:"close-button",onClick:r,children:"\xd7"})})]})]}),(0,Xe.jsx)("div",{className:"quest-progress-section",children:(0,Xe.jsxs)("div",{className:"progress-row",children:[(0,Xe.jsx)("div",{className:"progress-label",children:(0,Xe.jsx)("h4",{children:"Quest Progress"})}),(0,Xe.jsx)("div",{className:"progress-tags",children:y.map(((e,a)=>{const n=e.name===t.startingNode.tag.name,r=s.some((t=>t.name===e.name));return(0,Xe.jsx)("div",{className:`progress-tag-item ${(null===m||void 0===m?void 0:m.name)===e.name?"selected":""} ${n?"starting-tag":""} ${r?"completed-tag":""}`,onClick:()=>(e=>{g(e),d(!1),h(!1)})(e),children:(0,Xe.jsx)(aa,{tag:{tag:e,theme:"none",source:"QUEST"},showTooltip:!1})},a)}))})]})}),(0,Xe.jsxs)("div",{className:"questprogress-body",children:[(0,Xe.jsx)("div",{className:"conversation-section",children:(0,Xe.jsx)("div",{className:"conversation-content",children:f.length>0?(0,Xe.jsx)(Fs,{title:"Quest Dialogue",messages:f,onComplete:()=>d(!0),speedUp:u}):(0,Xe.jsx)("div",{className:"no-conversation",children:"No dialogue available for this quest step."})})}),(0,Xe.jsxs)("div",{className:"quest-details-section",children:[(0,Xe.jsx)("div",{className:"section-header",children:(0,Xe.jsx)("h3",{children:v?"Quest Completed!":"Quest Details"})}),(0,Xe.jsx)("div",{className:"quest-details-content",children:v?(0,Xe.jsx)("div",{className:"quest-complete-rewards",children:(0,Xe.jsx)("div",{className:"quest-info-block highlighted",children:(0,Xe.jsxs)("div",{className:"quest-info-block",children:[(0,Xe.jsx)("h4",{children:"Quest Rewards"}),t.rewards.map(((e,t)=>(0,Xe.jsx)("div",{className:"reward-item",children:(0,Xe.jsx)(Xs,{reward:e})},t)))]})})}):(0,Xe.jsxs)(Xe.Fragment,{children:[(0,Xe.jsxs)("div",{className:"quest-info-block",children:[(0,Xe.jsx)("h4",{children:"Quest Cost"}),t.cost.map(((e,t)=>(0,Xe.jsx)("div",{className:"cost-item",children:(0,Xe.jsxs)("div",{className:"cost-label",children:[e.type.charAt(0).toUpperCase()+e.type.slice(1)," ","+",e.amount]})},t)))]}),(0,Xe.jsxs)("div",{className:"quest-info-block",children:[(0,Xe.jsx)("h4",{children:"Quest Rewards"}),t.rewards.map(((e,t)=>(0,Xe.jsx)("div",{className:"reward-item",children:(0,Xe.jsx)(Xs,{reward:e})},t)))]})]})})]})]}),(0,Xe.jsx)("div",{className:"questprogress-footer",children:(0,Xe.jsx)("button",{className:"questprogress-accept-button "+(c?"":"disabled"),onClick:()=>{if(c){if(v){l.completeQuest(t.id);const e=t.rewards,a=e.find((e=>"treasure"===e.type)),n=e.find((e=>"score"===e.type));a&&o.getPartyManager().addTreasurePoints(a.amount),n&&o.getCampaignManager().addEncounterPoints(n.amount)}else l.activateQuest(t.id);i(),r()}},disabled:!c,children:v?"CLAIM REWARDS":"CONTINUE"})})]})})},er=e=>{let{activeQuests:t,onQuestSelect:a,onClose:n,getCollectedTagsForQuest:s}=e;return(0,Xe.jsx)("div",{className:"active-quests-modal-overlay",children:(0,Xe.jsx)("div",{className:"quest-modal-container",children:(0,Xe.jsxs)(ta,{title:"Active Quests",theme:"quests",children:[(0,Xe.jsxs)("div",{className:"modal-header",children:[(0,Xe.jsx)("div",{className:"quest-subheader",children:"View your currently active side-stories and their progress."}),(0,Xe.jsx)("button",{className:"close-button",onClick:n,children:"\xd7"})]}),0===t.length?(0,Xe.jsxs)("div",{className:"no-active-quests",children:[(0,Xe.jsx)("p",{children:"No active quests at the moment."}),(0,Xe.jsx)("p",{children:"Complete tag collections or advance the story to discover new quests!"})]}):(0,Xe.jsx)("div",{className:"quest-tiles",children:t.map((e=>{const t=e.quest,n=s(t.id),r=(e=>{const t=new Set,a=e=>{t.add(e.tag.name);for(const t of e.children)a(t)};return a(e.startingNode),t.size})(t),i=Math.round(n.length/r*100);return(0,Xe.jsx)(ta,{title:t.name,theme:"quest",onClick:()=>a(t.id),children:(0,Xe.jsxs)("div",{className:"quest-tile-content active-quest","data-quest-icon":t.icon||"default",children:[(0,Xe.jsx)("div",{className:"quest-icon-background",children:t.icon&&(0,Xe.jsx)(Je,{imageId:t.icon})}),(0,Xe.jsx)("div",{className:"quest-content-overlay",children:(0,Xe.jsxs)("div",{className:"quest-info",children:[(0,Xe.jsxs)("div",{className:"quest-progress-bar",children:[(0,Xe.jsxs)("div",{className:"progress-label",children:["Progress: ",i,"%"]}),(0,Xe.jsx)("div",{className:"progress-track",children:(0,Xe.jsx)("div",{className:"progress-fill",style:{width:`${i}%`}})}),(0,Xe.jsxs)("div",{className:"progress-details",children:[n.length," / ",r," tags collected"]})]}),(0,Xe.jsx)("div",{className:"quest-description",children:t.description}),(0,Xe.jsxs)("div",{className:"quest-rewards",children:[(0,Xe.jsx)("div",{className:"rewards-title",children:"Potential Rewards:"}),(0,Xe.jsx)("div",{className:"quest-reward-row",children:t.rewards.map(((e,t)=>(0,Xe.jsx)("span",{className:"quest-reward",children:(0,Xe.jsx)("div",{className:"quest-reward-treasure",children:(0,Xe.jsx)(Xs,{reward:e})})},t)))})]})]})})]})},t.id)}))})]})})})},tr=()=>{const e=Rt(),t=Ot(),[a,s]=n.useState(e.state),[r,i]=n.useState(void 0),[o,l]=n.useState(0),[c,d]=n.useState(!1),[u,h]=n.useState(!1),[m,g]=n.useState(null),[p,f]=n.useState(null);return(0,n.useEffect)((()=>{const a=()=>{s(e.state)},n=e=>{l(0),i(e)},r=e=>{l(e)},o=e=>{d(e)},c=e=>{h(e)},u=e=>{g(e)},m=e=>{f(e)};return e.on("stateChange",a),t.on("setNotebookState",n),t.on("setTutorialPage",r),t.on("showSelectQuestModal",o),t.on("showActiveQuestsModal",c),t.on("showQuestTerminalModal",u),t.on("showQuestProgressModal",m),()=>{t.off("setNotebookState",n),e.off("stateChange",a),t.off("setTutorialPage",r),t.off("showSelectQuestModal",o),t.off("showActiveQuestsModal",c),t.off("showQuestTerminalModal",u),t.off("showQuestProgressModal",m)}}),[e,t]),(0,Xe.jsxs)("div",{className:"global-ui-container",children:[(0,Xe.jsx)("div",{className:"state-display",children:function(e){switch(e){case Lt.PLAYER_RECRUITMENT:case Lt.CHARACTER_CREATION:case Lt.MAIN_MENU:case Lt.CAMPAIGN_SETUP:case Lt.SESSION_OVERVIEW:case Lt.SESSION:case Lt.SCORE:}return(0,Xe.jsx)("div",{})}(a)}),r?(0,Xe.jsx)(ma,{notebookPages:r,pageIndex:o}):null,(0,Xe.jsx)(qs,{}),c&&(0,Xe.jsx)(Zs,{quests:[...e.getQuestManager().getAvailableQuests(),...e.getQuestManager().getActiveQuests().map((e=>e.quest))],activeQuestIds:e.getQuestManager().getActiveQuests().map((e=>e.quest.id)),onQuestSelect:e=>{t.questSelected(e)},onClose:()=>t.hideSelectQuestModal()}),u&&(0,Xe.jsx)(er,{activeQuests:e.getQuestManager().getActiveQuests(),onQuestSelect:e=>{t.hideActiveQuestsModal(),t.showQuestProgressModal(e)},onClose:()=>t.hideActiveQuestsModal(),getCollectedTagsForQuest:t=>e.getQuestManager().getCollectedTagsForQuest(t)}),m&&(0,Xe.jsx)(Js,{quest:m.quest,node:m.node,players:e.getPlayerManager().getPlayers(),onComplete:()=>{e.getQuestManager().advanceQuest(m.quest.id,m.node.id),t.hideQuestTerminalModal()},onClose:()=>t.hideQuestTerminalModal()}),p&&(0,Xe.jsx)($s,{quest:(()=>{const t=e.getQuestManager().getAvailableQuests().find((e=>e.id===p));if(t)return t;const a=e.getQuestManager().getActiveQuests().find((e=>e.quest.id===p));return null===a||void 0===a?void 0:a.quest})(),currentNode:(()=>{const t=e.getQuestManager().getActiveQuests().find((e=>e.quest.id===p));if(t)return t.currentNode;const a=e.getQuestManager().getAvailableQuests().find((e=>e.id===p));return null===a||void 0===a?void 0:a.startingNode})(),collectedTags:e.getQuestManager().getCollectedTagsForQuest(p),onClose:()=>t.hideQuestProgressModal(),onAccept:()=>{e.getQuestManager().launchQuest(p),t.hideQuestProgressModal()}})]})},ar=e=>{let{}=e;return(0,Xe.jsxs)("div",{children:[(0,Xe.jsx)("div",{className:"App",children:(0,Xe.jsx)(Us,{})}),(0,Xe.jsx)(tr,{})]})},nr=[{id:"exposition",name:"Boring Exposition",description:"Dryly describe the surroundings.",time:2,tags:2,score:0,boredom:20,repeatable:!0,exhaustion:10,travelOptionType:r.HU.EXPLORE_CURRENT_LOCATION,tagInstructions:"Describe the current area as you travel."},{id:"forage",name:"Forage for Supplies",description:"Players procure supplies for the journey, or forage along the way.",time:5,tags:1,score:0,boredom:3,repeatable:!0,exhaustion:2,travelOptionType:r.HU.EXPLORE_CURRENT_LOCATION,tagInstructions:"describe something about the current location"},{id:"stories",name:"Share Stories",description:"Characters discuss their pasts during the trip.",time:5,tags:1,score:0,boredom:5,exhaustion:5,travelOptionType:r.HU.CHARACTER_BACKSTORY,tagInstructions:"Add a detail to a Character's backstory"},{id:"scout_ahead",name:"Scout Ahead",description:"The players send a character to scout the path ahead",time:5,tags:1,score:0,boredom:10,exhaustion:3,travelOptionType:r.HU.EXPLORE_UPCOMING_LOCATION,tagInstructions:"Bring up something about what may lie ahead"}],sr=[{id:"camp",name:"Camp",description:"Spend an uneventful night",time:20,tags:0,score:0,repeatable:!0,boredom:5,travelOptionType:r.HU.CAMP,exhaustion:5},{id:"ambush",name:"Remember Me?",description:"An enemy from the past ambushes the party",time:10,tags:0,score:0,boredom:0,travelOptionType:r.HU.AMBUSH,tagInstructions:"",exhaustion:15},{id:"ambush2",name:"Camp Ambush",description:"Attacked in the night",time:10,tags:1,score:0,boredom:0,travelOptionType:r.HU.AMBUSH2,tagInstructions:"Introduce a new enemy",exhaustion:15},{id:"traders",name:"Traders",description:"Characters meet traders on the road",time:5,tags:1,score:0,boredom:5,travelOptionType:r.HU.TRADERS,tagInstructions:"The Characters trade all their junk loot for some coins",exhaustion:5},{id:"mysterious_cache",name:"Elven Cache",description:"Discover a hidden cache along the route.",time:10,tags:1,score:0,boredom:5,tag:Na.D.ELVES,travelOptionType:r.HU.MAGIC_CACHE,tagInstructions:"Reward a magic item from the cache.",exhaustion:10}],rr=[{id:"cartography",name:"Cartography",description:"A player wants to carefully draw a map of the region...",time:15,tags:2,score:0,exhaustion:15,boredom:20,travelOptionType:r.HU.EXPLORE_CURRENT_LOCATION,tagInstructions:"The players learn things about the area while drawing a map"},{id:"horseback",name:"Horseback Riding",description:"Good thing we have these horsies!",time:20,tags:0,score:0,boredom:5,exhaustion:5,travelOptionType:r.HU.TRAVEL,tag:Na.D.HORSES},{id:"ship",name:"Ship Travel",description:"How convenient! We can take this ship!",time:20,tags:0,score:0,boredom:5,exhaustion:5,travelOptionType:r.HU.TRAVEL,tag:Na.D.SHIPS}];class ir extends(cn()){constructor(e){super(),this.currentCampaign=void 0,this.appManager=void 0,this.currentEncounter=void 0,this.encounterState=void 0,this.playerManager=void 0,this.tagManager=void 0,this.collectedTreasure=0,this.establishedTags=[],this.rumorTags=[],this.collectedLocationTags=[],this.expectedTagsForBranches={},this.resolvedTagsForBranches={},this.encounterSetScene={},this.dmTricks=[],this.dmPoints=0,this.campaignProgress=0,this.toneCounts={},this.completedEventIndexes=[],this.dmLevel=1,this.dmExperience=0,this.encounterPrepBonus=0,this.campaignScore=0,this.encounterPoints=0,this.travelOptions=[nr,sr,rr],this.tensionDescriptions=[...fs],this.dmAbilityPoints=0,this.maxSnacks=0,this.remainingSnacks=0,this.maxBreaks=0,this.remainingBreaks=0,this.dmAbilities={abilityMeters:{tones:{id:"tones",currentLevel:0,maxLevel:5,pointsSpent:0},hosting:{id:"hosting",currentLevel:0,maxLevel:4,pointsSpent:0},storytelling:{id:"storytelling",currentLevel:0,maxLevel:3,pointsSpent:0}},gameMasteries:{roleplaying:{id:"roleplaying",currentLevel:0,maxLevel:3,pointsSpent:0},combat:{id:"combat",currentLevel:0,maxLevel:3,pointsSpent:0},travel:{id:"travel",currentLevel:0,maxLevel:3,pointsSpent:0}}},this.maxProps=0,this.currentProps=0,this.maxVenue=0,this.currentVenue=0,this.rewardsAccepted=(e,t,a)=>{-2===t?this.partyManager().addPartyEnjoyment(-2):-1===t?this.partyManager().addPartyEnjoyment(-1):1===t?this.partyManager().multiplyPartyTension(.5):2===t&&this.partyManager().multiplyPartyTension(0);const n=this.appManager.getPartyManager();e.forEach((e=>{switch(e.type){case r.FX.TREASURE:n.addPartyEnjoyment(e.value);break;case r.FX.TOOLS:n.replenishPartyTools();break;case r.FX.XP:n.levelUpLowestCharacter();break;case r.FX.ITEM:const t=this.playerManager.getRandomPlayer(),a=this.playerManager.getRandomCharacterForPlayer(t,!0);e.tag&&this.appManager.getCharacterManager().assignGear(a,e.tag.name),this.rumorTags=this.rumorTags.filter((t=>{var a;return t.name!==(null===(a=e.tag)||void 0===a?void 0:a.name)}));break;case r.FX.PLOT_HOOK:this.collectPlotHook();break;case r.FX.HEALING:1===e.value?n.healRandomCharacter():n.raiseRandomFromDead();break;case r.FX.BACKSTORY:break;case r.FX.MAGIC:n.replenishPartyMagic()}})),a&&this.backToOverview(),this.emit("dmScreenUpdated")},this.appManager=e,this.playerManager=e.getPlayerManager(),this.tagManager=e.getTagManager(),this.currentCampaign=Ya[0],this.init()}partyManager(){return this.appManager.getPartyManager()}init(){this.dmTricks=[],this.resetConsumables()}resetConsumables(){const e=this.getDMAbilityMeterLevel("hosting");this.maxSnacks=e>=1?1:0,this.maxBreaks=e>=2?1:0,this.maxProps=e>=3?1:0,this.maxVenue=e>=4?1:0,this.remainingSnacks=this.maxSnacks,this.remainingBreaks=this.maxBreaks,this.currentProps=this.maxProps,this.currentVenue=this.maxVenue}redeemTheme(e){switch(delete this.toneCounts[e],e){case r.Co.COMEDIC:this.partyManager().addPartyEnjoyment(1);break;case r.Co.HEROIC:this.partyManager().setPartyTension(50);break;case r.Co.DRAMATIC:this.partyManager().updateAllAttention(10);break;case r.Co.GRIM:this.adjustTensionMeterForGrimTone();break;case r.Co.ROMANTIC:this.adjustTensionMeterForRomanticTone();break;case r.Co.NONE:this.partyManager().addPartyEnjoyment(1)}this.emit("dmScreenUpdated",this.toneCounts)}continueTheme(e){}updateFlavorTagThemesTally(e){e.forEach((e=>{e.theme!==r.Co.NONE&&this.addTheme(e.theme)}))}themedUiClicked(e){this.addTheme(e),this.emit("dmScreenUpdated",this.toneCounts)}addTheme(e){e!==r.Co.NONE&&(void 0===this.toneCounts[e]?this.toneCounts[e]=1:(this.toneCounts[e]||0)>=3?this.continueTheme(e):this.toneCounts[e]=Math.min(3,Math.max(0,(this.toneCounts[e]||0)+1)),this.emit("dmScreenUpdated",this.toneCounts))}spendDMPoints(e){this.dmPoints+=e,this.emit("dmScreenUpdated",this.dmPoints)}addDMPoints(e){this.dmPoints+=e,this.emit("dmScreenUpdated",this.dmPoints),console.log(`Awarded ${e} DM point(s). Total: ${this.dmPoints}`)}getDMPoints(){return this.dmPoints}getDMAbilityPoints(){return this.dmAbilityPoints}addDMAbilityPoints(e){this.dmAbilityPoints+=e,this.emit("dmAbilitiesUpdated",this.dmAbilityPoints),console.log(`Awarded ${e} DM ability point(s). Total: ${this.dmAbilityPoints}`)}spendDMAbilityPoints(e){return this.dmAbilityPoints>=e&&(this.dmAbilityPoints-=e,this.emit("dmAbilitiesUpdated",this.dmAbilityPoints),!0)}getMaxSnacks(){return this.maxSnacks}getRemainingSnacks(){return this.remainingSnacks}setMaxSnacks(e){this.maxSnacks=e,this.remainingSnacks=Math.min(this.remainingSnacks,this.maxSnacks),this.emit("dmAbilitiesUpdated",this.dmAbilityPoints)}getMaxBreaks(){return this.maxBreaks}getRemainingBreaks(){return this.remainingBreaks}setMaxBreaks(e){this.maxBreaks=e,this.remainingBreaks=Math.min(this.remainingBreaks,this.maxBreaks),this.emit("dmAbilitiesUpdated",this.dmAbilityPoints)}useSnacks(){this.remainingSnacks>0&&(this.remainingSnacks-=1,this.showSnacksModal(),this.emit("dmAbilitiesUpdated",this.dmAbilityPoints))}useBreak(){this.remainingBreaks>0&&(this.remainingBreaks-=1,this.showBreakModal(),this.emit("dmAbilitiesUpdated",this.dmAbilityPoints))}showSnacksModal(){const e={results:this.generateSnacksEffects(),title:"Snacks Offered",description:"Everyone enjoys a tasty treat and feels more positive about the adventure!",tags:[],travelOption:{id:"snacks_action",name:"Offer Snacks",description:"Everyone enjoys a tasty treat and feels more positive about the adventure!",time:0,tags:0,score:0,boredom:0,exhaustion:5,tagInstructions:"",repeatable:!1},info:{score:0,time:0,boredom:0,exhaustion:5}};this.appManager.getUiManager().showModal({title:"Snacks Effects",options:[{id:"ok",title:"OK",callback:()=>{}}],type:"travelresult",travelConfig:e})}showBreakModal(){const e={results:this.generateBreakEffects(),title:"Break Taken",description:"Everyone takes a moment to relax and decompress, but loses some focus in the process.",tags:[],travelOption:{id:"break_action",name:"Take Break",description:"Everyone takes a moment to relax and decompress, but loses some focus in the process.",time:0,tags:0,score:0,boredom:0,exhaustion:0,tagInstructions:"",repeatable:!1},info:{score:0,time:0,boredom:0,exhaustion:0}};this.appManager.getUiManager().showModal({title:"Break Effects",options:[{id:"ok",title:"OK",callback:()=>{}}],type:"travelresult",travelConfig:e})}generateSnacksEffects(){const e=[];return this.playerManager.getPlayers().forEach((t=>{this.partyManager().addEnjoyment(t,1),e.push({object:t,effects:[{effect:"+1 Attitude",class:"player-attitude"}]})})),this.partyManager().exhaustParty(5),e.push({object:"party",effects:[{effect:"+5 Exhaustion",class:"exhaustion"}]}),e}generateBreakEffects(){const e=[];return this.playerManager.getPlayers().forEach((t=>{this.partyManager().updateAttention(t,-1),t.playerStats.stress=Math.max(0,t.playerStats.stress-10),e.push({object:t,effects:[{effect:"-1 Attention",class:"player-attention"},{effect:"-10 Stress",class:"player-stress"}]})})),this.partyManager().addPartyTension(-10),e.push({object:"party",effects:[{effect:"-10 Tension",class:"tension"}]}),e}getMaxProps(){return this.maxProps}getCurrentProps(){return this.currentProps}setMaxProps(e){this.maxProps=e,this.currentProps=Math.min(this.currentProps,this.maxProps),this.emit("dmAbilitiesUpdated",this.dmAbilityPoints)}getMaxVenue(){return this.maxVenue}getCurrentVenue(){return this.currentVenue}setMaxVenue(e){this.maxVenue=e,this.currentVenue=Math.min(this.currentVenue,this.maxVenue),this.emit("dmAbilitiesUpdated",this.dmAbilityPoints)}getDMPropLevel(){return this.getCurrentProps()}setDMPropLevel(e){this.setMaxProps(e),this.currentProps=e}getDMComfortLevel(){return this.getCurrentVenue()}setDMComfortLevel(e){this.setMaxVenue(e),this.currentVenue=e}getDMAbilityMeterLevel(e){var t;return(null===(t=this.dmAbilities.abilityMeters[e])||void 0===t?void 0:t.currentLevel)||0}setDMAbilityMeterLevel(e,t){if(this.dmAbilities.abilityMeters[e]){const a=this.dmAbilities.abilityMeters[e].currentLevel;this.dmAbilities.abilityMeters[e].currentLevel=t;const n=t-a;this.dmAbilities.abilityMeters[e].pointsSpent+=n,this.emit("dmAbilitiesUpdated",this.dmAbilityPoints)}}upgradeDMAbilityMeter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const a=this.dmAbilities.abilityMeters[e];if(!a||a.currentLevel>=a.maxLevel)return!1;if(this.spendDMAbilityPoints(t)){const n=a.currentLevel;return a.currentLevel+=1,a.pointsSpent+=t,"hosting"===e&&(0===n&&1===a.currentLevel&&(this.maxSnacks=1,this.remainingSnacks=1),1===n&&2===a.currentLevel&&(this.maxBreaks=1,this.remainingBreaks=1),2===n&&3===a.currentLevel&&(this.maxProps=1,this.currentProps=1),3===n&&4===a.currentLevel&&(this.maxVenue=1,this.currentVenue=1)),this.emit("dmAbilitiesUpdated",this.dmAbilityPoints),!0}return!1}getDMGameMasteryLevel(e){var t;return(null===(t=this.dmAbilities.gameMasteries[e])||void 0===t?void 0:t.currentLevel)||0}setDMGameMasteryLevel(e,t){if(this.dmAbilities.gameMasteries[e]){const a=this.dmAbilities.gameMasteries[e].currentLevel;this.dmAbilities.gameMasteries[e].currentLevel=t;const n=t-a;this.dmAbilities.gameMasteries[e].pointsSpent+=n,this.emit("dmAbilitiesUpdated",this.dmAbilityPoints)}}upgradeDMGameMastery(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const a=this.dmAbilities.gameMasteries[e];return!(!a||a.currentLevel>=a.maxLevel)&&(!!this.spendDMAbilityPoints(t)&&(a.currentLevel+=1,a.pointsSpent+=t,this.emit("dmAbilitiesUpdated",this.dmAbilityPoints),!0))}getDMConsumableValue(e){switch(e){case"snacks":return this.maxSnacks;case"breaks":return this.maxBreaks;case"props":return this.maxProps;case"comfort":return this.maxVenue;default:return 0}}setDMConsumableValue(e,t){switch(e){case"snacks":this.maxSnacks=t,this.remainingSnacks=Math.min(this.remainingSnacks,this.maxSnacks);break;case"breaks":this.maxBreaks=t,this.remainingBreaks=Math.min(this.remainingBreaks,this.maxBreaks);break;case"props":this.maxProps=t,this.currentProps=Math.min(this.currentProps,this.maxProps);break;case"comfort":this.maxVenue=t,this.currentVenue=Math.min(this.currentVenue,this.maxVenue)}this.emit("dmAbilitiesUpdated",this.dmAbilityPoints)}purchaseDMConsumable(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return!!this.spendDMAbilityPoints(t)&&("snacks"===e?(this.maxSnacks+=1,this.remainingSnacks+=1):"breaks"===e?(this.maxBreaks+=1,this.remainingBreaks+=1):"props"===e?(this.maxProps+=1,this.currentProps+=1):"comfort"===e&&(this.maxVenue+=1,this.currentVenue+=1),this.emit("dmAbilitiesUpdated",this.dmAbilityPoints),!0)}getDMAbilitiesPurchaseHistory(){return this.dmAbilities}getTotalDMAbilityPointsSpent(){let e=0;return Object.values(this.dmAbilities.abilityMeters).forEach((t=>{e+=t.pointsSpent})),Object.values(this.dmAbilities.gameMasteries).forEach((t=>{e+=t.pointsSpent})),e}isDMUpgradeUnlocked(e,t,a){const n=this.dmAbilities.abilityMeters[t];return!!n&&n.currentLevel>=a}resetDMAbilities(){Object.values(this.dmAbilities.abilityMeters).forEach((e=>{e.currentLevel=0,e.pointsSpent=0})),Object.values(this.dmAbilities.gameMasteries).forEach((e=>{e.currentLevel=0,e.pointsSpent=0})),this.maxSnacks=0,this.remainingSnacks=0,this.maxBreaks=0,this.remainingBreaks=0,this.maxProps=0,this.currentProps=0,this.maxVenue=0,this.currentVenue=0,this.emit("dmAbilitiesUpdated",this.dmAbilityPoints)}hasToneUnlocked(e){return this.getDMAbilityMeterLevel("tones")>e}getUnlockedTones(){const e=this.getDMAbilityMeterLevel("tones");return[r.Co.COMEDIC,r.Co.DRAMATIC,r.Co.HEROIC,r.Co.ROMANTIC,r.Co.GRIM].slice(0,e)}hasHostingAbility(e){return this.getDMAbilityMeterLevel("hosting")>e}hasStorytellingAbility(e){return this.getDMAbilityMeterLevel("storytelling")>e}canUseSnacks(){return this.hasHostingAbility(0)&&this.remainingSnacks>0}canUseBreaks(){return this.hasHostingAbility(1)&&this.remainingBreaks>0}getPropsBonus(){return this.hasHostingAbility(2)&&this.currentProps>0?ms[this.currentProps-1]:0}getMaxPartyExhaustion(){return this.hasHostingAbility(3)?100+(this.currentVenue>0?ps[this.currentVenue-1]:0):100}getRoleplayingBonus(){return this.getDMGameMasteryLevel("roleplaying")}getCombatBonus(){return this.getDMGameMasteryLevel("combat")}getTravelBonus(){return this.getDMGameMasteryLevel("travel")}setTensionDescription(e){const t=this.tensionDescriptions.findIndex((t=>t.max===e.max));-1!==t?this.tensionDescriptions[t]={...e}:(this.tensionDescriptions.push({...e}),this.tensionDescriptions.sort(((e,t)=>e.max-t.max))),this.emit("tensionDescriptionsUpdated",this.tensionDescriptions)}getTensionDescriptions(){return this.tensionDescriptions.some(((e,t)=>{var a,n,s,r;return t>=fs.length||e.description!==(null===(a=fs[t])||void 0===a?void 0:a.description)||e.max!==(null===(n=fs[t])||void 0===n?void 0:n.max)||e.scoreMultiplier!==(null===(s=fs[t])||void 0===s?void 0:s.scoreMultiplier)||e.stressIncrease!==(null===(r=fs[t])||void 0===r?void 0:r.stressIncrease)}))?[...this.tensionDescriptions]:[...fs]}getTensionColors(){return this.getTensionDescriptions().map((e=>e.color))}getTensionColor(e){var t;const a=this.getTensionDescriptions();for(const n of a)if(e<=n.max)return n.color;return(null===(t=a[a.length-1])||void 0===t?void 0:t.color)||"#ADFF2F"}getTensionRanges(){const e=this.getTensionDescriptions(),t=[];for(let a=0;a<e.length;a++){const n=e[a];if(n.max===1/0)break;t.push(n.max)}return t}resetTensionDescriptions(){this.tensionDescriptions=[...fs],this.emit("tensionDescriptionsUpdated",this.tensionDescriptions)}applyDramaticNarrationEffect(){this.hasStorytellingAbility(2)&&(this.setTensionDescription({max:55,description:"Perfect!",scoreMultiplier:2,stressIncrease:0,color:"#009900da"}),this.setTensionDescription({max:75,description:"Perfect!",scoreMultiplier:2,stressIncrease:0,color:"#009900da"}),this.setTensionDescription({max:70,description:"Good",scoreMultiplier:1,stressIncrease:0,color:"#32CD32da"}))}adjustTensionMeterForRomanticTone(){this.setTensionDescription({max:30,description:"Romantic",scoreMultiplier:1.5,stressIncrease:0,color:"#d64cb4da"}),this.setTensionDescription({max:15,description:"Romantic",scoreMultiplier:1.5,stressIncrease:0,color:"#d64cb4da"})}adjustTensionMeterForGrimTone(){this.setTensionDescription({max:80,description:"Dangerous",scoreMultiplier:2,stressIncrease:0,color:"#4f3a67da"}),this.setTensionDescription({max:90,description:"Grimdark",scoreMultiplier:3,stressIncrease:0,color:"#3a2755da"})}testTensionDescriptionModifications(){console.log("Original tension descriptions:",this.getTensionDescriptions()),this.setTensionDescription({max:60,description:"Wowzer",scoreMultiplier:5,stressIncrease:0,color:"#FFD700da"}),this.setTensionDescription({max:85,description:"Intense",scoreMultiplier:1.5,stressIncrease:7,color:"#FF6600da"}),console.log("Modified tension descriptions:",this.getTensionDescriptions()),console.log("Generated colors:",this.getTensionColors())}exhaustForRoleplayAction(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.partyManager().exhaustParty(e)}getPerceptionTags(e){var t;const a=this.playerManager.getPlayerAssignedCharacter(e),n=(null===(t=this.currentEncounter)||void 0===t?void 0:t.branches)||[];if(!a||!this.currentEncounter)return[];const s=Math.floor(5*Math.random());switch(s){case r.lM.BRANCH_LOCATION:const t=n[Math.floor(Math.random()*n.length)],i=t.name;let o=this.tagManager.encounterTagsExpected[t.name];o=o.filter((e=>!this.tagManager.encounterTagsCollected[t.name].includes(e)));const l=Math.floor(2*Math.random())+1;if(0===o.length){return{tags:[{tag:{name:this.appManager.getCharacterManager().getRandomGear().name,type:r.Mf.GEAR},source:r.UW.LOCATION,theme:r.Co.NONE}],type:s,name:t.name}}return{tags:o.sort((()=>Math.random()-.5)).slice(0,l).map((e=>({tag:e,source:r.UW.LOCATION,theme:this.tagManager.getTheme()}))),type:s,name:i};case r.lM.CURRENT_LOCATION:const c=this.currentEncounter.location.name,d=this.getEncounterLocationTags(),u=Math.floor(2*Math.random())+1;return{tags:d.sort((()=>Math.random()-.5)).slice(0,u).map((e=>({tag:e,source:r.UW.LOCATION,theme:this.tagManager.getTheme()}))),type:s,name:c};case r.lM.PLOT_HOOK:return{tags:[{tag:{name:`Plot Hook: ${this.campaignProgress+1}`,type:r.Mf.PLOT},source:r.UW.PLOT,theme:r.Co.NONE}],type:r.lM.PLOT_HOOK,name:"Campaign Story"};case r.lM.CHARACTER_BACKSTORY:case r.lM.CHARACTER_BACKSTORY_PROGRESS:const h=this.appManager.getCharacterManager().getAllExpectedBackstoryTags();if(h.length>0&&Math.random()<.5){return{tags:[{tag:h[Math.floor(Math.random()*h.length)],source:r.UW.PLAYERS,theme:this.tagManager.getTheme()}],type:r.lM.CHARACTER_BACKSTORY_PROGRESS,name:e.name}}return{tags:this.getNewBackstoryTags(a,e,1),type:r.lM.CHARACTER_BACKSTORY,name:e.name};case r.lM.MAGIC_ITEM:const m=this.tagManager.magicItemRumors;if(m.length>0&&Math.random()<.5){const e=m[Math.floor(Math.random()*m.length)];return{tags:[{tag:e,source:r.UW.PLAYERS,theme:this.tagManager.getTheme()}],type:r.lM.MAGIC_ITEM,name:e.name}}const g={name:this.appManager.getCharacterManager().getRandomGear().name,type:r.Mf.GEAR};return{tags:[{tag:g,source:r.UW.PLAYERS,theme:r.Co.NONE}],type:r.lM.MAGIC_ITEM,name:g.name}}return[]}getNewBackstoryTags(e,t,a){const n=Object.values(Na.D).flat().sort((()=>Math.random()-.5)).slice(0,5);return[...e.preferences.map((e=>{let[t]=e;return t})),...n].sort((()=>Math.random()-.5)).slice(0,a).map((e=>({tag:e,source:r.UW.BACKSTORY,theme:this.tagManager.getTheme()})))}acceptPerceptionTags(e,t){this.updateFlavorTagThemesTally(e.tags);e.tags.map((e=>e.tag)).forEach((e=>{this.playerManager.exposeEncounterTag(e)}));const a=this.playerManager.getPlayerAssignedCharacter(t);let n=-1;switch(e.type){case r.lM.CURRENT_LOCATION:e.tags.forEach((e=>{this.tagManager.collectLocationTag(e.tag)}));break;case r.lM.BRANCH_LOCATION:e.tags.forEach((t=>{this.expectedTagsForBranches[e.name].push(t.tag)}));break;case r.lM.PLOT_HOOK:n=0,this.collectPlotHook();break;case r.lM.CHARACTER_BACKSTORY:case r.lM.CHARACTER_BACKSTORY_PROGRESS:this.appManager.getCharacterManager().assignBackstory(t,e.tags[0].tag);break;case r.lM.MAGIC_ITEM:const a=e.tags[0].tag;this.tagManager.magicItemRumors.includes(a)?(this.appManager.getCharacterManager().assignGear(t,a.name),this.tagManager.magicItemRumors=this.tagManager.magicItemRumors.filter((e=>e.name!==a.name))):this.tagManager.magicItemRumors=[...this.tagManager.magicItemRumors,a]}-1!==n?this.partyManager().updateAllAttention(n):this.partyManager().playersTakeAction(a&&[a.name]||void 0,!0),a&&this.partyManager().stressAction([a]),this.emit("dmScreenUpdated",this.establishedTags)}setCampaignProgress(e){this.campaignProgress=e,this.emit("campaignProgressUpdated",e)}getCampaignProgress(){return this.campaignProgress}handleExpositionClicked(){var e;const t=this.currentEncounter;if(!t)return;const a=t.branches||[],n=[];if(null===(e=this.currentEncounter)||void 0===e||e.location.tags.forEach((e=>{this.collectedLocationTags.includes(e)||n.push(e)})),this.getExpectedEncounterTags().forEach((e=>{n.push(e)})),a.forEach((e=>{e.tags.forEach((t=>{this.establishedTags.includes(t)||n.includes(t)||this.tagManager.encounterTagsExpected[e.name].includes(t)||n.push(t)}))})),0===n.length)return;const s=Math.floor(Math.random()*n.length),i=n[s];this.exposeTag({tag:i,source:r.UW.EXPOSITION,theme:r.Co.NONE}),this.partyManager().updateAllAttention(-1),this.emit("encounterUpdated",this.establishedTags)}getPotentialTagSource(e){return this.tagManager.getOutstandingLocationTags().includes(e)||this.tagManager.getCollectedLocationTags().includes(e)?r.UW.LOCATION:this.tagManager.getUpcomingEncounterTags().includes(e)?r.UW.FORESHADOWING:this.tagManager.magicItemRumors.includes(e)?r.UW.MAGIC_ITEM:e.type===r.Mf.GEAR?r.UW.MAGIC_ITEM_EXPECTED:this.tagManager.getOutstandingBackstoryTags().includes(e)?r.UW.BACKSTORY:r.UW.NONE}exposeTag(e,t){var a;if(e.source===r.UW.QUEST||e.source===r.UW.QUEST_TERMINAL){const t=this.appManager.getQuestManager(),a=t.getQuestForTag(e.tag.name);if(a){const{quest:n}=a,s=t.advanceQuest(n.id,e.tag.name);if(s){s.conversation&&s.conversation.length>0&&this.appManager.getChatManager().fireNewChatMessage(s.conversation,{speed:"fast"});const t=n.playerChoices&&n.playerChoices.length>0;e.source===r.UW.QUEST_TERMINAL&&t?this.emit("showQuestTerminal",{quest:n,node:s}):this.appManager.getUiManager().showQuestProgressModal(n.id)}}return}if(e.source===r.UW.TREASURE)return void this.partyManager().addTreasurePoints(1);if(e.source===r.UW.DM_POINT)return void this.addDmExp(1);let n=!0;this.updateFlavorTagThemesTally([e]),this.playerManager.exposeEncounterTag(e.tag);if(this.appManager.getCharacterManager().getCharactersWithBackstoryTag(e.tag).forEach((t=>{this.appManager.getCharacterManager().assignBackstory(t,e.tag),this.appManager.getChatManager().triggerCharacterBackstoryResponse(e,t),n=!1})),this.tagManager.magicItemRumors.includes(e.tag)){const t=this.playerManager.getRandomPlayer(),a=this.playerManager.getRandomCharacterForPlayer(t,!0);this.appManager.getCharacterManager().assignGear(a,e.tag.name)}else e.tag.type===r.Mf.GEAR&&this.tagManager.addMagicItemRumor(e.tag);(e.source===r.UW.LOCATION||e.source===r.UW.EXPOSITION||this.tagManager.getOutstandingLocationTags().includes(e.tag))&&this.tagManager.collectLocationTag(e.tag),e.source===r.UW.ENCOUNTER&&this.tagManager.getOutstandingEncounterTags().includes(e.tag)&&(this.tagManager.collectEncounterTag(e.tag),n=!1);const s=[],i=(null===(a=this.currentEncounter)||void 0===a?void 0:a.branches)||[];let o=!1;if(this.tagManager.collectUpcomingEncounterTag(e.tag)?o=!0:i.forEach(((e,t)=>{this.tagManager.couldAssignRandomTagToBranch(e)&&s.push(t)})),e.source===r.UW.FORESHADOWING_RANDOM&&!o&&s.length>0){const t=Math.floor(Math.random()*s.length),a=i[s[t]];this.tagManager.introduceNewTagForUpcomingBranch(a,e.tag),this.tagManager.collectUpcomingEncounterTag(e.tag),this.appManager.getChatManager().triggerAddRandomTagToEncounterConversation(e.tag,a),n=!1}this.appManager.getTagManager().collectTag(e);const l=this.getEncounterChatTrigger(e.tag);l&&e.source!==r.UW.ENCOUNTER&&(this.appManager.getChatManager().fireNewChatMessage(l),n=!1),n&&this.appManager.getChatManager().triggerEnhancedChatFromTag(e,t).catch((t=>{this.appManager.getChatManager().triggerChatFromTag(e)})),this.appManager.getChatManager().trackRecentTopic(e.tag),this.emit("dmScreenUpdated",this.establishedTags)}selectRoleplayFlavorTag(e,t){if(this.exhaustForRoleplayAction(4),t<=0&&this.partyManager().updateAllAttention(-1),this.appManager.getChatManager().triggerSpecialRPTagChat(e),"character"===e.type&&e.character){const t=this.playerManager.getPlayerAssignedCharacter(e.character);return void(t&&(this.partyManager().playersTakeAction([t.name],!0,2),this.partyManager().stressAction([t])))}const a=this.tagManager.convertRpTagToFlavorTag(e);if(a){if(a.source===r.UW.TREASURE)return void this.partyManager().addTreasurePoints(1);if(a.source===r.UW.DM_POINT)return void this.addDmExp(1);this.exposeTag(a)}}generateRoleplayEventTags(){if(!this.currentEncounter)return[];const e=this.tagManager.generateRelevantFlavorTags(12),t=Math.random()<.5,a=[];if(e.forEach((e=>{a.push({tag:e,type:"tag"})})),t){const e=this.appManager.getCharacterManager().getPlayerCharacters(),t={character:e[Math.floor(Math.random()*e.length)],type:"character"};a.push(t)}if(Math.random()<.5){const e={type:"treasure"};a.push(e)}return a}setDefaultTravelOptions(){this.travelOptions=[nr,sr,rr]}setTravelOptions(e){this.travelOptions=e,this.emit("travelOptionsUpdated",e)}getTravelOptions(){return this.travelOptions}getEventTag(e){switch(e.travelOptionType){case r.HU.AMBUSH:if(this.tagManager.getEstablishedCombatantTags().length>0){const e=Math.floor(Math.random()*this.tagManager.getEstablishedCombatantTags().length);return this.tagManager.getEstablishedCombatantTags()[e]}const e=Math.floor(Math.random()*this.tagManager.getPotentialCombatantsTags().length);return this.tagManager.getPotentialCombatantsTags()[e];case r.HU.TRADERS:if(this.tagManager.getEstablishedFriendlyTags().length>0){const e=Math.floor(Math.random()*this.tagManager.getEstablishedFriendlyTags().length);return this.tagManager.getEstablishedFriendlyTags()[e]}return this.tagManager.getRandomFriendlyTags(1)[0]}return e.tag}getResultTags(e){const t=this.playerManager.getPlayers(),a=t[Math.floor(Math.random()*t.length)],n=this.playerManager.getRandomCharacterForPlayer(a,!0);if(!n)return[];switch(e.travelOptionType){case r.HU.TRADERS:return[{tag:{name:"Treasure Cache",type:r.Mf.NONE},source:r.UW.TREASURE,theme:this.tagManager.getTheme()}];case r.HU.AMBUSH:break;case r.HU.AMBUSH2:return this.tagManager.getRandomTags(5,this.tagManager.getPotentialCombatantsTags()).map((e=>({tag:e,source:r.UW.ENEMY,theme:this.tagManager.getTheme()})));case r.HU.EXPLORE_CURRENT_LOCATION:return this.getEncounterLocationTags().map((e=>({tag:e,source:r.UW.LOCATION,theme:this.tagManager.getTheme()})));case r.HU.EXPLORE_UPCOMING_LOCATION:return this.tagManager.getUpcomingEncounterTags().map((e=>({tag:e,source:r.UW.FORESHADOWING,theme:this.tagManager.getTheme()})));case r.HU.CHARACTER_BACKSTORY:return this.getNewBackstoryTags(a,n,3);case r.HU.SIDE_QUEST:return this.tagManager.getRandomTags(3,Object.values(Na.D).flat()).map((e=>({tag:e,source:this.getPotentialTagSource(e),theme:this.tagManager.getTheme()})));case r.HU.MAGIC_CACHE:return this.tagManager.getRandomMagicItemTag(3).map((e=>({tag:e,source:this.getPotentialTagSource(e),theme:this.tagManager.getTheme()})))}}selectTravelOption(e,t){const a=[];-1===e.score&&(e.score=Math.floor(25*Math.random())),-1===e.exhaustion&&(e.exhaustion=Math.floor(15*Math.random()));const n=(e,t,n)=>{if(!e)return;const s=a.find((t=>t.object===e));s&&s.effects?s.effects.push({effect:t,class:n}):a.push({object:e,effects:[{effect:t,class:n}]})},s=this.playerManager.getPlayers(),i=t>66?1:t>33?.5:.2,o=this.playerManager.getRandomCharacter();if(!o)return;if(!this.playerManager.getPlayerAssignedCharacter(o))return;switch(e.travelOptionType){case r.HU.AMBUSH:case r.HU.AMBUSH2:if(this.partyManager().addPartyTension(15),o)if(Math.random()<.5){const e=this.partyManager().addInjury(o);n(o,e,"injury")}else if(Math.random()<.5&&this.appManager.getCharacterManager().getRemainingAttributes(o,r.Eh.MAGIC)>0){const e=this.appManager.getCharacterManager().useHalfRemainingAttributes(o,r.Eh.MAGIC);n(o,"Used "+e+" Magic","used-ability")}else if(this.appManager.getCharacterManager().getRemainingAttributes(o,r.Eh.TOOLS)>0){const e=this.appManager.getCharacterManager().useHalfRemainingAttributes(o,r.Eh.TOOLS);n(o,"Used "+e+" Tools","used-ability")}break;case r.HU.CHARACTER_BACKSTORY:n(o,"+New Backstory Details","backstory")}s.forEach((e=>{Math.random()<i&&(this.partyManager().updateAttention(e,-1),n(e,"-1 Attention","boredom")),t>66&&Math.random()<.15&&(this.partyManager().addEnjoyment(e,-1),n(e,"-1 Attitude","boredom"))}));const l=t>66?-10:t>33?-5:-1;return this.partyManager().addPartyTension(l),e.travelOptionType===r.HU.AMBUSH||e.travelOptionType===r.HU.AMBUSH2?(this.partyManager().addPartyTension(15),n("party","-"+Math.abs(l)+" Tension","tension-strikethrough"),n("party","+15 Tension","tension")):n("party","-"+Math.abs(l)+" Tension","tension"),e.exhaustion&&(this.partyManager().exhaustParty(e.exhaustion),n("party","+"+Math.abs(e.exhaustion)+" Exhaustion","exhaustion")),{travelResults:a,travelTags:this.getResultTags(e)}}collectPlotHook(){this.partyManager().updateAllAttention(2),this.setCampaignProgress(this.campaignProgress+1),this.emit("campaignProgressUpdated",this.campaignProgress)}getCampaignTooltipForTag(e){var t,a;const n=this.currentCampaign;if(n.tooltipTags&&null!==(t=n.tooltipTags[(null===(a=this.currentEncounter)||void 0===a?void 0:a.name)||""])&&void 0!==t&&t[e.tag.name]){var s,r;const t=null===(s=n.tooltipTags[(null===(r=this.currentEncounter)||void 0===r?void 0:r.name)||""])||void 0===s?void 0:s[e.tag.name];if(t)return this.appManager.getChatManager().getEncounterTagPrefix(e)+t+this.appManager.getChatManager().getThemePostFix(e)}}getOpenCampaignIndex(){return Ya.findIndex((e=>e.name===this.currentCampaign.name))}getColorForEncounterByName(e){var t;const a=null===(t=this.currentCampaign.processedEncounters)||void 0===t?void 0:t.flat().find((t=>t.name===e));return a?a.location.themes[0]:"none"}getNextPlotHookText(){var e;const t=this.campaignProgress;let a=null===(e=this.currentCampaign.plotHooks)||void 0===e?void 0:e[t||0];return a||(a="Next important plot information...."),a}getCollectedTones(){return this.toneCounts}getAvailableCampaigns(){return Ya}getCampaignIcon(){return this.currentCampaign.icon}getCampaignName(){return this.currentCampaign.name}getDmTricks(){return this.dmTricks}getCurrentEncounter(){return this.currentEncounter}getNextEncounters(){var e;return(null===(e=this.currentEncounter)||void 0===e?void 0:e.branches)||[]}getCurrentCampaign(){return this.currentCampaign}getEncounterEvents(){var e;return(null===(e=this.currentEncounter)||void 0===e?void 0:e.events)||[[],[],[]]}getEncounterLocationTags(){var e;return(null===(e=this.currentEncounter)||void 0===e?void 0:e.location.tags)||[]}getEncounterTags(){var e;return(null===(e=this.currentEncounter)||void 0===e?void 0:e.tags)||[]}getExpectedEncounterTags(){var e;return this.expectedTagsForBranches[(null===(e=this.currentEncounter)||void 0===e?void 0:e.name)||""]||[]}getTagsForUpcomingEncounters(){var e;const t=(null===(e=this.currentEncounter)||void 0===e?void 0:e.branches)||[];let a=[];return t.forEach((e=>{a=[...a,...e.tags]})),a}getCampaignScore(){return this.campaignScore}bankCampaignScore(e){this.campaignScore+=e,this.emit("dmScreenUpdated",this.campaignScore)}clearEncounterScore(){this.encounterPoints=0,this.collectedTreasure=0,this.emit("dmScreenUpdated",this.encounterPoints)}calculateEncounterTotalScore(e){return Hs(this.getEncounterScoring(e))}currentEncounterSceneSet(){return this.currentEncounter&&this.encounterSetScene[this.currentEncounter.name]||!1}setCurrentEncounterSceneComplete(){this.currentEncounter&&(this.encounterSetScene[this.currentEncounter.name]=!0)}showSetSceneModal(){this.tagManager.triggerSetSceneModal()}getEncounterExpositionText(){return"Expose details, players lose attention"}getFriendlyCombatantTags(){return[...this.establishedTags.filter((e=>e.friendly)),...this.tagManager.locationTagsCollected.filter((e=>e.friendly))]}getHostileCombatantTags(e){return[...this.establishedTags.filter((t=>t.enemy&&t.name!==e)),...this.tagManager.locationTagsCollected.filter((e=>e.enemy))]}getCampaignChatTriggers(){return void 0===this.currentCampaign?{}:this.currentCampaign.chatTriggers}getEncounterChatTriggers(){const e=this.getCampaignChatTriggers();if(void 0===this.currentEncounter||void 0===e)return{};return e[this.currentEncounter.name]}getEncounterChatTrigger(e){const t=this.getEncounterChatTriggers();if(void 0!==t)return t[e.name]}initiateQuickStart(){this.startCampaign(0)}startCampaign(e){var t;void 0===this.tagManager&&(this.tagManager=this.appManager.getTagManager()),this.encounterSetScene={},this.currentCampaign=Ya[e],this.currentEncounter=(null===(t=Ya[e])||void 0===t?void 0:t.startingEncounter)||void 0,this.currentCampaign&&this.appManager.getChatEventManager().addCampaignStartEvent(this.currentCampaign.name),this.resetConsumables(),this.tagManager.initializeNewCampaign(this.currentCampaign),this.tagManager.initializeNewEncounter(this.currentEncounter),this.partyManager().setPartyTension(20),this.completedEventIndexes=[],this.displayNewEncounter(),this.emit("dmScreenUpdated",this.toneCounts)}setSessionState(e){this.encounterState={sessionState:e,eventIndex:0}}validateTags(e){for(let t=0;t<e.length;t++){for(let a=0;a<e[t].tags.length;a++)void 0===e[t].tags[a]&&console.error(`Encounter ${e[t].name} tag ${a} is undefined`);for(let a=0;a<e[t].location.tags.length;a++)void 0===e[t].location.tags[a]&&console.error(`Encounter ${e[t].name} location ${e[t].location.name} tag ${a} is undefined`)}}getDmLevel(){return this.dmLevel}addDmExp(e){this.dmExperience+=e,this.dmExperience>=5&&(this.dmLevel++,this.dmExperience=0),this.emit("dmScreenUpdated",this.dmExperience)}getDmExp(){return this.dmExperience}isInitialEncounter(){var e,t,a;return(null===(e=this.currentEncounter)||void 0===e?void 0:e.name)===(null===(t=this.currentCampaign)||void 0===t||null===(a=t.startingEncounter)||void 0===a?void 0:a.name)}getCompletedEvents(){return this.completedEventIndexes}getEncounterAdvanceReadinessText(){var e;const t=0===this.getExpectedEncounterTags().length,a=(null===(e=this.currentEncounter)||void 0===e?void 0:e.branches)||[],n=a.some((e=>this.tagManager.encounterTagsExpected[e.name].length>=3)),s=a.every((e=>this.tagManager.encounterTagsExpected[e.name].length>=3));return t?n?s?"Players are ready to move on.":"Players are ready to move on, but feel some choices are unclear.":"Players don't have enough information to choose what to do next.":"Players will be confused. They expect more from the current encounter."}encounterEventSelected(e){if(void 0===this.encounterState)return;if(this.completedEventIndexes.includes(e))return;this.appManager.state=Lt.SESSION,this.completedEventIndexes.push(e),this.encounterState.eventIndex=e;const t=this.getCurrentEvent();t&&this.appManager.getChatEventManager().addEncounterEvent(t.type,t.name),this.appManager.getUiManager().updateEncounterState(this.encounterState)}getEncounterState(){return this.encounterState}getCurrentEvent(){var e;if(void 0!==this.encounterState)return null===(e=this.currentEncounter)||void 0===e?void 0:e.events[this.encounterState.eventIndex]}backToOverview(){void 0!==this.encounterState&&(this.appManager.state=Lt.SESSION_OVERVIEW,this.appManager.getUiManager().updateEncounterState(this.encounterState))}advanceEncounter(e){var t,a,n,s;this.currentEncounter&&this.appManager.getChatManager().getGameContextManager().logEvent({type:"encounter_end",description:`Completed encounter: ${this.currentEncounter.name}`,details:{encounter:this.currentEncounter,outcome:"success"}}),this.resetConsumables();const r=(null===(t=this.currentEncounter)||void 0===t?void 0:t.branches)||[];if(e&&r.includes(e))this.currentEncounter=e;else{const e=r.sort(((e,t)=>this.tagManager.encounterTagsExpected[t.name].length-this.tagManager.encounterTagsExpected[e.name].length))[1];this.currentEncounter=e||r[0]}this.currentEncounter&&this.appManager.getChatManager().logEncounterStart(this.currentEncounter),this.resolvedTagsForBranches={};const i=(null===(a=this.currentEncounter)||void 0===a?void 0:a.branches)||[];this.resolvedTagsForBranches[this.currentEncounter.name]=[],i.forEach((e=>{this.expectedTagsForBranches[e.name]=[],this.resolvedTagsForBranches[e.name]=[]}));const o=this.expectedTagsForBranches[(null===(n=this.currentEncounter)||void 0===n?void 0:n.name)||""]||[];this.encounterPrepBonus=4*o.length,this.expectedTagsForBranches[(null===(s=this.currentEncounter)||void 0===s?void 0:s.name)||""]=[...o,...this.getEncounterTags()],this.collectedLocationTags=[],this.completedEventIndexes=[],this.displayNewEncounter(),this.emit("encounterUpdated",this.toneCounts),this.emit("dmScreenUpdated",this.toneCounts)}displayNewEncounter(){this.currentEncounter&&this.appManager.getUiManager().showBasicNotebook(r.d8.ENCOUNTER,this.currentEncounter)}addEncounterPoints(e){this.collectEncounterPoints(e)}collectEncounterPoints(e){this.encounterPoints+=e,this.emit("dmScreenUpdated",this.encounterPoints)}getEncounterPoints(){return this.encounterPoints}getTensionMultiplier(e){const t=null!==e&&void 0!==e?e:this.partyManager().getPartyTension(),a=this.getTensionDescriptions();for(const n of a)if(t<=n.max)return n.scoreMultiplier;return 0}getEncounterPrepBonus(){return this.encounterPrepBonus}collectTreasure(e){this.collectedTreasure+=e}getCollectedTreasure(){return this.collectedTreasure}getEncounterScoring(e){const t=[];this.isInitialEncounter()?t.push({description:"New Campaign Bonus",points:4}):t.push({description:"Encounter Prep Bonus",points:this.encounterPrepBonus}),this.encounterPoints>0&&t.push({description:"Event Points",points:this.encounterPoints});const a=this.playerManager.getPlayers();let n=0;if(a.forEach((e=>{e.playerStats.enjoyment>2&&n++})),n>0&&t.push({description:"Players' Enjoyment",points:1*n}),this.collectedTreasure>0&&t.push({description:"Treasure Collected",points:this.collectedTreasure}),this.currentProps>0){const e=["Battlemaps","Cardboard Buildings","Miniatures","3D Printed Everything"];t.push({description:"Props: "+e[this.currentProps-1],points:gs[this.currentProps-1]})}const s=this.partyManager().getPartyTension(),r=this.getTensionDescriptions();let i=r[r.length-1];for(const l of r)if(s<=l.max){i=l;break}const o=i.scoreMultiplier;return t.push({description:`Tension: ${i.description}`,multiplier:!0,points:o,color:i.color}),0===this.tagManager.getOutstandingLocationTags().length&&t.push({description:"Location Bonus: Scene Set",points:2,multiplier:!0}),t}getTotalEncounterScore(){return this.getEncounterScoring({}).reduce(((e,t)=>e+t.points),0)*this.getTensionMultiplier()}}const or=ir,lr={CHARACTER_NAMES:[["Godfrey","Sable","Saul","Jimbo","Neb","Nestrin","Dirk","Crystal","Immeral","Olga","Ricky"],["Rose","Goodwyne","Halfheart","Farmer","Taylor","of the Sea","Trainer","of the Woods","Silkmonger","Smith"]],PLAYER_NAMES:[["Olivier","Dan","Matt","Maxim","Angie","Charlotte","Dawn","Bill","Tom","Sarah"],["Brass","Andrews","Wallace","Skuski","Kubrik","Binchs","Wells","Anteds","Kruk","Madup"]]};const cr=e=>e[Math.floor(Math.random()*e.length)],dr=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return cr(e?lr.CHARACTER_NAMES[0]:lr.PLAYER_NAMES[0])+" "+cr(e?lr.CHARACTER_NAMES[1]:lr.PLAYER_NAMES[1])};const ur={TEAM_PLAYER:{name:"Team Player",description:"+1 to all other players happiness"},GRUMPY:{name:"Grumpy",description:"-1 to all other players happiness"},FORMER_DM:{name:"Former DM",description:"Ignores personal LIKES and HATES when choosing encounters"},MIN_MAXER:{name:"Min-Maxer",description:"Gets a bonus to Combat encounters"},ROLE_PLAYER:{name:"Role Player",description:"Gets a bonus to Social encounters"},LOGICIAN:{name:"Logician",description:"Gets a bonus to Puzzle encounters"},WEALTHY:{name:"Wealthy",description:"Gives a bonus 20% reward at the end of a Campaign if Happy"},BLOODTHIRSTY:{name:"Bloodthirsty",description:"Gets x2 happiness from Combat encounters"}},hr=[{race:$e.ELF,character_class:et.WIZARD,abilities:[],level:1,experience:0,name:"Saul",id:0,icon:"elf_1",gear:[],backstory:[{tag:{name:"Dark Gem"},completed:!1}]},{race:$e.HUMAN,character_class:et.FIGHTER,abilities:[],level:1,experience:0,name:"Riker",id:1,icon:"human_1",gear:[],backstory:[]},{race:$e.HUMAN,character_class:et.ROGUE,abilities:[],level:1,experience:0,name:"Godfrey",id:2,icon:"human_2",gear:[],backstory:[]}],mr=[{name:"Matt W",characters:[hr[0]],id:0,icon:"player_1",schedule:[10,20,30,40,50,60,70],preferences:[[Na.D.ELVES,r.zo.LIKE],[Na.D.HUMANS,r.zo.LIKE],[Na.D.UNDEAD,r.zo.LIKE],[Na.D.DEER,r.zo.HATE],[Na.D.POLITICS,r.zo.HATE],[Na.D.BRIDGES,r.zo.LIKE],[Na.D.SOCIALIZING,r.zo.LIKE],[Na.D.BEER,r.zo.LIKE]],traits:[],playerStats:{stress:0,enjoyment:1,engagement:25,involvement:3,experience:0,level:1,maxEngagement:5,maxInvolvement:5,maxEnjoyment:5,stressBuffer:10}},{name:"Dan A",characters:[hr[1]],id:1,icon:"player_2",schedule:[10,20,30,40,50,60,70],preferences:[[Na.D.HALFLINGS,r.zo.LIKE],[Na.D.POLITICS,r.zo.LIKE],[Na.D.TAVERNS,r.zo.LIKE],[Na.D.GOBLINS,r.zo.HATE],[Na.D.EXPLORATION,r.zo.LIKE],[Na.D.BEER,r.zo.LIKE]],traits:[],playerStats:{stress:0,enjoyment:4,engagement:25,involvement:3,experience:0,level:1,maxEngagement:5,maxInvolvement:5,maxEnjoyment:5,stressBuffer:10}},{name:"Olivier B",characters:[hr[2]],id:2,icon:"player_3",schedule:[10,20,30,40,50,60,70],preferences:[[Na.D.DWARVES,r.zo.LIKE],[Na.D.HALFLINGS,r.zo.LIKE],[Na.D.PUZZLES,r.zo.LIKE],[Na.D.SOCIALIZING,r.zo.LIKE],[Na.D.BORING_THINGS,r.zo.HATE],[Na.D.BEER,r.zo.LIKE]],traits:[ur.TEAM_PLAYER],playerStats:{stress:0,enjoyment:3,engagement:25,involvement:3,experience:0,level:1,maxEngagement:5,maxInvolvement:5,maxEnjoyment:5,stressBuffer:10}}];const gr=class{constructor(e){this.recruitablePlayers=void 0,this.selectedPlayers=void 0,this.players=void 0,this.uniqueID=0,this._currentPlayerIndex=0,this.appManager=void 0,this.uiManager=void 0,this.recruitablePlayers=[],this.players=[],this.selectedPlayers=[],this.appManager=e}getCurrentPlayer(){return 0===this.players.length?void 0:this.players[this._currentPlayerIndex]}isCurrentPlayerLast(){return this._currentPlayerIndex===this.players.length-1}init(){this.uiManager=this.appManager.getUiManager(),this.generateAvailablePlayers(8)}stressPlayers(e){var t;this.players.forEach((t=>{t.playerStats.stress+=e})),null===(t=this.uiManager)||void 0===t||t.updateParty()}getRecruitablePlayers(){return this.recruitablePlayers}setSelectedPlayers(e){this.selectedPlayers=this.recruitablePlayers.filter(((t,a)=>e.includes(a)))}getPlayers(){return this.players}getSelectedPlayers(){return this.selectedPlayers}getPlayerById(e){return this.players.find((t=>t.id===e))||void 0}getSelectedPlayerIds(){return this.selectedPlayers.map((e=>e.id))}generateIcon(){return"player_"+Math.ceil(9.9*Math.random())}generateSchedule(){const e=[];for(let t=0;t<7;t++)e.push(Math.ceil(100*Math.random()));return e}generateAvailablePlayers(e){for(let t=0;t<e;t++){const e={name:dr(!1),id:this.uniqueID++,characters:[],icon:this.generateIcon(),schedule:this.generateSchedule(),preferences:this.generatePreferences(),traits:this.generatePlayerTraits(),playerStats:{stress:50,enjoyment:3,engagement:50,involvement:3,experience:0,level:1,maxEngagement:5,maxInvolvement:5,maxEnjoyment:5,stressBuffer:10}};this.recruitablePlayers.push(e)}}getMaxCharactersPerPlayer(){return 1}acceptSelectedPlayers(){this.players=this.selectedPlayers}getPlayerWithAttitudeForTag(e,t){const a=this.players.filter((a=>a.preferences.some((a=>a[0].name===e.name&&a[1]===t))));if(a.length>0)return a[Math.floor(Math.random()*a.length)]}generatePlayerTraits(){const e=Object.values(ur);if(Math.random()<.5){return[e[Math.floor(Math.random()*e.length)]]}return[]}generatePreferences(){const e=[],t=Object.values(Na.D).flat(),a=t.filter((e=>e.preference===r.Ok.START)),n=t.filter((e=>e.preference===r.Ok.MAIN));if(a.length>1){const t=a.splice(Math.floor(Math.random()*a.length),1)[0],n=a.splice(Math.floor(Math.random()*a.length),1)[0];e.push([t,r.zo.LIKE]),e.push([n,r.zo.HATE])}const s=(e,t,a,n)=>{const s=[];for(let r=0;r<t;r++){const t=e[Math.floor(Math.random()*e.length)],r=Math.floor(Math.random()*(n-a+1))+a;s.push([t,r])}return s},i=Math.floor(3*Math.random()),o=Math.floor(3*Math.random()),l=s(n,i,1,5),c=s(n,o,-5,-1);return e.push(...l),e.push(...c),e}exposeEncounterTag(e){var t;this.players.forEach((t=>{const a=t.preferences.find((t=>t[0].name===e.name));a&&(t.playerStats.enjoyment=Math.max(Math.min(t.playerStats.maxEnjoyment,t.playerStats.enjoyment+a[1]),0))})),null===(t=this.uiManager)||void 0===t||t.updateParty()}toggleSinglePlayerForCharacter(e,t){e&&(e.characters.includes(t)?this.removeCharacterFromPlayer(e,t):(this.players.forEach((e=>{e.characters.includes(t)&&this.removeCharacterFromPlayer(e,t)})),e.characters.push(t)))}getPlayerAssignedCharacter(e){if(!e)return;let t;return this.players.forEach((a=>{a.characters.includes(e)&&(t=a)})),t}assignCharactersToPlayer(e,t){e&&t.forEach((t=>{e.characters.push(t)}))}isCharacterAssigned(e){return this.players.some((t=>t.characters.includes(e)))}removeCharacterFromPlayer(e,t){if(e){const a=e.characters.indexOf(t);a>-1&&e.characters.splice(a,1)}}aggregateSchedule(){const e=[0,0,0,0,0,0,0];return this.selectedPlayers.forEach((t=>{t.schedule.forEach(((t,a)=>{e[a]+=t/this.selectedPlayers.length,e[a]=Math.ceil(e[a])}))})),e}getGroupAttitudes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectedPlayers;const t={};e.forEach((e=>{e.preferences.forEach((e=>{const a=e[0],n=e[1];if(t[a.name])switch(t[a.name]){case r.zo.LIKE:n<0&&(t[a.name]=r.zo.CONFLICTED);break;case r.zo.HATE:n>0&&(t[a.name]=r.zo.CONFLICTED)}else t[a.name]=n<0?r.zo.HATE:r.zo.LIKE}))}));return{likes:Object.keys(t).map((e=>t[e]===r.zo.LIKE?e:"")).filter((e=>""!==e)),hates:Object.keys(t).map((e=>t[e]===r.zo.HATE?e:"")).filter((e=>""!==e)),conflicted:Object.keys(t).map((e=>t[e]===r.zo.CONFLICTED?e:"")).filter((e=>""!==e))}}getGroupAttitudeForTag(e,t){const a=this.getGroupAttitudes(e);return a.likes.includes(t.name)?r.zo.LIKE:a.hates.includes(t.name)?r.zo.HATE:a.conflicted.includes(t.name)?r.zo.CONFLICTED:r.zo.NEUTRAL}getPartyAttitudeForTag(e){return this.getGroupAttitudeForTag(this.players,e)}readyForGame(){if(0===this.players.length)return!1;let e=!0;return this.players.forEach((t=>{0===t.characters.length&&(e=!1)})),e}initiateQuickStart(){this.recruitablePlayers=this.players=mr}addPlayerExp(e,t){var a;e&&(e.playerStats.experience+=t,e.playerStats.experience>=this.expNeededForLevel(e.playerStats.level)&&(e.playerStats.level+=1,e.playerStats.experience=0,console.log("player leveled up!!!!"),this.appManager.getChatManager().dmMessage(`${e.name} learned something!`),this.handleLevelUp(e)),null===(a=this.uiManager)||void 0===a||a.updateParty())}expNeededForLevel(e){return rt[e-1]||0}getAllPlayerPreferences(){const e=[];return this.players.forEach((t=>{t.preferences.forEach((t=>{e.includes(t[0])||e.push(t[0])}))})),e}getAllPlayerCharacters(){const e=[];return this.players.forEach((t=>{t.characters.forEach((t=>{e.includes(t)||e.push(t)}))})),e}getRandomPlayer(){return this.players[Math.floor(Math.random()*this.players.length)]}getRandomCharacter(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.getAllPlayerCharacters();if(0!==t.length){if(!e){const e=t.filter((e=>!("dead"===e.injury)));if(0===e.length)return;return e[Math.floor(Math.random()*e.length)]}return t[Math.floor(Math.random()*t.length)]}}getRandomCharacterForPlayer(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e&&0!==e.characters.length){if(!t){const t=e.characters.filter((e=>!("dead"===e.injury)));if(0===t.length)return;return t[Math.floor(Math.random()*t.length)]}return e.characters[Math.floor(Math.random()*e.characters.length)]}}refreshPlayer(e){var t;e&&(e.playerStats.involvement=e.playerStats.maxInvolvement,e.playerStats.enjoyment=e.playerStats.maxEnjoyment,e.playerStats.stress=0),null===(t=this.uiManager)||void 0===t||t.updateParty()}getPlayerLevelUpOption(e){let t;const a=Math.floor(3*Math.random())+1,n=(()=>{const e=Math.random();return e<.5?1:e<.9?2:3})(),s=1===n?"common":2===n?"rare":"legend";return t=1===a?{id:st.MAX_HAPPINESS,title:(1===n?"":2===n?"Better ":"Great ")+"Happiness",description:`+${n} max Enjoyment`,icon:"\ud83d\ude0a",level:n,class:s,callback:()=>{var t;e.playerStats.maxEnjoyment+=n,null===(t=this.uiManager)||void 0===t||t.updateParty()}}:2===a?{id:st.MAX_ATTENTION,title:(1===n?"":2===n?"Better ":"Great ")+"Attention",description:`+${n} max Attention`,icon:"\ud83e\udde0",level:n,class:s,callback:()=>{var t;e.playerStats.maxInvolvement+=n,null===(t=this.uiManager)||void 0===t||t.updateParty()}}:{id:st.STRESS_BUFFER,title:(1===n?"":2===n?"Better ":"Great ")+"Stress Proof",description:`+${5*n} Stress Buffer/Reduce`,icon:"\ud83d\udee1\ufe0f",class:s,callback:()=>{var t;e.playerStats.stressBuffer+=5*n,e.playerStats.stress=Math.max(0,e.playerStats.stress-5*n),null===(t=this.uiManager)||void 0===t||t.updateParty()}},t}getFancyLevelUpOption(e){const t=this.appManager.getCharacterManager().generateRandomCharacter(1);return{id:st.CHARACTER,title:"New Character",description:`Get ${t.name}`,icon:`${t.icon}`,class:"level-up-option-character",callback:()=>{var a;e.characters.push(t),null===(a=this.uiManager)||void 0===a||a.updateParty()}}}handleLevelUp(e){var t;const a=[];a.push({id:st.REFRESH,title:"Refresh",description:"Fill Attitude, Attention. Reduce Stress.",icon:"\ud83d\udd04",callback:()=>this.refreshPlayer(e)}),a.push(this.getPlayerLevelUpOption(e)),a.push(this.getFancyLevelUpOption(e)),null===(t=this.uiManager)||void 0===t||t.showModal({title:e.name+" Level Up!",options:a,onClose:()=>console.log("Modal closed"),type:"levelup"})}evaluateEncounterPreferences(e){const t={},a={},n={};return this.players.forEach((t=>{n[t.name]={},e.forEach((e=>{var a,s,i;let o=0,l=0;null===(a=e.tags)||void 0===a||a.forEach((e=>{const a=t.preferences.find((t=>t[0].name===e.name));a&&(a[1]===r.zo.LIKE&&o++,a[1]===r.zo.HATE&&l++)})),null===(s=e.location)||void 0===s||null===(i=s.tags)||void 0===i||i.forEach((e=>{const a=t.preferences.find((t=>t[0].name===e.name));a&&(a[1]===r.zo.LIKE&&o++,a[1]===r.zo.HATE&&l++)})),n[t.name][e.name]={likes:o,hates:l}}))})),this.players.forEach((e=>{const s=n[e.name];let r=0,i=[];if(Object.keys(s).forEach((e=>{const t=s[e],a=t.likes-t.hates;t.likes>0&&a>r?(r=a,i=[e]):t.likes>0&&a===r&&i.push(e)})),i.length>0){const a=i[Math.floor(Math.random()*i.length)];t[a]||(t[a]=[]),t[a].push(e)}Object.keys(s).forEach((t=>{const n=s[t];(n.likes-n.hates<0||!i.includes(t)&&e.preferences.length>0&&Math.random()<.25)&&(a[t]||(a[t]=[]),a[t].push(e))}))})),{preferredEncounters:t,notWantedEncounters:a}}playersAffectedByRailroading(){return[...this.players]}applyEncounterSelectionEffects(e,t){this.appManager.getPartyManager().applyEncounterSelectionEffects(e,t)}calculateIncompleteExplorationPenalties(e){const t=e.getOutstandingLocationTags(),a=e.getOutstandingEncounterTags(),n=5*t.length,s=a.length;return{locationTagPenalty:n,encounterTagPenalty:s,totalStressPenalty:n,totalAttentionPenalty:s}}applyIncompleteExplorationPenalties(e){this.appManager.getPartyManager().applyIncompleteExplorationPenalties(e)}handleNextEncounterSelection(e,t,a){this.appManager.getPartyManager().handleNextEncounterSelection(e,t,a)}};const pr=class{constructor(){this.init()}init(){}startSession(){console.log("Starting session...")}};class fr extends(cn()){constructor(e){super(),this.dataManager=void 0,this.appManager=void 0,this.characterManager=void 0,this.campaignManager=void 0,this.playerManager=void 0,this.uiManager=void 0,this.partyTension=0,this.treasureLevel=0,this.treasurePoints=0,this.partyExhaustion=0,this.stressColors=["#FFB347","#FFDF80","#FFDF80","#B2FF66","#B2FF66","#B2FF66","#66FF66","#FF7043","#FF7043","#FF6666"],this.getTreasureReward=e=>e%2===0?{type:"attitude",value:1}:{type:"score",value:2*(e+1)},setTimeout((()=>{this.appManager=e,this.dataManager=e.getDataManager(),this.characterManager=e.getCharacterManager(),this.campaignManager=e.getCampaignManager(),this.playerManager=e.getPlayerManager(),this.uiManager=e.getUiManager()}),0)}perceptionEventReveal(e){var t,a;const n=null===(t=this.playerManager)||void 0===t?void 0:t.getPlayers();null===n||void 0===n||n.forEach((t=>{t.characters.includes(e)?t.playerStats.engagement=Math.min(t.playerStats.maxEngagement,Math.max(t.playerStats.engagement+1,0)):t.playerStats.engagement=Math.min(t.playerStats.maxEngagement,Math.max(t.playerStats.engagement-1,0))})),null===(a=this.uiManager)||void 0===a||a.updateParty()}getPartyStrength(){var e;const t=null===(e=this.playerManager)||void 0===e?void 0:e.getPlayers();let a=0;return null===t||void 0===t||t.forEach((e=>{e.characters.forEach((e=>{e&&(a+=e.level)}))})),a}playersTakeAction(e){var t,a;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const r=null===(t=this.playerManager)||void 0===t?void 0:t.getPlayers();null===r||void 0===r||r.forEach((t=>{var a;null!==e&&void 0!==e&&e.includes(t.name)?(t.playerStats.involvement=Math.min(t.playerStats.involvement+s,t.playerStats.maxInvolvement),null===(a=this.playerManager)||void 0===a||a.addPlayerExp(t,s)):n&&this.updateAttention(t,-s)})),null===(a=this.uiManager)||void 0===a||a.updateParty()}updateAllAttention(e){var t,a;const n=null===(t=this.playerManager)||void 0===t?void 0:t.getPlayers();null===n||void 0===n||n.forEach((t=>{this.updateAttention(t,e)})),null===(a=this.uiManager)||void 0===a||a.updateParty()}updateAttention(e,t){var a;e&&(t<0&&0===e.playerStats.involvement&&(e.playerStats.enjoyment=Math.max(e.playerStats.enjoyment-1,0)),e.playerStats.involvement=Math.max(0,Math.min(e.playerStats.involvement+t,e.playerStats.maxInvolvement))),null===(a=this.uiManager)||void 0===a||a.updateParty()}multiplyPartyTension(e){var t;this.partyTension*=e,null===(t=this.uiManager)||void 0===t||t.updateParty()}addPartyTension(e){var t;this.partyTension+=e,this.partyTension>100&&(this.partyTension=100),null===(t=this.uiManager)||void 0===t||t.updateParty()}setPartyTension(e){var t;this.partyTension=e,null===(t=this.uiManager)||void 0===t||t.updateParty()}takeBreak(){var e;this.partyTension=.5*this.partyTension,this.updateAllAttention(-2),this.partyExhaustion=.5*this.partyExhaustion,this.emit("dmScreenUpdated",this.partyExhaustion),null===(e=this.uiManager)||void 0===e||e.updateParty()}getPartyExhaustion(){return this.partyExhaustion}getMaxPartyExhaustion(){return 100}exhaustParty(e){this.partyExhaustion+=e,this.emit("dmScreenUpdated",this.partyExhaustion)}addPartyEngagement(e){var t,a;const n=null===(t=this.playerManager)||void 0===t?void 0:t.getPlayers();null===n||void 0===n||n.forEach((t=>{t.playerStats.engagement=Math.min(t.playerStats.maxEngagement,Math.max(t.playerStats.engagement+e,0))})),null===(a=this.uiManager)||void 0===a||a.updateParty()}updateAllStress(e){var t,a;const n=null===(t=this.playerManager)||void 0===t?void 0:t.getPlayers();null===n||void 0===n||n.forEach((t=>{t.playerStats.stress=Math.max(0,t.playerStats.stress+e)})),null===(a=this.uiManager)||void 0===a||a.updateParty()}updatePlayersStress(e,t){var a;e.forEach((e=>{e.playerStats.stress=Math.max(0,e.playerStats.stress+t)})),null===(a=this.uiManager)||void 0===a||a.updateParty()}addInjury(e){var t,a;if(!e)return" invalid";e.injury="injured"===e.injury?"dead":"injured";const n=null===(t=this.playerManager)||void 0===t?void 0:t.getPlayerAssignedCharacter(e);return n&&(e.injury,n.playerStats.enjoyment=Math.max(n.playerStats.enjoyment-1,0)),null===(a=this.uiManager)||void 0===a||a.updateParty(),e.injury}addEnjoyment(e,t){var a;e&&(e.playerStats.enjoyment=Math.min(e.playerStats.maxEnjoyment,Math.max(e.playerStats.enjoyment+t,0)),null===(a=this.uiManager)||void 0===a||a.updateParty())}getTreasureLevel(){return this.treasureLevel}getTreasurePoints(){return this.treasurePoints}getTreasureThreshold(e){return e+1}addTreasurePoints(e){var t;for(this.treasurePoints+=e;this.getTreasureThreshold(this.treasureLevel+1)<=this.treasurePoints;)this.treasureLevelUp(this.treasureLevel),this.treasureLevel++,this.treasurePoints=0;null===(t=this.uiManager)||void 0===t||t.updateParty()}treasureLevelUp(e){const t=this.getTreasureReward(e);if("score"===t.type){var a;null===(a=this.campaignManager)||void 0===a||a.collectTreasure(t.value)}else{var n;const e=null===(n=this.playerManager)||void 0===n?void 0:n.getPlayers();null===e||void 0===e||e.forEach((e=>{e.playerStats.enjoyment=Math.min(e.playerStats.maxEnjoyment,e.playerStats.enjoyment+t.value)}))}}addPartyEnjoyment(e){var t,a;const n=null===(t=this.playerManager)||void 0===t?void 0:t.getPlayers();null===n||void 0===n||n.forEach((t=>{t.playerStats.enjoyment=Math.min(t.playerStats.maxEnjoyment,Math.max(t.playerStats.enjoyment+e,0))})),null===(a=this.uiManager)||void 0===a||a.updateParty()}replenishTools(e,t){e.attributeLoss&&e.attributeLoss.tools&&(t||(t=e.attributeLoss.tools),e.attributeLoss.tools=Math.max(0,e.attributeLoss.tools-t),e.attributeLoss.tools=0)}replenishPartyTools(){var e,t;const a=null===(e=this.playerManager)||void 0===e?void 0:e.getPlayers();null===a||void 0===a||a.forEach((e=>{e.characters.forEach((e=>{e&&e.attributeLoss&&(e.attributeLoss.tools=0)}))})),null===(t=this.uiManager)||void 0===t||t.updateParty()}healRandomCharacter(){var e;const t=null===(e=this.playerManager)||void 0===e?void 0:e.getPlayers(),a=[];if(null===t||void 0===t||t.forEach((e=>{e.characters.forEach((e=>{e&&e.injury&&a.push(e)}))})),0===a.length)return;const n=Math.floor(Math.random()*a.length);a[n].injury=void 0}healParty(){var e,t;const a=null===(e=this.playerManager)||void 0===e?void 0:e.getPlayers();null===a||void 0===a||a.forEach((e=>{e.characters.forEach((e=>{e&&(e.injury=void 0)}))})),null===(t=this.uiManager)||void 0===t||t.updateParty()}healCharacter(e){var t;e&&(e.injury=void 0,null===(t=this.uiManager)||void 0===t||t.updateParty())}raiseRandomFromDead(){var e;const t=null===(e=this.playerManager)||void 0===e?void 0:e.getPlayers(),a=[];if(null===t||void 0===t||t.forEach((e=>{e.characters.forEach((e=>{e&&"dead"===e.injury&&a.push(e)}))})),0===a.length)return;const n=Math.floor(Math.random()*a.length);a[n].injury=void 0}replenishPartyMagic(){var e,t;const a=null===(e=this.playerManager)||void 0===e?void 0:e.getPlayers();null===a||void 0===a||a.forEach((e=>{e.characters.forEach((e=>{e&&e.attributeLoss&&(e.attributeLoss.magic=0)}))})),null===(t=this.uiManager)||void 0===t||t.updateParty()}replenishMagic(e,t){var a;e.attributeLoss&&e.attributeLoss.magic&&(t||(t=e.attributeLoss.magic),e.attributeLoss.magic=Math.max(0,e.attributeLoss.magic-t),null===(a=this.uiManager)||void 0===a||a.updateParty())}levelUpLowestCharacter(){var e;const t=null===(e=this.playerManager)||void 0===e?void 0:e.getPlayers();let a,n=100;null===t||void 0===t||t.forEach((e=>{e.characters.forEach((e=>{e&&e.level<n&&(n=e.level,a=e)}))})),a&&(a.level+=1)}levelUp(e){e&&(e.level+=1)}stressAction(e){var t,a;const n=null===(t=this.playerManager)||void 0===t?void 0:t.getPlayers(),s=this.getStressIncrease(this.partyTension)||0;null===n||void 0===n||n.forEach((t=>{e&&!e.includes(t)||(t.playerStats.stress=Math.min(100,t.playerStats.stress+s))})),null===(a=this.uiManager)||void 0===a||a.updateParty()}generateHeroes(e){var t;const a=[];e.forEach((e=>{const t={npcTag:e,icon:`combat_${e.name}`,name:e.name};a.push(t)}));const n=null===(t=this.characterManager)||void 0===t?void 0:t.getPlayerCharacters();return null===n||void 0===n||n.forEach((e=>{const t={character:e,icon:e.icon,name:e.name};a.push(t)})),a}getPartyTension(){return this.partyTension}getTensionScoreMultiplier(){var e;const t=(null===(e=this.campaignManager)||void 0===e?void 0:e.getTensionDescriptions())||[];for(const a of t)if(this.partyTension<=a.max)return a.scoreMultiplier;return 0}getTensionDescription(e){var t;const a=(null===(t=this.campaignManager)||void 0===t?void 0:t.getTensionDescriptions())||[];for(const n of a)if(e<=n.max)return n.description;return"Unknown Tension"}getTensionDescription2(e){var t;let a=0;const n=(null===(t=this.campaignManager)||void 0===t?void 0:t.getTensionDescriptions())||[];for(const s of n)if(e<=s.max){a=s.scoreMultiplier;break}return 0===a?"No Score":.5===a?"Score Multiplier: 50%":1===a?"Normal Scoring":`Score x${a}`}getScoreMultiplier(e){var t;const a=(null===(t=this.campaignManager)||void 0===t?void 0:t.getTensionDescriptions())||[];for(const n of a)if(e<=n.max)return n.scoreMultiplier}getStressIncrease(e){var t;const a=(null===(t=this.campaignManager)||void 0===t?void 0:t.getTensionDescriptions())||[];for(const n of a)if(e<=n.max)return n.stressIncrease;return 0}getStressColors(){return this.stressColors}applyEncounterSelectionEffects(e,t){var a;const{preferredEncounters:n,notWantedEncounters:s}=(null===(a=this.playerManager)||void 0===a?void 0:a.evaluateEncounterPreferences(t))||{preferredEncounters:{},notWantedEncounters:{}};if(1===t.length)this.updateAllAttention(-1),console.log("Applied railroading penalty: -1 engagement to all players");else{const t=n[e.name]||[];t.length>0&&t.forEach((a=>{this.updateAttention(a,1),console.log(`Applied +1 engagement to ${t.length} players who preferred "${e.name}"`)}));const a=s[e.name]||[];a.length>0&&a.forEach((t=>{this.updateAttention(t,1),console.log(`Applied -1 engagement to ${a.length} players who not-wanted "${e.name}"`)}))}}applyIncompleteExplorationPenalties(e){var t;const a=null===(t=this.playerManager)||void 0===t?void 0:t.calculateIncompleteExplorationPenalties(e);a&&(a.totalStressPenalty>0&&this.updateAllStress(a.totalStressPenalty),a.totalAttentionPenalty>0&&this.updateAllAttention(-a.totalAttentionPenalty),(a.totalStressPenalty>0||a.totalAttentionPenalty>0)&&console.log("Applied incomplete exploration penalties:",{stressPenalty:a.totalStressPenalty,attentionPenalty:a.totalAttentionPenalty,outstandingLocationTags:a.locationTagPenalty,outstandingEncounterTags:a.encounterTagPenalty}))}handleNextEncounterSelection(e,t,a){var n;this.applyIncompleteExplorationPenalties(a),this.applyEncounterSelectionEffects(e,t),null===(n=this.campaignManager)||void 0===n||n.advanceEncounter(e)}}const vr=fr;class yr extends ln.EventEmitter{constructor(e){super(),this.appManager=void 0,this.playerManager=void 0,this.characterManager=void 0,this.renderImageForEvent=!0,this.eventImageOpacity=0,this.activeModal=null,this.init(),this.appManager=e,this.playerManager=this.appManager.getPlayerManager(),this.characterManager=this.appManager.getCharacterManager()}showModal(e){this.activeModal=e,this.emit("modalStateChanged",this.activeModal)}closeModal(){var e;null!==(e=this.activeModal)&&void 0!==e&&e.onClose&&this.activeModal.onClose(),this.activeModal=null,this.emit("modalStateChanged",null)}showWelcomeModal(){this.showModal({title:"Welcome to Dungeon Planner",type:"welcome",options:[{id:"continue",title:"Begin Adventure",description:"Start your campaign experience",callback:()=>{}}]})}handleModalOptionSelected(e){var t;const a=null===(t=this.activeModal)||void 0===t?void 0:t.options.find((t=>t.id===e));a&&(a.callback(),this.closeModal())}closeNotebook(){this.emit("setNotebookState",void 0)}closeTutorial(){this.closeNotebook()}updateEncounterState(e){this.emit("updateEncounterState",e)}showNotebook(e){this.emit("setNotebookState",e)}removePlayer(e){this.emit("removePlayer",e)}getEventIcon(e){return`event_${e}`}showTutorialPage(e){this.emit("setTutorialPage",e)}changeEventTimer(e){this.emit("setupTimeChange",e)}showRewardModal(e,t){this.emit("showRewardModal",e,t)}showSelectQuestModal(){this.emit("showSelectQuestModal",!0)}hideSelectQuestModal(){this.emit("showSelectQuestModal",!1)}showQuestTerminalModal(e,t){this.emit("showQuestTerminalModal",{quest:e,node:t})}hideQuestTerminalModal(){this.emit("showQuestTerminalModal",null)}showQuestProgressModal(e){this.emit("showQuestProgressModal",e)}hideQuestProgressModal(){this.emit("showQuestProgressModal",null)}showActiveQuestsModal(){this.emit("showActiveQuestsModal",!0)}hideActiveQuestsModal(){this.emit("showActiveQuestsModal",!1)}showResultModal(e){this.emit("showResultModal",e)}hideResultModal(){this.emit("showResultModal",void 0)}toggleImageForEvent(){this.eventImageOpacity=1,this.renderImageForEvent=!this.renderImageForEvent,this.emit("eventUpdated")}questSelected(e){const t=this.appManager.getQuestManager().getExhaustionForQuest(e),a=this.appManager.getPartyManager();t>0&&a.exhaustParty(t),this.hideSelectQuestModal(),this.showQuestProgressModal(e)}getMessageIconId(e){let t;switch(e.type){case r.wb.PLAYER:t=this.playerManager.getRecruitablePlayers()[e.id].icon;break;case r.wb.CHARACTER:t=this.characterManager.getCharacterById(e.id).icon;break;case r.wb.DM:t="chat_dm";break;case r.wb.HELPER:default:t="chat_imp"}return t}getMessageSpeakerName(e){let t;switch(e.type){case r.wb.PLAYER:t=this.playerManager.getRecruitablePlayers()[e.id].name;break;case r.wb.CHARACTER:t=this.characterManager.getCharacterById(e.id).name;break;case r.wb.DM:t="You";break;case r.wb.HELPER:default:t="Impy"}return t}getShortenedName(e){return e.split(" ").map((e=>e[0])).join("")}showImageForEvent(){return this.renderImageForEvent}setEventImageOpacity(e){this.eventImageOpacity=e,this.emit("eventUpdated")}getEventImageOpacity(){return this.eventImageOpacity}getHeroFirstName(e){return e.split(" ")[0]}showBasicNotebook(e,t){let a,n="",s=[];switch(e){case r.d8.CHARACTER:a={character:t},n=a.character.name;let e=this.playerManager.getPlayerAssignedCharacter(a.character);e&&s.push({category:r.d8.PLAYER,content:{player:e,message:""},title:e.name});break;case r.d8.LOCATION:a={location:t},n=a.location.name;break;case r.d8.ENCOUNTER:a={encounter:t},n=a.encounter.name,s.push({category:r.d8.LOCATION,content:{location:a.encounter.location},title:a.encounter.location.name});break;case r.d8.PLAYER:a={player:t},n=a.player.name,a.player.characters.forEach((e=>{s.push({category:r.d8.CHARACTER,content:{character:e,message:""},title:e.name})}));break;default:return void console.error("BAD SHOW BASIC NOTEBOOK CALLED")}const i={category:e,content:a,title:n};s.length>0?this.showNotebook([i,...s]):this.showNotebook([i])}showTutorialMessage(e){const t={category:r.d8.TUTORIAL,content:{message:e.content[0],showNext:e.content.length>1?1:void 0,icon:e.icons?e.icons[0]:void 0,title:e.title},title:e.title},a=e.content.slice(1).map(((t,a)=>({category:r.d8.TUTORIAL,content:{message:t,showNext:a<e.content.length-2?a+2:void 0,showPrev:a,icon:e.icons?e.icons[a+1]:void 0,title:e.title},title:e.title})));a.length>0?this.showNotebook([t,...a]):this.showNotebook([t])}getPlayerAttitudesStyle(e){switch(this.playerManager.getGroupAttitudeForTag(this.playerManager.getPlayers(),e)){case r.zo.LIKE:return"player-like";case r.zo.CONFLICTED:return"player-conflicted";case r.zo.HATE:return"player-hate";default:return""}}updateParty(){this.emit("playerUpdate")}showAcceptCampaignModal(e){console.log("showing accept campaign modal...")}init(){console.log("init uiManager...")}update(e){}showTagModal(e){this.showModal({title:e.title,type:"tagmodal",options:[],tagModalConfig:{title:e.title,description:e.description,tags:e.tags,effects:e.effects,selectedTags:e.selectedTags,remainingClicks:e.remainingClicks,tagInstructions:e.tagInstructions,onTagClick:e.onTagClick,onClose:e.onClose}})}static getPlayerEmail(e){const t=this.hashString(e),a=this.seededRandom(t);return`${e.replace(" ",".").toLowerCase()}${this.randomDigit(a)}${this.randomDigit(a)}${this.randomDigit(a)}@gmail.com`}static getPlayerPhone(e){const t=this.hashString(e),a=this.seededRandom(t);return`(${this.randomDigit(a)}${this.randomDigit(a)}${this.randomDigit(a)}) ${this.randomDigit(a)}${this.randomDigit(a)}${this.randomDigit(a)}-${this.randomDigit(a)}${this.randomDigit(a)}${this.randomDigit(a)}${this.randomDigit(a)}`}static hashString(e){let t=0;for(let a=0;a<e.length;a++){t=(t<<5)-t+e.charCodeAt(a),t|=0}return t}static seededRandom(e){return function(){const t=1e4*Math.sin(e++);return t-Math.floor(t)}}static randomDigit(e){return Math.floor(10*e())}getRewardDisplayConfig(e){switch(e.type){case"score":return{type:"dice",score:e.amount};case"treasure":return{type:"treasurePills",amount:e.amount,tagConfig:{tag:{name:"Treasure"},source:r.UW.TREASURE,theme:r.Co.NONE}};default:return{type:"text",text:`${e.description||"Reward"}: ${e.amount}`}}}}const br=yr;const Er=class{getGraph(){return this.campaignGraph}constructor(e){this.campaignGraph=void 0,this.stateConfigs=new Map,this.appManager=void 0,this.appManager=e,this.init()}init(){this.campaignGraph=new r.TS,this.initStates(),console.log("init dataManager...")}getStateProps(e){var t;return null!==(t=this.stateConfigs.get(e||this.appManager.state))&&void 0!==t?t:Pt}initStates(){this.stateConfigs.set(Lt.MAIN_MENU,{...Pt,...Dt[Lt.MAIN_MENU]}),this.stateConfigs.set(Lt.CAMPAIGN_SETUP,{...Pt,...Dt[Lt.CAMPAIGN_SETUP]}),this.stateConfigs.set(Lt.PLAYER_RECRUITMENT,{...Pt,...Dt[Lt.PLAYER_RECRUITMENT]}),this.stateConfigs.set(Lt.CHARACTER_CREATION,{...Pt,...Dt[Lt.CHARACTER_CREATION]}),this.stateConfigs.set(Lt.SESSION_OVERVIEW,{...Pt,...Dt[Lt.SESSION_OVERVIEW]}),this.stateConfigs.set(Lt.SESSION,{...Pt,...Dt[Lt.SESSION]}),this.stateConfigs.set(Lt.SCORE,{...Pt,...Dt[Lt.SCORE]})}};const xr=class{constructor(e){this.characters=void 0,this.uniqueID=0,this.selectedCharacters=void 0,this.appManager=void 0,this.getUFClass=e=>{switch(e){case et.CLERIC:return"Cleric";case et.DRUID:return"Druid";case et.FIGHTER:return"Fighter";case et.PALADIN:return"Paladin";case et.ROGUE:return"Rogue";case et.WIZARD:return"Wizard";default:return"Unknown"}},this.getUFRace=e=>{switch(e){case $e.HUMAN:return"Human";case $e.ELF:return"Elven";case $e.DWARF:return"Dwarven";case $e.HALFLING:return"Halfling";case $e.HALF_ELF:return"Half-Elf";case $e.HALF_ORC:return"Half-Orc";default:return"Unknown"}},this.getUFAttributeName=e=>{switch(e){case r.Eh.COMBAT:return"Combat";case r.Eh.MAGIC:return"Magic";case r.Eh.TOOLS:return"Tools";default:return"Unknown"}},this.getUFAttributeSymbol=e=>{switch(e){case r.Eh.COMBAT:return"\u2694\ufe0f";case r.Eh.MAGIC:return"\u2728";case r.Eh.TOOLS:return"\ud83d\udd27";default:return"\u2753"}},this.getUFInitials=e=>e.name.split(" ").map((e=>e[0])).join(""),this.characters=[],this.selectedCharacters=[],this.appManager=e}init(){this.generateRandomCharacters(12)}getCharacters(){return this.characters}getPlayerCharacters(){return this.appManager.getPlayerManager().getPlayers().flatMap((e=>e.characters))}setSelectedCharacters(e){this.selectedCharacters=this.characters.filter(((t,a)=>e.includes(a))).map((e=>e.id))}getCharacterByIndex(e){return this.characters[e]}getCharacterById(e){return this.characters.find((t=>t.id===e))||this.characters[0]}getCharacterReferences(){return this.characters}setAttributeUsed(e,t,a){e.attributeLoss||(e.attributeLoss={}),e.attributeLoss[t]=(e.attributeLoss[t]||0)+a}addUsedAttribute(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.setAttributeUsed(e,t,a)}useHalfRemainingAttributes(e,t){var a;const n=Wt(e)[t]-((null===(a=e.attributeLoss)||void 0===a?void 0:a[t])||0),s=n-Math.floor(n/2);return this.setAttributeUsed(e,t,s),s}getRemainingAttributes(e,t){var a;return(Wt(e)[t]||0)-((null===(a=e.attributeLoss)||void 0===a?void 0:a[t])||0)}getSelectedCharacters(){return this.selectedCharacters}getRandomRace(){const e=Object.values($e);return e[Math.floor(Math.random()*e.length)]}getRandomClass(){const e=Object.values(et);return e[Math.floor(Math.random()*e.length)]}getRandomIconNumber(){return Math.floor(2*Math.random())+1}getRandomIcon(e){switch(e){case $e.DWARF:return"dwarf_"+this.getRandomIconNumber();case $e.ELF:return"elf_"+this.getRandomIconNumber();case $e.HUMAN:return"human_"+this.getRandomIconNumber();case $e.HALF_ORC:return"halfOrc_"+this.getRandomIconNumber();case $e.HALF_ELF:return"halfElf_"+this.getRandomIconNumber();case $e.HALFLING:return"halfling_"+this.getRandomIconNumber();default:return"human_"+this.getRandomIconNumber()}}generateStartingGear(){switch(Math.floor(6*Math.random())){case 0:return[Ht.SWORD_1];case 1:return[Ht.WAND_5];case 2:return[Ht.HELPFUL_IMP];default:return[]}}getRandomGear(){const e=Object.keys(Ht),t=Math.floor(Math.random()*e.length);return Ht[e[t]]}assignGear(e,t){void 0===Ht[t]&&(console.error("Gear not found: "+t),t=Object.keys(Ht).find((e=>Ht[e].name===t))||"");const a=Ht[t];a?e.gear.push(a):console.error("Gear not found: "+t)}getAllExpectedBackstoryTags(){const e=this.characters.flatMap((e=>e.backstory.filter((e=>!e.completed)).map((e=>e.tag))));return[...new Set(e)]}getCharactersWithBackstoryTag(e){return this.characters.filter((t=>t.backstory.some((t=>t.tag===e))))}assignBackstory(e,t){const a=e.backstory.find((e=>e.tag===t));if(a)a.completed=!0;else{const a={tag:t,completed:!1,description:void 0};e.backstory.push(a)}const n=this.appManager.getPlayerManager().getPlayerAssignedCharacter(e);n&&this.appManager.getPlayerManager().addPlayerExp(n,1)}generateRandomCharacter(e){return this.generateSingleCharacter(e||1)}generateSingleCharacter(e){const t=this.getRandomClass(),a=this.getRandomRace();return{name:dr(!0),race:a,character_class:t,level:e||1+Math.floor(4*Math.random()),experience:Math.floor(50*Math.random())+0,icon:this.getRandomIcon(a),abilities:[],id:this.uniqueID++,gear:this.generateStartingGear(),backstory:[]}}generateRandomCharacters(e,t){for(let a=0;a<e;a++)this.characters.push(this.generateSingleCharacter(t||1))}generateNPC(e){return{race:$e.NPC,character_class:et.NPC,abilities:[],level:1,experience:0,name:e.name,id:this.uniqueID++,icon:`combat_${e.name}`,gear:[],backstory:[]}}initiateQuickStart(){this.characters=hr}characterAction(e,t){const a=this.getCharacterById(e);if(!a)return;const n=void 0!==t?t:Math.floor(5*Math.random())+1;a.experience=Math.min(100,a.experience+n)}},Nr={MAIN_MENU:{title:"Welcome to Dungeon Master Simulator!",content:[{withHTML:"\n        <h1>Welcome!</h1>\n        <p>Thanks for trying out my game, the latest version is version 0.0.1 from Dec 22, 2024. It is still very much in the early stages.<br><br>This is a game about running a fantasy-tabletop RPG. Instead of exploring, adventuring, and conquering, this is a game about scheduling players, designing balanced encounters, managing potential branches in storylines, and above all keeping your players happy!</p>\n        <p>At the moment the only things available are:</p>\n        <ul>\n            <li>Player Recruitment</li>\n            <li>Character Assignment</li>\n            <li>Campaign Selection</li>\n        </ul>\n        <p> Get started by going to Player Recruitment</p>\n        <br>\n        <h1>COMING SOON</h1>\n        <ul>\n            <li>Player chatter / message system</li>\n            <li>Campaign settings / launch game</li>\n        </ul>\n         <h1>COMING LATER</h1>\n          <ul>\n            <li>Rest of game</li>\n        </ul>\n    "}.withHTML],icons:["tutorial_mascot","tutorial_mascot","tutorial_mascot"]},PLAYER_RECRUITMENT:{title:"Player Recruitment",content:["\n        <h1>PLAYERS</h1>\n        <p>Players are your clients. After a successful campaign, they will reward you with money and respect. You'll want to recruit players with similar, or complimentary preferences (LIKES/HATES), as well as making sure their schedules are compatible.<br><br>To see a player's preferences, hover over the red or green dots on their player card. When you click a player it will be added to the group, and you will see the player's preferences added to the notebook on the left. The notebook will also contain a page for each player.</p>\n        <p>I think three players is a good number to go for. I have a feeling the game will be more difficult to play with more players - as keeping them all happy and juggling other game elements with high player-counts may prove difficult. having more players would also logically lead to getting paid more at the end of the campaign so it could be a nice synergy of difficulty and reward scaling on its own.</p>\n        \n        <br>","\n        <h1>Notes</h1>\n        <ul>\n            <li>I have a new design for the player-cards in mind. I realize they are very busy now.</li>\n            <li>Im not sure how scheduling will work out in the game. Im hesitant to remove it because it provides a bit of a counter to simply matching LIKES/HATES of players. Im thinking that a better-schedule might impact some elements of the actual gameplay later on, even if it's just a points-multiplier at the end if you have a good schedule-synergy...give me ideas!</li>\n            <li>I'm thinking of adding more player-stats. Things like stamina, or focus, which would come into play during sessions. Some players may tolerate certain gameplay elements outside of simply liking/hating based on the metadata tags. \n        </ul>\n        <p>Once you have some Players, head over to Character Assignment to assign them some characters.</p>\n    "],icons:["tutorial_mascot","tutorial_mascot"]},CHARACTER_CREATION:{title:"Character Creation",content:["\n        <h1>CHARACTERS</h1>\n        <p>Characters are what you are probably used to in a game. These are the wizards, fighters, elves, dwarves, etc.. Characters are assigned to Players. At the moment, there is a four Character limit for each player, and I feel like that's a lot. Im not sure what the tradeoff is in the Player:Character ratio though.</p>\n        <br>The Character stats are about as far into the 'game within the game' as I'd like to get. Id like for there to be some simple mechanics that can be used to make these stats important or fun though.</p>\n        <p>I'm also not sure what the limit should be for a player to have a higher level character. As a Dungeon Master, having higher level characters at your table isn't a reward in itself, but it might be a fun element of progression in the game. As you get to know your players and play with them over multiple campaigns, maybe the same would be true with the Characters.</p>\n        <p>Once you have some Characters, head over to Campaign Setup to start a campaign.</p>\n    "],icons:["tutorial_mascot"]},CAMPAIGN_SETUP:{title:"Campaign Setup",content:["\n    <h1>Campaigns</h1>\n    <p>Campaigns are the storyline of the game you are presenting to your players. A Campaign is composed of a series of events, called 'encounters'.\n    <br>Encounters all have different features, including a Location and some number of characteristics. For example, an encounter called 'Goblin Ambush' may feature a Location 'Forest' and have characteristics like 'goblins', 'combat', forest', 'wilderness', 'night', etc.. Any of which may be things certain players prefer (or prefer to avoid!)\n    <p>During the encounter, the players will uncover the different features and react to them based on their preferences. They will also be uncovering information about the <i>upcoming<i> encounters. This will then lead to the players choosing which branching encounter to go to next. Some encounters may be more rewarding than others, so there will be ways to try and 'steer' the player's decisions, but there will still be an element of randomness, and if you try to put too much emphasis on ONE encounter over the others there will be some penalty.</p>\n    ","\n        <h1>Notes</h1>\n        <ul>\n            <li>I actually really like the design of this screen. I'd like to achieve this level of style in the rest of the game.</p> \n            <li>Making the encounters is pretty fun too. I like being able to tell the idea of a story - it allows for so much potential in terms of the details that could all <i>possibly</i> exist. \n            <li>I plan to make the actual CREATING of campaigns, encounters, and location possible. I find the idea of making an in-game editor a bit daunting, to be honest so I'll probably circle back to that closer to the end of the first full version of this game.</li>\n        \n        </ul>\n"],icons:["tutorial_mascot","tutorial_mascot"]}};class Tr extends ln.EventEmitter{constructor(e){super(),this.appManager=void 0,this.uiManager=void 0,this.seenTutorials=new Set,this.turnOffTutorials=!1,this.appManager=e,this.uiManager=this.appManager.getUiManager(),this.seenTutorials=new Set}startTutorial(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.turnOffTutorials||this.seenTutorials.has(e)&&!t||this.uiManager.showTutorialMessage(Nr[e])}disableTutorial(){this.turnOffTutorials=!0}}const Cr=Tr,Ar=20,Sr=0,Mr=15;const jr=class{constructor(){this.apiKey=null,this.baseUrl="https://api.openai.com/v1",this.model="gpt-3.5-turbo",this.enabled=!1,this.loadConfiguration()}loadConfiguration(){const e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_OPENAI_API_KEY||localStorage.getItem("llm_api_key");e&&(this.apiKey=e,this.enabled=!0)}setApiKey(e){this.apiKey=e,this.enabled=!0,localStorage.setItem("llm_api_key",e)}setConfiguration(e){e.baseUrl&&(this.baseUrl=e.baseUrl),e.model&&(this.model=e.model)}isEnabled(){return this.enabled&&null!==this.apiKey}async generateContextualResponse(e){if(!this.isEnabled())return null;try{const t=this.buildPrompt(e);console.log("LLM Prompt:",t);const a=await this.callLLM(t);return this.parseResponse(a,e)}catch(t){return console.error("LLM Service Error:",t),null}}getGameContextPrompt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t.eventType){case nt.CHALLENGE:return`The player(s) or DM must discuss how ${e.name} helps them overcome a challenge with the description: ${t.challengeDescription||" something difficult"}  ${t.attribute||" skills"}`;case nt.ROLEPLAY:default:return`The player(s) or DM should casually mention ${e.name}`}}buildPrompt(e){const{tag:t,gameContext:a,theme:n,participants:s,speakerType:r,partyTension:i,recentTopics:o}=e;let l="";n&&"none"!==n&&(l=`The ${t.name} should be treated with a ${n} attitude`);let c="";3*Math.random()<1&&(i<10?c="the party is bored and the message should reflect this":i>80&&(c="the party mood is very tense and the message tone should reflect this."));let d="";100*Math.random()<Ar&&(d=`The current location ${a.location} should be mentioned.`);let u="";if(o&&100*Math.random()<Mr){u=`the message should refer to ${o[Math.floor(Math.random()*o.length)]} as potentially related`}let h=`You are a helpful assistant for a tabletop RPG game. \n    Generate short contextual dialogue for the following situation. \n    \n    GAME CONTEXT: ${this.getGameContextPrompt(t,a)}\n    ${l}\n    ${c}\n    ${d}\n    ${u}\n    The message should be short and nonspecific, like a casual remark.\n`;return h+=100*Math.random()<=Sr?`return a JSON object representing the conversation as an array with the structure such that each message in the converstation is an object with this structure :\n\n{\n  "message": "The actual dialogue text",\n  "speaker": "dm" | "player" | "character",\n  "speakerId": ${(null===s||void 0===s?void 0:s[0])||0},\n  }`:`Return a JSON object with this structure:\n{\n  "message": "The actual dialogue text",\n  "speaker": ${r},\n  "speakerId": ${null===s||void 0===s?void 0:s[0]},\n}`,h}async callLLM(e){if(!this.apiKey)throw new Error("No API key configured");const t=await fetch(`${this.baseUrl}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify({model:this.model,messages:[{role:"user",content:e}],temperature:.8,max_tokens:150})});if(!t.ok)throw new Error(`LLM API Error: ${t.status} ${t.statusText}`);return(await t.json()).choices[0].message.content}parseResponse(e,t){try{const t=JSON.parse(e);return Array.isArray(t),{message:t.message||e,speaker:t.speaker||"dm",speakerId:t.speakerId,confidence:t.confidence||.7}}catch(a){return{message:e.trim(),speaker:"dm",confidence:.5}}}generateFallbackResponse(e,t){const a=[`Oh! That ${e.name} is interesting given our current situation...`,`${e.name}... that reminds me of something important.`,`Hmm, ${e.name} could be significant here.`,`I wonder if that ${e.name} is connected to what we're doing...`,`${e.name}? That's unexpected in this context.`];return{message:a[Math.floor(Math.random()*a.length)],speaker:{type:r.wb.DM,id:0}}}toLLMResponseToChatMessage(e){let t;switch(e.speaker){case"player":t=r.wb.PLAYER;break;case"character":t=r.wb.CHARACTER;break;default:t=r.wb.DM}const a=e.debugInfo||"";return{message:e.message+a,speaker:{type:t,id:e.speakerId||0}}}};class wr extends(cn()){constructor(e){super(),this.appManager=void 0,this.gameEvents=[],this.maxEvents=50,this.appManager=e}logEvent(e){const t={...e,id:this.generateEventId(),timestamp:Date.now()};this.gameEvents.push(t),this.gameEvents.length>this.maxEvents&&(this.gameEvents=this.gameEvents.slice(-this.maxEvents)),this.emit("gameEvent",t)}getGameContext(){var e,t,a,n,s;const r=this.appManager.getCampaignManager(),i=this.appManager.getPlayerManager();return{currentLocation:(null===(e=r.getCurrentEncounter())||void 0===e?void 0:e.location)||null,currentEncounter:r.getCurrentEncounter()||null,recentEvents:this.gameEvents.slice(-10),discoveredTags:this.appManager.getTagManager().getCollectedTags(),activeCharacters:i.getPlayers().flatMap((e=>e.characters)),currentTheme:(null===(t=r.getCurrentEncounter())||void 0===t||null===(a=t.location)||void 0===a||null===(n=a.themes)||void 0===n?void 0:n[0])||"fantasy",sessionDuration:Date.now()-((null===(s=this.gameEvents[0])||void 0===s?void 0:s.timestamp)||Date.now()),mood:this.inferCurrentMood()}}getContextSummary(){const e=this.getGameContext(),t=e.recentEvents.slice(-5);let a="";if(e.currentLocation&&(a+=`Current Location: ${e.currentLocation.name} - ${e.currentLocation.description}\n`),e.currentEncounter&&(a+=`Current Encounter: ${e.currentEncounter.name} - ${e.currentEncounter.description}\n`),a+=`Current Theme: ${e.currentTheme}\n`,a+=`Current Mood: ${e.mood}\n`,t.length>0&&(a+="\nRecent Events:\n",t.forEach((e=>{a+=`- ${e.description}\n`}))),e.discoveredTags.length>0){const t=e.discoveredTags.slice(-5);a+=`\nRecently Discovered: ${t.map((e=>e.name)).join(", ")}\n`}return a}inferCurrentMood(){const e=this.gameEvents.slice(-3);for(const a of e.reverse()){var t;if("combat_start"===a.type)return"tense";if("combat_end"===a.type&&"success"===a.details.outcome)return"excited";if("tag_discovered"===a.type&&null!==(t=a.details.tag)&&void 0!==t&&t.name.toLowerCase().includes("mystery"))return"mysterious";if("failure"===a.details.outcome)return"dramatic"}return"relaxed"}generateEventId(){return`evt_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}logEncounterStart(e){this.logEvent({type:"encounter_start",description:`Started encounter: ${e.name} at ${e.location.name}`,details:{encounter:e,location:e.location}})}logTagDiscovered(e,t){this.logEvent({type:"tag_discovered",description:`Discovered ${e.name}${t?` ${t}`:""}`,details:{tag:e}})}logCombatStart(e){this.logEvent({type:"combat_start",description:`Combat started against ${e.join(", ")}`,details:{participants:e}})}logCombatEnd(e,t){this.logEvent({type:"combat_end",description:`Combat ended in ${e}${t?`: ${t}`:""}`,details:{outcome:e}})}logConversation(e,t){this.logEvent({type:"conversation",description:`Conversation about ${t}`,details:{participants:e,topic:t}})}}const Rr=wr;class kr extends(cn()){constructor(e){super(),this.appManager=void 0,this.playerManager=void 0,this.characterManager=void 0,this._tagManager=void 0,this.llmService=void 0,this.gameContextManager=void 0,this.recentTopics=[],this.messageQueue=[],this.isProcessingQueue=!1,this.messageDelay=3e3,this.currentTimeout=null,this.messageHistory=[],this.recentMessages=[],this.conversationMessageIds=[],this.isInConversation=!1,this.conversations={WELCOME_CONVERSATION:[{message:"Hello everyone, welcome to the game. Have a seat and grab some snacks. I'm just looking over my notes and we will start in a moment.",speaker:{type:r.wb.DM,id:0}},{message:"Where are the snacks?",speaker:{type:r.wb.PLAYER,id:2}},{message:"Can I sit here?",speaker:{type:r.wb.PLAYER,id:1}},{message:"I apologize in advance, Im in kind of a bad mood tonight. I even have a red bar by my name.",speaker:{type:r.wb.PLAYER,id:0}},{message:"Everyone settled? We start in the Village of Fairlight during the Fairlight Festival. You should listen for gossip about some cursed fog you've heard of. Maybe the Village Elder knows something.",speaker:{type:r.wb.DM,id:0}}]},this.appManager=e,this.playerManager=this.appManager.getPlayerManager(),this.characterManager=this.appManager.getCharacterManager(),this.llmService=new jr,this.gameContextManager=new Rr(e)}get tagManager(){return this._tagManager||(this._tagManager=this.appManager.getTagManager()),this._tagManager}set tagManager(e){this._tagManager=e}fireNewChatMessage(e,t){const a=(null===t||void 0===t?void 0:t.speed)||"normal";if(Array.isArray(e)){const t=e.map((e=>({...e,_speed:a})));this.messageQueue.push(...t)}else{const t="string"===typeof e?{message:e,speaker:{type:r.wb.DM,id:0},_speed:a}:{...e,_speed:a};this.messageQueue.push(t)}this.isProcessingQueue||this.processMessageQueue()}async processMessageQueue(){if(0===this.messageQueue.length)return this.isProcessingQueue=!1,this.currentTimeout=null,this.isInConversation=!1,void(this.conversationMessageIds=[]);this.isProcessingQueue=!0;const e=this.messageQueue[0],t=`msg-${Date.now()}-${Math.random()}`,a=this.messageQueue.length>1,n=this.isInConversation;a||n?(this.isInConversation=!0,this.conversationMessageIds.push(t)):(this.isInConversation=!1,this.conversationMessageIds=[t]);const{_speed:s,...r}=e,i={...r,timestamp:r.timestamp||Date.now()};for(this.messageHistory.push(i),this.recentMessages.push(i);this.recentMessages.length>20;)this.recentMessages.shift();this.emit("chat-message",{...i,messageId:t,hasMoreMessages:a,isNewConversation:!n&&a,conversationIds:[...this.conversationMessageIds],isLastInConversation:!a&&this.isInConversation});const o=a,l="fast"===e._speed;let c=0;o&&(c=l?e.message.length>42?400:200:e.message.length>42?2*this.messageDelay:this.messageDelay),this.currentTimeout=setTimeout((()=>{this.messageQueue.shift(),this.processMessageQueue()}),c)}advanceQueue(){this.messageQueue.length>0&&this.currentTimeout&&(clearTimeout(this.currentTimeout),this.currentTimeout=null,this.messageQueue.shift(),this.processMessageQueue())}playerMessage(e,t){let a;a=Array.isArray(e)?e[Math.floor(Math.random()*e.length)]:e;const n=null!==t&&void 0!==t?t:this.playerManager.getRandomPlayer().id,s={message:a,speaker:{type:r.wb.PLAYER,id:n}};this.fireNewChatMessage(s)}dmMessage(e){let t;t=Array.isArray(e)?e[Math.floor(Math.random()*e.length)]:e;const a={message:t,speaker:{type:r.wb.DM,id:0}};this.fireNewChatMessage(a)}launchNewConversationById(e){const t=this.conversations[e];t?this.fireNewChatMessage(t):console.error("Conversation not found: ",e)}launchNewConversation(e){this.fireNewChatMessage(e)}startSessionEvent(){}perceptionEvent(e,t){let a="",n=!1;if(t.tags.forEach((e=>{this.tagResolved_badFunctionDontUse(e.tag)&&(n=!0)})),n)return;switch(t.type){case r.lM.CURRENT_LOCATION:a=`${t.tags[0].tag.name}? Pretty much what I would expect from a ${t.name}.`;break;case r.lM.BRANCH_LOCATION:a=`Hmm. Sounds like we know where to look for ${t.tags[0].tag.name}...`;break;case r.lM.CHARACTER_BACKSTORY:a="OH. MY. GOSH.";break;case r.lM.CHARACTER_BACKSTORY_PROGRESS:a=`AT LAST! My character has been searching for ${t.tags[0].tag.name}.`;break;case r.lM.MAGIC_ITEM:a="Magic item? I'm intrigued.";break;case r.lM.PLOT_HOOK:const n=[{message:"I have a feeling this is going to be important",speaker:{type:r.wb.PLAYER,id:e.id}},{message:"... in a few months.",speaker:{type:r.wb.PLAYER,id:this.playerManager.getRandomPlayer().id}}];return void this.launchNewConversation(n)}const s={message:a,speaker:{type:r.wb.PLAYER,id:e.id}};this.fireNewChatMessage(s)}chance(e){return 100*Math.random()<e}getThemePostFix(e){switch(e.theme){case"comedic":return" in a comedic way";case"heroic":return" in a heroic way";case"serious":return" in a serious way";case"dramatic":return" in a dramatic way";case"grim":return" in a grim way";case"romantic":return" in a romantic way";case"fantasy":return" in a fantasy way";case"horror":return" in a horror way"}return""}getEncounterTagPrefix(e){const t=e.source;return t===r.UW.LOCATION?"Set the Scene: ":t===r.UW.ENCOUNTER?"Encounter Event: ":""}triggerCharacterBackstoryResponse(e,t){let a="",n=this.playerManager.getPlayerAssignedCharacter(t)||this.playerManager.getRandomPlayer(),s=r.wb.DM,i=0;switch(Math.floor(5*Math.random())){case 0:a=`I never expected to find ${e.tag.name} here.`,s=r.wb.PLAYER,i=n.id;break;case 1:a=`${t.name} you discovered that ${e.tag.name} were looking for`;break;case 2:a=`${e.tag.name} has been on your ${t.name}'s mind for a while...behold, ${e.tag.name}!`;break;case 3:a=`I HAVE BEEN WAITING FOR ${e.tag.name.toUpperCase()} FOREVER!`,s=r.wb.CHARACTER,i=n.id;break;default:a=`You find ${e.tag.name} in a place you never expected.`}const o={message:a,speaker:{type:s,id:i}};this.fireNewChatMessage(o)}triggerSpecialRPTagChat(e){if("character"===e.type){const t=e.character;this.dmMessage(`We are going to focus on ${t.name} for a while...`)}"treasure"===e.type&&this.dmMessage("You guys discover.... some treasure!"),"dmpoint"===e.type&&this.dmMessage("Something just clicked for me! Im getting better at this...")}triggerChatFromTag(e){let t=this.playerManager.getRandomPlayer(),a="maxim broke something, haha",n=t.id,s=r.wb.PLAYER;if(this.chance(50)&&this.tagManager.magicItemRumors.includes(e.tag))return this.magicItemConversation(e.tag.name,t.id),!0;if(this.chance(50)&&"none"!==e.theme)return this.themeConversation(e,t.id),!0;const i=this.playerManager.getPlayers();if(this.tagManager.getOutstandingBackstoryTags().includes(e.tag)){const n=this.characterManager.getCharactersWithBackstoryTag(e.tag)[0];t=this.playerManager.getPlayerAssignedCharacter(n)||t,a=`${n.name} was looking for ${e.tag.name}!`}else if(this.chance(50)&&this.playerManager.getGroupAttitudeForTag(i,e.tag)!==r.zo.NEUTRAL){if(this.playerManager.getGroupAttitudeForTag(i,e.tag)===r.zo.HATE)t=this.playerManager.getPlayerWithAttitudeForTag(e.tag,r.zo.HATE),a=`Ick. ${e.tag.name}.`;else if(this.playerManager.getGroupAttitudeForTag(i,e.tag)===r.zo.LIKE)t=this.playerManager.getPlayerWithAttitudeForTag(e.tag,r.zo.LIKE),a=`Oooh, I like ${e.tag.name}.`;else if(this.playerManager.getGroupAttitudeForTag(i,e.tag)===r.zo.CONFLICTED){var o,l,c;t=this.playerManager.getPlayerWithAttitudeForTag(e.tag,r.zo.LIKE);let a=this.playerManager.getPlayerWithAttitudeForTag(e.tag,r.zo.HATE),n=null!==(o=null===(l=t)||void 0===l?void 0:l.id)&&void 0!==o?o:0,s=null!==(c=null===a||void 0===a?void 0:a.id)&&void 0!==c?c:0;const i=[{message:`Ugh. I'm sick of ${e.tag.name}!`,speaker:{type:r.wb.PLAYER,id:s}},{message:`...I like ${e.tag.name}.`,speaker:{type:r.wb.PLAYER,id:n}}];return this.launchNewConversation(i),!0}}else switch(Math.floor(7*Math.random())){case 0:a=`What do we think about ${e.tag.name}?`;break;case 1:a=`You remember something about ${e.tag.name} ...`,s=r.wb.DM;break;case 2:a=`I was hoping ${e.tag.name} would come up!`;break;case 3:a=`Can ${e.tag.name} be important?`;break;case 4:a=`${e.tag.name}? ok.`;break;case 5:a=`${e.tag.name} reminds me of gob${e.tag.name}lins.`;break;case 6:a=`You overhear someone talking about ${e.tag.name}.`,s=r.wb.DM}const d={message:a,speaker:{type:s,id:n}};return this.fireNewChatMessage(d),!0}tagResolved_badFunctionDontUse(e){const t=this.appManager.getCampaignManager().getEncounterChatTriggers(),a=null===t||void 0===t?void 0:t[e.name];return!!a&&(this.fireNewChatMessage(a),!0)}triggerAddRandomTagToEncounterConversation(e,t){const a=[[{message:`Thinking: "Hmmm....should I add ${e.name} to the ${t.name} encounter....?"`,speaker:{type:r.wb.DM,id:0}},{message:"Hey!...why are you so quiet? What are you thinking about?",speaker:{type:r.wb.PLAYER,id:this.playerManager.getRandomPlayer().id}},{message:`Oh, nothing...just thinking about how much you guys are going to love ${e.name} if you go to ${t.location.name}...`,speaker:{type:r.wb.DM,id:0}}],[{message:`Why do I get the feeling we will find ${e.name} at ${t.location.name}?`,speaker:{type:r.wb.PLAYER,id:this.playerManager.getRandomPlayer().id}},{message:"Yeah, sure. Why not?",speaker:{type:r.wb.DM,id:0}},{message:`You shrewdly devise that you will find ${e.name} at ${t.location.name}...`,speaker:{type:r.wb.DM,id:0}}],[{message:`Going off-script here - but I think it will be fun to have ${e.name} involved with the events at ${t.location.name}...`,speaker:{type:r.wb.DM,id:0}}],[{message:`I bet ${e.name} will be at ${t.location.name}!`,speaker:{type:r.wb.PLAYER,id:this.playerManager.getRandomPlayer().id}},{message:"Why? I don't think I ever indicated that th-",speaker:{type:r.wb.DM,id:0}},{message:`Oh man! I bet you're right! If we get to ${t.location.name} we are sure to find ${e.name}!`,speaker:{type:r.wb.PLAYER,id:this.playerManager.getRandomPlayer().id}}]],n=a[Math.floor(Math.random()*a.length)];this.launchNewConversation(n)}magicItemConversation(e,t){const a=[{message:`Behold....the ${e}...`,speaker:{type:r.wb.PLAYER,id:t}},{message:"Say it in-character",speaker:{type:r.wb.DM,id:this.playerManager.getRandomPlayer().id}},{message:`Behold....the ${e}...`,speaker:{type:r.wb.CHARACTER,id:t}}];this.launchNewConversation(a)}themeConversation(e,t){let a="",n=t,s=r.wb.PLAYER;switch(e.theme){case"comedic":a=`Heheh..."${e.tag.name}"`;break;case"grim":a=`I need to tell you something disturbing about ${e.tag.name}.`,s=r.wb.DM;break;case"fantasy":a=`I sometimes daydream about ${e.tag.name}.`;break;case"heroic":a=`Yeah! ${e.tag.name}!!!`,s=r.wb.CHARACTER;break;case"horror":a=`A chill descends on the party as they think about ${e.tag.name}.`,s=r.wb.DM;break;case"romantic":a=`OOoooooOOOoo ${e.tag.name}. Kissy kissy!`;break;case"serious":a=`We should focus on ${e.tag.name}.`;break;case"dramatic":a=`BEHOLD! ${e.tag.name}!!!`,s=r.wb.CHARACTER}const i={message:a,speaker:{type:s,id:n}};this.fireNewChatMessage(i)}sayCombatModifiedMessage(e,t,a,n){let s="";s="DM"===t.name?"heroes"===e?`The ${a.name} are not as strong as you first thought...`:`Oops, the ${a.name} have more HP than regular...`:n<0?`Nevermind about the ${t.name}...`:"heroes"===e?t.enemy||t.friendly?`Some ${t.name} are distracting the ${a.name}!`:`The ${a.name} get stuck trying to avoid the ${t.name}.`:t.enemy||t.friendly?`The ${a.name} seem to have some ${t.name} on their side...`:`The ${a.name} use the ${t.name} to their advantage.`;const i={message:s,speaker:{type:r.wb.DM,id:0}};this.fireNewChatMessage(i)}combatIntroMessage(e){const t=this.playerManager.getGroupAttitudeForTag(this.playerManager.getPlayers(),e);let a="",n=this.playerManager.getRandomPlayer();t===r.zo.LIKE?(a=`Yay! ${e.name} are my favorite!`,n=this.playerManager.getPlayerWithAttitudeForTag(e,r.zo.LIKE)||n):t===r.zo.HATE?(n=this.playerManager.getPlayerWithAttitudeForTag(e,r.zo.HATE)||n,a=`Ugh. I hate ${e.name}. Why do we even have them in the game?`):t===r.zo.CONFLICTED?(a=`Well, I know some people don't like ${e.name}, but I like em.`,n=this.playerManager.getPlayerWithAttitudeForTag(e,r.zo.LIKE)||n):a=`I figured we'd fight ${e.name} eventually.`;const s={message:a,speaker:{type:r.wb.PLAYER,id:n.id}};this.dmMessage("You guys enter combat with some "+e.name),setTimeout((()=>{this.fireNewChatMessage(s)}),5e3)}startWelcomeConversation(){this.launchNewConversationById("WELCOME_CONVERSATION")}getConversationById(e){return this.conversations[e]||null}getLLMService(){return this.llmService}getGameContextManager(){return this.gameContextManager}trackRecentTopic(e){this.recentTopics.push(e.name),this.recentTopics.length>10&&this.recentTopics.shift()}async triggerEnhancedChatFromTag(e,t,a){var n;const s=this.appManager.getCampaignManager().getCurrentEvent(),r=this.appManager.getCampaignManager().getCurrentEncounter(),i={location:(null===r||void 0===r||null===(n=r.location)||void 0===n?void 0:n.name)||"unknown location",eventType:(null===s||void 0===s?void 0:s.type)||nt.ROLEPLAY};var o;(null===s||void 0===s?void 0:s.type)===nt.CHALLENGE&&(i.challengeDescription=(null===r||void 0===r||null===(o=r.challenge)||void 0===o?void 0:o[0].description)||null);if(this.llmService.isEnabled())try{const a=Math.random()<.4?"player":Math.random()<.3?"character":"dm",n=await this.llmService.generateContextualResponse({tag:e.tag,gameContext:i,theme:e.theme.toString(),participants:t?[t.id]:[0],recentTopics:this.recentTopics,speakerType:a,partyTension:this.appManager.getPartyManager().getPartyTension()});if(n&&n.confidence>.6){const t=this.llmService.toLLMResponseToChatMessage(n);return this.fireNewChatMessage(t),this.gameContextManager.logConversation([n.speaker],`Discussion about ${e.tag.name}`),!0}}catch(l){console.warn("LLM response failed, falling back to enhanced generic:",l)}return a?a(e,t):this.triggerChatFromTag(e),!0}logEncounterStart(e){this.gameContextManager.logEncounterStart(e)}logTagDiscovered(e,t){this.gameContextManager.logTagDiscovered(e,t)}logCombatStart(e){this.gameContextManager.logCombatStart(e)}logCombatEnd(e,t){this.gameContextManager.logCombatEnd(e,t)}triggerCollectionCompleteChat(e){const t=ds.TAG_COLLECTIONS.find((t=>t.name===e));t&&this.fireNewChatMessage(t.chat)}getMessageHistory(){return[...this.messageHistory]}getRecentMessages(){return[...this.recentMessages]}triggerChallengeAssistChat(e,t){if(t&&e){const a=this.tagManager.tagToFlavorTag(e),n=this.playerManager.getPlayerAssignedCharacter(t);this.triggerEnhancedChatFromTag(a,n,(async e=>{const a=`${t.name} uses their ${e.tag.name} to assist in the challenge!`;return this.dmMessage(a),!0}))}}}const Ir=kr;class Or extends(cn()){constructor(e){super(),this.appManager=void 0,this.eventHistory=[],this.appManager=e}addEvent(e,t,a,n){const s={type:e,title:t,subtitle:a,data:n,timestamp:Date.now()};this.eventHistory.push(s),this.emit("chat-event",s)}addCampaignStartEvent(e){this.addEvent(r.p6.CAMPAIGN_START,e)}addEncounterEvent(e,t){const a=this.getEncounterEventDescription(e);this.addEvent(r.p6.ENCOUNTER_EVENT,a,t,{eventType:e})}addLocationChangeEvent(e){this.addEvent(r.p6.LOCATION_CHANGE,"Location Change",e)}addCombatStartEvent(e){this.addEvent(r.p6.COMBAT_START,"Combat Started",e)}addCombatEndEvent(e){this.addEvent(r.p6.COMBAT_END,"Combat Ended",e)}getEventHistory(){return[...this.eventHistory]}getEncounterEventDescription(e){switch(e){case nt.COMBAT:return"Combat";case nt.ROLEPLAY:return"Roleplaying";case nt.PUZZLE:return"Puzzle";case nt.DUNGEON:return"Dungeon Crawl";case nt.PERCEPTION:return"Perception Check";case nt.TOWN:return"Town Stuff";case nt.TRAVEL:return"Travel";case nt.CHALLENGE:return"Skill Challenge";case nt.TRAP:return"Trap";case nt.CHARACTER_BACKSTORY:return"Backstory";case nt.STORY:return"Story";case nt.EXPLORATION:return"Exploration";default:return"Unknown Event"}}}const Lr=Or;const Pr=class{constructor(e){this.appManager=void 0,this.partyManager=void 0,this.playerManager=void 0,this.campaignManager=void 0,this.tagManager=void 0,this.appManager=e,this.tagManager=e.getTagManager(),this.partyManager=this.appManager.getPartyManager(),this.playerManager=this.appManager.getPlayerManager(),this.campaignManager=this.appManager.getCampaignManager()}getTagsForBuilding(e){let t=[...e.tags];const a=this.tagManager.getCollectedTags();if(t=t.filter((e=>!a.some((t=>t.name===e.name)))),e.addFriendlyTags){const e=this.tagManager.getRandomFriendlyTags(1,!1);t=[...t,...e]}if(e.allowMagicItems){const e=this.tagManager.getRandomMagicItemTag(1);t=[...t,...e]}const n=this.tagManager.getOutstandingLocationTags(),s=this.tagManager.getUpcomingEncounterTags(),i=this.tagManager.getOutstandingBackstoryTags(),o=(e.nbTags||5)-t.length,l=[...n,...s,...i],c=new Set(t);for(;c.size<o&&c.size<l.length;){const e=l[Math.floor(Math.random()*l.length)];c.add(e)}let d=[];return c.forEach((e=>{d.push({tag:e,source:this.tagManager.getFormattedSource(e,r.UW.ALL),theme:this.tagManager.getTheme()})})),d}townBuildingAssigned(e,t){const a=this.playerManager.getPlayerAssignedCharacter(e);a&&(this.partyManager.playersTakeAction([a.name],!0,1),this.partyManager.stressAction([a])),this.appManager.getChatManager().playerMessage(`${e.name} will head towards the ${t.building.name}`,null===a||void 0===a?void 0:a.id)}townBuildingResolved(e,t,a){const n=this.playerManager.getPlayerAssignedCharacter(e),s=[];let i=[],o=[],l=[];return l.push({effect:"+1 Player experience",class:"player-experience"}),l.push({effect:"+1 Attention",class:"player-attention"}),o.push({effect:"other players -1 Attention",class:"party-experience"}),[...t.effects,...t.positionEffects[a]||[]].forEach((a=>{if(a.chance&&Math.random()>a.chance)return;const n=this.formatBuildingEffect(a),s=this.getBuildingEffectClass(a);switch(a.type){case r.Cu.HEAL:case r.Cu.RESURRECT:case r.Cu.INJURE:case r.Cu.USE_MAGIC:case r.Cu.USE_TOOLS:case r.Cu.REPLENISH_MAGIC:case r.Cu.REPLENISH_TOOLS:i.push({effect:n,class:s});break;case r.Cu.ADD_TENSION:case r.Cu.ADD_ENJOYMENT:o.push({effect:n,class:s})}this.applyBuildingEffect(a,e,t)})),i.length>0&&s.push({object:e,effects:i}),l.length>0&&n&&s.push({object:n,effects:l}),o.length>0&&s.push({object:"party",effects:o}),t.capacity=0,{results:s,title:`${t.building.name} Results`,description:`${e.name} visits the ${t.building.name}`,tags:this.getTagsForBuilding(t.building),travelOption:{tagInstructions:"Select a topic"},info:{building:t.building.name,character:e.name,player:null===n||void 0===n?void 0:n.name}}}applyBuildingEffect(e,t,a){switch(t.attributeLoss||(t.attributeLoss={}),e.type){case r.Cu.HEAL:t.injury=void 0;break;case r.Cu.RESURRECT:t.injury=void 0,t.attributeLoss={};break;case r.Cu.INJURE:t.injury="injured";break;case r.Cu.ADD_TENSION:this.partyManager.addPartyTension(e.value);break;case r.Cu.ADD_ENJOYMENT:this.partyManager.addPartyEnjoyment(e.value);break;case r.Cu.CAMPAIGN_POINT:this.campaignManager.addEncounterPoints(e.value);break;case r.Cu.REPLENISH_MAGIC:t.attributeLoss[r.Eh.MAGIC]=0;break;case r.Cu.REPLENISH_TOOLS:t.attributeLoss[r.Eh.TOOLS]=0;break;case r.Cu.USE_MAGIC:t.attributeLoss[r.Eh.MAGIC]=(t.attributeLoss[r.Eh.MAGIC]||0)+e.value;break;case r.Cu.USE_TOOLS:t.attributeLoss[r.Eh.TOOLS]=(t.attributeLoss[r.Eh.TOOLS]||0)+e.value;break;case r.Cu.ADD_TREASURE:this.partyManager.addTreasurePoints(e.value)}}formatBuildingEffect(e){switch(e.type){case r.Cu.HEAL:return"any Injuries Healed";case r.Cu.RESURRECT:return"Resurrected if dead";case r.Cu.INJURE:return"Injured!";case r.Cu.ADD_TENSION:return`${e.value>0?"+":""}${e.value} tension`;case r.Cu.ADD_ENJOYMENT:return`${e.value>0?"+":""}${e.value} attitude`;case r.Cu.ADD_REWARDS:return`${e.value} rewards`;case r.Cu.REPLENISH_MAGIC:return"Replenished \u2728";case r.Cu.REPLENISH_TOOLS:return"Replenished \ud83d\udd27";case r.Cu.USE_MAGIC:return"Used \u2728";case r.Cu.USE_TOOLS:return"Used \ud83d\udd27";case r.Cu.ADD_TREASURE:return`Found treasure (${e.value})`;default:return"Unknown effect"}}getBuildingEffectClass(e){switch(e.type){case r.Cu.HEAL:case r.Cu.REPLENISH_MAGIC:case r.Cu.REPLENISH_TOOLS:case r.Cu.RESURRECT:return"positive";case r.Cu.INJURE:case r.Cu.ADD_TENSION:case r.Cu.USE_TOOLS:case r.Cu.USE_MAGIC:return"negative";case r.Cu.ADD_REWARDS:case r.Cu.ADD_TREASURE:case r.Cu.ADD_ENJOYMENT:return"reward";default:return"neutral"}}};const Dr=class{set locationTagsCollected(e){this._locationTagsCollected=e}get locationTagsExpected(){return this._locationTagsExpected}set locationTagsExpected(e){this._locationTagsExpected=e}get encounterTagsCollected(){return this._encounterTagsCollected}set encounterTagsCollected(e){this._encounterTagsCollected=e}get encounterTagsExpected(){return this._encounterTagsExpected}set encounterTagsExpected(e){this._encounterTagsExpected=e}addMagicItemRumor(e){this._magicItemRumors.some((t=>t.name===e.name))||this._magicItemRumors.push(e)}get magicItemRumors(){return this._magicItemRumors}set magicItemRumors(e){this._magicItemRumors=e}get collectedTags(){return this._collectedTags}set collectedTags(e){this._collectedTags=e}collectLocationTag(e){this._locationTagsCollected.some((t=>t.name===e.name))||(this._locationTagsCollected.push(e),this.collectTag(e)),this._locationTagsCollected.length>=this._locationTagsExpected.length&&(this.triggerSetSceneModal(),this.appManager.getUiManager().setEventImageOpacity(1))}collectEncounterTag(e){var t;const a=this.campaignManager.getCurrentEncounter();let n=!1;if(!a)return!1;return!(a.tags||[]).some((t=>t.name===e.name))||null!==(t=this.encounterTagsCollected[a.name])&&void 0!==t&&t.some((t=>t.name===e.name))||(this.encounterTagsCollected[a.name]||(this.encounterTagsCollected[a.name]=[]),this.encounterTagsCollected[a.name].push(e),n=!0,this.triggerEncounterTagModal(e)),n}isTagCollected(e){return this.collectedTags.some((t=>t.name===e.name))}introduceNewTagForUpcomingBranch(e,t){e&&this.campaignManager.getCurrentEncounter()&&(e.tags.includes(t)||!this.encounterTagsExpected[e.name]||this.encounterTagsExpected[e.name].includes(t)||this.encounterTagsExpected[e.name].push(t))}collectUpcomingEncounterTag(e){const t=this.campaignManager.getCurrentEncounter();let a=!1;if(!t)return!1;return(t.branches||[]).forEach((t=>{if(this.encounterTagsExpected[t.name]){var n;!this.encounterTagsExpected[t.name].some((t=>t.name===e.name))||null!==(n=this.encounterTagsCollected[t.name])&&void 0!==n&&n.some((t=>t.name===e.name))||(this.encounterTagsCollected[t.name]||(this.encounterTagsCollected[t.name]=[]),this.encounterTagsCollected[t.name].push(e),a=!0)}})),a}getOutstandingQuestTags(){var e,t;return(null===(e=this.appManager)||void 0===e||null===(t=e.getQuestManager())||void 0===t?void 0:t.getOutstandingQuestTags())||[]}getOutstandingBackstoryTags(){return this.appManager.getCharacterManager().getAllExpectedBackstoryTags()}getOutstandingLocationTags(){return this._locationTagsExpected.filter((e=>!this._locationTagsCollected.some((t=>t.name===e.name))))}getCollectedLocationTags(){return this._locationTagsCollected}getEstablishedFriendlyTags(){const e=Object.values(Na.D).flat().filter((e=>e.friendly));return this.collectedTags.filter((t=>e.includes(t)))}getRandomFriendlyTags(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const a=Object.values(Na.D).flat();if(!t){const t=this.getEstablishedFriendlyTags(),n=a.filter((e=>e.friendly&&!t.includes(e)));return this.getRandomTags(e,n)}const n=a.filter((e=>e.friendly));return this.getRandomTags(e,n)}getPotentialCombatantsTags(){return Object.values(Na.D).flat().filter((e=>e.enemy||e.friendly))}getEstablishedCombatantTags(){const e=Object.values(Na.D).flat().filter((e=>e.enemy||e.friendly));return this.collectedTags.filter((t=>e.includes(t)))}getRandomMagicItemTag(e){const t=[...this.magicItemRumors];for(;t.length<e+2;){const e={name:this.appManager.getCharacterManager().getRandomGear().name,type:r.Mf.GEAR};t.push(e)}return this.getRandomTags(e,t)}get locationTagsCollected(){return this._locationTagsCollected}initializeNewCampaign(e){this.locationTagsCollected=[],this.encounterTagsCollected={},this.magicItemRumors=[],this.collectedTags=[],this.cashedInCollections=[],this.encounterTagsExpected={},e&&e.encounters.forEach((e=>{this.encounterTagsExpected[e.name]=e.tags||[],this.encounterTagsCollected[e.name]=[]}))}initializeNewEncounter(e){this.locationTagsCollected=[],this.locationTagsExpected=e.location.tags||[]}constructor(e,t,a,n){this.campaignManager=void 0,this.playerManager=void 0,this.chatManager=void 0,this.appManager=void 0,this._locationTagsCollected=[],this._locationTagsExpected=[],this._encounterTagsCollected={},this._encounterTagsExpected={},this._magicItemRumors=[],this._collectedTags=[],this._cashedInCollections=[],this.getFormattedSource=(e,t)=>{let a=t;return this.magicItemRumors.includes(e)?a=r.UW.MAGIC_ITEM:e.type===r.Mf.GEAR?a=r.UW.MAGIC_ITEM_EXPECTED:this.getOutstandingBackstoryTags().includes(e)?a=r.UW.BACKSTORY:this.locationTagsExpected.includes(e)?a=r.UW.LOCATION:this.isCurrentEncounterTag(e.name)?a=r.UW.ENCOUNTER:this.isUpcomingEncounterTag(e.name)&&(a=r.UW.FORESHADOWING),a},this.playerManager=t,this.chatManager=a,this.campaignManager=e,this.appManager=n}setChatManager(e){this.chatManager=e}getTooltipText(e){let t="";if(e.tag){if(this.campaignManager.getCampaignTooltipForTag(e.tag))return this.campaignManager.getCampaignTooltipForTag(e.tag);const a=e.tag,n=this.playerManager.getPartyAttitudeForTag(a.tag);switch(a.source){case r.UW.LOCATION:switch(Math.floor(2*Math.random())){case 0:t=`The players interact with ${a.tag.name}`;break;case 1:t=`You describe some nearby ${a.tag.name}`}break;case r.UW.MAGIC_ITEM_EXPECTED:t="Hint about a magic item: "+a.tag.name;break;case r.UW.FORESHADOWING:t=n===r.zo.LIKE?`Some players will be happy to know that ${a.tag.name} seems to be part of an upcoming encounter`:n===r.zo.HATE?`Much to one player's annoyaince - you imply that ${a.tag.name} will be expected in an upcoming encounter`:`You foreshadow ${a.tag.name} for an upcoming encounter`;break;case r.UW.FORESHADOWING_RANDOM:t=n===r.zo.LIKE?`The players like ${a.tag.name}...add it on a whim to an upcoming encounter`:n===r.zo.HATE?`${a.tag.name} will feature in an upcoming encounter - even though some players hate ${a.tag.name}!`:`Ad-lib ${a.tag.name} into an upcoming encounter`;break;case r.UW.RUMOR:t=this.campaignManager.getExpectedEncounterTags().includes(a.tag)?`You reinforce the importance of ${a.tag.name}.`:`You confirm the players' questions about ${a.tag.name}`;break;case r.UW.PLAYERS:t=`The players have feelings about ${a.tag.name}`;break;case r.UW.QUESTS:t=`While questing, the players learn about ${a.tag.name}`;break;case r.UW.ALL:t=`For no specific reason, the players discuss ${a.tag.name}`;break;case r.UW.MAGIC_ITEM:t=this.magicItemRumors.includes(a.tag)?`You award the players the ${a.tag.name} they have been looking for!`:`You tell the players about a magic item: ${a.tag.name}`;break;case r.UW.BACKSTORY:t=`The ${a.tag.name} is integral to a character's backstory!`;break;case r.UW.PLOT:t=`${a.tag.name} will be important to the story`;break;case r.UW.ENEMY:t=`Introduce some ${a.tag.name} as a new enemy for this campaign.`;break;case r.UW.TREASURE:t="The players discover valuable treasure!";break;case r.UW.NONE:t=(null===a||void 0===a?void 0:a.tag.name)+" comes up for no specific reason.";break;case r.UW.ENCOUNTER:t=(null===a||void 0===a?void 0:a.tag.name)+" is a very important topic. Maxim should have Authored a tooltip for this! BAD MAXIM",t="LAUNCH ENCOUNTER SCENE:"+t;break;case r.UW.QUEST:t="Revealing or discussing this will progress a quest";break;case r.UW.QUEST_TERMINAL:t="Revealing or discussing this will complete a quest";break;default:t=""}return t+=this.chatManager.getThemePostFix(a),t}return e.character?(t=`Spend some time focusing on ${e.character.name}`,t):"treasure"===e.type?(t="TREASURE: award the players a bit of treasure...",t):"dmpoint"===e.type?(t="DM POINT: You have a great idea which will inform future decisions and make you an overall better dm",t):void 0}tagToEncounterFlavorTag(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.UW.ALL,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.Co.NONE;return{tag:e,source:t,theme:a}}collectTag(e){const t=("tag"in e?e:this.tagToEncounterFlavorTag(e)).tag;this.collectedTags.some((e=>e.name===t.name))||this.collectedTags.push(t)}getCollectedTags(){return this.collectedTags}isCurrentEncounterTag(e){const t=this.campaignManager.getCurrentEncounter();return!!t&&this.encounterTagsExpected[t.name].some((t=>t.name===e))}getCollectedEncounterTags(){const e=this.campaignManager.getCurrentEncounter();return e&&this.encounterTagsCollected[e.name]||[]}getOutstandingEncounterTags(){const e=this.campaignManager.getCurrentEncounter();if(!e)return[];return(this.encounterTagsExpected[e.name]||[]).filter((t=>{var a;return!(null!==(a=this.encounterTagsCollected[e.name])&&void 0!==a&&a.some((e=>e.name===t.name)))}))}getUpcomingEncounterTags(){const e=this.campaignManager.getCurrentEncounter();if(!e)return[];return(e.branches||[]).flatMap((e=>this.encounterTagsExpected[e.name]||[]))}isUpcomingEncounterTag(e){const t=this.campaignManager.getCurrentEncounter(),a=null===t||void 0===t?void 0:t.branches;return!(!a||0===a.length)&&a.some((t=>this.encounterTagsExpected[t.name].some((t=>t.name===e))))}showNextEncounterModal(){this.triggerNextEncounterModal()}couldAssignRandomTagToBranch(e){return 4>this.encounterTagsExpected[e.name].length}couldAssignRandomTag(e){if(!e)return!1;const t=e.branches||[];let a=!1;return t.forEach((e=>{this.couldAssignRandomTagToBranch(e)&&(a=!0)})),a}tagToFlavorTag(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.Co.NONE;return{tag:e,source:this.getFormattedSource(e,r.UW.ALL),theme:t}}convertRpTagToFlavorTag(e){return"treasure"===e.type?{tag:{name:"Treasure"},source:r.UW.TREASURE,theme:r.Co.NONE}:"dmpoint"===e.type?{tag:{name:"DM Point"},source:r.UW.DM_POINT,theme:r.Co.NONE}:"character"===e.type?{tag:{name:e.character.name},source:r.UW.PLAYERS,theme:r.Co.NONE}:e.tag}generateRelevantFlavorTags(e,t){var a,n;const s=this.campaignManager.getCurrentEncounter();if(!s)return[];const i=this.getOutstandingLocationTags(),o=this.encounterTagsExpected[s.name]||[],l=this.getUpcomingEncounterTags(),c=this.magicItemRumors,d=this.getOutstandingBackstoryTags(),u=this.playerManager.getAllPlayerPreferences(),h=(null===(a=this.appManager)||void 0===a||null===(n=a.getQuestManager())||void 0===n?void 0:n.getCurrentQuestTags())||[];let m=[];const g=i.map((e=>({tag:e,source:this.getFormattedSource(e,r.UW.LOCATION),theme:this.getTheme()})));m=[...m,...i];const p=o.map((e=>({tag:e,source:this.getFormattedSource(e,r.UW.ENCOUNTER),theme:r.Co.NONE})));if(p.length>0){const e=p[Math.floor(Math.random()*p.length)];m.push(e)}const f=l.map((e=>({tag:e,source:this.getFormattedSource(e,r.UW.FORESHADOWING),theme:this.getTheme()})));m=[...m,...l];const v=c.map((e=>({tag:e,source:this.getFormattedSource(e,r.UW.MAGIC_ITEM),theme:this.getTheme()})));m=[...m,...c];const y=d.map((e=>({tag:e,source:this.getFormattedSource(e,r.UW.BACKSTORY),theme:this.getTheme()})));m=[...m,...d];const b=(e,a)=>this.getRandomTags(e,this.getAllAllTags(),a).map((e=>t&&!t.includes(r.UW.FORESHADOWING_RANDOM)&&this.couldAssignRandomTag(this.campaignManager.getCurrentEncounter())&&Math.random()<.25?{tag:e,source:this.getFormattedSource(e,r.UW.FORESHADOWING_RANDOM),theme:this.getTheme()}:{tag:e,source:this.getFormattedSource(e,r.UW.ALL),theme:this.getTheme()})),E=this.getRandomTags(4,u,m),x=b(4,m),N=E.map((e=>({tag:e,source:this.getFormattedSource(e,r.UW.ALL),theme:this.getTheme()})));let T=[...g,...p,...f,...v,...y,...h,...N,...x];T=T.filter((e=>!1===this.collectedTags.includes(e.tag))),t&&(T=T.filter((e=>!t.includes(e.source))));const C=T.sort((()=>Math.random()-.5)).slice(0,e);if(C.length<e){const a=e-C.length;let n=b(2*a,T.map((e=>e.tag))).filter((e=>!1===this.collectedTags.includes(e.tag)));t&&(n=n.filter((e=>!t.includes(e.source)))),C.push(...n.slice(0,a))}return C}getRandomTags(e,t,a){if(Array.isArray(e)&&(e=Math.floor(Math.random()*e[1]+e[0])),e<=0)return[];if(a){const e=a.map((e=>e.name));t=t.filter((t=>!e.includes(t.name)))}return t.sort((()=>Math.random()-.5)).slice(0,e)}getAllAllTags(){return Object.values(Na.D).flat()}getTheme(){if(0!==Math.floor(6*Math.random()))return r.Co.NONE;const e=this.campaignManager.getUnlockedTones();if(0===e.length)return r.Co.NONE;return e[Math.floor(Math.random()*e.length)]}triggerSetSceneModal(){const e=this.campaignManager.getCurrentEncounter();if(!e)return;this.appManager.getUiManager().showModal({title:"Location Described",type:"setscene",options:[{id:"ok",title:"Continue",description:"Proceed with the encounter",callback:()=>{this.campaignManager.setCurrentEncounterSceneComplete()}}],sceneData:{location:e.location,encounter:e}})}triggerEncounterTagModal(e){const t=this.campaignManager.getCurrentEncounter();if(!t)return;const a=this.campaignManager.getEncounterChatTrigger(e);if(a){const e=this.appManager.getChatManager();Array.isArray(a)||"string"===typeof a?e.fireNewChatMessage(a,{speed:"fast"}):a.message&&e.fireNewChatMessage({message:a.message,speaker:a.speaker||{type:r.wb.DM,id:0}},{speed:"fast"})}this.appManager.getUiManager().showModal({title:`Tag Discovered: ${e.name}`,type:"encountertag",options:[{id:"ok",title:"Continue",description:"Proceed with the encounter",callback:()=>{}}],tagData:{tag:e,chatTrigger:a,encounter:t}})}triggerNextEncounterModal(){const e=this.campaignManager.getCurrentEncounter();if(!e||!e.branches||0===e.branches.length)return;const t=this.playerManager.getPlayers(),a=e.branches,n=this.calculateBranchPreferences(a,t);this.appManager.getUiManager().showModal({title:"Choose Next Encounter",type:"nextencounter",options:a.map((e=>({id:e.name,title:e.name,description:e.description,callback:()=>{this.handleNextEncounterSelection(e)}}))),encounterData:{branches:a,branchPreferences:n,currentEncounter:e}})}calculateBranchPreferences(e,t){const a={};return e.forEach((e=>{a[e.name]=[];const n=this.encounterTagsExpected[e.name]||[],s=this.encounterTagsCollected[e.name]||[];t.forEach((t=>{this.calculatePlayerBranchScore(t,n,s)>0&&a[e.name].push(t)}))})),t.forEach((t=>{if(!Object.values(a).some((e=>e.includes(t)))){const n=e[Math.floor(Math.random()*e.length)];a[n.name].push(t)}})),a}calculatePlayerBranchScore(e,t,a){let n=0;const s=a.length;if(s>=3)n+=4;else{if(!(s>=1))return 0;n+=2}return t.forEach((t=>{const a=e.preferences.find((e=>e[0].name===t.name));a&&(n+=a[1])})),Math.max(0,n)}handleNextEncounterSelection(e){const t=this.campaignManager.getCurrentEncounter(),a=(null===t||void 0===t?void 0:t.branches)||[];this.appManager.getPartyManager().handleNextEncounterSelection(e,a,this)}get cashedInCollections(){return this._cashedInCollections}set cashedInCollections(e){this._cashedInCollections=e}cashInCollection(e){this._cashedInCollections.includes(e)||(this.chatManager.triggerCollectionCompleteChat(e),this._cashedInCollections.push(e))}isCollectionCashedIn(e){return this._cashedInCollections.includes(e)}getAvailableCollectionRewards(){const{TAG_COLLECTIONS:e}=a(7382);return e.filter((e=>e.tags.every((e=>this._collectedTags.some((t=>t.name===e.name)))))).filter((e=>!this.isCollectionCashedIn(e.name))).length}},Ur={id:"ricky",name:"Tricky Rose",description:"A fast-talking merchant with a dirty velvet coat has a job for you...",icon:"rickyrose",cost:[{type:"exhaustion",amount:5}],rewards:[{type:"score",amount:5},{type:"treasure",amount:2}],playerChoices:[{name:"Claim the Reward",description:"Deliver Ricky's Cargo and Get the Reward",conversation:[{message:"You deliver the cargo to Ricky and he pays you handsomely.",speaker:{type:r.wb.DM,id:0}}]}],startingNode:{tag:{name:"Ricky Rose"},conversation:[{message:"Ricky Rose is a fast-talking merchant with a dirty velvet coat. He has a job for you that involves some risk, but the rewards could be worth it. Are you interested in hearing more?",speaker:{type:r.wb.DM,id:0}}],children:[{tag:{name:"Mark's Menagerie"},conversation:[{message:"Mark's Menagerie blah blah",speaker:{type:r.wb.DM,id:1}}],children:[{tag:{name:"Cargo"},conversation:[{message:"You smuggle some crazy cargo for ricky.",speaker:{type:r.wb.DM,id:1}}],children:[]}]}]}},_r={id:"rockpepper",name:"Rock Pepper Scissors",description:"The Spicer's guild will reward anyone who can find who is stealing rock pepper.",icon:"theface",cost:[{type:"exhaustion",amount:15}],rewards:[{type:"score",amount:10}],startingNode:{tag:{name:"Shadowy Figure"},conversation:[{message:"A shadowy figure approaches",speaker:{type:r.wb.DM,id:0}},{message:"I ATTACK!",speaker:{type:r.wb.CHARACTER,id:0}},{message:"'Hold on there, I am not your enemy!' The figure pulls back it's hood to reveal a wide moustache, the signature look for a member of the spicers guild. He goes on to explain that soeone has been stealing rock pepper from the guild and they will offer a reward to anyone who can find out who is behind it.",speaker:{type:r.wb.DM,id:0}},{message:"I ACCEPT!",speaker:{type:r.wb.CHARACTER,id:0}}],children:[{tag:{name:"Pepper Pots"},conversation:[{message:"A discarded pot is found in a dark corner.",speaker:{type:r.wb.DM,id:1}},{message:"I peer inside.",speaker:{type:r.wb.CHARACTER,id:2}},{message:"inside is a discarded hankerchief with the intials 'R.R.' and a pair of small, specialized scissors.",speaker:{type:r.wb.DM,id:1}},{message:"I'm going to smell the hankerchief and lick the scissors.",speaker:{type:r.wb.CHARACTER,id:2}},{message:"...",speaker:{type:r.wb.PLAYER,id:0}},{message:"The hankerchief smells like clove-scented cologne and the scissors have a faint peppery flavor which immediately becomes very spicy!",speaker:{type:r.wb.DM,id:0}}],children:[{tag:{name:"Spicy Meet"},conversation:[{message:"The Spicer's guild member approaches again and asks if you have found any information.",speaker:{type:r.wb.DM,id:1}}],children:[]}]}]}};class Br extends ln.EventEmitter{constructor(){super(...arguments),this.activeQuests=new Map,this.availableQuests=[Ur,_r]}getAvailableQuests(){return this.availableQuests.filter((e=>!this.activeQuests.has(e.id)))}getActiveQuests(){return Array.from(this.activeQuests.values())}launchQuest(e){const t=this.availableQuests.find((t=>t.id===e));return!(!t||this.activeQuests.has(e))&&(this.activeQuests.set(e,{quest:t,currentNode:t.startingNode,completedTags:[]}),this.emit("questLaunched",t),!0)}isQuestActive(e){return this.activeQuests.has(e)}getCurrentQuestTags(){const e=[];for(const t of this.activeQuests.values())for(const a of t.currentNode.children){const t=0===a.children.length;e.push({tag:a.tag,source:t?r.UW.QUEST_TERMINAL:r.UW.QUEST,theme:"none"})}return e}getOutstandingQuestTags(){const e=[];for(const t of this.activeQuests.values())for(const a of t.currentNode.children)t.completedTags.includes(a.tag.name)||e.push(a.tag);return e}getExhaustionForQuest(e){const t=this.getQuestById(e);if(!t)return 0;let a=0;return t.cost.forEach((e=>{"exhaustion"===e.type&&(a+=e.amount)})),a}getQuestById(e){const t=this.activeQuests.get(e);return t?t.quest:this.availableQuests.find((t=>t.id===e))||null}advanceQuest(e,t){const a=this.activeQuests.get(e);if(!a)return null;if(!this.findNodeByTag(a.quest.startingNode,t))return null;a.completedTags.includes(t)||a.completedTags.push(t);const n=a.currentNode.children.find((e=>e.tag.name===t));return n?(a.currentNode=n,0===n.children.length?this.emit("questTerminalReached",{quest:a.quest,node:n}):this.emit("questAdvanced",{quest:a.quest,node:n}),n):a.currentNode.tag.name===t?(this.emit("questAdvanced",{quest:a.quest,node:a.currentNode}),a.currentNode):(console.warn(`Quest ${e}: Tag "${t}" doesn't match current quest progression from node "${a.currentNode.tag.name}"`),null)}getQuestForTag(e){for(const t of this.activeQuests.values()){const a=this.findNodeByTag(t.quest.startingNode,e);if(a)return{quest:t.quest,node:a}}for(const t of this.availableQuests){const a=this.findNodeByTag(t.startingNode,e);if(a)return{quest:t,node:a}}return null}findNodeByTag(e,t){if(e.tag.name===t)return e;for(const a of e.children){const e=this.findNodeByTag(a,t);if(e)return e}return null}generatePlayerPreferences(e,t){const a=[],n=[r.zo.LIKE,r.zo.HATE,r.zo.NEUTRAL];for(let s=0;s<e;s++)for(const e of t){const t=n[Math.floor(3*Math.random())];a.push({playerId:e.id,optionIndex:s,attitude:t})}return a}completeQuest(e){if(this.activeQuests.has(e)){const t=this.activeQuests.get(e);this.activeQuests.delete(e),this.emit("questCompleted",t.quest)}}isQuestComplete(e){const t=this.activeQuests.get(e);return!!t&&0===t.currentNode.children.length}getNextQuestNode(e){const t=this.activeQuests.get(e);return t&&0!==t.currentNode.children.length?t.currentNode.children[0]:null}activateQuest(e){return this.launchQuest(e)}getCollectedTagsForQuest(e){const t=this.activeQuests.get(e);if(!t)return[];const a=[],n=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;if(!s.has(e.tag.name)){s.add(e.tag.name),t.completedTags.includes(e.tag.name)&&a.push(e.tag);for(const t of e.children)n(t,s)}};return n(t.quest.startingNode),a}}const Fr=Br;class Hr extends ln.EventEmitter{constructor(){super(),this._state=Lt.MAIN_MENU,this.lastTime=0,this.campaignManager=void 0,this.playerManager=void 0,this.sessionManager=void 0,this.dataManager=void 0,this.partyManager=void 0,this.uiManager=void 0,this.characterManager=void 0,this.tutorialManager=void 0,this.chatManager=void 0,this.chatEventManager=void 0,this.combatManager=void 0,this.townManager=void 0,this.tagManager=void 0,this.questManager=void 0,this.playerManager=new gr(this),this.campaignManager=new or(this),this.characterManager=new xr(this),this.sessionManager=new pr,this.dataManager=new Er(this),this.partyManager=new vr(this),this.uiManager=new br(this),this.tutorialManager=new Cr(this),this.combatManager=new mn(this),this.tagManager=new Dr(this.campaignManager,this.playerManager,void 0,this),this.chatManager=new Ir(this),this.chatEventManager=new Lr(this),this.questManager=new Fr,this.tagManager.setChatManager(this.chatManager),this.townManager=new Pr(this),this.init()}init(){this.state=Lt.MAIN_MENU,this.playerManager.init(),this.characterManager.init(),this.startGameLoop(),this.initiateQuickStartSetup(),this.state=Lt.SESSION_OVERVIEW}initiateQuickStartSetup(){this.playerManager.initiateQuickStart(),this.characterManager.initiateQuickStart(),this.campaignManager.initiateQuickStart(),this.chatManager.startSessionEvent(),setTimeout((()=>{this.uiManager.showWelcomeModal(),this.chatManager.startWelcomeConversation()}),1e3)}startGameLoop(){const e=t=>{const a=t-this.lastTime;this.lastTime=t,this.update(a),requestAnimationFrame(e)};requestAnimationFrame(e)}update(e){var t;null===(t=this.uiManager)||void 0===t||t.update(e)}get state(){return this._state}set state(e){switch(console.log("Changing state from",this._state,"to",e),this._state){case Lt.PLAYER_RECRUITMENT:this.playerManager.acceptSelectedPlayers();break;case Lt.MAIN_MENU:case Lt.CHARACTER_CREATION:case Lt.CAMPAIGN_SETUP:console.log("Changing state from ",this._state)}switch(e){case Lt.MAIN_MENU:break;case Lt.PLAYER_RECRUITMENT:this.tutorialManager.startTutorial("PLAYER_RECRUITMENT");break;case Lt.CHARACTER_CREATION:this.tutorialManager.startTutorial("CHARACTER_CREATION");break;case Lt.CAMPAIGN_SETUP:this.tutorialManager.startTutorial("CAMPAIGN_SETUP");break;case Lt.SESSION_OVERVIEW:this.campaignManager.setSessionState(r.$t.LOCATION_INTRO);break;case Lt.SESSION:this.campaignManager.setSessionState(r.$t.INTRO_EVENTS)}this._state=e,this.emit("stateChange")}advanceState(){var e;this.state=(null===(e=this.dataManager)||void 0===e?void 0:e.getStateProps().nextState)||Lt.MAIN_MENU}getUiManager(){return this.uiManager}getDataManager(){return this.dataManager}getPlayerManager(){return this.playerManager}getCharacterManager(){return this.characterManager}getSessionManager(){return this.sessionManager}getPartyManager(){return this.partyManager}getTagManager(){return this.tagManager}getCombatManager(){return this.combatManager}getCampaignManager(){return this.campaignManager}getTutorialManager(){return this.tutorialManager}getChatManager(){return this.chatManager}getChatEventManager(){return this.chatEventManager}getTownManager(){return this.townManager}getQuestManager(){return this.questManager}}const Gr=new Hr,Wr=Gr.getDataManager(),zr=Gr.getCampaignManager(),Qr=Gr.getSessionManager(),Vr=Gr.getPartyManager(),Yr=Gr.getUiManager(),Kr=Gr.getCharacterManager(),qr=Gr.getPlayerManager();s.createRoot(document.getElementById("root")).render((0,Xe.jsx)(n.StrictMode,{children:(0,Xe.jsx)(Et,{manager:Kr,children:(0,Xe.jsx)(xt,{manager:qr,children:(0,Xe.jsx)(Nt,{manager:Gr,children:(0,Xe.jsx)(Tt,{manager:Wr,children:(0,Xe.jsx)(Ct,{manager:zr,children:(0,Xe.jsx)(At,{manager:Qr,children:(0,Xe.jsx)(St,{manager:Vr,children:(0,Xe.jsx)(Mt,{manager:Yr,children:(0,Xe.jsx)(ar,{})})})})})})})})})}))})();
//# sourceMappingURL=main.6b3f5ede.js.map